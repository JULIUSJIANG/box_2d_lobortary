window.__require=function t(e,i,o){function n(s,a){if(!i[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return n(e[s][1][t]||t)},u,u.exports,t,e,i,o)}return i[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<o.length;s++)n(o[s]);return n}({AddCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"4173cBwsD5Clb4bNLJzKnlV","AddCtrl");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){var e=t.call(this)||this;return e._val=0,e.evntChanged.On(function(){e._val=0,e.appRec.forEach(function(t){e._val+=t})}),e}return n(e,t),Object.defineProperty(e.prototype,"val",{get:function(){return this._val},enumerable:!1,configurable:!0}),e}(t("./ApplyCtrl").default);i.default=r,cc._RF.pop()},{"./ApplyCtrl":"ApplyCtrl"}],ApplyCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"820e9WMHgdDPo2fuii8riX3","ApplyCtrl"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../frame/basic/IdGeneration"),n=t("./EventerNoArgs"),r=t("./EventerWithArgs"),s=function(){function t(){this.appRec=new Map,this._idGen=new o.default,this.evntChanged=new n.default,this.evntApped=new r.default,this.evetCanceled=new r.default}return t.prototype.Apply=function(t){var e=this._idGen.GenId();return this.appRec.set(e,t),this.evntApped.Call(e),this.evntChanged.Call(),e},t.prototype.Cancel=function(t){this.appRec.has(t)&&(this.appRec.delete(t),this.evetCanceled.Call(t),this.evntChanged.Call())},t}();i.default=s,cc._RF.pop()},{"../../frame/basic/IdGeneration":"IdGeneration","./EventerNoArgs":"EventerNoArgs","./EventerWithArgs":"EventerWithArgs"}],ArgsPromiseCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"c6a67qGPVJIb5Hj+c4spyET","ArgsPromiseCtrl"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){var t=this;this.promise=null,this._resolve=null,this._reject=null,this.promise=new Promise(function(e,i){t._resolve=e,t._reject=i})}return t.prototype.resolve=function(t){this._resolve(t)},t.prototype.reject=function(t){this._reject(t)},t}();i.default=o,cc._RF.pop()},{}],B2ControllerExtend:[function(t,e,i){"use strict";cc._RF.push(e,"988d2b0taJNSqJxicPILY3f","B2ControllerExtend"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../../regist_define/RegistDefine"),r=t("./B2ControllerRD"),s=t("./B2ControllerRS");(function(t){t.rd=new n.default(r.default,s.default,function(t){return t.type}),t.DrawController=function(e,i){if(null!=e){var o=t.rd.GetRegMsg(e.constructor);o&&o.drawer(e,i)}}})(o||(o={})),window.b2ControllerExtend=o,i.default=o,cc._RF.pop()},{"../../regist_define/RegistDefine":"RegistDefine","./B2ControllerRD":"B2ControllerRD","./B2ControllerRS":"B2ControllerRS"}],B2ControllerRD:[function(t,e,i){"use strict";cc._RF.push(e,"d30fbLUabNMIY5WZUmlqGTU","B2ControllerRD"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../../box2d_ts/Box2D"),r=t("../B2EleSetting"),s=t("./B2ControllerRS");(function(t){t.buoyancy=new s.default({type:n.b2BuoyancyController,drawer:function(t,e){var i=r.default.farLen,o=t.normal.Clone();o.Normalize();var s=new n.b2Vec2,a=new n.b2Vec2;s.x=o.x*t.offset+o.y*i,s.y=o.y*t.offset-o.x*i,a.x=o.x*t.offset-o.y*i,a.y=o.y*t.offset+o.x*i,e.StraightLine(s.x,s.y,a.x,a.y,e.Pixel(r.default.lineWidth),r.default.color.controller.b2BuoyancyController)}})})(o||(o={})),i.default=o,cc._RF.pop()},{"../../box2d_ts/Box2D":"Box2D","../B2EleSetting":"B2EleSetting","./B2ControllerRS":"B2ControllerRS"}],B2ControllerRS:[function(t,e,i){"use strict";cc._RF.push(e,"419d1InPypIzoQ5Hj0kWphx","B2ControllerRS");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(t("../../regist_define/RDClass").default);i.default=r,cc._RF.pop()},{"../../regist_define/RDClass":"RDClass"}],B2Drawer:[function(t,e,i){"use strict";var o;cc._RF.push(e,"1372f7s6ZdFaZBicqqL+6Wc","B2Drawer"),Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.Draw=function(){}}(o||(o={})),i.default=o,cc._RF.pop()},{}],B2EleDotRadius:[function(t,e){"use strict";cc._RF.push(e,"a2c99McqHdNIK8Y2yC9U6Tp","B2EleDotRadius"),cc._RF.pop()},{}],B2EleSetting:[function(t,e,i){"use strict";cc._RF.push(e,"d68fdJx53pE3KA515knK+6Y","B2EleSetting"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../box2d_ts/Box2D");(function(t){t.lineWidth=2,t.dotRadius=3,t.farLen=100,t.color={shape:{outline:new cc.Color(100,255,100,255),body:new cc.Color(100,255,100,100)},aabb:new cc.Color(0,0,255,255),joint:{areaBegin:new cc.Color(150,150,150,255),areaEnd:new cc.Color(75,75,75,255),dot:new cc.Color(255,255,255,255)},transform:{xColor:new cc.Color(255,0,0,255),yColor:new cc.Color(0,255,0,255)},contactPoint:{dot:new cc.Color(255,255,100,255)},particle:{fill:new cc.Color(100,100,255,100),stroke:new cc.Color(100,100,255,255)},controller:{b2BuoyancyController:new cc.Color(255,100,100,100)}},t.transformLen=1,t.posO=new n.b2Vec2(0,0),t.xAxis=new n.b2Vec2(t.transformLen,0),t.yAxis=new n.b2Vec2(0,t.transformLen)})(o||(o={})),i.default=o,cc._RF.pop()},{"../box2d_ts/Box2D":"Box2D"}],B2ElementExtend:[function(t,e,i){"use strict";cc._RF.push(e,"80057zzzi1AWpI44u+Po5Gk","B2ElementExtend"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../../regist_define/RegistDefine"),r=t("./B2ElementRD"),s=t("./B2ElementRS");r.default,function(t){t.rd=new n.default(r.default,s.default,function(t){return t.drawAbleTag}),t.DrawWorld=function(t,e,i){s.default.eleDrawFuncList.forEach(function(o){o(t,e,i)})}}(o||(o={})),window.b2ElementExtend=o,i.default=o,cc._RF.pop()},{"../../regist_define/RegistDefine":"RegistDefine","./B2ElementRD":"B2ElementRD","./B2ElementRS":"B2ElementRS"}],B2ElementRD:[function(t,e,i){"use strict";cc._RF.push(e,"f1841rj7clIuLM61uUFBLM+","B2ElementRD"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../../box2d_ts/Box2D"),r=t("../B2EleSetting"),s=t("../b2_controller/B2ControllerExtend"),a=t("../b2_joint/B2JointExtend"),c=t("../b2_shape/B2ShapeExtend"),l=t("./B2ElementRS");(function(t){t.joint=new l.default({drawAbleTag:Math.pow(2,0),arrayGetter:function(t){for(var e=[],i=t.GetJointList();i;i=i.GetNext())e.push(i);return e},tDrawer:function(t,e){a.default.DrawB2Joint(t,e)}}),t.bodyTransform=new l.default({drawAbleTag:Math.pow(2,1),arrayGetter:function(t){for(var e=[],i=t.GetBodyList();i;i=i.GetNext())e.push(i);return e},tDrawer:function(t,e){var i=t.GetWorldPoint(r.default.xAxis,new n.b2Vec2),o=t.GetWorldPoint(r.default.yAxis,new n.b2Vec2),s=t.GetWorldPoint(r.default.posO,new n.b2Vec2);e.StraightLine(s.x,s.y,i.x,i.y,e.Pixel(r.default.lineWidth),r.default.color.transform.xColor),e.StraightLine(s.x,s.y,o.x,o.y,e.Pixel(r.default.lineWidth),r.default.color.transform.yColor)}}),t.aabb=new l.default({drawAbleTag:Math.pow(2,2),arrayGetter:function(t){for(var e=[],i=t.GetBodyList();i;i=i.GetNext())for(var o=i.GetFixtureList();o;o=o.GetNext())for(var n=0;n<o.m_proxyCount;n++){var r=o.m_proxies[n];e.push(r.treeNode.aabb)}return e},tDrawer:function(t,e){e.CyclePosSetAll([new n.b2Vec2(t.lowerBound.x,t.lowerBound.y),new n.b2Vec2(t.upperBound.x,t.lowerBound.y),new n.b2Vec2(t.upperBound.x,t.upperBound.y),new n.b2Vec2(t.lowerBound.x,t.upperBound.y)],e.Pixel(r.default.lineWidth),r.default.color.aabb)}});var e=function(){};t.ShapeRecord=e,t.shape=new l.default({drawAbleTag:Math.pow(2,3),arrayGetter:function(t){for(var i=[],o=t.GetBodyList();o;o=o.GetNext())for(var n=o.GetFixtureList();n;n=n.GetNext()){var r=new e;r.shape=n.GetShape(),r.body=o,i.push(r)}return i},tDrawer:function(t,e){c.default.DrawShape(t.shape,t.body,e)}}),t.particle=new l.default({drawAbleTag:Math.pow(2,4),arrayGetter:function(t){for(var e=[],i=t.GetParticleSystemList();i;i=i.GetNext())e.push(i);return e},tDrawer:function(t,e){for(var i=t.GetRadius(),o=t.GetParticleCount(),n=t.GetPositionBuffer(),s=0;s<o;s++){var a=n[s];e.RoundFill(a.x,a.y,i,r.default.color.particle.fill),e.RoundLine(a.x,a.y,i,e.Pixel(r.default.lineWidth),r.default.color.particle.fill)}}}),t.controller=new l.default({drawAbleTag:Math.pow(2,5),arrayGetter:function(t){for(var e=[],i=t.m_controllerList;i;i=i.GetNext())e.push(i);return e},tDrawer:function(t,e){s.default.DrawController(t,e)}}),t.contact=new l.default({drawAbleTag:Math.pow(2,6),arrayGetter:function(t){for(var e=[],i=new n.b2WorldManifold,o=t.GetContactManager().m_contactList;o;o=o.GetNext())o.GetWorldManifold(i),e.push.apply(e,i.points.map(function(t){return(new n.b2Vec2).Set(t.x,t.y)}));return e},tDrawer:function(t,e){e.RoundFill(t.x,t.y,e.Pixel(r.default.dotRadius),r.default.color.contactPoint.dot)}})})(o||(o={})),i.default=o,cc._RF.pop()},{"../../box2d_ts/Box2D":"Box2D","../B2EleSetting":"B2EleSetting","../b2_controller/B2ControllerExtend":"B2ControllerExtend","../b2_joint/B2JointExtend":"B2JointExtend","../b2_shape/B2ShapeExtend":"B2ShapeExtend","./B2ElementRS":"B2ElementRS"}],B2ElementRS:[function(t,e,i){"use strict";cc._RF.push(e,"21533yeE+BFoINq76kQKYyE","B2ElementRS");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(i){var o=t.call(this,i)||this;return e.eleDrawFuncList.push(function(t,e,o){o&i.drawAbleTag&&i.arrayGetter(t).forEach(function(t){i.tDrawer(t,e)})}),o}return n(e,t),e.eleDrawFuncList=[],e}(t("../../regist_define/RDClass").default);i.default=r,cc._RF.pop()},{"../../regist_define/RDClass":"RDClass"}],B2ExamBuoyancy:[function(t,e,i){"use strict";cc._RF.push(e,"7e093cFGeFPSamjG1f9WLWv","B2ExamBuoyancy"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t=new o.b2World({x:0,y:-10}),e=new n.default(t),i=new o.b2BuoyancyController;i.normal.Set(.7,.7),i.offset=10,i.density=2,i.linearDrag=5,i.angularDrag=2;var r=t.CreateBody(new o.b2BodyDef),s=new o.b2EdgeShape;s.Set(new o.b2Vec2(-40,0),new o.b2Vec2(40,0)),r.CreateFixture(s),s.Set(new o.b2Vec2(-40,0),new o.b2Vec2(-40,25)),r.CreateFixture(s,0),s.Set(new o.b2Vec2(40,0),new o.b2Vec2(40,25)),r.CreateFixture(s,0);for(var a=[],c=0;c<5;c++){var l=new o.b2BodyDef;l.type=o.b2BodyType.b2_dynamicBody,l.position.Set(40*Math.random()-20,15*Math.random()+5),l.angle=Math.random()*Math.PI;var u=t.CreateBody(l),_=new o.b2FixtureDef;_.density=1,_.friction=.3,_.restitution=.1;var m=new o.b2PolygonShape;_.shape=m,m.SetAsBox(.5*Math.random()+1,.5*Math.random()+1),u.CreateFixture(_),a.push(u)}return a.forEach(function(t){i.AddBody(t)}),t.AddController(i),e},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamCantilever:[function(t,e,i){"use strict";cc._RF.push(e,"00b89hnq7ZIzqDyH6hc4ISn","B2ExamCantilever"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e,i,r=new o.b2World({x:0,y:-10}),s=new n.default(r),a=new o.b2BodyDef;t=r.CreateBody(a),(e=new o.b2EdgeShape).Set(new o.b2Vec2(-40,0),new o.b2Vec2(40,0)),t.CreateFixture(e,0),(e=new o.b2PolygonShape).SetAsBox(.5,.125),(i=new o.b2FixtureDef).shape=e,i.density=20;for(var c=new o.b2WeldJointDef,l=t,u=0;u<8;u++){(a=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,a.position.Set(1*u-14.5,5),(m=r.CreateBody(a)).CreateFixture(i);var _=new o.b2Vec2(1*u-15,5);c.Initialize(l,m,_),r.CreateJoint(c),l=m}for((e=new o.b2PolygonShape).SetAsBox(1,.125),(i=new o.b2FixtureDef).shape=e,i.density=20,(c=new o.b2WeldJointDef).frequencyHz=5,c.dampingRatio=.7,l=t,u=0;u<3;u++){var m;(a=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,a.position.Set(2*u-14,15),(m=r.CreateBody(a)).CreateFixture(i),_=new o.b2Vec2(2*u-15,15),c.Initialize(l,m,_),r.CreateJoint(c),l=m}return s},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamCharacterCollision:[function(t,e,i){"use strict";cc._RF.push(e,"dbd9dGPcHJJhbldUdT6IFTm","B2ExamCharacterCollision"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e=new o.b2World({x:0,y:-10}),i=new o.b2BodyDef,r=e.CreateBody(i);(s=new o.b2EdgeShape).Set(new o.b2Vec2(-20,0),new o.b2Vec2(20,0)),r.CreateFixture(s,0),i=new o.b2BodyDef,r=e.CreateBody(i),(s=new o.b2EdgeShape).Set(new o.b2Vec2(-8,1),new o.b2Vec2(-6,1)),r.CreateFixture(s,0),s.Set(new o.b2Vec2(-6,1),new o.b2Vec2(-4,1)),r.CreateFixture(s,0),s.Set(new o.b2Vec2(-4,1),new o.b2Vec2(-2,1)),r.CreateFixture(s,0),(i=new o.b2BodyDef).angle=.25*o.b2_pi,r=e.CreateBody(i),(t=o.b2Vec2.MakeArray(4))[0].Set(5,7),t[1].Set(6,8),t[2].Set(7,8),t[3].Set(8,7),(s=new o.b2ChainShape).CreateChain(t,4),r.CreateFixture(s,0),i=new o.b2BodyDef,r=e.CreateBody(i),(s=new o.b2PolygonShape).SetAsBox(1,1,new o.b2Vec2(4,3),0),r.CreateFixture(s,0),s.SetAsBox(1,1,new o.b2Vec2(6,3),0),r.CreateFixture(s,0),s.SetAsBox(1,1,new o.b2Vec2(8,3),0),r.CreateFixture(s,0),i=new o.b2BodyDef,r=e.CreateBody(i),(t=o.b2Vec2.MakeArray(4))[0].Set(-1,3),t[1].Set(1,3),t[2].Set(1,5),t[3].Set(-1,5),(s=new o.b2ChainShape).CreateChain(t,4),r.CreateFixture(s,0),(i=new o.b2BodyDef).position.Set(-10,4),r=e.CreateBody(i),(t=o.b2Vec2.MakeArray(10))[0].Set(0,0),t[1].Set(6,0),t[2].Set(6,2),t[3].Set(4,1),t[4].Set(2,2),t[5].Set(0,2),t[6].Set(-2,2),t[7].Set(-4,3),t[8].Set(-6,2),t[9].Set(-6,0),(s=new o.b2ChainShape).CreateChain(t,10),r.CreateFixture(s,0),(i=new o.b2BodyDef).position.Set(-3,8),i.type=o.b2BodyType.b2_dynamicBody,i.fixedRotation=!0,i.allowSleep=!1;var s,a,c=e.CreateBody(i);(s=new o.b2PolygonShape).SetAsBox(.5,.5),(a=new o.b2FixtureDef).shape=s,a.density=20,c.CreateFixture(a),(i=new o.b2BodyDef).position.Set(-5,5),i.type=o.b2BodyType.b2_dynamicBody,i.fixedRotation=!0,i.allowSleep=!1,c=e.CreateBody(i),(s=new o.b2PolygonShape).SetAsBox(.25,.25),(a=new o.b2FixtureDef).shape=s,a.density=20,c.CreateFixture(a),(i=new o.b2BodyDef).position.Set(-5,8),i.type=o.b2BodyType.b2_dynamicBody,i.fixedRotation=!0,i.allowSleep=!1,c=e.CreateBody(i);for(var l=0,u=o.b2_pi/3,_=o.b2Vec2.MakeArray(6),m=0;m<6;m++)_[m].Set(.5*o.b2Cos(l),.5*o.b2Sin(l)),l+=u;return(s=new o.b2PolygonShape).Set(_,6),(a=new o.b2FixtureDef).shape=s,a.density=20,c.CreateFixture(a),(i=new o.b2BodyDef).position.Set(3,5),i.type=o.b2BodyType.b2_dynamicBody,i.fixedRotation=!0,i.allowSleep=!1,c=e.CreateBody(i),(s=new o.b2CircleShape).m_radius=.5,(a=new o.b2FixtureDef).shape=s,a.density=20,c.CreateFixture(a),(i=new o.b2BodyDef).position.Set(-7,6),i.type=o.b2BodyType.b2_dynamicBody,i.allowSleep=!1,(s=new o.b2CircleShape).m_radius=.25,(a=new o.b2FixtureDef).shape=s,a.density=20,a.friction=1,new n.default(e)},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamConveyorBelt:[function(t,e,i){"use strict";cc._RF.push(e,"439a10RYx9MYoyZQ0UUD9ks","B2ExamConveyorBelt"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e=new o.b2World({x:0,y:-10}),i=new o.b2BodyDef,r=e.CreateBody(i);(l=new o.b2EdgeShape).Set(new o.b2Vec2(-20,0),new o.b2Vec2(20,0)),r.CreateFixture(l,0),(i=new o.b2BodyDef).position.Set(-5,5);var s=e.CreateBody(i);(l=new o.b2PolygonShape).SetAsBox(10,.5);var a=new o.b2FixtureDef;a.shape=l,a.friction=.8,t=s.CreateFixture(a);for(var c=0;c<5;c++){var l;(i=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,i.position.Set(2*c-10,7),s=e.CreateBody(i),(l=new o.b2PolygonShape).SetAsBox(.5,.5),s.CreateFixture(l,20)}return e.SetContactListener({BeginContact:function(){},EndContact:function(){},BeginContactFixtureParticle:function(){},EndContactFixtureParticle:function(){},BeginContactParticleParticle:function(){},EndContactParticleParticle:function(){},PreSolve:function(e){var i=e.GetFixtureA(),o=e.GetFixtureB();i==t&&e.SetTangentSpeed(5),o==t&&e.SetTangentSpeed(-5)},PostSolve:function(){}}),new n.default(e)},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamEdgeShapes:[function(t,e,i){"use strict";cc._RF.push(e,"f17e9w6uAxLF7S02oJvp4cT","B2ExamEdgeShapes");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../../lib/box2d_ts/Box2D"),s=t("../../component/Box2DDrawer"),a=t("../../ConfigCenter"),c=t("../ExamContext");i.default=function(){for(var t=new r.b2World({x:0,y:-10}),e=new c.default(t),i=new r.b2BodyDef,o=t.CreateBody(i),l=-20,u=2*r.b2Cos(l/10*r.b2_pi),_=0;_<80;_++){var m=l+.5,h=2*r.b2Cos(m/10*r.b2_pi),p=new r.b2EdgeShape;p.Set(new r.b2Vec2(l,u),new r.b2Vec2(m,h)),o.CreateFixture(p,0),l=m,u=h}var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.m_point=new r.b2Vec2,e.m_normal=new r.b2Vec2,e}return n(e,t),e.prototype.ReportFixture=function(t,e,i,o){return this.m_fixture=t,this.m_point.Copy(e),this.m_normal.Copy(i),o},e}(r.b2RayCastCallback),b=new cc.Color(255,255,255,255),d=r.b2_pi/2+1e-4;return e.evterUpdate.On(function(){var e=new r.b2Vec2(0,10),i=new r.b2Vec2(25*r.b2Cos(d),-25*r.b2Abs(r.b2Sin(d))),o=r.b2Vec2.AddVV(e,i,new r.b2Vec2),n=new f;if(t.RayCast(n,e,o),n.m_fixture){s.default.inst.graphicsDrawer.RoundFill(n.m_point.x,n.m_point.y,s.default.inst.graphicsDrawer.Pixel(a.default.STANDARD_WIDTH),b),s.default.inst.graphicsDrawer.StraightLine(e.x,e.y,n.m_point.x,n.m_point.y,s.default.inst.graphicsDrawer.Pixel(a.default.STANDARD_WIDTH),b);var c=r.b2Vec2.AddVV(n.m_point,r.b2Vec2.MulSV(.5,n.m_normal,r.b2Vec2.s_t0),new r.b2Vec2);s.default.inst.graphicsDrawer.StraightLine(n.m_point.x,n.m_point.y,c.x,c.y,s.default.inst.graphicsDrawer.Pixel(a.default.STANDARD_WIDTH),b)}else s.default.inst.graphicsDrawer.StraightLine(e.x,e.y,o.x,o.y,s.default.inst.graphicsDrawer.Pixel(a.default.STANDARD_WIDTH),b);d+=.25*r.b2_pi/180}),e},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../../ConfigCenter":"ConfigCenter","../../component/Box2DDrawer":"Box2DDrawer","../ExamContext":"ExamContext"}],B2ExamGearsA:[function(t,e,i){"use strict";cc._RF.push(e,"844fd9j3vFASIht+m9Dgn8b","B2ExamGearsA"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t=new o.b2World({x:0,y:-10}),e=new o.b2CircleShape;e.m_radius=1;var i=new o.b2PolygonShape;i.SetAsBox(.5,5);var r=new o.b2CircleShape;r.m_radius=2;var s=new o.b2BodyDef;s.type=o.b2BodyType.b2_staticBody,s.position.Set(10,9);var a=t.CreateBody(s);a.CreateFixture(e,5);var c=new o.b2BodyDef;c.type=o.b2BodyType.b2_dynamicBody,c.position.Set(10,8);var l=t.CreateBody(c);l.CreateFixture(i,5);var u=new o.b2BodyDef;u.type=o.b2BodyType.b2_dynamicBody,u.position.Set(10,6);var _=t.CreateBody(u);_.CreateFixture(r,5);var m=new o.b2RevoluteJointDef;m.Initialize(l,a,s.position);var h=t.CreateJoint(m),p=new o.b2RevoluteJointDef;p.Initialize(l,_,u.position);var f=t.CreateJoint(p),b=new o.b2GearJointDef;return b.bodyA=a,b.bodyB=_,b.joint1=h,b.joint2=f,b.ratio=r.m_radius/e.m_radius,t.CreateJoint(b),new n.default(t)},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamGearsB:[function(t,e,i){"use strict";cc._RF.push(e,"841a3ZARBVLrpqj2Q9gXoOv","B2ExamGearsB"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e=new o.b2World({x:0,y:-10}),i=new o.b2BodyDef;t=e.CreateBody(i);var r=new o.b2EdgeShape;r.Set(new o.b2Vec2(-50,0),new o.b2Vec2(50,0)),t.CreateFixture(r,0);var s=new o.b2CircleShape;s.m_radius=1;var a=new o.b2CircleShape;a.m_radius=2;var c=new o.b2PolygonShape;c.SetAsBox(.5,5);var l=new o.b2BodyDef;l.type=o.b2BodyType.b2_dynamicBody,l.position.Set(-3,12);var u=e.CreateBody(l);u.CreateFixture(s,5);var _=new o.b2RevoluteJointDef;_.bodyA=t,_.bodyB=u,t.GetLocalPoint(l.position,_.localAnchorA),u.GetLocalPoint(l.position,_.localAnchorB),_.referenceAngle=u.GetAngle()-t.GetAngle();var m=e.CreateJoint(_),h=new o.b2BodyDef;h.type=o.b2BodyType.b2_dynamicBody,h.position.Set(0,12);var p=e.CreateBody(h);p.CreateFixture(a,5);var f=new o.b2RevoluteJointDef;f.Initialize(t,p,h.position);var b=e.CreateJoint(f),d=new o.b2BodyDef;d.type=o.b2BodyType.b2_dynamicBody,d.position.Set(2.5,12);var y=e.CreateBody(d);y.CreateFixture(c,5);var v=new o.b2PrismaticJointDef;v.Initialize(t,y,d.position,new o.b2Vec2(0,1)),v.lowerTranslation=-5,v.upperTranslation=5,v.enableLimit=!0;var V=e.CreateJoint(v),x=new o.b2GearJointDef;x.bodyA=u,x.bodyB=p,x.joint1=m,x.joint2=b,x.ratio=a.m_radius/s.m_radius,e.CreateJoint(x);var C=new o.b2GearJointDef;return C.bodyA=p,C.bodyB=y,C.joint1=b,C.joint2=V,C.ratio=-1/a.m_radius,e.CreateJoint(C),new n.default(e)},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamMobileBalanced:[function(t,e,i){"use strict";cc._RF.push(e,"386d4df0U9GmZpBC6n1pjaf","B2ExamMobileBalanced"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t=new o.b2World({x:0,y:-10}),e=new o.b2BodyDef;e.position.Set(0,10);var i=t.CreateBody(e),r=new o.b2Vec2(0,.5),s=function e(i,n,r,s,a){var c=new o.b2Vec2(0,a),l=i.GetPosition().Clone().SelfAdd(n).SelfSub(c),u=new o.b2BodyDef;u.type=o.b2BodyType.b2_dynamicBody,u.position.Copy(l);var _=t.CreateBody(u),m=new o.b2PolygonShape;if(m.SetAsBox(.25*a,a),_.CreateFixture(m,20),4==r)return _;m.SetAsBox(s,.25*a,new o.b2Vec2(0,-a),0),_.CreateFixture(m,20);var h=new o.b2Vec2(s,-a),p=new o.b2Vec2(-s,-a),f=e(_,h,r+1,.5*s,a),b=e(_,p,r+1,.5*s,a),d=new o.b2RevoluteJointDef;return d.bodyA=_,d.localAnchorB.Copy(c),d.localAnchorA.Copy(h),d.bodyB=f,t.CreateJoint(d),d.localAnchorA.Copy(p),d.bodyB=b,t.CreateJoint(d),_}(i,o.b2Vec2_zero,0,3,.5),a=new o.b2RevoluteJointDef;return a.bodyA=i,a.bodyB=s,a.localAnchorA.SetZero(),a.localAnchorB.Copy(r),t.CreateJoint(a),new n.default(t)},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamMobile:[function(t,e,i){"use strict";cc._RF.push(e,"529b549gY5MGJz/0ZsicS5U","B2ExamMobile"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t=new o.b2World({x:0,y:-10}),e=new o.b2BodyDef;e.position.Set(0,0);var i=t.CreateBody(e),r=new o.b2Vec2(0,.5),s=function e(i,n,r,s,a){var c=new o.b2Vec2(0,a),l=i.GetPosition().Clone().SelfAdd(n).SelfSub(c),u=new o.b2BodyDef;u.type=o.b2BodyType.b2_dynamicBody,u.position.Copy(l);var _=t.CreateBody(u),m=new o.b2PolygonShape;if(m.SetAsBox(.25*a,a),_.CreateFixture(m,20),4==r)return _;var h=new o.b2Vec2(s,-a),p=new o.b2Vec2(-s,-a),f=e(_,h,r+1,.5*s,a),b=e(_,p,r+1,.5*s,a),d=new o.b2RevoluteJointDef;return d.bodyA=_,d.localAnchorB.Copy(c),d.localAnchorA.Copy(h),d.bodyB=f,t.CreateJoint(d),d.localAnchorA.Copy(p),d.bodyB=b,t.CreateJoint(d),_}(i,o.b2Vec2_zero,0,3,.5),a=new o.b2RevoluteJointDef;return a.bodyA=i,a.bodyB=s,a.localAnchorA.SetZero(),a.localAnchorB.Copy(r),t.CreateJoint(a),new n.default(t)},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamMotorJoint:[function(t,e,i){"use strict";cc._RF.push(e,"e27b71HhslJL7xcphJLwvW6","B2ExamMotorJoint"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e,i=new o.b2World({x:0,y:-10}),r=new o.b2BodyDef;e=i.CreateBody(r),(s=new o.b2EdgeShape).Set(new o.b2Vec2(-20,0),new o.b2Vec2(20,0)),(a=new o.b2FixtureDef).shape=s,e.CreateFixture(a),(r=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,r.position.Set(0,8);var s,a,c=i.CreateBody(r);(s=new o.b2PolygonShape).SetAsBox(2,5),(a=new o.b2FixtureDef).shape=s,a.friction=.6,a.density=2,c.CreateFixture(a);var l=new o.b2MotorJointDef;l.Initialize(e,c),l.maxForce=1e3,l.maxTorque=1e3,t=i.CreateJoint(l);var u=!1,_=new n.default(i);_.evterKeyDown.On(function(){u=!u,console.log("m_go["+u+"]")});var m=0;return _.evterUpdate.On(function(){u&&(m+=1/60);var e=new o.b2Vec2;e.x=6*o.b2Sin(2*m),e.y=8+4*o.b2Sin(m);var i=4*m;t.SetLinearOffset(e),t.SetAngularOffset(i)}),_},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamOneSidePlatform:[function(t,e,i){"use strict";cc._RF.push(e,"93900zRJilFdIX5sGCu7dlb","B2ExamOneSidePlatform"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e=new o.b2World({x:0,y:-10}),i=new o.b2BodyDef,r=e.CreateBody(i);(a=new o.b2EdgeShape).Set(new o.b2Vec2(-40,0),new o.b2Vec2(40,0)),r.CreateFixture(a,0),(i=new o.b2BodyDef).position.Set(0,10);var s,a,c=e.CreateBody(i);return(a=new o.b2PolygonShape).SetAsBox(3,.5),t=c.CreateFixture(a,.8),(i=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,i.position.Set(0,12),c=e.CreateBody(i),(a=new o.b2CircleShape).m_radius=.5,s=c.CreateFixture(a,20),c.SetLinearVelocity(new o.b2Vec2(0,-50)),e.SetContactListener({BeginContact:function(){},EndContact:function(){},BeginContactFixtureParticle:function(){},EndContactFixtureParticle:function(){},BeginContactParticleParticle:function(){},EndContactParticleParticle:function(){},PreSolve:function(e){var i=e.GetFixtureA(),n=e.GetFixtureB();i!=t&&i!=s||n!=t&&n!=s||s.GetBody().GetPosition().y<11-2*o.b2_linearSlop&&e.SetEnabled(!1)},PostSolve:function(){}}),new n.default(e)},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamParticleCollisionFilter:[function(t,e,i){"use strict";cc._RF.push(e,"d1d846xV8hJIbHFOztsL49x","B2ExamParticleCollisionFilter");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=t("../../../lib/box2d_ts/Box2D"),s=t("../ExamContext"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.m_enableFixtureParticleCollisions=!0,e.m_enableParticleParticleCollisions=!0,e}return n(e,t),e.prototype.ShouldCollideFixtureParticle=function(){return this.m_enableFixtureParticleCollisions},e.prototype.ShouldCollideParticleParticle=function(){return this.m_enableParticleParticleCollisions},e}(r.b2ContactFilter);i.default=function(){var t=new r.b2World({x:0,y:0}),e=new s.default(t),i=new a;t.SetContactFilter(i);var o=new r.b2BodyDef,n=t.CreateBody(o),c=new r.b2ChainShape,l=[new r.b2Vec2(-10,-10),new r.b2Vec2(10,-10),new r.b2Vec2(10,10),new r.b2Vec2(-10,10)];c.CreateLoop(l);var u=new r.b2FixtureDef;u.shape=c,u.density=0,u.density=0,u.restitution=1,n.CreateFixture(u);var _,m=t.CreateParticleSystem(new r.b2ParticleSystemDef);m.SetRadius(.5),(c=new r.b2PolygonShape).SetAsBox(1.5,1.5,new r.b2Vec2(5,5),0);var h=new r.b2ParticleGroupDef;h.shape=c,h.flags=r.b2ParticleFlag.b2_powderParticle|r.b2ParticleFlag.b2_particleContactFilterParticle|r.b2ParticleFlag.b2_fixtureContactFilterParticle,_=m.CreateParticleGroup(h);for(var p=m.GetVelocityBuffer(),f=_.GetBufferIndex(),b=0;b<_.GetParticleCount();b++){var d=p[f+b];d.Set(2*Math.random()-1,2*Math.random()-1),d.SelfNormalize(),d.SelfMul(8)}return e.evterUpdate.On(function(){for(var t=_.GetBufferIndex(),e=m.GetVelocityBuffer(),i=0;i<_.GetParticleCount();i++){var o=e[t+i];o.SelfNormalize(),o.SelfMul(8)}}),e.evterKeyDown.On(function(t){switch(t.toLowerCase()){case"a":i.m_enableFixtureParticleCollisions=!i.m_enableFixtureParticleCollisions;break;case"s":i.m_enableParticleParticleCollisions=!i.m_enableParticleParticleCollisions}}),e},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamPolyCollision:[function(t,e,i){"use strict";cc._RF.push(e,"fbc43jcvUBNkITnUkCF7dng","B2ExamPolyCollision"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../../component/Box2DDrawer"),r=t("../../ConfigCenter"),s=t("../ExamContext");i.default=function(){var t=new o.b2World({x:0,y:-10}),e=new s.default(t),i=new o.b2PolygonShape,a=new o.b2PolygonShape,c=new o.b2Transform,l=new o.b2Transform,u=new o.b2Vec2,_=0;return i.SetAsBox(4,4),c.SetPositionAngle(new o.b2Vec2,0),a.SetAsBox(4,4),u.Set(8,1.5),_=2,l.SetPositionAngle(u,_),e.evterKeyDown.On(function(t){switch(t){case"a":u.x-=.1;break;case"d":u.x+=.1;break;case"s":u.y-=.1;break;case"w":u.y+=.1;break;case"q":_+=.1*o.b2_pi;break;case"e":_-=.1*o.b2_pi}l.SetPositionAngle(u,_)}),e.evterUpdate.On(function(){var t=new o.b2Manifold;o.b2CollidePolygons(t,i,c,a,l);var e=new o.b2WorldManifold;e.Initialize(t,c,i.m_radius,l,a.m_radius);for(var s=[],u=0;u<i.m_count;u++)s[u]=o.b2Transform.MulXV(c,i.m_vertices[u],new o.b2Vec2);for(n.default.inst.graphicsDrawer.CyclePosOrigin(s,i.m_count,n.default.inst.graphicsDrawer.Pixel(r.default.STANDARD_WIDTH),cc.Color.RED),u=0;u<a.m_count;u++)s[u]=o.b2Transform.MulXV(l,a.m_vertices[u],new o.b2Vec2);for(n.default.inst.graphicsDrawer.CyclePosOrigin(s,a.m_count,n.default.inst.graphicsDrawer.Pixel(r.default.STANDARD_WIDTH),cc.Color.BLUE),u=0;u<t.pointCount;u++)n.default.inst.graphicsDrawer.RoundFill(e.points[u].x,e.points[u].y,n.default.inst.graphicsDrawer.Pixel(r.default.STANDARD_WIDTH),cc.Color.GREEN)}),e},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../../ConfigCenter":"ConfigCenter","../../component/Box2DDrawer":"Box2DDrawer","../ExamContext":"ExamContext"}],B2ExamPulleys:[function(t,e,i){"use strict";cc._RF.push(e,"98e3e4LhY5IFqfAMMKfFaiO","B2ExamPulleys"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e=new o.b2World({x:0,y:-10}),i=new n.default(e),r=new o.b2BodyDef;t=e.CreateBody(r);var s=new o.b2EdgeShape;s.Set(new o.b2Vec2(-40,0),new o.b2Vec2(40,0)),t.CreateFixture(s,0);var a=new o.b2CircleShape;a.m_radius=2,a.m_p.Set(-10,12),t.CreateFixture(a,0),a.m_p.Set(10,12),t.CreateFixture(a,0);var c=new o.b2PolygonShape;c.SetAsBox(1,2),(r=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,r.position.Set(-10,5);var l=e.CreateBody(r);l.CreateFixture(c,5),r.position.Set(10,5);var u=e.CreateBody(r);u.CreateFixture(c,5);var _=new o.b2PulleyJointDef,m=new o.b2Vec2(-10,7),h=new o.b2Vec2(10,7),p=new o.b2Vec2(-10,12),f=new o.b2Vec2(10,12);return _.Initialize(l,u,p,f,m,h,1.5),e.CreateJoint(_),i},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamRope:[function(t,e,i){"use strict";cc._RF.push(e,"798c5T0P9xKdZYtEsr9l5hs","B2ExamRope"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../../component/Box2DDrawer"),r=t("../../ConfigCenter"),s=t("../ExamContext");i.default=function(){for(var t=new o.b2World({x:0,y:-10}),e=new s.default(t),i=new o.b2Rope,a=0,c=o.b2Vec2.MakeArray(40),l=o.b2MakeNumberArray(40),u=0;u<40;u++)c[u].Set(0,10-1*u),l[u]=1;l[0]=0,l[1]=0;var _=new o.b2RopeDef;return _.vertices=c,_.count=40,_.gravity.Set(0,-10),_.masses=l,_.damping=.1,_.k2=1,_.k3=.5,i.Initialize(_),a=0,i.SetAngle(a),e.evterKeyDown.On(function(t){switch(t){case"q":a=o.b2Max(-o.b2_pi,a-.05*o.b2_pi),i.SetAngle(a);break;case"e":a=o.b2Min(o.b2_pi,a+.05*o.b2_pi),i.SetAngle(a)}}),e.evterUpdate.On(function(t){n.default.inst.graphicsDrawer.ConnectPosOrigin(i.m_ps,i.m_count,n.default.inst.graphicsDrawer.Pixel(r.default.STANDARD_WIDTH),cc.Color.BLUE),i.Step(t,1)}),e},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../../ConfigCenter":"ConfigCenter","../../component/Box2DDrawer":"Box2DDrawer","../ExamContext":"ExamContext"}],B2ExamSegway:[function(t,e,i){"use strict";cc._RF.push(e,"6aa418Wk95FmaRyG/g+gvla","B2ExamSegway"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext"),r=function(){function t(){this.gainP=1,this.gainI=1,this.gainD=1,this.currentError=0,this.previousError=0,this.integral=0}return t.prototype.Step=function(t){this.integral=t*(this.integral+this.currentError);var e=1/t*(this.currentError-this.previousError);this.output=this.gainP*this.currentError+this.gainI*this.integral+this.gainD*e,this.previousError=this.currentError},t}();i.default=function(){var t=10,e=0,i=0,s=new o.b2World({x:0,y:-30}),a=new n.default(s),c=new r,l=new r;c.gainP=1e3,c.gainI=0,c.gainD=250,l.gainP=.5,l.gainI=0,l.gainD=1.5;var u=new o.b2BodyDef,_=new o.b2FixtureDef;u.type=o.b2BodyType.b2_dynamicBody,u.position.x=0,u.position.y=7;var m=s.CreateBody(u),h=new o.b2PolygonShape;h.SetAsBox(.5,5),_.shape=h,_.density=.1,m.CreateFixture(_),u.type=o.b2BodyType.b2_dynamicBody,u.position.x=0,u.position.y=1;var p=s.CreateBody(u),f=new o.b2CircleShape;f.m_radius=.6,_.shape=f,_.density=1/(.36*Math.PI),_.friction=10,p.CreateFixture(_);var b=new o.b2RevoluteJointDef;b.Initialize(p,m,{x:0,y:0}),b.localAnchorA.Set(0,0),b.localAnchorB.Set(0,-5),b.collideConnected=!1,b.enableMotor=!0,b.maxMotorTorque=40;var d=s.CreateJoint(b);u.type=o.b2BodyType.b2_staticBody,u.position.x=0,u.position.y=0;var y=s.CreateBody(u),v=new o.b2EdgeShape;v.Set({x:-100,y:0},{x:100,y:0}),_.shape=v,_.friction=10,y.CreateFixture(_);var V=function(t){for(;t>o.b2DegToRad(180);)t-=o.b2DegToRad(360);for(;t<o.b2DegToRad(-180);)t+=o.b2DegToRad(360);return t};return a.evterUpdate.On(function(n){var r=n;8<=(e+=r)&&(e=0,t=10==t?-10:10);var a=0;i=.6*i+.4*m.GetPosition().x,l.currentError=t-i,l.Step(r);var u=l.output;a=(u=o.b2Clamp(u,-10,10))/s.GetGravity().y,a=o.b2Clamp(a,o.b2DegToRad(-15),o.b2DegToRad(15));var _=m.GetAngle();_=V(_),c.currentError=a-_,c.Step(r);var h=c.output;1e3<Math.abs(h)&&(h=0);var p=h/(1.2*Math.PI);d.SetMotorSpeed(p)}),a},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamSensorTest:[function(t,e,i){"use strict";cc._RF.push(e,"6fbfb9MbdtD9LgM/1mIG8b3","B2ExamSensorTest"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){for(var t=new o.b2World({x:0,y:-10}),e=new n.default(t),i=[],r=[],s=0;s<7;s++)r[s]=[];var a,c=new o.b2BodyDef,l=t.CreateBody(c);(u=new o.b2EdgeShape).Set(new o.b2Vec2(-40,0),new o.b2Vec2(40,0)),l.CreateFixture(u,0),(u=new o.b2CircleShape).m_radius=5,u.m_p.Set(0,10);var u,_=new o.b2FixtureDef;for(_.shape=u,_.isSensor=!0,a=l.CreateFixture(_),(u=new o.b2CircleShape).m_radius=1,s=0;s<7;s++)c.type=o.b2BodyType.b2_dynamicBody,c.position.Set(3*s-10,20),c.userData=r[s],r[s][0]=!1,i[s]=t.CreateBody(c),i[s].CreateFixture(u,1);return t.SetContactListener({BeginContact:function(t){var e,i=t.GetFixtureA(),o=t.GetFixtureB();i==a&&(e=o.GetBody().GetUserData())&&(e[0]=!0),o==a&&(e=i.GetBody().GetUserData())&&(e[0]=!0)},EndContact:function(t){var e,i=t.GetFixtureA(),o=t.GetFixtureB();i==a&&(e=o.GetBody().GetUserData())&&(e[0]=!1),o==a&&(e=i.GetBody().GetUserData())&&(e[0]=!1)},BeginContactFixtureParticle:function(){},EndContactFixtureParticle:function(){},BeginContactParticleParticle:function(){},EndContactParticleParticle:function(){},PreSolve:function(){},PostSolve:function(){}}),e.evterUpdate.On(function(){for(var t=0;t<7;t++)if(r[t][0]){var e=i[t],n=a.GetBody(),s=a.GetShape(),c=n.GetWorldPoint(s.m_p,new o.b2Vec2),l=e.GetPosition(),u=o.b2Vec2.SubVV(c,l,new o.b2Vec2);if(!(u.LengthSquared()<1e-10)){u.Normalize();var _=o.b2Vec2.MulSV(100,u,new o.b2Vec2);e.ApplyForce(_,l)}}}),e},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamSparky:[function(t,e,i){"use strict";cc._RF.push(e,"1859ajpJRdKxrhxQvTpRYIB","B2ExamSparky"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t=new o.b2World({x:0,y:-10}),e=new o.b2BodyDef,i=t.CreateBody(e),r=new n.default(t),s=new o.b2PolygonShape,a=[new o.b2Vec2(-20,-15),new o.b2Vec2(20,-15),new o.b2Vec2(20,-14),new o.b2Vec2(-20,-14)];s.Set(a,4),i.CreateFixture(s,0),s=new o.b2PolygonShape,a=[new o.b2Vec2(-20,14),new o.b2Vec2(20,14),new o.b2Vec2(20,15),new o.b2Vec2(-20,15)],s.Set(a,4),i.CreateFixture(s,0),s=new o.b2PolygonShape,a=[new o.b2Vec2(-21,-15),new o.b2Vec2(-20,-15),new o.b2Vec2(-20,15),new o.b2Vec2(-21,15)],s.Set(a,4),i.CreateFixture(s,0),s=new o.b2PolygonShape,a=[new o.b2Vec2(20,-15),new o.b2Vec2(21,-15),new o.b2Vec2(21,15),new o.b2Vec2(20,15)],s.Set(a,4),i.CreateFixture(s,0);var c=new o.b2ParticleSystemDef,l=t.CreateParticleSystem(c);l.SetRadius(.5);for(var u=0;u<3;u++){var _=new o.b2BodyDef;_.type=o.b2BodyType.b2_dynamicBody,_.position.Set(0,0);var m=t.CreateBody(_);(s=new o.b2CircleShape).Set({x:0,y:0},2),m.CreateFixture(s,.5).SetUserData({spark:!0})}var h=new o.b2Vec2,p=!1;return t.SetContactListener({BeginContact:function(t){var e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e&&e.spark||i&&i.spark){var n=new o.b2WorldManifold;t.GetWorldManifold(n),h.Copy(n.points[0]),p=!0}},EndContact:function(){},BeginContactFixtureParticle:function(){},EndContactFixtureParticle:function(){},BeginContactParticleParticle:function(){},EndContactParticleParticle:function(){},PreSolve:function(){},PostSolve:function(){}}),r.evterUpdate.On(function(){if(p){var t=new o.b2CircleShape;t.m_p.Copy(h),t.m_radius=1;var e=new o.b2ParticleGroupDef;e.flags=o.b2ParticleFlag.b2_powderParticle,e.shape=t,l.CreateParticleGroup(e),p=!1}}),r},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamTheoJansen:[function(t,e,i){"use strict";cc._RF.push(e,"efd5eOYjo5D1KUt2fNlNiXT","B2ExamTheoJansen"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e,i=new o.b2World({x:0,y:-10}),r=new n.default(i),s=new o.b2Vec2;function a(n,r){var a=new o.b2Vec2(5.4*n,-6.1),c=new o.b2Vec2(7.2*n,-1.2),l=new o.b2Vec2(4.3*n,-1.9),u=new o.b2Vec2(3.1*n,.8),_=new o.b2Vec2(6*n,1.5),m=new o.b2Vec2(2.5*n,3.7),h=new o.b2FixtureDef,p=new o.b2FixtureDef;h.filter.groupIndex=-1,p.filter.groupIndex=-1,h.density=1,p.density=1;var f,b=new o.b2PolygonShape,d=new o.b2PolygonShape;0<n?((f=[])[0]=a,f[1]=c,f[2]=l,b.Set(f),f[0]=o.b2Vec2_zero,f[1]=o.b2Vec2.SubVV(_,u,new o.b2Vec2),f[2]=o.b2Vec2.SubVV(m,u,new o.b2Vec2),d.Set(f)):((f=[])[0]=a,f[1]=l,f[2]=c,b.Set(f),f[0]=o.b2Vec2_zero,f[1]=o.b2Vec2.SubVV(m,u,new o.b2Vec2),f[2]=o.b2Vec2.SubVV(_,u,new o.b2Vec2),d.Set(f)),h.shape=b,p.shape=d;var y=new o.b2BodyDef,v=new o.b2BodyDef;y.type=o.b2BodyType.b2_dynamicBody,v.type=o.b2BodyType.b2_dynamicBody,y.position.Copy(s),v.position.Copy(o.b2Vec2.AddVV(u,s,new o.b2Vec2)),y.angularDamping=10,v.angularDamping=10;var V=i.CreateBody(y),x=i.CreateBody(v);V.CreateFixture(h),x.CreateFixture(p);var C=new o.b2DistanceJointDef;C.dampingRatio=.5,C.frequencyHz=10,C.Initialize(V,x,o.b2Vec2.AddVV(c,s,new o.b2Vec2),o.b2Vec2.AddVV(_,s,new o.b2Vec2)),i.CreateJoint(C),C.Initialize(V,x,o.b2Vec2.AddVV(l,s,new o.b2Vec2),o.b2Vec2.AddVV(u,s,new o.b2Vec2)),i.CreateJoint(C),C.Initialize(V,t,o.b2Vec2.AddVV(l,s,new o.b2Vec2),o.b2Vec2.AddVV(r,s,new o.b2Vec2)),i.CreateJoint(C),C.Initialize(x,t,o.b2Vec2.AddVV(m,s,new o.b2Vec2),o.b2Vec2.AddVV(r,s,new o.b2Vec2)),i.CreateJoint(C);var S=new o.b2RevoluteJointDef;S.Initialize(x,e,o.b2Vec2.AddVV(u,s,new o.b2Vec2)),i.CreateJoint(S)}s.Set(0,8);var c,l=new o.b2Vec2(0,.8),u=new o.b2BodyDef,_=i.CreateBody(u);(h=new o.b2EdgeShape).Set(new o.b2Vec2(-50,0),new o.b2Vec2(50,0)),_.CreateFixture(h,0),h.Set(new o.b2Vec2(-50,0),new o.b2Vec2(-50,10)),_.CreateFixture(h,0),h.Set(new o.b2Vec2(50,0),new o.b2Vec2(50,10)),_.CreateFixture(h,0);for(var m=0;m<40;m++){var h;(h=new o.b2CircleShape).m_radius=.25,(u=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,u.position.Set(2*m-40,.5),i.CreateBody(u).CreateFixture(h,1)}(h=new o.b2PolygonShape).SetAsBox(2.5,1),(c=new o.b2FixtureDef).density=1,c.shape=h,c.filter.groupIndex=-1,(u=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,u.position.Copy(l).SelfAdd(s),(e=i.CreateBody(u)).CreateFixture(c),(h=new o.b2CircleShape).m_radius=1.6,(c=new o.b2FixtureDef).density=1,c.shape=h,c.filter.groupIndex=-1,(u=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,u.position.Copy(l).SelfAdd(s),(t=i.CreateBody(u)).CreateFixture(c);var p=new o.b2RevoluteJointDef;p.Initialize(t,e,o.b2Vec2.AddVV(l,s,new o.b2Vec2)),p.collideConnected=!1,p.motorSpeed=2,p.maxMotorTorque=400,p.enableMotor=!0,i.CreateJoint(p);var f=o.b2Vec2.AddVV(l,new o.b2Vec2(0,-.8),new o.b2Vec2);return a(-1,f),a(1,f),t.SetTransformVec(t.GetPosition(),120*o.b2_pi/180),a(-1,f),a(1,f),t.SetTransformVec(t.GetPosition(),-120*o.b2_pi/180),a(-1,f),a(1,f),r},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamTumber:[function(t,e,i){"use strict";cc._RF.push(e,"7d28bJqe8dDe6s6dlLDLsSu","B2ExamTumber"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=(o.ccclass,o.property,t("../../../lib/box2d_ts/Box2D")),r=t("../ExamContext");i.default=function(){var t=new n.b2World({x:0,y:-10}),e=t.CreateBody(new n.b2BodyDef),i=new n.b2BodyDef;i.type=n.b2BodyType.b2_dynamicBody,i.allowSleep=!1,i.position.Set(0,0);var o=t.CreateBody(i),s=new n.b2PolygonShape;s.SetAsBox(.125,10,new n.b2Vec2(10,0),0),o.CreateFixture(s,5),s.SetAsBox(.125,10,new n.b2Vec2(-10,0),0),o.CreateFixture(s,5),s.SetAsBox(10,.125,new n.b2Vec2(0,10),0),o.CreateFixture(s,5),s.SetAsBox(10,.125,new n.b2Vec2(0,-10),0),o.CreateFixture(s,5);var a=new n.b2RevoluteJointDef;a.bodyA=e,a.bodyB=o,a.localAnchorA.Set(3,3),a.localAnchorB.Set(-2,2),a.referenceAngle=0,a.motorSpeed=.05*n.b2_pi,a.maxMotorTorque=1e8,a.enableMotor=!0,t.CreateJoint(a);for(var c=0;c<100;c++){var l=new n.b2BodyDef;l.type=n.b2BodyType.b2_dynamicBody,l.position.Set(0,0);var u=t.CreateBody(l),_=new n.b2PolygonShape;_.SetAsBox(.5,.5),u.CreateFixture(_,1)}return new r.default(t)},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamVaryingRestitution:[function(t,e,i){"use strict";cc._RF.push(e,"1599dgI1WZJ4KsNoe6hb0nu","B2ExamVaryingRestitution"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e=new o.b2World({x:0,y:-10}),i=new n.default(e),r=new o.b2BodyDef,s=e.CreateBody(r);(t=new o.b2EdgeShape).Set(new o.b2Vec2(-40,0),new o.b2Vec2(40,0)),s.CreateFixture(t,0),(t=new o.b2CircleShape).m_radius=1;var a=new o.b2FixtureDef;a.shape=t,a.density=1;for(var c=[0,.1,.3,.5,.75,.9,1],l=0;l<7;l++){(r=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,r.position.Set(3*l-10,20);var u=e.CreateBody(r);a.restitution=c[l],u.CreateFixture(a)}return i},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamWaveMachine:[function(t,e,i){"use strict";cc._RF.push(e,"557ddRheoFM85q+bj+1sk+6","B2ExamWaveMachine"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e,i=new o.b2World({x:0,y:-30}),r=new n.default(i),s=new o.b2BodyDef;t=i.CreateBody(s),(s=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,s.allowSleep=!1,s.position.Set(0,1);var a=i.CreateBody(s);(_=new o.b2PolygonShape).SetAsBox(.05,5,new o.b2Vec2(10,0),0),a.CreateFixture(_,5),_.SetAsBox(.05,5,new o.b2Vec2(-10,0),0),a.CreateFixture(_,5),_.SetAsBox(10,.05,new o.b2Vec2(0,5),0),a.CreateFixture(_,5),_.SetAsBox(10,.05,new o.b2Vec2(0,-5),0),a.CreateFixture(_,5);var c=new o.b2RevoluteJointDef;c.bodyA=t,c.bodyB=a,c.localAnchorA.Set(0,0),c.localAnchorB.Set(0,0),c.referenceAngle=0,c.motorSpeed=.05*o.b2_pi,c.maxMotorTorque=1e7,c.enableMotor=!0,e=i.CreateJoint(c);var l=new o.b2ParticleSystemDef,u=i.CreateParticleSystem(l);u.SetRadius(.5),u.SetDamping(2);var _,m=new o.b2ParticleGroupDef;m.flags=o.b2ParticleFlag.b2_colorMixingParticle,(_=new o.b2PolygonShape).SetAsBox(10,2,new o.b2Vec2(0,1),0),m.shape=_,u.CreateParticleGroup(m);var h=0;return r.evterUpdate.On(function(t){h+=t,e.SetMotorSpeed(.05*Math.cos(h)*o.b2_pi)}),r},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2ExamWeb:[function(t,e,i){"use strict";cc._RF.push(e,"9e7d1s0qgdA7ILBy0iR8TDV","B2ExamWeb"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../lib/box2d_ts/Box2D"),n=t("../ExamContext");i.default=function(){var t,e,i=new o.b2World({x:0,y:-10}),r=new n.default(i),s=new o.b2BodyDef;t=i.CreateBody(s),(e=new o.b2EdgeShape).Set(new o.b2Vec2(-40,0),new o.b2Vec2(40,0)),t.CreateFixture(e,0),(e=new o.b2PolygonShape).SetAsBox(.5,.5),(s=new o.b2BodyDef).type=o.b2BodyType.b2_dynamicBody,s.position.Set(-5,5);var a=i.CreateBody(s);a.CreateFixture(e,5),s.position.Set(5,5);var c=i.CreateBody(s);c.CreateFixture(e,5),s.position.Set(5,15);var l=i.CreateBody(s);l.CreateFixture(e,5),s.position.Set(-5,15);var u=i.CreateBody(s);u.CreateFixture(e,5);var _=new o.b2DistanceJointDef,m=void 0,h=void 0,p=void 0;return _.frequencyHz=2,_.dampingRatio=0,_.bodyA=t,_.bodyB=a,_.localAnchorA.Set(-10,0),_.localAnchorB.Set(-.5,-.5),m=_.bodyA.GetWorldPoint(_.localAnchorA,new o.b2Vec2),h=_.bodyB.GetWorldPoint(_.localAnchorB,new o.b2Vec2),p=o.b2Vec2.SubVV(h,m,new o.b2Vec2),_.length=p.Length(),i.CreateJoint(_),_.bodyA=t,_.bodyB=c,_.localAnchorA.Set(10,0),_.localAnchorB.Set(.5,-.5),m=_.bodyA.GetWorldPoint(_.localAnchorA,new o.b2Vec2),h=_.bodyB.GetWorldPoint(_.localAnchorB,new o.b2Vec2),p=o.b2Vec2.SubVV(h,m,new o.b2Vec2),_.length=p.Length(),i.CreateJoint(_),_.bodyA=t,_.bodyB=l,_.localAnchorA.Set(10,20),_.localAnchorB.Set(.5,.5),m=_.bodyA.GetWorldPoint(_.localAnchorA,new o.b2Vec2),h=_.bodyB.GetWorldPoint(_.localAnchorB,new o.b2Vec2),p=o.b2Vec2.SubVV(h,m,new o.b2Vec2),_.length=p.Length(),i.CreateJoint(_),_.bodyA=t,_.bodyB=u,_.localAnchorA.Set(-10,20),_.localAnchorB.Set(-.5,.5),m=_.bodyA.GetWorldPoint(_.localAnchorA,new o.b2Vec2),h=_.bodyB.GetWorldPoint(_.localAnchorB,new o.b2Vec2),p=o.b2Vec2.SubVV(h,m,new o.b2Vec2),_.length=p.Length(),i.CreateJoint(_),_.bodyA=a,_.bodyB=c,_.localAnchorA.Set(.5,.5),_.localAnchorB.Set(-.5,.5),m=_.bodyA.GetWorldPoint(_.localAnchorA,new o.b2Vec2),h=_.bodyB.GetWorldPoint(_.localAnchorB,new o.b2Vec2),p=o.b2Vec2.SubVV(h,m,new o.b2Vec2),_.length=p.Length(),i.CreateJoint(_),_.bodyA=c,_.bodyB=l,_.localAnchorA.Set(-.5,.5),_.localAnchorB.Set(-.5,-.5),m=_.bodyA.GetWorldPoint(_.localAnchorA,new o.b2Vec2),h=_.bodyB.GetWorldPoint(_.localAnchorB,new o.b2Vec2),p=o.b2Vec2.SubVV(h,m,new o.b2Vec2),_.length=p.Length(),i.CreateJoint(_),_.bodyA=l,_.bodyB=u,_.localAnchorA.Set(-.5,-.5),_.localAnchorB.Set(.5,-.5),m=_.bodyA.GetWorldPoint(_.localAnchorA,new o.b2Vec2),h=_.bodyB.GetWorldPoint(_.localAnchorB,new o.b2Vec2),p=o.b2Vec2.SubVV(h,m,new o.b2Vec2),_.length=p.Length(),i.CreateJoint(_),_.bodyA=u,_.bodyB=a,_.localAnchorA.Set(.5,-.5),_.localAnchorB.Set(.5,.5),m=_.bodyA.GetWorldPoint(_.localAnchorA,new o.b2Vec2),h=_.bodyB.GetWorldPoint(_.localAnchorB,new o.b2Vec2),p=o.b2Vec2.SubVV(h,m,new o.b2Vec2),_.length=p.Length(),i.CreateJoint(_),r},cc._RF.pop()},{"../../../lib/box2d_ts/Box2D":"Box2D","../ExamContext":"ExamContext"}],B2Extend:[function(t,e,i){"use strict";cc._RF.push(e,"f842eUKQ9JHwaeSElsJ17t3","B2Extend"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../box2d_ts/Box2D");(function(t){function e(t){var e=Math.cos(t),i=Math.sin(t),o=new n.b2Mat33;return o.SetVVV({x:e,y:i,z:0},{x:-i,y:e,z:0},{x:0,y:0,z:1}),o}function i(t,e){var i=new n.b2Mat33;return i.SetVVV({x:1,y:0,z:0},{x:0,y:1,z:0},{x:t,y:e,z:1}),i}function o(t,e){var i=new n.b2Vec3,o=new n.b2Vec3,r=new n.b2Vec3;n.b2Mat33.MulM33V3(t,e.ex,i),n.b2Mat33.MulM33V3(t,e.ey,o),n.b2Mat33.MulM33V3(t,e.ez,r);var s=new n.b2Mat33;return s.SetVVV(i,o,r),s}t.GetDistanceJoint=function(t){if(null!=t)return t.m_type==n.b2JointType.e_distanceJoint?t:void 0},t.GetPulleyJoint=function(t){if(null!=t)return t.m_type==n.b2JointType.e_pulleyJoint?t:void 0},t.GetMouseJoint=function(t){if(null!=t)return t.m_type==n.b2JointType.e_motorJoint?t:void 0},t.Getb2BuoyancyController=function(t){if(null!=t)return t instanceof n.b2BuoyancyController?t:void 0},t.GetChainShape=function(t){if(null!=t)return t.GetType()==n.b2ShapeType.e_chainShape?t:void 0},t.GetEdgeShape=function(t){if(null!=t)return t.GetType()==n.b2ShapeType.e_edgeShape?t:void 0},t.GetPolygonShape=function(t){if(null!=t)return t.GetType()==n.b2ShapeType.e_polygonShape?t:null},t.GetCircleShape=function(t){if(null!=t)return t.GetType()==n.b2ShapeType.e_circleShape?t:null},t.GetTransMat=function(t){var n=t.GetAngle(),r=t.GetPosition();return o(i(r.x,r.y),e(n))},t.GetRotateMat=e,t.GetPosMat=i,t.MergeMat=o,t.GetMatStr=function(t){return t.ex.x+", "+t.ey.x+", "+t.ez.x+"\n"+t.ex.y+", "+t.ey.y+", "+t.ez.y+"\n"+t.ex.z+", "+t.ey.z+", "+t.ez.z},t.GetV3Str=function(t){return t.x+", "+t.y+", "+t.z}})(o||(o={})),i.default=o,cc._RF.pop()},{"../box2d_ts/Box2D":"Box2D"}],B2JointContext:[function(t,e,i){"use strict";cc._RF.push(e,"55afaI+hkNNepYfibUYmEGc","B2JointContext"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],B2JointExtend:[function(t,e,i){"use strict";cc._RF.push(e,"4e68eLD7SNKyowhNdQ90hRK","B2JointExtend"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../../box2d_ts/Box2D"),r=t("../../regist_define/RegistDefine"),s=t("../B2EleSetting"),a=t("./B2JointRD"),c=t("./B2JointRS");(function(t){function e(t,e,i){i.StraightLine(e.x1.x,e.x1.y,e.p1.x,e.p1.y,i.Pixel(s.default.lineWidth),s.default.color.joint.areaBegin),i.StraightLine(e.p1.x,e.p1.y,e.p2.x,e.p2.y,i.Pixel(s.default.lineWidth),s.default.color.joint.areaBegin),i.StraightLine(e.x2.x,e.x2.y,e.p2.x,e.p2.y,i.Pixel(s.default.lineWidth),s.default.color.joint.areaEnd)}t.DefJointDrawer=e,t.rd=new r.default(a.default,c.default,function(t){return t.type}),t.DrawB2Joint=function(i,o){if(null!=i){var r=i.GetBodyA(),s=i.GetBodyB(),a=r.m_xf,c=s.m_xf,l={x1:a.p,x2:c.p,p1:i.GetAnchorA(new n.b2Vec2),p2:i.GetAnchorB(new n.b2Vec2)},u=t.rd.GetRegMsg(i.m_type);u?u.drawer(i,l,o):e(0,l,o)}}})(o||(o={})),window.b2JointExtend=o,i.default=o,cc._RF.pop()},{"../../box2d_ts/Box2D":"Box2D","../../regist_define/RegistDefine":"RegistDefine","../B2EleSetting":"B2EleSetting","./B2JointRD":"B2JointRD","./B2JointRS":"B2JointRS"}],B2JointRD:[function(t,e,i){"use strict";cc._RF.push(e,"eb06exGGiJEApf3opY9jar0","B2JointRD"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../../box2d_ts/Box2D"),r=t("../B2EleSetting"),s=t("./B2JointRS");(function(t){t.distance=new s.default({type:n.b2JointType.e_distanceJoint,drawer:function(t,e,i){i.StraightLine(e.p1.x,e.p1.y,e.p2.x,e.p2.y,i.Pixel(r.default.lineWidth),r.default.color.joint.areaBegin)}}),t.pulley=new s.default({type:n.b2JointType.e_pulleyJoint,drawer:function(t,e,i){var o=t.GetGroundAnchorA(),n=t.GetGroundAnchorB();i.StraightLine(o.x,o.y,e.p1.x,e.p1.y,i.Pixel(r.default.lineWidth),r.default.color.joint.areaBegin),i.StraightLine(n.x,n.y,e.p2.x,e.p2.y,i.Pixel(r.default.lineWidth),r.default.color.joint.areaBegin),i.StraightLine(o.x,o.y,n.x,n.y,i.Pixel(r.default.lineWidth),r.default.color.joint.areaEnd)}}),t.mouse=new s.default({type:n.b2JointType.e_mouseJoint,drawer:function(t,e,i){i.RoundFill(e.p1.x,e.p1.y,i.Pixel(r.default.dotRadius),r.default.color.joint.dot),i.RoundFill(e.p2.x,e.p2.y,i.Pixel(r.default.dotRadius),r.default.color.joint.dot),i.StraightLine(e.p1.x,e.p1.y,e.p2.x,e.p2.y,i.Pixel(r.default.dotRadius),r.default.color.joint.areaBegin)}})})(o||(o={})),i.default=o,cc._RF.pop()},{"../../box2d_ts/Box2D":"Box2D","../B2EleSetting":"B2EleSetting","./B2JointRS":"B2JointRS"}],B2JointRS:[function(t,e,i){"use strict";cc._RF.push(e,"a4b04n3wi9PF5fG2ozvFRPH","B2JointRS");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(t("../../regist_define/RDClass").default);i.default=r,cc._RF.pop()},{"../../regist_define/RDClass":"RDClass"}],B2ShapeExtend:[function(t,e,i){"use strict";cc._RF.push(e,"c7738hpn21Oc6Ozqn5G5Yre","B2ShapeExtend"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../../regist_define/RegistDefine"),r=t("./B2ShapeRD"),s=t("./B2ShapeRS");(function(t){t.rd=new n.default(r.default,s.default,function(t){return t.type}),t.DrawShape=function(e,i,o){if(null!=e){var n=t.rd.GetRegMsg(e.m_type);n&&n.drawer(e,i,o)}}})(o||(o={})),window.b2ShapeExtend=o,i.default=o,cc._RF.pop()},{"../../regist_define/RegistDefine":"RegistDefine","./B2ShapeRD":"B2ShapeRD","./B2ShapeRS":"B2ShapeRS"}],B2ShapeRD:[function(t,e,i){"use strict";cc._RF.push(e,"bd66f9W3mVNuqy/f/1Fg3PH","B2ShapeRD"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../../box2d_ts/Box2D"),r=t("../B2EleSetting"),s=t("./B2ShapeRS");(function(t){t.circle=new s.default({type:n.b2ShapeType.e_circleShape,drawer:function(t,e,i){var o=e.GetWorldPoint(t.m_p,new n.b2Vec2),s=t.m_radius;i.RoundFill(o.x,o.y,s,r.default.color.shape.body),i.RoundLine(o.x,o.y,s,i.Pixel(r.default.lineWidth),r.default.color.shape.outline)}}),t.edge=new s.default({type:n.b2ShapeType.e_edgeShape,drawer:function(t,e,i){var o=e.GetWorldPoint(t.m_vertex1,new n.b2Vec2),s=e.GetWorldPoint(t.m_vertex2,new n.b2Vec2);i.StraightLine(o.x,o.y,s.x,s.y,i.Pixel(r.default.lineWidth),r.default.color.shape.outline)}}),t.chain=new s.default({type:n.b2ShapeType.e_chainShape,drawer:function(t,e,i){var o=t.m_count,s=t.m_vertices,a=e.GetWorldPoint(s[0],new n.b2Vec2);if(i.RoundFill(a.x,a.y,i.Pixel(r.default.dotRadius),r.default.color.shape.outline),t.m_hasPrevVertex){var c=e.GetWorldPoint(t.m_prevVertex,new n.b2Vec2);i.StraightLine(c.x,c.y,a.x,a.y,i.Pixel(r.default.lineWidth),r.default.color.shape.outline),i.RoundFill(c.x,c.y,i.Pixel(r.default.dotRadius),r.default.color.shape.outline)}for(var l=1;l<o;l++){var u=e.GetWorldPoint(s[l],new n.b2Vec2);i.StraightLine(a.x,a.y,u.x,u.y,i.Pixel(r.default.lineWidth),r.default.color.shape.outline),i.RoundFill(u.x,u.y,i.Pixel(r.default.dotRadius),r.default.color.shape.outline),a=u}if(t.m_hasNextVertex){var _=e.GetWorldPoint(t.m_nextVertex,new n.b2Vec2);i.StraightLine(_.x,_.y,a.x,a.y,i.Pixel(r.default.lineWidth),r.default.color.shape.outline),i.RoundFill(_.x,_.y,i.Pixel(r.default.dotRadius),r.default.color.shape.outline)}}}),t.polygon=new s.default({type:n.b2ShapeType.e_polygonShape,drawer:function(t,e,i){t.m_count;var o=t.m_vertices.slice(0,t.m_count).map(function(t){return e.GetWorldPoint(t,new n.b2Vec2)});i.FillPosSetAll(o,r.default.color.shape.body),i.CyclePosSetAll(o,i.Pixel(r.default.lineWidth),r.default.color.shape.outline)}})})(o||(o={})),i.default=o,cc._RF.pop()},{"../../box2d_ts/Box2D":"Box2D","../B2EleSetting":"B2EleSetting","./B2ShapeRS":"B2ShapeRS"}],B2ShapeRS:[function(t,e,i){"use strict";cc._RF.push(e,"65807sdCiFP6ZskPlCf4waS","B2ShapeRS");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(t("../../regist_define/RDClass").default);(function(t){t.Cont=function(){}})(r||(r={})),i.default=r,cc._RF.pop()},{"../../regist_define/RDClass":"RDClass"}],Box2DDrawer:[function(t,e,i){"use strict";cc._RF.push(e,"01c80GCPo5EKa1wlZK8rkZ+","Box2DDrawer");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../ConfigCenter"),a=t("./CheckBox"),c=t("../DataCenter"),l=t("../../lib/graphics_drawer/GraphicsDrawer"),u=t("../../lib/b2_extend/b2_element/B2ElementExtend"),_=cc._decorator,m=_.ccclass,h=_.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.graphics=null,e.checkBoxPrefab=null,e.checkBoxContainer=null,e}var i;return n(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.graphicsDrawer=new l.default(this.graphics,s.default.b2ShapeScale),this.checkBoxContainer.removeAllChildren(),u.default.rd.list.forEach(function(e,i){var o=cc.instantiate(t.checkBoxPrefab).getComponent(a.default);t.checkBoxContainer.addChild(o.node),o.Init(i),o.Refresh(),o.evter.On(function(){c.default.vo.enableRec[""+i]=!c.default.vo.enableRec[""+i],o.Refresh()})}),i.inst=this},e.prototype.DrawB2World=function(t){if(this._b2w=t,this.graphics.clear(),null!=this._b2w){for(var e in this._currDrawTag=0,c.default.vo.enableRec){var i=c.default.vo.enableRec[e],o=Number.parseInt(e);if(!isNaN(o)){var n=u.default.rd.list[o];null!=n&&i&&(this._currDrawTag|=n.drawAbleTag)}}u.default.DrawWorld(this._b2w,this.graphicsDrawer,this._currDrawTag)}},r([h(cc.Graphics)],e.prototype,"graphics",void 0),r([h(cc.Prefab)],e.prototype,"checkBoxPrefab",void 0),r([h(cc.Node)],e.prototype,"checkBoxContainer",void 0),i=r([m],e)}(cc.Component);i.default=p,cc._RF.pop()},{"../../lib/b2_extend/b2_element/B2ElementExtend":"B2ElementExtend","../../lib/graphics_drawer/GraphicsDrawer":"GraphicsDrawer","../ConfigCenter":"ConfigCenter","../DataCenter":"DataCenter","./CheckBox":"CheckBox"}],Box2D:[function(t,e,i){"use strict";cc._RF.push(e,"9e550hkQyNNkYZO/YiigcTl","Box2D");var o=this&&this.__createBinding||(Object.create?function(t,e,i,o){void 0===o&&(o=i),Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,o){void 0===o&&(o=i),t[o]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||o(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(t("./Common/b2Settings"),i),n(t("./Common/b2Math"),i),n(t("./Common/b2Draw"),i),n(t("./Common/b2Timer"),i),n(t("./Common/b2GrowableStack"),i),n(t("./Common/b2BlockAllocator"),i),n(t("./Common/b2StackAllocator"),i),n(t("./Collision/b2Collision"),i),n(t("./Collision/b2Distance"),i),n(t("./Collision/b2BroadPhase"),i),n(t("./Collision/b2DynamicTree"),i),n(t("./Collision/b2TimeOfImpact"),i),n(t("./Collision/b2CollideCircle"),i),n(t("./Collision/b2CollidePolygon"),i),n(t("./Collision/b2CollideEdge"),i),n(t("./Collision/Shapes/b2Shape"),i),n(t("./Collision/Shapes/b2CircleShape"),i),n(t("./Collision/Shapes/b2PolygonShape"),i),n(t("./Collision/Shapes/b2EdgeShape"),i),n(t("./Collision/Shapes/b2ChainShape"),i),n(t("./Dynamics/b2Fixture"),i),n(t("./Dynamics/b2Body"),i),n(t("./Dynamics/b2World"),i),n(t("./Dynamics/b2WorldCallbacks"),i),n(t("./Dynamics/b2Island"),i),n(t("./Dynamics/b2TimeStep"),i),n(t("./Dynamics/b2ContactManager"),i),n(t("./Dynamics/Contacts/b2Contact"),i),n(t("./Dynamics/Contacts/b2ContactFactory"),i),n(t("./Dynamics/Contacts/b2ContactSolver"),i),n(t("./Dynamics/Contacts/b2CircleContact"),i),n(t("./Dynamics/Contacts/b2PolygonContact"),i),n(t("./Dynamics/Contacts/b2PolygonAndCircleContact"),i),n(t("./Dynamics/Contacts/b2EdgeAndCircleContact"),i),n(t("./Dynamics/Contacts/b2EdgeAndPolygonContact"),i),n(t("./Dynamics/Contacts/b2ChainAndCircleContact"),i),n(t("./Dynamics/Contacts/b2ChainAndPolygonContact"),i),n(t("./Dynamics/Joints/b2Joint"),i),n(t("./Dynamics/Joints/b2AreaJoint"),i),n(t("./Dynamics/Joints/b2DistanceJoint"),i),n(t("./Dynamics/Joints/b2FrictionJoint"),i),n(t("./Dynamics/Joints/b2GearJoint"),i),n(t("./Dynamics/Joints/b2MotorJoint"),i),n(t("./Dynamics/Joints/b2MouseJoint"),i),n(t("./Dynamics/Joints/b2PrismaticJoint"),i),n(t("./Dynamics/Joints/b2PulleyJoint"),i),n(t("./Dynamics/Joints/b2RevoluteJoint"),i),n(t("./Dynamics/Joints/b2RopeJoint"),i),n(t("./Dynamics/Joints/b2WeldJoint"),i),n(t("./Dynamics/Joints/b2WheelJoint"),i),n(t("./Controllers/b2Controller"),i),n(t("./Controllers/b2BuoyancyController"),i),n(t("./Controllers/b2ConstantAccelController"),i),n(t("./Controllers/b2ConstantForceController"),i),n(t("./Controllers/b2GravityController"),i),n(t("./Controllers/b2TensorDampingController"),i),n(t("./Particle/b2Particle"),i),n(t("./Particle/b2ParticleGroup"),i),n(t("./Particle/b2ParticleSystem"),i),n(t("./Rope/b2Rope"),i),cc._RF.pop()},{"./Collision/Shapes/b2ChainShape":"b2ChainShape","./Collision/Shapes/b2CircleShape":"b2CircleShape","./Collision/Shapes/b2EdgeShape":"b2EdgeShape","./Collision/Shapes/b2PolygonShape":"b2PolygonShape","./Collision/Shapes/b2Shape":"b2Shape","./Collision/b2BroadPhase":"b2BroadPhase","./Collision/b2CollideCircle":"b2CollideCircle","./Collision/b2CollideEdge":"b2CollideEdge","./Collision/b2CollidePolygon":"b2CollidePolygon","./Collision/b2Collision":"b2Collision","./Collision/b2Distance":"b2Distance","./Collision/b2DynamicTree":"b2DynamicTree","./Collision/b2TimeOfImpact":"b2TimeOfImpact","./Common/b2BlockAllocator":"b2BlockAllocator","./Common/b2Draw":"b2Draw","./Common/b2GrowableStack":"b2GrowableStack","./Common/b2Math":"b2Math","./Common/b2Settings":"b2Settings","./Common/b2StackAllocator":"b2StackAllocator","./Common/b2Timer":"b2Timer","./Controllers/b2BuoyancyController":"b2BuoyancyController","./Controllers/b2ConstantAccelController":"b2ConstantAccelController","./Controllers/b2ConstantForceController":"b2ConstantForceController","./Controllers/b2Controller":"b2Controller","./Controllers/b2GravityController":"b2GravityController","./Controllers/b2TensorDampingController":"b2TensorDampingController","./Dynamics/Contacts/b2ChainAndCircleContact":"b2ChainAndCircleContact","./Dynamics/Contacts/b2ChainAndPolygonContact":"b2ChainAndPolygonContact","./Dynamics/Contacts/b2CircleContact":"b2CircleContact","./Dynamics/Contacts/b2Contact":"b2Contact","./Dynamics/Contacts/b2ContactFactory":"b2ContactFactory","./Dynamics/Contacts/b2ContactSolver":"b2ContactSolver","./Dynamics/Contacts/b2EdgeAndCircleContact":"b2EdgeAndCircleContact","./Dynamics/Contacts/b2EdgeAndPolygonContact":"b2EdgeAndPolygonContact","./Dynamics/Contacts/b2PolygonAndCircleContact":"b2PolygonAndCircleContact","./Dynamics/Contacts/b2PolygonContact":"b2PolygonContact","./Dynamics/Joints/b2AreaJoint":"b2AreaJoint","./Dynamics/Joints/b2DistanceJoint":"b2DistanceJoint","./Dynamics/Joints/b2FrictionJoint":"b2FrictionJoint","./Dynamics/Joints/b2GearJoint":"b2GearJoint","./Dynamics/Joints/b2Joint":"b2Joint","./Dynamics/Joints/b2MotorJoint":"b2MotorJoint","./Dynamics/Joints/b2MouseJoint":"b2MouseJoint","./Dynamics/Joints/b2PrismaticJoint":"b2PrismaticJoint","./Dynamics/Joints/b2PulleyJoint":"b2PulleyJoint","./Dynamics/Joints/b2RevoluteJoint":"b2RevoluteJoint","./Dynamics/Joints/b2RopeJoint":"b2RopeJoint","./Dynamics/Joints/b2WeldJoint":"b2WeldJoint","./Dynamics/Joints/b2WheelJoint":"b2WheelJoint","./Dynamics/b2Body":"b2Body","./Dynamics/b2ContactManager":"b2ContactManager","./Dynamics/b2Fixture":"b2Fixture","./Dynamics/b2Island":"b2Island","./Dynamics/b2TimeStep":"b2TimeStep","./Dynamics/b2World":"b2World","./Dynamics/b2WorldCallbacks":"b2WorldCallbacks","./Particle/b2Particle":"b2Particle","./Particle/b2ParticleGroup":"b2ParticleGroup","./Particle/b2ParticleSystem":"b2ParticleSystem","./Rope/b2Rope":"b2Rope"}],CheckBox:[function(t,e,i){"use strict";cc._RF.push(e,"9f1d99eakhEOpI88F2iT5KK","CheckBox");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../../frame/basic/EventerNoArgs"),a=t("../../lib/b2_extend/b2_element/B2ElementExtend"),c=t("../DataCenter"),l=cc._decorator,u=l.ccclass,_=l.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.actLab=null,e.activeNode=null,e.touchNode=null,e.evter=new s.default,e}return n(e,t),e.prototype.Init=function(t){var e=this;this.index=t;var i=a.default.rd.list[t],o=a.default.rd.nameDict.get(i);this.label.string=this.actLab.string=""+o,this.touchNode.on(cc.Node.EventType.TOUCH_START,function(){e.evter.Call()})},e.prototype.Refresh=function(){this.activeNode.active=c.default.vo.enableRec[this.index]},r([_(cc.Label)],e.prototype,"label",void 0),r([_(cc.Label)],e.prototype,"actLab",void 0),r([_(cc.Node)],e.prototype,"activeNode",void 0),r([_(cc.Node)],e.prototype,"touchNode",void 0),r([u],e)}(cc.Component);i.default=m,cc._RF.pop()},{"../../frame/basic/EventerNoArgs":"EventerNoArgs","../../lib/b2_extend/b2_element/B2ElementExtend":"B2ElementExtend","../DataCenter":"DataCenter"}],CollectionStorage:[function(t,e,i){"use strict";cc._RF.push(e,"7f427noUBlCb607hfQmqoHa","CollectionStorage"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./UtilCollection"),n=function(){function t(){this._core=new t.Core}return Object.defineProperty(t.prototype,"coll",{get:function(){return this._core.list},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this._core.add(t)},t.prototype.rem=function(t){this._core.rem(t)},t.prototype.select=function(e,i){return new t.Selector([this._core]).select(e,i)},t}();(function(t){var e=function(){function t(){this.collection=new Set,this._storage=new Map,this.list=[]}return t.prototype.add=function(e){this.collection.has(e)||(this.collection.add(e),this.RefreshList(),this._storage.forEach(function(i,o){var n=o(e);i.has(n)||i.set(n,new t),i.get(n).add(e)}))},t.prototype.rem=function(t){this.collection.has(t)&&(this.collection.delete(t),this.RefreshList(),this._storage.forEach(function(e,i){var o=i(t);e.get(o).rem(t)}))},t.prototype.initSelector=function(e){if(!this._storage.has(e)){var i=new Map;this._storage.set(e,i),this.collection.forEach(function(o){var n=e(o);i.has(n)||i.set(n,new t),i.get(n).add(o)})}},t.prototype.select=function(t,e){return this.initSelector(t),this._storage.get(t).get(e)},t.prototype.RefreshList=function(){this.list=o.default.GetSetCollection(this.collection)},t}();t.Core=e;var i=function(){function t(t){this._coreList=t}return t.prototype.select=function(e,i){var o=this._coreList.map(function(t){return t.select(e,i)});return new t(o=o.filter(function(t){return null!=t}))},t.prototype.GetCollection=function(){var t=[];return this._coreList.forEach(function(e){e.collection.forEach(function(e){t.push(e)})}),t},t}();t.Selector=i})(n||(n={})),i.default=n,cc._RF.pop()},{"./UtilCollection":"UtilCollection"}],ConfigBulletAIStraight:[function(t,e,i){"use strict";cc._RF.push(e,"aa261zFq/VHQIQwO8Wh5/J7","ConfigBulletAIStraight"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.id=t[0],this.speed=t[1],this.maxDistance=t[2]}return t.idGetter=function(t){return t.id},t.speedGetter=function(t){return t.speed},t.maxDistanceGetter=function(t){return t.maxDistance},t}();i.default=o,cc._RF.pop()},{}],ConfigBullet:[function(t,e,i){"use strict";cc._RF.push(e,"9481c29jWlH57Iho/0I2zNH","ConfigBullet"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.id=t[0],this.concaveId=t[1],this.sizeScale=t[2],this.effRelease=t[3],this.effHit=t[4]}return t.idGetter=function(t){return t.id},t.concaveIdGetter=function(t){return t.concaveId},t.sizeScaleGetter=function(t){return t.sizeScale},t.effReleaseGetter=function(t){return t.effRelease},t.effHitGetter=function(t){return t.effHit},t}();i.default=o,cc._RF.pop()},{}],ConfigCenter:[function(t,e,i){"use strict";cc._RF.push(e,"7b162auhgJA3rGBD5DdNO+P","ConfigCenter"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("./view/b2_example/B2ExamBuoyancy"),r=t("./view/b2_example/B2ExamCantilever"),s=t("./view/b2_example/B2ExamCharacterCollision"),a=t("./view/b2_example/B2ExamConveyorBelt"),c=t("./view/b2_example/B2ExamEdgeShapes"),l=t("./view/b2_example/B2ExamGearsA"),u=t("./view/b2_example/B2ExamGearsB"),_=t("./view/b2_example/B2ExamMobile"),m=t("./view/b2_example/B2ExamMobileBalanced"),h=t("./view/b2_example/B2ExamMotorJoint"),p=t("./view/b2_example/B2ExamOneSidePlatform"),f=t("./view/b2_example/B2ExamParticleCollisionFilter"),b=t("./view/b2_example/B2ExamPolyCollision"),d=t("./view/b2_example/B2ExamPulleys"),y=t("./view/b2_example/B2ExamRope"),v=t("./view/b2_example/B2ExamSegway"),V=t("./view/b2_example/B2ExamSensorTest"),x=t("./view/b2_example/B2ExamSparky"),C=t("./view/b2_example/B2ExamTheoJansen"),S=t("./view/b2_example/B2ExamTumber"),B=t("./view/b2_example/B2ExamVaryingRestitution"),g=t("./view/b2_example/B2ExamWaveMachine"),A=t("./view/b2_example/B2ExamWeb");(function(t){t.examArr=[{info:"Sparky",b2WorldCreator:x.default},{info:"Character Collision",b2WorldCreator:s.default},{info:"Tumber",b2WorldCreator:S.default},{info:"Motor Joint",b2WorldCreator:h.default},{info:"Mobile",b2WorldCreator:_.default},{info:"Mobile Balanced",b2WorldCreator:m.default},{info:"Segway",b2WorldCreator:v.default},{info:"Wave Machine",b2WorldCreator:g.default},{info:"Web",b2WorldCreator:A.default},{info:"Edge Shapes",b2WorldCreator:c.default},{info:"Buoyancy",b2WorldCreator:n.default},{info:"Poly Collision",b2WorldCreator:b.default},{info:"Conveyor Belt",b2WorldCreator:a.default},{info:"One Side Platform",b2WorldCreator:p.default},{info:"Gears A",b2WorldCreator:l.default},{info:"Gears B",b2WorldCreator:u.default},{info:"Varying Restitution",b2WorldCreator:B.default},{info:"Particle Collision Filter",b2WorldCreator:f.default},{info:"Theo Jansen",b2WorldCreator:C.default},{info:"Sensor Test",b2WorldCreator:V.default},{info:"Rope",b2WorldCreator:y.default},{info:"Cantilevel",b2WorldCreator:r.default},{info:"Pulleys",b2WorldCreator:d.default}],t.b2ShapeScale=20})(o||(o={})),i.default=o,cc._RF.pop()},{"./view/b2_example/B2ExamBuoyancy":"B2ExamBuoyancy","./view/b2_example/B2ExamCantilever":"B2ExamCantilever","./view/b2_example/B2ExamCharacterCollision":"B2ExamCharacterCollision","./view/b2_example/B2ExamConveyorBelt":"B2ExamConveyorBelt","./view/b2_example/B2ExamEdgeShapes":"B2ExamEdgeShapes","./view/b2_example/B2ExamGearsA":"B2ExamGearsA","./view/b2_example/B2ExamGearsB":"B2ExamGearsB","./view/b2_example/B2ExamMobile":"B2ExamMobile","./view/b2_example/B2ExamMobileBalanced":"B2ExamMobileBalanced","./view/b2_example/B2ExamMotorJoint":"B2ExamMotorJoint","./view/b2_example/B2ExamOneSidePlatform":"B2ExamOneSidePlatform","./view/b2_example/B2ExamParticleCollisionFilter":"B2ExamParticleCollisionFilter","./view/b2_example/B2ExamPolyCollision":"B2ExamPolyCollision","./view/b2_example/B2ExamPulleys":"B2ExamPulleys","./view/b2_example/B2ExamRope":"B2ExamRope","./view/b2_example/B2ExamSegway":"B2ExamSegway","./view/b2_example/B2ExamSensorTest":"B2ExamSensorTest","./view/b2_example/B2ExamSparky":"B2ExamSparky","./view/b2_example/B2ExamTheoJansen":"B2ExamTheoJansen","./view/b2_example/B2ExamTumber":"B2ExamTumber","./view/b2_example/B2ExamVaryingRestitution":"B2ExamVaryingRestitution","./view/b2_example/B2ExamWaveMachine":"B2ExamWaveMachine","./view/b2_example/B2ExamWeb":"B2ExamWeb"}],ConfigCommon:[function(t,e,i){"use strict";cc._RF.push(e,"26e65DhJ+VMqJfPs3obdhNP","ConfigCommon"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.planeSpeed=t[0]}return t.planeSpeedGetter=function(t){return t.planeSpeed},t}();i.default=o,cc._RF.pop()},{}],ConfigConave:[function(t,e,i){"use strict";cc._RF.push(e,"6d2343RfrVE0KhRyKheP4vB","ConfigConave"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.id=t[0],this.prefabName=t[1],this.dotArr=t[2],this.gunTransform=t[3]}return t.idGetter=function(t){return t.id},t.prefabNameGetter=function(t){return t.prefabName},t.dotArrGetter=function(t){return t.dotArr},t.gunTransformGetter=function(t){return t.gunTransform},t}();i.default=o,cc._RF.pop()},{}],ConfigEff:[function(t,e,i){"use strict";cc._RF.push(e,"36d762KnwZGL7WoVGA+5WVZ","ConfigEff"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.id=t[0],this.res=t[1],this.keepTime=t[2]}return t.idGetter=function(t){return t.id},t.resGetter=function(t){return t.res},t.keepTimeGetter=function(t){return t.keepTime},t}();i.default=o,cc._RF.pop()},{}],ConfigGun:[function(t,e,i){"use strict";cc._RF.push(e,"20054xfRDdDCaJ6BJrm7y6f","ConfigGun"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.id=t[0],this.bullet=t[1],this.cd=t[2],this.aiType=t[3],this.aiID=t[4]}return t.idGetter=function(t){return t.id},t.bulletGetter=function(t){return t.bullet},t.cdGetter=function(t){return t.cd},t.aiTypeGetter=function(t){return t.aiType},t.aiIDGetter=function(t){return t.aiID},t}();i.default=o,cc._RF.pop()},{}],ConfigMixMark:[function(t,e,i){"use strict";cc._RF.push(e,"dad624ShdFFMLKII8rKcaeG","ConfigMixMark"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.desc=t[0],this.name=t[1],this.postivePlane=t[2],this.postiveBullet=t[3],this.antiPlane=t[4],this.antiBullet=t[5]}return t.descGetter=function(t){return t.desc},t.nameGetter=function(t){return t.name},t.postivePlaneGetter=function(t){return t.postivePlane},t.postiveBulletGetter=function(t){return t.postiveBullet},t.antiPlaneGetter=function(t){return t.antiPlane},t.antiBulletGetter=function(t){return t.antiBullet},t}();i.default=o,cc._RF.pop()},{}],ConfigPlane:[function(t,e,i){"use strict";cc._RF.push(e,"d6fcaWn9EVKYJa8/FFqpm+l","ConfigPlane"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.id=t[0],this.concaveId=t[1],this.sizeScale=t[2],this.gunId=t[3],this.turnSpeed=t[4]}return t.idGetter=function(t){return t.id},t.concaveIdGetter=function(t){return t.concaveId},t.sizeScaleGetter=function(t){return t.sizeScale},t.gunIdGetter=function(t){return t.gunId},t.turnSpeedGetter=function(t){return t.turnSpeed},t}();i.default=o,cc._RF.pop()},{}],ConfigRelease:[function(t,e,i){"use strict";cc._RF.push(e,"83384M+hLZCPrGD0WUUItAn","ConfigRelease"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){this.id=t[0],this.res=t[1],this.size=t[2],this.keepTime=t[3]}return t.idGetter=function(t){return t.id},t.resGetter=function(t){return t.res},t.sizeGetter=function(t){return t.size},t.keepTimeGetter=function(t){return t.keepTime},t}();i.default=o,cc._RF.pop()},{}],DataCenter:[function(t,e,i){"use strict";cc._RF.push(e,"21108u4+cxK5LsHBjwd1p7z","DataCenter"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../frame/basic/UtilObject");(function(t){t.vo={selectExam:0,enableRec:{}}})(o||(o={})),window.dc=o;var r=localStorage.getItem("DataCenter"),s=null!=r&&""!=r?JSON.parse(r):null;o.vo=n.default.Merge(o.vo,s),cc.game.on(cc.game.EVENT_HIDE,function(){localStorage.setItem("DataCenter",JSON.stringify(o.vo))}),i.default=o,cc._RF.pop()},{"../frame/basic/UtilObject":"UtilObject"}],Define:[function(t,e,i){"use strict";cc._RF.push(e,"be10c3RWyNJoKnwCdH/2Xa/","Define"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],EmptyPromiseCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"88be47Kt6RJN6TFxP6HXEwJ","EmptyPromiseCtrl"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){var t=this;this._resolve=null,this._reject=null,this.promise=new Promise(function(e,i){t._resolve=e,t._reject=i}),this.promise.then(function(){t._isResolved=!0}),this.promise.catch(function(){t._isRejected=!0})}return Object.defineProperty(t.prototype,"isResolved",{get:function(){return this._isResolved},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRejected",{get:function(){return this._isRejected},enumerable:!1,configurable:!0}),t.prototype.resolve=function(){this._resolve()},t.prototype.reject=function(t){this._reject(t)},t}();i.default=o,cc._RF.pop()},{}],EventerNoArgs:[function(t,e,i){"use strict";cc._RF.push(e,"9e0c6C5pv1Gr5aJ/XcbG+av","EventerNoArgs"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../frame/basic/IdGeneration"),n=function(){function t(){this._idGen=new o.default,this._listenMap=new Map}return t.prototype.Once=function(t){var e,i=this;e=this.On(function(){i.Off(e),t()})},t.prototype.On=function(t){var e=this._idGen.GenId();return this._listenMap.set(e,t),e},t.prototype.Off=function(t){this._listenMap.delete(t)},t.prototype.Call=function(){this._listenMap.forEach(function(t){t()})},t}();i.default=n,cc._RF.pop()},{"../../frame/basic/IdGeneration":"IdGeneration"}],EventerWithArgs:[function(t,e,i){"use strict";cc._RF.push(e,"2bcc0IQpLpKqLJuifp2JIYS","EventerWithArgs"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../frame/basic/IdGeneration"),n=function(){function t(){this._idGen=new o.default,this._listenMap=new Map}return t.prototype.Once=function(t){var e,i=this;e=this.On(function(o){i.Off(e),t(o)})},t.prototype.On=function(t){var e=this._idGen.GenId();return this._listenMap.set(e,t),e},t.prototype.Off=function(t){this._listenMap.delete(t)},t.prototype.Call=function(t){this._listenMap.forEach(function(e){e(t)})},t}();i.default=n,cc._RF.pop()},{"../../frame/basic/IdGeneration":"IdGeneration"}],ExamContext:[function(t,e,i){"use strict";cc._RF.push(e,"fff62mpJB5MVr405QVPpktn","ExamContext"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../frame/basic/EventerWithArgs"),n=t("../../lib/box2d_ts/Box2D"),r=function(){function t(t){this.evterUpdate=new o.default,this.evterKeyDown=new o.default,this.b2w=t;var e=new n.b2BodyDef;this.ground=this.b2w.CreateBody(e),this.evterUpdate.On(function(e){t.Step(e,8,8,8)})}return t.prototype.MouseDown=function(t){var e;if(this.b2w.QueryPointAABB(t,function(i){return i.GetBody().GetType()!==n.b2BodyType.b2_dynamicBody||!i.TestPoint(t)||(e=i,!1)}),e){var i=e.GetBody(),o=new n.b2MouseJointDef;o.bodyA=this.ground,o.bodyB=i,o.target.Copy(t),o.maxForce=1e3*i.GetMass(),this.m_mouseJoint=this.b2w.CreateJoint(o),i.SetAwake(!0)}},t.prototype.MouseMove=function(t){this.m_mouseJoint&&this.m_mouseJoint.SetTarget(t)},t.prototype.MouseUp=function(){this.m_mouseJoint&&(this.b2w.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null)},t}();i.default=r,cc._RF.pop()},{"../../frame/basic/EventerWithArgs":"EventerWithArgs","../../lib/box2d_ts/Box2D":"Box2D"}],FrameMsClock:[function(t,e,i){"use strict";cc._RF.push(e,"54284gSZYxBhLtuTdzqdqrL","FrameMsClock"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./EventerWithArgs"),n=t("./UtilDecoration"),r=function(){function t(){var t=this;this.evntMsPassed=new o.default,this.Resume=n.default.Radio("pauseResume",function(){t._lastTimer=Date.now();var e=function(){new Promise(function(e){t._lastTimeout=setTimeout(function(){t.CheckTimePass(),e(null)},15)}).then(e)};e()}),this.Pause=n.default.Radio("pauseResume",function(){clearTimeout(t._lastTimeout),t.CheckTimePass()})}return t.prototype.CheckTimePass=function(){var t=Date.now(),e=t-this._lastTimer;this._lastTimer=t,this.evntMsPassed.Call(e)},t}();i.default=r,cc._RF.pop()},{"./EventerWithArgs":"EventerWithArgs","./UtilDecoration":"UtilDecoration"}],GraphicsDrawer:[function(t,e,i){"use strict";cc._RF.push(e,"77f64c5UVBHKoNydI7/u01X","GraphicsDrawer"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e){this._graphics=t,this._posScale=e}return t.prototype.FillPosSetAll=function(t,e){this.FillPosOrigin(t,t.length,e)},t.prototype.FillPosOrigin=function(t,e,i){this._graphics.fillColor=i,this.GraphMoveTo(t[0].x,t[0].y);for(var o=1;o<e;o++)this.GraphLineTo(t[o].x,t[o].y);this.GraphLineTo(t[0].x,t[0].y),this._graphics.fill()},t.prototype.CyclePosSetAll=function(t,e,i){this.CyclePosOrigin(t,t.length,e,i)},t.prototype.CyclePosOrigin=function(t,e,i,o){for(var n=0;n<e;n++){var r=t[n],s=t[(n+1)%t.length];this.StraightLine(r.x,r.y,s.x,s.y,i,o)}},t.prototype.ConnectPosSetAll=function(t,e,i){this.ConnectPosOrigin(t,t.length,e,i)},t.prototype.ConnectPosOrigin=function(t,e,i,o){for(var n=0;n<e-1;n++){var r=t[n],s=t[(n+1)%t.length];this.StraightLine(r.x,r.y,s.x,s.y,i,o)}},t.prototype.RoundFill=function(t,e,i,o){this._graphics.fillColor=o,this.GraphArc(t,e,i),this._graphics.fill()},t.prototype.RoundLine=function(t,e,i,o,n){this._graphics.strokeColor=n,this._graphics.lineWidth=o*this._posScale,this.GraphArc(t,e,i),this._graphics.stroke()},t.prototype.StraightLine=function(t,e,i,o,n,r){this._graphics.strokeColor=r,this._graphics.lineWidth=n*this._posScale,this.GraphMoveTo(t,e),this.GraphLineTo(i,o),this._graphics.stroke()},t.prototype.Pixel=function(t){return t/this._posScale},t.prototype.GraphMoveTo=function(t,e){this._graphics.moveTo(t*this._posScale,e*this._posScale)},t.prototype.GraphLineTo=function(t,e){this._graphics.lineTo(t*this._posScale,e*this._posScale)},t.prototype.GraphArc=function(t,e,i){this._graphics.arc(t*this._posScale,e*this._posScale,i*this._posScale,0,360,!0)},t}();i.default=o,cc._RF.pop()},{}],IdGeneration:[function(t,e,i){"use strict";cc._RF.push(e,"9ab23ErThRBvrDtC0KJvYYd","IdGeneration"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this._genId=0}return Object.defineProperty(t.prototype,"lastGenId",{get:function(){return this._genId},enumerable:!1,configurable:!0}),t.prototype.GenId=function(){return++this._genId},t}();i.default=o,cc._RF.pop()},{}],Index:[function(t,e,i){"use strict";cc._RF.push(e,"d7819nkjN1AYpU2Tl6LAh5j","Index");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0}),i.Index=void 0;var s=t("../game/view/ViewMain"),a=t("./Jiang"),c=cc._decorator,l=c.ccclass,u=c.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.uiContainer=null,e}return n(e,t),e.prototype.onLoad=function(){a.default.Init(this.uiContainer).then(function(){a.default.mgrView.OpenNoArgsView(s.default.registMsg)})},r([u({displayName:"\u653e\u7f6eUI\u5b9e\u4f8b\u9884\u5236\u4f53\u7684\u5bb9\u5668",type:cc.Node})],e.prototype,"uiContainer",void 0),r([l],e)}(cc.Component);i.Index=_,cc._RF.pop()},{"../game/view/ViewMain":"ViewMain","./Jiang":"Jiang"}],Jiang:[function(t,e,i){"use strict";cc._RF.push(e,"f9c47OTgi9KcoZ2z7PfSfCG","Jiang"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("./config/MgrCfg"),r=t("./res/MgrRes"),s=t("./view/MgrView"),a=t("./view/MgrViewInitData");(function(t){t.mgrRes=r.default.inst,t.mgrView=s.default.inst,t.mgrCfg=n.default.inst,t.Init=function(e){return t.mgrRes.Init(),t.mgrView.Init(new a.default(e)),Promise.all(t.mgrCfg.Init())}})(o||(o={})),window.jiang=o,i.default=o,cc._RF.pop()},{"./config/MgrCfg":"MgrCfg","./res/MgrRes":"MgrRes","./view/MgrView":"MgrView","./view/MgrViewInitData":"MgrViewInitData"}],MgrCfg:[function(t,e,i){"use strict";cc._RF.push(e,"25959Qu1GdIooV2XbLPPRvd","MgrCfg"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../basic/CollectionStorage"),n=t("../res/MgrRes"),r=t("./src/ConfigBulletAIStraight"),s=t("./src/ConfigBullet"),a=t("./src/ConfigCommon"),c=t("./src/ConfigEff"),l=t("./src/ConfigGun"),u=t("./src/ConfigMixMark"),_=t("./src/ConfigPlane"),m=t("./src/ConfigConave"),h=function(){function t(){this.configBulletAIStraight=new o.default,this.configBullet=new o.default,this.configCommon=new o.default,this.configEff=new o.default,this.configGun=new o.default,this.configMixMark=new o.default,this.configPlane=new o.default,this.configConave=new o.default}return t.prototype.Init=function(){var t=this;return[n.default.inst.CertainLoadJson("./config/ConfigBulletAIStraight").loadingPromise.then(function(e){e.json.forEach(function(e){t.configBulletAIStraight.add(new r.default(e))})}),n.default.inst.CertainLoadJson("./config/ConfigBullet").loadingPromise.then(function(e){e.json.forEach(function(e){t.configBullet.add(new s.default(e))})}),n.default.inst.CertainLoadJson("./config/ConfigCommon").loadingPromise.then(function(e){e.json.forEach(function(e){t.configCommon.add(new a.default(e))})}),n.default.inst.CertainLoadJson("./config/ConfigEff").loadingPromise.then(function(e){e.json.forEach(function(e){t.configEff.add(new c.default(e))})}),n.default.inst.CertainLoadJson("./config/ConfigGun").loadingPromise.then(function(e){e.json.forEach(function(e){t.configGun.add(new l.default(e))})}),n.default.inst.CertainLoadJson("./config/ConfigMixMark").loadingPromise.then(function(e){e.json.forEach(function(e){t.configMixMark.add(new u.default(e))})}),n.default.inst.CertainLoadJson("./config/ConfigPlane").loadingPromise.then(function(e){e.json.forEach(function(e){t.configPlane.add(new _.default(e))})}),n.default.inst.CertainLoadJson("./config/ConfigConave").loadingPromise.then(function(e){e.json.forEach(function(e){t.configConave.add(new m.default(e))})})]},t.inst=new t,t}();i.default=h,cc._RF.pop()},{"../basic/CollectionStorage":"CollectionStorage","../res/MgrRes":"MgrRes","./src/ConfigBullet":"ConfigBullet","./src/ConfigBulletAIStraight":"ConfigBulletAIStraight","./src/ConfigCommon":"ConfigCommon","./src/ConfigConave":"ConfigConave","./src/ConfigEff":"ConfigEff","./src/ConfigGun":"ConfigGun","./src/ConfigMixMark":"ConfigMixMark","./src/ConfigPlane":"ConfigPlane"}],MgrRes:[function(t,e,i){"use strict";cc._RF.push(e,"d4a64Nu+j1D6IuFQlJWKOzb","MgrRes"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../basic/ArgsPromiseCtrl"),n=function(){function t(){this._prefabCtrlRec=new Map,this._jsonCtrlRec=new Map}return t.prototype.Init=function(){return[Promise.resolve()]},t.prototype.CertainLoadPrefab=function(t){var e=this._prefabCtrlRec.get(t);return null==e&&(e=this.DoLoadPrefab(t),this._prefabCtrlRec.set(t,e)),e},t.prototype.DoLoadPrefab=function(e){var i=new o.default;return cc.resources.load(e,function(t){t?i.reject(t):i.resolve(cc.resources.get(e))}),new t.AssetLoadCtrl(i.promise)},t.prototype.CertainLoadJson=function(t){var e=this._jsonCtrlRec.get(t);return null==e&&(e=this.DoLoadJson(t),this._jsonCtrlRec.set(t,e)),e},t.prototype.DoLoadJson=function(e){var i=new o.default;return cc.resources.load(e,function(t){t?i.reject(t):i.resolve(cc.resources.get(e))}),new t.AssetLoadCtrl(i.promise)},t.inst=new t,t}();(function(t){t.AssetLoadCtrl=function(t){this.loadingPromise=null,this.loadingPromise=t}})(n||(n={})),i.default=n,cc._RF.pop()},{"../basic/ArgsPromiseCtrl":"ArgsPromiseCtrl"}],MgrViewBasicCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"248caRTdR9HfJN8aWXTsSIw","MgrViewBasicCtrl"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../basic/EmptyPromiseCtrl");i.default=function(){this.ctrlClear=new o.default},cc._RF.pop()},{"../basic/EmptyPromiseCtrl":"EmptyPromiseCtrl"}],MgrViewBasicRegistMsg:[function(t,e,i){"use strict";cc._RF.push(e,"bc64bB5K0BD7LHzifkmLmQK","MgrViewBasicRegistMsg"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(t,e){this.prefabName=null,this.viewType=null,this.prefabName=t,this.viewType=e},cc._RF.pop()},{}],MgrViewInitData:[function(t,e,i){"use strict";cc._RF.push(e,"4af6472txpMtp/dKDAOEsWx","MgrViewInitData"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(t){this.container=t},cc._RF.pop()},{}],MgrViewNoArgsViewBasic:[function(t,e,i){"use strict";cc._RF.push(e,"96b0bddhO9BFbFWMC3rhxh+","MgrViewNoArgsViewBasic");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.SetInitData=function(t){this.ctrl=t},e.prototype.Close=function(){this.ctrl.ctrlClear.resolve()},e}(cc.Component);i.default=r,cc._RF.pop()},{}],MgrViewOpenCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"16386goMjhNZ55UasNdTUeI","MgrViewOpenCtrl");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(e){var i=t.call(this)||this;return i.promise=null,i.promise=e,i}return n(e,t),e}(t("./MgrViewBasicCtrl").default);i.default=r,cc._RF.pop()},{"./MgrViewBasicCtrl":"MgrViewBasicCtrl"}],MgrViewWithArgsRegistMsg:[function(t,e,i){"use strict";cc._RF.push(e,"dd8cc/NQOFAlbiWhV95PaFl","MgrViewWithArgsRegistMsg");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(t("./MgrViewBasicRegistMsg").default);i.default=r,cc._RF.pop()},{"./MgrViewBasicRegistMsg":"MgrViewBasicRegistMsg"}],MgrViewWithArgsViewBasic:[function(t,e,i){"use strict";cc._RF.push(e,"70e8dpWyqtHiZseILRnmX4z","MgrViewWithArgsViewBasic");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.OnFillData=function(t){this.initData=t,this.onDataInited()},e.prototype.onDataInited=function(){},e}(t("./MgrViewNoArgsViewBasic").default);i.default=r,cc._RF.pop()},{"./MgrViewNoArgsViewBasic":"MgrViewNoArgsViewBasic"}],MgrView:[function(t,e,i){"use strict";cc._RF.push(e,"95da60MKH9AT5u/deqhIGXQ","MgrView"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../basic/ArgsPromiseCtrl"),n=t("../res/MgrRes"),r=t("../Setting"),s=t("./MgrViewOpenCtrl"),a=function(){function t(){this.initData=null}return t.prototype.Init=function(t){return this.initData=t,[Promise.resolve()]},t.prototype.Waiting=function(){},t.prototype.OpenNoArgsView=function(t){var e=this,i=new o.default,a=new s.default(i.promise);return n.default.inst.CertainLoadPrefab(r.default.uiPrefabFolderDir+"/"+t.prefabName).loadingPromise.then(function(o){if(!a.ctrlClear.isResolved){var n=cc.instantiate(o);a.ctrlClear.promise.then(function(){n.destroy()}),e.initData.container.addChild(n);var r=n.getComponent(t.viewType());r.SetInitData(a),i.resolve(r)}}).catch(function(t){i.reject(t)}),a},t.prototype.OpenWithArgsView=function(t,e){var i=this.OpenNoArgsView(t);return i.promise.then(function(t){t.OnFillData(e)}),i},t.inst=new t,t}();i.default=a,cc._RF.pop()},{"../Setting":"Setting","../basic/ArgsPromiseCtrl":"ArgsPromiseCtrl","../res/MgrRes":"MgrRes","./MgrViewOpenCtrl":"MgrViewOpenCtrl"}],MulCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"bb5c6l7FUhJLrmJtywkXx2d","MulCtrl");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){var e=t.call(this)||this;return e._val=1,e.evntChanged.On(function(){e._val=1,e.appRec.forEach(function(t){e._val*=t})}),e}return n(e,t),Object.defineProperty(e.prototype,"val",{get:function(){return this._val},enumerable:!1,configurable:!0}),e}(t("./ApplyCtrl").default);i.default=r,cc._RF.pop()},{"./ApplyCtrl":"ApplyCtrl"}],RDClass:[function(t,e,i){"use strict";cc._RF.push(e,"3b383CCVN9DXo0/vQJoiCdZ","RDClass"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(t){this.cont=t},cc._RF.pop()},{}],RadioBtn:[function(t,e,i){"use strict";cc._RF.push(e,"656b7Gp2cdOg7TKVlaUPZ94","RadioBtn");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../../frame/basic/EventerNoArgs"),a=t("../ConfigCenter"),c=t("../DataCenter"),l=cc._decorator,u=l.ccclass,_=l.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.touchNode=null,e.evter=new s.default,e}return n(e,t),e.prototype.Init=function(t){var e=this;this.index=t;var i=a.default.examArr[t];this.label.string=""+i.info,this.touchNode.on(cc.Node.EventType.TOUCH_START,function(){e.evter.Call()})},e.prototype.Refresh=function(){this.touchNode.active=this.index!=c.default.vo.selectExam},r([_(cc.Label)],e.prototype,"label",void 0),r([_(cc.Node)],e.prototype,"touchNode",void 0),r([u],e)}(cc.Component);i.default=m,cc._RF.pop()},{"../../frame/basic/EventerNoArgs":"EventerNoArgs","../ConfigCenter":"ConfigCenter","../DataCenter":"DataCenter"}],RegistDefine:[function(t,e,i){"use strict";cc._RF.push(e,"0be984EA3lOVoLA+9DmtYlG","RegistDefine"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e,i){if(this.list=[],this.map=new Map,this.nameDict=new Map,null!=t)for(var o in t){var n=t[o];n instanceof e&&(this.nameDict.set(n.cont,o),this.list.push(n.cont),this.map.set(i(n.cont),n.cont))}}return t.prototype.GetRegMsg=function(t){return this.map.get(t)},t}();i.default=o,cc._RF.pop()},{}],Setting:[function(t,e,i){"use strict";cc._RF.push(e,"f20a4AlYcxL8bKDVtWZ6RSn","Setting"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("./view/MgrViewWithArgsRegistMsg"),r=t("./com/ViewLoading");(function(t){t.uiPrefabFolderDir="view",t.registMsg=new n.default("loading",function(){return r.default})})(o||(o={})),i.default=o,cc._RF.pop()},{"./com/ViewLoading":"ViewLoading","./view/MgrViewWithArgsRegistMsg":"MgrViewWithArgsRegistMsg"}],UnitaryCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"7a386sHXZBN95p3KDI/EVVB","UnitaryCtrl"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this._val=null,this._callBackList=[]}return Object.defineProperty(t.prototype,"val",{get:function(){return this._val},enumerable:!1,configurable:!0}),t.prototype.Apply=function(t){t!=this._val&&(this._val=t,this.OnChange(),this._callBackList.forEach(function(t){t()}))},t.prototype.ListenChange=function(t){this._callBackList.push(t)},t.prototype.OnChange=function(){},t}();i.default=o,cc._RF.pop()},{}],UtilCollection:[function(t,e,i){"use strict";var o;cc._RF.push(e,"55caaCnz8ZP0YdaveWOXhne","UtilCollection"),Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.CloneSet=function(t){var e=new Set;return t.forEach(function(t){e.add(t)}),e},t.GetMapCollection=function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},t.GetSetCollection=function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},t.GetCollSet=function(t){var e=new Set;return t.forEach(function(t){e.add(t)}),e}}(o||(o={})),i.default=o,cc._RF.pop()},{}],UtilColor:[function(t,e,i){"use strict";cc._RF.push(e,"52541Ayjj1B7bPmZxS2hUj0","UtilColor"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],UtilDecoration:[function(t,e,i){"use strict";var o;cc._RF.push(e,"21973bQ7NdGd5vVZI82uS5f","UtilDecoration"),Object.defineProperty(i,"__esModule",{value:!0}),function(t){var e=Symbol("utilDecoration");t.Radio=function(t,i){var o=(this[e]||(this[e]=new Map),this[e]);return function(){o.get(t)!=i&&(o.set(t,i),i())}}}(o||(o={})),i.default=o,cc._RF.pop()},{}],UtilMath:[function(t,e,i){"use strict";var o;cc._RF.push(e,"e24fedBqyNFs6jtqj3+dXfx","UtilMath"),Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.MoveTo=function(t,e,i,o,n){var r=i-t,s=o-e,a=Math.sqrt(Math.pow(r,2)+Math.pow(s,2));if(a<=n)return{x:i,y:o};var c=n/a;return{x:t+r*c,y:e+s*c}},t.TurnTo=function(t,e,i,o){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(o))return console.warn("\u53c2\u6570\u975e\u6cd5"),i;for(var n=Math.atan2(t,e)/Math.PI*180;n<0;)n+=360;for(;360<n;)n-=360;for(;i<0;)i+=360;for(;360<i;)i-=360;return Math.abs(n-i)<=o?n:i<=180?i<n&&n<i+180?i+o:i-o:n<i&&i-180<n?i-o:i+o},t.SIN90=Math.sin(Math.PI/2),t.COS90=Math.cos(Math.PI/2),t.SIN_90=Math.sin(-Math.PI/2),t.COS_90=Math.cos(-Math.PI/2),t.GetRightVecX=function(e,i){return e*t.COS_90-i*t.SIN_90},t.GetRightVecY=function(e,i){return i*t.COS_90+e*t.SIN_90},t.GetShadowPos=function(t,e,i,o){return t*i+e*o},t.Get2DRotateMat=function(t){var e=Math.cos(t),i=Math.sin(t);return[e,-i,0,i,e,0,0,0,1]},t.Get2DPosMat=function(t,e){return[1,0,t,0,1,e,0,0,1]},t.Merge2DMat=function(){return[]}}(o||(o={})),i.default=o,cc._RF.pop()},{}],UtilObject:[function(t,e,i){"use strict";cc._RF.push(e,"aa344Bqw35Mk6XqA7tzv9Uz","UtilObject"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("./UtilCollection");(function(t){function e(t){return JSON.parse(JSON.stringify(t))}t.Merge=function t(i,o){if(null==i)return e(o);if(null==o)return e(i);var r=typeof i;if(r!=typeof o)return e(o);if(Array.isArray(o))return e(o);if("object"==r){var s=e(i),a=new Set;return n.default.GetCollSet(Object.keys(i)).forEach(function(t){a.add(t)}),n.default.GetCollSet(Object.keys(o)).forEach(function(t){a.add(t)}),a.forEach(function(e){s[e]=t(s[e],o[e])}),s}return e(o)},t.Clone=e})(o||(o={})),i.default=o,cc._RF.pop()},{"./UtilCollection":"UtilCollection"}],ViewLoading:[function(t,e,i){"use strict";cc._RF.push(e,"fdf35O2jzhILqPcKiKIxHjY","ViewLoading");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.OnFillData=function(){},r([a],e)}(t("../view/MgrViewWithArgsViewBasic").default));i.default=c,cc._RF.pop()},{"../view/MgrViewWithArgsViewBasic":"MgrViewWithArgsViewBasic"}],ViewMain:[function(t,e,i){"use strict";cc._RF.push(e,"b2fb4wkCwxEUqyCixw54nfi","ViewMain");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../../frame/view/ViewRegistMsg"),a=t("../../frame/view/MgrViewNoArgsViewBasic"),c=t("../component/RadioBtn"),l=t("../../frame/basic/EventerWithArgs"),u=t("../../lib/box2d_ts/Box2D"),_=t("../../frame/basic/FrameMsClock"),m=t("../component/Box2DDrawer"),h=t("../DataCenter"),p=t("../ConfigCenter"),f=cc._decorator,b=f.ccclass,d=f.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.radioContainer=null,e.radioBtnPrefab=null,e.touchNode=null,e}var i;return n(e,t),i=e,e.prototype.onLoad=function(){var t,e=this;this.radioContainer.removeAllChildren();var i=new l.default,o=[];p.default.examArr.forEach(function(t,n){var r=cc.instantiate(e.radioBtnPrefab).getComponent(c.default);e.radioContainer.addChild(r.node),r.Init(n),r.evter.On(function(){i.Call(n)}),o.push(r)}),i.On(function(e){h.default.vo.selectExam=e;var i=p.default.examArr[e];t=i.b2WorldCreator?i.b2WorldCreator():null,m.default.inst.DrawB2World(t&&t.b2w),o.forEach(function(t){t.Refresh()})});var n=0;0<=h.default.vo.selectExam&&h.default.vo.selectExam<=p.default.examArr.length-1&&(n=h.default.vo.selectExam),i.Call(n);var r=new _.default;r.evntMsPassed.On(function(e){if(null!=t){var i=16<e?.016:e/1e3;m.default.inst.DrawB2World(t.b2w),t.evterUpdate.Call(i)}}),r.Resume(),this.touchNode.on(cc.Node.EventType.TOUCH_START,function(i){var o=i.getLocationX(),n=i.getLocationY();t&&t.MouseDown(e.GetTouchNode(o,n))}),this.touchNode.on(cc.Node.EventType.TOUCH_MOVE,function(i){var o=i.getLocationX(),n=i.getLocationY();t&&t.MouseMove(e.GetTouchNode(o,n))}),this.touchNode.on(cc.Node.EventType.TOUCH_END,function(i){var o=i.getLocationX(),n=i.getLocationY();t&&t.MouseUp(e.GetTouchNode(o,n))}),this.touchNode.on(cc.Node.EventType.TOUCH_CANCEL,function(i){var o=i.getLocationX(),n=i.getLocationY();t&&t.MouseUp(e.GetTouchNode(o,n))}),document.onkeydown=function(e){t&&t.evterKeyDown.Call(e.key)}},e.prototype.GetTouchNode=function(t,e){var i=t-this.node.width/2,o=e-this.node.height/2;return new u.b2Vec2(i/p.default.b2ShapeScale,o/p.default.b2ShapeScale)},e.registMsg=new s.default("view_main",function(){return i}),r([d(cc.Node)],e.prototype,"radioContainer",void 0),r([d(cc.Prefab)],e.prototype,"radioBtnPrefab",void 0),r([d(cc.Node)],e.prototype,"touchNode",void 0),i=r([b],e)}(a.default);i.default=y,cc._RF.pop()},{"../../frame/basic/EventerWithArgs":"EventerWithArgs","../../frame/basic/FrameMsClock":"FrameMsClock","../../frame/view/MgrViewNoArgsViewBasic":"MgrViewNoArgsViewBasic","../../frame/view/ViewRegistMsg":"ViewRegistMsg","../../lib/box2d_ts/Box2D":"Box2D","../ConfigCenter":"ConfigCenter","../DataCenter":"DataCenter","../component/Box2DDrawer":"Box2DDrawer","../component/RadioBtn":"RadioBtn"}],ViewRegistMsg:[function(t,e,i){"use strict";cc._RF.push(e,"970d7wxXWdMZqByfMj6sb2G","ViewRegistMsg");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(t("./MgrViewBasicRegistMsg").default);i.default=r,cc._RF.pop()},{"./MgrViewBasicRegistMsg":"MgrViewBasicRegistMsg"}],b2AreaJoint:[function(t,e,i){"use strict";cc._RF.push(e,"94848TzCctGcpocAsaEpbIo","b2AreaJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2AreaJoint=i.b2AreaJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=t("./b2DistanceJoint"),l=function(t){function e(){var e=t.call(this,a.b2JointType.e_areaJoint)||this;return e.bodies=[],e.frequencyHz=0,e.dampingRatio=0,e}return n(e,t),e.prototype.AddBody=function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)},e}(a.b2JointDef);i.b2AreaJointDef=l;var u=function(t){function e(e){var i=t.call(this,e)||this;i.m_frequencyHz=0,i.m_dampingRatio=0,i.m_impulse=0,i.m_targetArea=0,i.m_delta=new s.b2Vec2,i.m_bodies=e.bodies,i.m_frequencyHz=r.b2Maybe(e.frequencyHz,0),i.m_dampingRatio=r.b2Maybe(e.dampingRatio,0),i.m_targetLengths=r.b2MakeNumberArray(e.bodies.length),i.m_normals=s.b2Vec2.MakeArray(e.bodies.length),i.m_joints=[],i.m_deltas=s.b2Vec2.MakeArray(e.bodies.length);var o=new c.b2DistanceJointDef;o.frequencyHz=i.m_frequencyHz,o.dampingRatio=i.m_dampingRatio,i.m_targetArea=0;for(var n=0;n<i.m_bodies.length;++n){var a=i.m_bodies[n],l=i.m_bodies[(n+1)%i.m_bodies.length],u=a.GetWorldCenter(),_=l.GetWorldCenter();i.m_targetLengths[n]=s.b2Vec2.DistanceVV(u,_),i.m_targetArea+=s.b2Vec2.CrossVV(u,_),o.Initialize(a,l,u,_),i.m_joints[n]=a.GetWorld().CreateJoint(o)}return i.m_targetArea*=.5,i}return n(e,t),e.prototype.GetAnchorA=function(t){return t},e.prototype.GetAnchorB=function(t){return t},e.prototype.GetReactionForce=function(t,e){return e},e.prototype.GetReactionTorque=function(){return 0},e.prototype.SetFrequency=function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.Dump=function(t){t("Area joint dumping is not supported.\n")},e.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],o=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,r=t.positions[o.m_islandIndex].c,a=this.m_deltas[e];s.b2Vec2.SubVV(r,n,a)}if(t.step.warmStarting)for(this.m_impulse*=t.step.dtRatio,e=0;e<this.m_bodies.length;++e){var c=this.m_bodies[e],l=t.velocities[c.m_islandIndex].v;a=this.m_deltas[e],l.x+=c.m_invMass*a.y*.5*this.m_impulse,l.y+=c.m_invMass*-a.x*.5*this.m_impulse}else this.m_impulse=0},e.prototype.SolveVelocityConstraints=function(t){for(var e=0,i=0,o=0;o<this.m_bodies.length;++o){var n=this.m_bodies[o],r=t.velocities[n.m_islandIndex].v;e+=(c=this.m_deltas[o]).LengthSquared()/n.GetMass(),i+=s.b2Vec2.CrossVV(r,c)}var a=-2*i/e;for(this.m_impulse+=a,o=0;o<this.m_bodies.length;++o){n=this.m_bodies[o],r=t.velocities[n.m_islandIndex].v;var c=this.m_deltas[o];r.x+=n.m_invMass*c.y*.5*a,r.y+=n.m_invMass*-c.x*.5*a}},e.prototype.SolvePositionConstraints=function(t){for(var e=0,i=0,o=0;o<this.m_bodies.length;++o){var n=this.m_bodies[o],a=this.m_bodies[(o+1)%this.m_bodies.length],c=t.positions[n.m_islandIndex].c,l=t.positions[a.m_islandIndex].c,u=(h=s.b2Vec2.SubVV(l,c,this.m_delta)).Length();u<r.b2_epsilon&&(u=1),this.m_normals[o].x=h.y/u,this.m_normals[o].y=-h.x/u,e+=u,i+=s.b2Vec2.CrossVV(c,l)}i*=.5;var _=.5*(this.m_targetArea-i)/e,m=!0;for(o=0;o<this.m_bodies.length;++o){n=this.m_bodies[o],c=t.positions[n.m_islandIndex].c;var h,p=(o+1)%this.m_bodies.length;(h=s.b2Vec2.AddVV(this.m_normals[o],this.m_normals[p],this.m_delta)).SelfMul(_);var f=h.LengthSquared();f>s.b2Sq(r.b2_maxLinearCorrection)&&h.SelfMul(r.b2_maxLinearCorrection/s.b2Sqrt(f)),f>s.b2Sq(r.b2_linearSlop)&&(m=!1),c.x+=h.x,c.y+=h.y}return m},e}(a.b2Joint);i.b2AreaJoint=u,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2DistanceJoint":"b2DistanceJoint","./b2Joint":"b2Joint"}],b2BlockAllocator:[function(t,e,i){"use strict";cc._RF.push(e,"a4af9mgoFFOYayVgkegfQq4","b2BlockAllocator"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2BlockAllocator=void 0;i.b2BlockAllocator=function(){},cc._RF.pop()},{}],b2Body:[function(t,e,i){"use strict";cc._RF.push(e,"3bc97GxQslDYoou+mnUMNzR","b2Body"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Body=i.b2BodyDef=i.b2BodyType=void 0;var o,n=t("../Common/b2Settings"),r=t("../Common/b2Math"),s=t("../Collision/Shapes/b2Shape"),a=t("./b2Fixture");(function(t){t[t.b2_unknown=-1]="b2_unknown",t[t.b2_staticBody=0]="b2_staticBody",t[t.b2_kinematicBody=1]="b2_kinematicBody",t[t.b2_dynamicBody=2]="b2_dynamicBody"})(o=i.b2BodyType||(i.b2BodyType={}));i.b2BodyDef=function(){this.type=o.b2_staticBody,this.position=new r.b2Vec2(0,0),this.angle=0,this.linearVelocity=new r.b2Vec2(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1};var c=function(){function t(t,e){this.m_type=o.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new r.b2Transform,this.m_xf0=new r.b2Transform,this.m_sweep=new r.b2Sweep,this.m_linearVelocity=new r.b2Vec2,this.m_angularVelocity=0,this.m_force=new r.b2Vec2,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=n.b2Maybe(t.bullet,!1),this.m_fixedRotationFlag=n.b2Maybe(t.fixedRotation,!1),this.m_autoSleepFlag=n.b2Maybe(t.allowSleep,!0),this.m_awakeFlag=n.b2Maybe(t.awake,!0),this.m_activeFlag=n.b2Maybe(t.active,!0),this.m_world=e,this.m_xf.p.Copy(n.b2Maybe(t.position,r.b2Vec2.ZERO)),this.m_xf.q.SetAngle(n.b2Maybe(t.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(n.b2Maybe(t.linearVelocity,r.b2Vec2.ZERO)),this.m_angularVelocity=n.b2Maybe(t.angularVelocity,0),this.m_linearDamping=n.b2Maybe(t.linearDamping,0),this.m_angularDamping=n.b2Maybe(t.angularDamping,0),this.m_gravityScale=n.b2Maybe(t.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=n.b2Maybe(t.type,o.b2_staticBody),t.type===o.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}return t.prototype.CreateFixture=function(t,e){return void 0===e&&(e=0),t instanceof s.b2Shape?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)},t.prototype.CreateFixtureDef=function(t){if(this.m_world.IsLocked())throw new Error;var e=new a.b2Fixture(this,t);return this.m_activeFlag&&e.CreateProxies(),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e},t.prototype.CreateFixtureShapeDensity=function(e,i){void 0===i&&(i=0);var o=t.CreateFixtureShapeDensity_s_def;return o.shape=e,o.density=i,this.CreateFixtureDef(o)},t.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}for(var o=this.m_contactList;o;){var n=o.contact;o=o.next;var r=n.GetFixtureA(),s=n.GetFixtureB();t!==r&&t!==s||this.m_world.m_contactManager.Destroy(n)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Reset(),--this.m_fixtureCount,this.ResetMassData()},t.prototype.SetTransformVec=function(t,e){this.SetTransformXY(t.x,t.y,e)},t.prototype.SetTransformXY=function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),r.b2Transform.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var o=this.m_fixtureList;o;o=o.m_next)o.SynchronizeProxies(this.m_xf,this.m_xf,r.b2Vec2.ZERO);this.m_world.m_contactManager.FindNewContacts()},t.prototype.SetTransform=function(t){this.SetTransformVec(t.p,t.GetAngle())},t.prototype.GetTransform=function(){return this.m_xf},t.prototype.GetPosition=function(){return this.m_xf.p},t.prototype.SetPosition=function(t){this.SetTransformVec(t,this.GetAngle())},t.prototype.SetPositionXY=function(t,e){this.SetTransformXY(t,e,this.GetAngle())},t.prototype.GetAngle=function(){return this.m_sweep.a},t.prototype.SetAngle=function(t){this.SetTransformVec(this.GetPosition(),t)},t.prototype.GetWorldCenter=function(){return this.m_sweep.c},t.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},t.prototype.SetLinearVelocity=function(t){this.m_type!==o.b2_staticBody&&(r.b2Vec2.DotVV(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))},t.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},t.prototype.SetAngularVelocity=function(t){this.m_type!==o.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)},t.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},t.prototype.GetDefinition=function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t},t.prototype.ApplyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type===o.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},t.prototype.ApplyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type===o.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))},t.prototype.ApplyTorque=function(t,e){void 0===e&&(e=!0),this.m_type===o.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},t.prototype.ApplyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type===o.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))},t.prototype.ApplyLinearImpulseToCenter=function(t,e){void 0===e&&(e=!0),this.m_type===o.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))},t.prototype.ApplyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type===o.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},t.prototype.GetMass=function(){return this.m_mass},t.prototype.GetInertia=function(){return this.m_I+this.m_mass*r.b2Vec2.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},t.prototype.GetMassData=function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*r.b2Vec2.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t},t.prototype.SetMassData=function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type===o.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&!this.m_fixedRotationFlag&&(this.m_I=e.I-this.m_mass*r.b2Vec2.DotVV(e.center,e.center),this.m_invI=1/this.m_I);var i=t.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),r.b2Transform.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),r.b2Vec2.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,r.b2Vec2.SubVV(this.m_sweep.c,i,r.b2Vec2.s_t0),this.m_linearVelocity)}},t.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===o.b2_staticBody||this.m_type===o.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var e=t.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!==i.m_density){var n=i.GetMassData(t.ResetMassData_s_massData);this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*r.b2Vec2.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=t.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),r.b2Transform.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),r.b2Vec2.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,r.b2Vec2.SubVV(this.m_sweep.c,s,r.b2Vec2.s_t0),this.m_linearVelocity)},t.prototype.GetWorldPoint=function(t,e){return r.b2Transform.MulXV(this.m_xf,t,e)},t.prototype.GetWorldVector=function(t,e){return r.b2Rot.MulRV(this.m_xf.q,t,e)},t.prototype.GetLocalPoint=function(t,e){return r.b2Transform.MulTXV(this.m_xf,t,e)},t.prototype.GetLocalVector=function(t,e){return r.b2Rot.MulTRV(this.m_xf.q,t,e)},t.prototype.GetLinearVelocityFromWorldPoint=function(t,e){return r.b2Vec2.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,r.b2Vec2.SubVV(t,this.m_sweep.c,r.b2Vec2.s_t0),e)},t.prototype.GetLinearVelocityFromLocalPoint=function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)},t.prototype.GetLinearDamping=function(){return this.m_linearDamping},t.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},t.prototype.GetAngularDamping=function(){return this.m_angularDamping},t.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},t.prototype.GetGravityScale=function(){return this.m_gravityScale},t.prototype.SetGravityScale=function(t){this.m_gravityScale=t},t.prototype.SetType=function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t){this.m_type=t,this.ResetMassData(),this.m_type===o.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var n=this.m_fixtureList;n;n=n.m_next)n.TouchProxies()}},t.prototype.GetType=function(){return this.m_type},t.prototype.SetBullet=function(t){this.m_bulletFlag=t},t.prototype.IsBullet=function(){return this.m_bulletFlag},t.prototype.SetSleepingAllowed=function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)},t.prototype.IsSleepingAllowed=function(){return this.m_autoSleepFlag},t.prototype.SetAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},t.prototype.IsAwake=function(){return this.m_awakeFlag},t.prototype.SetActive=function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies();else{for(e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxies();for(var i=this.m_contactList;i;){var o=i;i=i.next,this.m_world.m_contactManager.Destroy(o.contact)}this.m_contactList=null}},t.prototype.IsActive=function(){return this.m_activeFlag},t.prototype.SetFixedRotation=function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())},t.prototype.IsFixedRotation=function(){return this.m_fixedRotationFlag},t.prototype.GetFixtureList=function(){return this.m_fixtureList},t.prototype.GetJointList=function(){return this.m_jointList},t.prototype.GetContactList=function(){return this.m_contactList},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(t){this.m_userData=t},t.prototype.GetWorld=function(){return this.m_world},t.prototype.Dump=function(t){var e=this.m_islandIndex;t("{\n"),t("  const bd: b2BodyDef = new b2BodyDef();\n");var i="";switch(this.m_type){case o.b2_staticBody:i="b2BodyType.b2_staticBody";break;case o.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case o.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(var n=this.m_fixtureList;n;n=n.m_next)t("  {\n"),n.Dump(t,e),t("  }\n");t("}\n")},t.prototype.SynchronizeFixtures=function(){var e=t.SynchronizeFixtures_s_xf1;e.q.SetAngle(this.m_sweep.a0),r.b2Rot.MulRV(e.q,this.m_sweep.localCenter,e.p),r.b2Vec2.SubVV(this.m_sweep.c0,e.p,e.p);for(var i=r.b2Vec2.SubVV(this.m_sweep.c,this.m_sweep.c0,t.SynchronizeFixtures_s_displacement),o=this.m_fixtureList;o;o=o.m_next)o.SynchronizeProxies(e,this.m_xf,i)},t.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngle(this.m_sweep.a),r.b2Rot.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),r.b2Vec2.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},t.prototype.ShouldCollide=function(t){return(this.m_type!==o.b2_staticBody||t.m_type!==o.b2_staticBody)&&this.ShouldCollideConnected(t)},t.prototype.ShouldCollideConnected=function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0},t.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),r.b2Rot.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),r.b2Vec2.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},t.prototype.GetControllerList=function(){return this.m_controllerList},t.prototype.GetControllerCount=function(){return this.m_controllerCount},t.CreateFixtureShapeDensity_s_def=new a.b2FixtureDef,t.SetMassData_s_oldCenter=new r.b2Vec2,t.ResetMassData_s_localCenter=new r.b2Vec2,t.ResetMassData_s_oldCenter=new r.b2Vec2,t.ResetMassData_s_massData=new s.b2MassData,t.SynchronizeFixtures_s_xf1=new r.b2Transform,t.SynchronizeFixtures_s_displacement=new r.b2Vec2,t}();i.b2Body=c,cc._RF.pop()},{"../Collision/Shapes/b2Shape":"b2Shape","../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Fixture":"b2Fixture"}],b2BroadPhase:[function(t,e,i){"use strict";cc._RF.push(e,"3229bYZULlEx7TUngfITx4y","b2BroadPhase"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2PairLessThan=i.b2BroadPhase=i.b2Pair=void 0;var o=t("./b2DynamicTree");function n(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}function r(t,e){return t<e}function s(t,e,i,o){void 0===e&&(e=0),void 0===i&&(i=t.length-e),void 0===o&&(o=r);for(var s=e,a=[],c=0;;){for(;s+1<i;i++){var l=t[s+Math.floor(Math.random()*(i-s))];a[c++]=i;for(var u=s-1;;){for(;o(t[++u],l););for(;o(l,t[--i]););if(u>=i)break;n(t,u,i)}}if(0===c)break;s=i,i=a[--c]}return t}var a=function(t,e){this.proxyA=t,this.proxyB=e};i.b2Pair=a;var c=function(){function t(){this.m_tree=new o.b2DynamicTree,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return t.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i},t.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},t.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},t.prototype.TouchProxy=function(t){this.BufferMove(t)},t.prototype.GetProxyCount=function(){return this.m_proxyCount},t.prototype.UpdatePairs=function(t){var e=this;this.m_pairCount=0;for(var i=function(t){var i=o.m_moveBuffer[t];if(null===i)return"continue";var n=i.aabb;o.m_tree.Query(n,function(t){if(t.m_id===i.m_id)return!0;var o,n;if(t.m_id<i.m_id?(o=t,n=i):(o=i,n=t),e.m_pairCount===e.m_pairBuffer.length)e.m_pairBuffer[e.m_pairCount]=new a(o,n);else{var r=e.m_pairBuffer[e.m_pairCount];r.proxyA=o,r.proxyB=n}return++e.m_pairCount,!0})},o=this,n=0;n<this.m_moveCount;++n)i(n);this.m_moveCount=0,s(this.m_pairBuffer,0,this.m_pairCount,l);for(var r=0;r<this.m_pairCount;){var c=this.m_pairBuffer[r];for(t(c.proxyA.userData,c.proxyB.userData),++r;r<this.m_pairCount;){var u=this.m_pairBuffer[r];if(u.proxyA.m_id!==c.proxyA.m_id||u.proxyB.m_id!==c.proxyB.m_id)break;++r}}},t.prototype.Query=function(t,e){this.m_tree.Query(t,e)},t.prototype.QueryPoint=function(t,e){this.m_tree.QueryPoint(t,e)},t.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},t.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},t.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},t.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},t.prototype.ShiftOrigin=function(t){this.m_tree.ShiftOrigin(t)},t.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},t.prototype.UnBufferMove=function(t){var e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null},t}();function l(t,e){return t.proxyA.m_id<e.proxyA.m_id||t.proxyA.m_id===e.proxyA.m_id&&t.proxyB.m_id<e.proxyB.m_id}i.b2BroadPhase=c,i.b2PairLessThan=l,cc._RF.pop()},{"./b2DynamicTree":"b2DynamicTree"}],b2BuoyancyController:[function(t,e,i){"use strict";cc._RF.push(e,"d0753jURcVJ75ZwoslrI3wn","b2BuoyancyController");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2BuoyancyController=void 0;var r=t("./b2Controller"),s=t("../Common/b2Math"),a=t("../Common/b2Settings"),c=t("../Common/b2Draw"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.normal=new s.b2Vec2(0,1),e.offset=0,e.density=0,e.velocity=new s.b2Vec2(0,0),e.linearDrag=0,e.angularDrag=0,e.useDensity=!1,e.useWorldGravity=!0,e.gravity=new s.b2Vec2(0,0),e}return n(e,t),e.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(e.IsAwake()){for(var i=new s.b2Vec2,o=new s.b2Vec2,n=0,r=0,c=e.GetFixtureList();c;c=c.m_next){var l=new s.b2Vec2,u=c.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),l);n+=u,i.x+=u*l.x,i.y+=u*l.y;var _;r+=u*(_=this.useDensity?c.GetDensity():1),o.x+=u*l.x*_,o.y+=u*l.y*_}if(i.x/=n,i.y/=n,o.x/=r,o.y/=r,!(n<a.b2_epsilon)){var m=this.gravity.Clone().SelfNeg();m.SelfMul(this.density*n),e.ApplyForce(m,o);var h=e.GetLinearVelocityFromWorldPoint(i,new s.b2Vec2);h.SelfSub(this.velocity),h.SelfMul(-this.linearDrag*n),e.ApplyForce(h,i),e.ApplyTorque(-e.GetInertia()/e.GetMass()*n*e.GetAngularVelocity()*this.angularDrag)}}}}},e.prototype.Draw=function(t){var e=100,i=new s.b2Vec2,o=new s.b2Vec2;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,o.x=this.normal.x*this.offset-this.normal.y*e,o.y=this.normal.y*this.offset+this.normal.x*e;var n=new c.b2Color(0,0,.8);t.DrawSegment(i,o,n)},e}(r.b2Controller);i.b2BuoyancyController=l,cc._RF.pop()},{"../Common/b2Draw":"b2Draw","../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Controller":"b2Controller"}],b2ChainAndCircleContact:[function(t,e,i){"use strict";cc._RF.push(e,"238b3tcGa1KPL4hrr6oakCH","b2ChainAndCircleContact");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2ChainAndCircleContact=void 0;var r=t("../../Collision/b2CollideEdge"),s=t("../../Collision/Shapes/b2EdgeShape"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,i,o){var n=e.Evaluate_s_edge;this.GetShapeA().GetChildEdge(n,this.m_indexA),r.b2CollideEdgeAndCircle(t,n,i,this.GetShapeB(),o)},e.Evaluate_s_edge=new s.b2EdgeShape,e}(t("./b2Contact").b2Contact);i.b2ChainAndCircleContact=a,cc._RF.pop()},{"../../Collision/Shapes/b2EdgeShape":"b2EdgeShape","../../Collision/b2CollideEdge":"b2CollideEdge","./b2Contact":"b2Contact"}],b2ChainAndPolygonContact:[function(t,e,i){"use strict";cc._RF.push(e,"68976cDHh5KoYKgp2KqDNKC","b2ChainAndPolygonContact");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2ChainAndPolygonContact=void 0;var r=t("../../Collision/b2CollideEdge"),s=t("../../Collision/Shapes/b2EdgeShape"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,i,o){var n=e.Evaluate_s_edge;this.GetShapeA().GetChildEdge(n,this.m_indexA),r.b2CollideEdgeAndPolygon(t,n,i,this.GetShapeB(),o)},e.Evaluate_s_edge=new s.b2EdgeShape,e}(t("./b2Contact").b2Contact);i.b2ChainAndPolygonContact=a,cc._RF.pop()},{"../../Collision/Shapes/b2EdgeShape":"b2EdgeShape","../../Collision/b2CollideEdge":"b2CollideEdge","./b2Contact":"b2Contact"}],b2ChainShape:[function(t,e,i){"use strict";cc._RF.push(e,"38093k1zn1PILvq7atwfLIc","b2ChainShape");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2ChainShape=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Shape"),c=t("./b2EdgeShape"),l=function(t){function e(){var e=t.call(this,a.b2ShapeType.e_chainShape,r.b2_polygonRadius)||this;return e.m_vertices=[],e.m_count=0,e.m_prevVertex=new s.b2Vec2,e.m_nextVertex=new s.b2Vec2,e.m_hasPrevVertex=!1,e.m_hasNextVertex=!1,e}return n(e,t),e.prototype.CreateLoop=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if("number"==typeof t[0][0]){var i=t[0];if(i.length%2!=0)throw new Error;return this._CreateLoop(function(t){return{x:i[2*t],y:i[2*t+1]}},i.length/2)}var o=t[0],n=t[1]||o.length;return this._CreateLoop(function(t){return o[t]},n)},e.prototype._CreateLoop=function(t,e){if(e<3)return this;this.m_count=e+1,this.m_vertices=s.b2Vec2.MakeArray(this.m_count);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},e.prototype.CreateChain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if("number"==typeof t[0][0]){var i=t[0];if(i.length%2!=0)throw new Error;return this._CreateChain(function(t){return{x:i[2*t],y:i[2*t+1]}},i.length/2)}var o=t[0],n=t[1]||o.length;return this._CreateChain(function(t){return o[t]},n)},e.prototype._CreateChain=function(t,e){this.m_count=e,this.m_vertices=s.b2Vec2.MakeArray(e);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},e.prototype.SetPrevVertex=function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this},e.prototype.SetNextVertex=function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this},e.prototype.Clone=function(){return(new e).Copy(this)},e.prototype.Copy=function(e){return t.prototype.Copy.call(this,e),this._CreateChain(function(t){return e.m_vertices[t]},e.m_count),this.m_prevVertex.Copy(e.m_prevVertex),this.m_nextVertex.Copy(e.m_nextVertex),this.m_hasPrevVertex=e.m_hasPrevVertex,this.m_hasNextVertex=e.m_hasNextVertex,this},e.prototype.GetChildCount=function(){return this.m_count-1},e.prototype.GetChildEdge=function(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)},e.prototype.TestPoint=function(){return!1},e.prototype.ComputeDistance=function(t,i,o,n){var r=e.ComputeDistance_s_edgeShape;return this.GetChildEdge(r,n),r.ComputeDistance(t,i,o,0)},e.prototype.RayCast=function(t,i,o,n){var r=e.RayCast_s_edgeShape;return r.m_vertex1.Copy(this.m_vertices[n]),r.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),r.RayCast(t,i,o,0)},e.prototype.ComputeAABB=function(t,i,o){var n=this.m_vertices[o],r=this.m_vertices[(o+1)%this.m_count],a=s.b2Transform.MulXV(i,n,e.ComputeAABB_s_v1),c=s.b2Transform.MulXV(i,r,e.ComputeAABB_s_v2);s.b2Vec2.MinV(a,c,t.lowerBound),s.b2Vec2.MaxV(a,c,t.upperBound)},e.prototype.ComputeMass=function(t){t.mass=0,t.center.SetZero(),t.I=0},e.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius},e.prototype.ComputeSubmergedArea=function(t,e,i,o){return o.SetZero(),0},e.prototype.Dump=function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},e.ComputeDistance_s_edgeShape=new c.b2EdgeShape,e.RayCast_s_edgeShape=new c.b2EdgeShape,e.ComputeAABB_s_v1=new s.b2Vec2,e.ComputeAABB_s_v2=new s.b2Vec2,e}(a.b2Shape);i.b2ChainShape=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2EdgeShape":"b2EdgeShape","./b2Shape":"b2Shape"}],b2CircleContact:[function(t,e,i){"use strict";cc._RF.push(e,"730465lbJhOKKuegufDH+K1","b2CircleContact");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2CircleContact=void 0;var r=t("../../Collision/b2CollideCircle"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,i){r.b2CollideCircles(t,this.GetShapeA(),e,this.GetShapeB(),i)},e}(t("./b2Contact").b2Contact);i.b2CircleContact=s,cc._RF.pop()},{"../../Collision/b2CollideCircle":"b2CollideCircle","./b2Contact":"b2Contact"}],b2CircleShape:[function(t,e,i){"use strict";cc._RF.push(e,"60e00+1xxhHtq9Oug5eio2b","b2CircleShape");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2CircleShape=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Shape"),c=function(t){function e(e){void 0===e&&(e=0);var i=t.call(this,a.b2ShapeType.e_circleShape,e)||this;return i.m_p=new s.b2Vec2,i}return n(e,t),e.prototype.Set=function(t,e){return void 0===e&&(e=this.m_radius),this.m_p.Copy(t),this.m_radius=e,this},e.prototype.Clone=function(){return(new e).Copy(this)},e.prototype.Copy=function(e){return t.prototype.Copy.call(this,e),this.m_p.Copy(e.m_p),this},e.prototype.GetChildCount=function(){return 1},e.prototype.TestPoint=function(t,i){var o=s.b2Transform.MulXV(t,this.m_p,e.TestPoint_s_center),n=s.b2Vec2.SubVV(i,o,e.TestPoint_s_d);return s.b2Vec2.DotVV(n,n)<=s.b2Sq(this.m_radius)},e.prototype.ComputeDistance=function(t,i,o){var n=s.b2Transform.MulXV(t,this.m_p,e.ComputeDistance_s_center);return s.b2Vec2.SubVV(i,n,o),o.Normalize()-this.m_radius},e.prototype.RayCast=function(t,i,o){var n=s.b2Transform.MulXV(o,this.m_p,e.RayCast_s_position),a=s.b2Vec2.SubVV(i.p1,n,e.RayCast_s_s),c=s.b2Vec2.DotVV(a,a)-s.b2Sq(this.m_radius),l=s.b2Vec2.SubVV(i.p2,i.p1,e.RayCast_s_r),u=s.b2Vec2.DotVV(a,l),_=s.b2Vec2.DotVV(l,l),m=u*u-_*c;if(m<0||_<r.b2_epsilon)return!1;var h=-(u+s.b2Sqrt(m));return 0<=h&&h<=i.maxFraction*_&&(h/=_,t.fraction=h,s.b2Vec2.AddVMulSV(a,h,l,t.normal).SelfNormalize(),!0)},e.prototype.ComputeAABB=function(t,i){var o=s.b2Transform.MulXV(i,this.m_p,e.ComputeAABB_s_p);t.lowerBound.Set(o.x-this.m_radius,o.y-this.m_radius),t.upperBound.Set(o.x+this.m_radius,o.y+this.m_radius)},e.prototype.ComputeMass=function(t,e){var i=s.b2Sq(this.m_radius);t.mass=e*r.b2_pi*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+s.b2Vec2.DotVV(this.m_p,this.m_p))},e.prototype.SetupDistanceProxy=function(t){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius},e.prototype.ComputeSubmergedArea=function(t,e,i,o){var n=s.b2Transform.MulXV(i,this.m_p,new s.b2Vec2),a=-(s.b2Vec2.DotVV(t,n)-e);if(a<-this.m_radius+r.b2_epsilon)return 0;if(a>this.m_radius)return o.Copy(n),r.b2_pi*this.m_radius*this.m_radius;var c=this.m_radius*this.m_radius,l=a*a,u=c*(s.b2Asin(a/this.m_radius)+r.b2_pi/2)+a*s.b2Sqrt(c-l),_=-2/3*s.b2Pow(c-l,1.5)/u;return o.x=n.x+t.x*_,o.y=n.y+t.y*_,u},e.prototype.Dump=function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},e.TestPoint_s_center=new s.b2Vec2,e.TestPoint_s_d=new s.b2Vec2,e.ComputeDistance_s_center=new s.b2Vec2,e.RayCast_s_position=new s.b2Vec2,e.RayCast_s_s=new s.b2Vec2,e.RayCast_s_r=new s.b2Vec2,e.ComputeAABB_s_p=new s.b2Vec2,e}(a.b2Shape);i.b2CircleShape=c,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Shape":"b2Shape"}],b2CollideCircle:[function(t,e,i){"use strict";cc._RF.push(e,"7b909u3nv1Kk4ddPEGw4j0n","b2CollideCircle"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2CollidePolygonAndCircle=i.b2CollideCircles=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=t("./b2Collision"),s=new n.b2Vec2,a=new n.b2Vec2;i.b2CollideCircles=function(t,e,i,o,c){t.pointCount=0;var l=n.b2Transform.MulXV(i,e.m_p,s),u=n.b2Transform.MulXV(c,o.m_p,a),_=n.b2Vec2.DistanceSquaredVV(l,u),m=e.m_radius+o.m_radius;_>m*m||(t.type=r.b2ManifoldType.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(o.m_p),t.points[0].id.key=0)};var c=new n.b2Vec2,l=new n.b2Vec2,u=new n.b2Vec2;i.b2CollidePolygonAndCircle=function(t,e,i,s,a){t.pointCount=0;for(var _=n.b2Transform.MulXV(a,s.m_p,c),m=n.b2Transform.MulTXV(i,_,l),h=0,p=-o.b2_maxFloat,f=e.m_radius+s.m_radius,b=e.m_count,d=e.m_vertices,y=e.m_normals,v=0;v<b;++v){var V=n.b2Vec2.DotVV(y[v],n.b2Vec2.SubVV(m,d[v],n.b2Vec2.s_t0));if(V>f)return;V>p&&(p=V,h=v)}var x=h,C=(x+1)%b,S=d[x],B=d[C];if(p<o.b2_epsilon)return t.pointCount=1,t.type=r.b2ManifoldType.e_faceA,t.localNormal.Copy(y[h]),n.b2Vec2.MidVV(S,B,t.localPoint),t.points[0].localPoint.Copy(s.m_p),void(t.points[0].id.key=0);var g=n.b2Vec2.DotVV(n.b2Vec2.SubVV(m,S,n.b2Vec2.s_t0),n.b2Vec2.SubVV(B,S,n.b2Vec2.s_t1)),A=n.b2Vec2.DotVV(n.b2Vec2.SubVV(m,B,n.b2Vec2.s_t0),n.b2Vec2.SubVV(S,B,n.b2Vec2.s_t1));if(g<=0){if(n.b2Vec2.DistanceSquaredVV(m,S)>f*f)return;t.pointCount=1,t.type=r.b2ManifoldType.e_faceA,n.b2Vec2.SubVV(m,S,t.localNormal).SelfNormalize(),t.localPoint.Copy(S),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else if(A<=0){if(n.b2Vec2.DistanceSquaredVV(m,B)>f*f)return;t.pointCount=1,t.type=r.b2ManifoldType.e_faceA,n.b2Vec2.SubVV(m,B,t.localNormal).SelfNormalize(),t.localPoint.Copy(B),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else{var w=n.b2Vec2.MidVV(S,B,u);if(n.b2Vec2.DotVV(n.b2Vec2.SubVV(m,w,n.b2Vec2.s_t1),y[x])>f)return;t.pointCount=1,t.type=r.b2ManifoldType.e_faceA,t.localNormal.Copy(y[x]).SelfNormalize(),t.localPoint.Copy(w),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}},cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Collision":"b2Collision"}],b2CollideEdge:[function(t,e,i){"use strict";cc._RF.push(e,"bc422C7xANHcbrGkAcj61fd","b2CollideEdge"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2CollideEdgeAndPolygon=i.b2CollideEdgeAndCircle=void 0;var o,n=t("../Common/b2Settings"),r=t("../Common/b2Math"),s=t("./b2Collision"),a=t("./b2Collision"),c=new r.b2Vec2,l=new r.b2Vec2,u=new r.b2Vec2,_=new r.b2Vec2,m=new r.b2Vec2,h=new r.b2Vec2,p=new r.b2Vec2,f=new s.b2ContactID;i.b2CollideEdgeAndCircle=function(t,e,i,o,n){t.pointCount=0;var b=r.b2Transform.MulTXV(i,r.b2Transform.MulXV(n,o.m_p,r.b2Vec2.s_t0),c),d=e.m_vertex1,y=e.m_vertex2,v=r.b2Vec2.SubVV(y,d,l),V=r.b2Vec2.DotVV(v,r.b2Vec2.SubVV(y,b,r.b2Vec2.s_t0)),x=r.b2Vec2.DotVV(v,r.b2Vec2.SubVV(b,d,r.b2Vec2.s_t0)),C=e.m_radius+o.m_radius,S=f;if(S.cf.indexB=0,S.cf.typeB=s.b2ContactFeatureType.e_vertex,x<=0){var B=d,g=r.b2Vec2.SubVV(b,B,u);if(r.b2Vec2.DotVV(g,g)>C*C)return;if(e.m_hasVertex0){var A=e.m_vertex0,w=d,M=r.b2Vec2.SubVV(w,A,_);if(r.b2Vec2.DotVV(M,r.b2Vec2.SubVV(w,b,r.b2Vec2.s_t0))>0)return}return S.cf.indexA=0,S.cf.typeA=s.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=a.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(B),t.points[0].id.Copy(S),void t.points[0].localPoint.Copy(o.m_p)}if(V<=0){var P=y,D=r.b2Vec2.SubVV(b,P,u);if(r.b2Vec2.DotVV(D,D)>C*C)return;if(e.m_hasVertex3){var R=e.m_vertex3,F=y,G=r.b2Vec2.SubVV(R,F,m);if(r.b2Vec2.DotVV(G,r.b2Vec2.SubVV(b,F,r.b2Vec2.s_t0))>0)return}return S.cf.indexA=1,S.cf.typeA=s.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=a.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(P),t.points[0].id.Copy(S),void t.points[0].localPoint.Copy(o.m_p)}var I=r.b2Vec2.DotVV(v,v),T=h;T.x=1/I*(V*d.x+x*y.x),T.y=1/I*(V*d.y+x*y.y);var L=r.b2Vec2.SubVV(b,T,u);if(!(r.b2Vec2.DotVV(L,L)>C*C)){var E=p.Set(-v.y,v.x);r.b2Vec2.DotVV(E,r.b2Vec2.SubVV(b,d,r.b2Vec2.s_t0))<0&&E.Set(-E.x,-E.y),E.Normalize(),S.cf.indexA=0,S.cf.typeA=s.b2ContactFeatureType.e_face,t.pointCount=1,t.type=a.b2ManifoldType.e_faceA,t.localNormal.Copy(E),t.localPoint.Copy(d),t.points[0].id.Copy(S),t.points[0].localPoint.Copy(o.m_p)}},function(t){t[t.e_unknown=0]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(o||(o={}));var b,d=function(){this.type=o.e_unknown,this.index=0,this.separation=0},y=function(){this.vertices=[],this.normals=[],this.count=0},v=function(){this.i1=0,this.i2=0,this.v1=new r.b2Vec2,this.v2=new r.b2Vec2,this.normal=new r.b2Vec2,this.sideNormal1=new r.b2Vec2,this.sideOffset1=0,this.sideNormal2=new r.b2Vec2,this.sideOffset2=0};(function(t){t[t.e_isolated=0]="e_isolated",t[t.e_concave=1]="e_concave",t[t.e_convex=2]="e_convex"})(b||(b={}));var V=new(function(){function t(){this.m_polygonB=new y,this.m_xf=new r.b2Transform,this.m_centroidB=new r.b2Vec2,this.m_v0=new r.b2Vec2,this.m_v1=new r.b2Vec2,this.m_v2=new r.b2Vec2,this.m_v3=new r.b2Vec2,this.m_normal0=new r.b2Vec2,this.m_normal1=new r.b2Vec2,this.m_normal2=new r.b2Vec2,this.m_normal=new r.b2Vec2,this.m_type1=b.e_isolated,this.m_type2=b.e_isolated,this.m_lowerLimit=new r.b2Vec2,this.m_upperLimit=new r.b2Vec2,this.m_radius=0,this.m_front=!1}return t.prototype.Collide=function(e,i,c,l,u){r.b2Transform.MulTXX(c,u,this.m_xf),r.b2Transform.MulXV(this.m_xf,l.m_centroid,this.m_centroidB),this.m_v0.Copy(i.m_vertex0),this.m_v1.Copy(i.m_vertex1),this.m_v2.Copy(i.m_vertex2),this.m_v3.Copy(i.m_vertex3);var _=i.m_hasVertex0,m=i.m_hasVertex3,h=r.b2Vec2.SubVV(this.m_v2,this.m_v1,t.s_edge1);h.Normalize(),this.m_normal1.Set(h.y,-h.x);var p=r.b2Vec2.DotVV(this.m_normal1,r.b2Vec2.SubVV(this.m_centroidB,this.m_v1,r.b2Vec2.s_t0)),f=0,b=0,d=!1,y=!1;if(_){var v=r.b2Vec2.SubVV(this.m_v1,this.m_v0,t.s_edge0);v.Normalize(),this.m_normal0.Set(v.y,-v.x),d=r.b2Vec2.CrossVV(v,h)>=0,f=r.b2Vec2.DotVV(this.m_normal0,r.b2Vec2.SubVV(this.m_centroidB,this.m_v0,r.b2Vec2.s_t0))}if(m){var V=r.b2Vec2.SubVV(this.m_v3,this.m_v2,t.s_edge2);V.Normalize(),this.m_normal2.Set(V.y,-V.x),y=r.b2Vec2.CrossVV(h,V)>0,b=r.b2Vec2.DotVV(this.m_normal2,r.b2Vec2.SubVV(this.m_centroidB,this.m_v2,r.b2Vec2.s_t0))}_&&m?d&&y?(this.m_front=f>=0||p>=0||b>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=f>=0||p>=0&&b>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):y?(this.m_front=b>=0||f>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=f>=0&&p>=0&&b>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):_?d?(this.m_front=f>=0||p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=f>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):m?y?(this.m_front=p>=0||b>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0&&b>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=l.m_count;for(var x=0;x<l.m_count;++x)this.m_polygonB.vertices.length<=x&&this.m_polygonB.vertices.push(new r.b2Vec2),this.m_polygonB.normals.length<=x&&this.m_polygonB.normals.push(new r.b2Vec2),r.b2Transform.MulXV(this.m_xf,l.m_vertices[x],this.m_polygonB.vertices[x]),r.b2Rot.MulRV(this.m_xf.q,l.m_normals[x],this.m_polygonB.normals[x]);this.m_radius=l.m_radius+i.m_radius,e.pointCount=0;var C=this.ComputeEdgeSeparation(t.s_edgeAxis);if(C.type!==o.e_unknown&&!(C.separation>this.m_radius)){var S=this.ComputePolygonSeparation(t.s_polygonAxis);if(!(S.type!==o.e_unknown&&S.separation>this.m_radius)){var B;B=S.type===o.e_unknown?C:S.separation>.98*C.separation+.001?S:C;var g=t.s_ie,A=t.s_rf;if(B.type===o.e_edgeA){e.type=a.b2ManifoldType.e_faceA;var w=0,M=r.b2Vec2.DotVV(this.m_normal,this.m_polygonB.normals[0]);for(x=1;x<this.m_polygonB.count;++x){var P=r.b2Vec2.DotVV(this.m_normal,this.m_polygonB.normals[x]);P<M&&(M=P,w=x)}var D=w,R=(D+1)%this.m_polygonB.count;(F=g[0]).v.Copy(this.m_polygonB.vertices[D]),F.id.cf.indexA=0,F.id.cf.indexB=D,F.id.cf.typeA=s.b2ContactFeatureType.e_face,F.id.cf.typeB=s.b2ContactFeatureType.e_vertex,(G=g[1]).v.Copy(this.m_polygonB.vertices[R]),G.id.cf.indexA=0,G.id.cf.indexB=R,G.id.cf.typeA=s.b2ContactFeatureType.e_face,G.id.cf.typeB=s.b2ContactFeatureType.e_vertex,this.m_front?(A.i1=0,A.i2=1,A.v1.Copy(this.m_v1),A.v2.Copy(this.m_v2),A.normal.Copy(this.m_normal1)):(A.i1=1,A.i2=0,A.v1.Copy(this.m_v2),A.v2.Copy(this.m_v1),A.normal.Copy(this.m_normal1).SelfNeg())}else{var F,G;e.type=a.b2ManifoldType.e_faceB,(F=g[0]).v.Copy(this.m_v1),F.id.cf.indexA=0,F.id.cf.indexB=B.index,F.id.cf.typeA=s.b2ContactFeatureType.e_vertex,F.id.cf.typeB=s.b2ContactFeatureType.e_face,(G=g[1]).v.Copy(this.m_v2),G.id.cf.indexA=0,G.id.cf.indexB=B.index,G.id.cf.typeA=s.b2ContactFeatureType.e_vertex,G.id.cf.typeB=s.b2ContactFeatureType.e_face,A.i1=B.index,A.i2=(A.i1+1)%this.m_polygonB.count,A.v1.Copy(this.m_polygonB.vertices[A.i1]),A.v2.Copy(this.m_polygonB.vertices[A.i2]),A.normal.Copy(this.m_polygonB.normals[A.i1])}A.sideNormal1.Set(A.normal.y,-A.normal.x),A.sideNormal2.Copy(A.sideNormal1).SelfNeg(),A.sideOffset1=r.b2Vec2.DotVV(A.sideNormal1,A.v1),A.sideOffset2=r.b2Vec2.DotVV(A.sideNormal2,A.v2);var I=t.s_clipPoints1,T=t.s_clipPoints2;if(!(a.b2ClipSegmentToLine(I,g,A.sideNormal1,A.sideOffset1,A.i1)<n.b2_maxManifoldPoints||a.b2ClipSegmentToLine(T,I,A.sideNormal2,A.sideOffset2,A.i2)<n.b2_maxManifoldPoints)){B.type===o.e_edgeA?(e.localNormal.Copy(A.normal),e.localPoint.Copy(A.v1)):(e.localNormal.Copy(l.m_normals[A.i1]),e.localPoint.Copy(l.m_vertices[A.i1]));var L=0;for(x=0;x<n.b2_maxManifoldPoints;++x)if(r.b2Vec2.DotVV(A.normal,r.b2Vec2.SubVV(T[x].v,A.v1,r.b2Vec2.s_t0))<=this.m_radius){var E=e.points[L];B.type===o.e_edgeA?(r.b2Transform.MulTXV(this.m_xf,T[x].v,E.localPoint),E.id.Copy(T[x].id)):(E.localPoint.Copy(T[x].v),E.id.cf.typeA=T[x].id.cf.typeB,E.id.cf.typeB=T[x].id.cf.typeA,E.id.cf.indexA=T[x].id.cf.indexB,E.id.cf.indexB=T[x].id.cf.indexA),++L}e.pointCount=L}}}},t.prototype.ComputeEdgeSeparation=function(t){var e=t;e.type=o.e_edgeA,e.index=this.m_front?0:1,e.separation=n.b2_maxFloat;for(var i=0;i<this.m_polygonB.count;++i){var s=r.b2Vec2.DotVV(this.m_normal,r.b2Vec2.SubVV(this.m_polygonB.vertices[i],this.m_v1,r.b2Vec2.s_t0));s<e.separation&&(e.separation=s)}return e},t.prototype.ComputePolygonSeparation=function(e){var i=e;i.type=o.e_unknown,i.index=-1,i.separation=-n.b2_maxFloat;for(var s=t.s_perp.Set(-this.m_normal.y,this.m_normal.x),a=0;a<this.m_polygonB.count;++a){var c=r.b2Vec2.NegV(this.m_polygonB.normals[a],t.s_n),l=r.b2Vec2.DotVV(c,r.b2Vec2.SubVV(this.m_polygonB.vertices[a],this.m_v1,r.b2Vec2.s_t0)),u=r.b2Vec2.DotVV(c,r.b2Vec2.SubVV(this.m_polygonB.vertices[a],this.m_v2,r.b2Vec2.s_t0)),_=r.b2Min(l,u);if(_>this.m_radius)return i.type=o.e_edgeB,i.index=a,i.separation=_,i;if(r.b2Vec2.DotVV(c,s)>=0){if(r.b2Vec2.DotVV(r.b2Vec2.SubVV(c,this.m_upperLimit,r.b2Vec2.s_t0),this.m_normal)<-n.b2_angularSlop)continue}else if(r.b2Vec2.DotVV(r.b2Vec2.SubVV(c,this.m_lowerLimit,r.b2Vec2.s_t0),this.m_normal)<-n.b2_angularSlop)continue;_>i.separation&&(i.type=o.e_edgeB,i.index=a,i.separation=_)}return i},t.s_edge1=new r.b2Vec2,t.s_edge0=new r.b2Vec2,t.s_edge2=new r.b2Vec2,t.s_ie=a.b2ClipVertex.MakeArray(2),t.s_rf=new v,t.s_clipPoints1=a.b2ClipVertex.MakeArray(2),t.s_clipPoints2=a.b2ClipVertex.MakeArray(2),t.s_edgeAxis=new d,t.s_polygonAxis=new d,t.s_n=new r.b2Vec2,t.s_perp=new r.b2Vec2,t}());i.b2CollideEdgeAndPolygon=function(t,e,i,o,n){V.Collide(t,e,i,o,n)},cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Collision":"b2Collision"}],b2CollidePolygon:[function(t,e,i){"use strict";cc._RF.push(e,"6787anfQf1ADZ8Z0EyuYw0q","b2CollidePolygon"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2CollidePolygons=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=t("./b2Collision"),s=t("./b2Collision"),a=new n.b2Vec2,c=new n.b2Vec2,l=new n.b2Vec2,u=new n.b2Vec2;function _(t,e,i,r,s){for(var _=t.m_vertices,m=t.m_normals,h=r.m_count,p=r.m_vertices,f=n.b2Rot.MulRV(e.q,m[i],a),b=n.b2Rot.MulTRV(s.q,f,c),d=0,y=o.b2_maxFloat,v=0;v<h;++v){var V=n.b2Vec2.DotVV(p[v],b);V<y&&(y=V,d=v)}var x=n.b2Transform.MulXV(e,_[i],l),C=n.b2Transform.MulXV(s,p[d],u);return n.b2Vec2.DotVV(n.b2Vec2.SubVV(C,x,n.b2Vec2.s_t0),f)}var m=new n.b2Vec2,h=new n.b2Vec2;function p(t,e,i,r,s){for(var a=e.m_count,c=e.m_normals,l=n.b2Vec2.SubVV(n.b2Transform.MulXV(s,r.m_centroid,n.b2Vec2.s_t0),n.b2Transform.MulXV(i,e.m_centroid,n.b2Vec2.s_t1),m),u=n.b2Rot.MulTRV(i.q,l,h),p=0,f=-o.b2_maxFloat,b=0;b<a;++b){var d=n.b2Vec2.DotVV(c[b],u);d>f&&(f=d,p=b)}var y=_(e,i,p,r,s),v=(p+a-1)%a,V=_(e,i,v,r,s),x=(p+1)%a,C=_(e,i,x,r,s),S=0,B=0,g=0;if(V>y&&V>C)g=-1,S=v,B=V;else{if(!(C>y))return t[0]=p,y;g=1,S=x,B=C}for(;(y=_(e,i,p=-1===g?(S+a-1)%a:(S+1)%a,r,s))>B;)S=p,B=y;return t[0]=S,B}var f=new n.b2Vec2;function b(t,e,i,s,a,c){for(var l=e.m_normals,u=a.m_count,_=a.m_vertices,m=a.m_normals,h=n.b2Rot.MulTRV(c.q,n.b2Rot.MulRV(i.q,l[s],n.b2Vec2.s_t0),f),p=0,b=o.b2_maxFloat,d=0;d<u;++d){var y=n.b2Vec2.DotVV(h,m[d]);y<b&&(b=y,p=d)}var v=p,V=(v+1)%u,x=t[0];n.b2Transform.MulXV(c,_[v],x.v);var C=x.id.cf;C.indexA=s,C.indexB=v,C.typeA=r.b2ContactFeatureType.e_face,C.typeB=r.b2ContactFeatureType.e_vertex;var S=t[1];n.b2Transform.MulXV(c,_[V],S.v);var B=S.id.cf;B.indexA=s,B.indexB=V,B.typeA=r.b2ContactFeatureType.e_face,B.typeB=r.b2ContactFeatureType.e_vertex}var d=s.b2ClipVertex.MakeArray(2),y=s.b2ClipVertex.MakeArray(2),v=s.b2ClipVertex.MakeArray(2),V=[0],x=[0],C=new n.b2Vec2,S=new n.b2Vec2,B=new n.b2Vec2,g=new n.b2Vec2,A=new n.b2Vec2,w=new n.b2Vec2,M=new n.b2Vec2,P=new n.b2Vec2;i.b2CollidePolygons=function(t,e,i,r,a){t.pointCount=0;var c=e.m_radius+r.m_radius,l=V;l[0]=0;var u=p(l,e,i,r,a);if(!(u>c)){var _=x;_[0]=0;var m=p(_,r,a,e,i);if(!(m>c)){var h,f,D,R,F=0,G=0;m>.98*u+.001?(h=r,f=e,D=a,R=i,F=_[0],t.type=s.b2ManifoldType.e_faceB,G=1):(h=e,f=r,D=i,R=a,F=l[0],t.type=s.b2ManifoldType.e_faceA,G=0);var I=d;b(I,h,D,F,f,R);var T=h.m_count,L=h.m_vertices,E=F,J=(F+1)%T,O=L[E],k=L[J],j=n.b2Vec2.SubVV(k,O,C);j.Normalize();var q=n.b2Vec2.CrossVOne(j,S),z=n.b2Vec2.MidVV(O,k,B),N=n.b2Rot.MulRV(D.q,j,A),W=n.b2Vec2.CrossVOne(N,g),U=n.b2Transform.MulXV(D,O,M),X=n.b2Transform.MulXV(D,k,P),Z=n.b2Vec2.DotVV(W,U),H=-n.b2Vec2.DotVV(N,U)+c,Q=n.b2Vec2.DotVV(N,X)+c,K=y,Y=v,$=n.b2Vec2.NegV(N,w);if(!(s.b2ClipSegmentToLine(K,I,$,H,E)<2||s.b2ClipSegmentToLine(Y,K,N,Q,J)<2)){t.localNormal.Copy(q),t.localPoint.Copy(z);for(var tt=0,et=0;et<o.b2_maxManifoldPoints;++et){var it=Y[et];if(n.b2Vec2.DotVV(W,it.v)-Z<=c){var ot=t.points[tt];if(n.b2Transform.MulTXV(R,it.v,ot.localPoint),ot.id.Copy(it.id),G){var nt=ot.id.cf;ot.id.cf.indexA=nt.indexB,ot.id.cf.indexB=nt.indexA,ot.id.cf.typeA=nt.typeB,ot.id.cf.typeB=nt.typeA}++tt}}t.pointCount=tt}}}},cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Collision":"b2Collision"}],b2Collision:[function(t,e,i){"use strict";cc._RF.push(e,"ebdfcamJyFD9pGPtPVXrh+5","b2Collision"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2TestOverlapShape=i.b2ClipSegmentToLine=i.b2TestOverlapAABB=i.b2AABB=i.b2RayCastOutput=i.b2RayCastInput=i.b2ClipVertex=i.b2GetPointStates=i.b2PointState=i.b2WorldManifold=i.b2Manifold=i.b2ManifoldType=i.b2ManifoldPoint=i.b2ContactID=i.b2ContactFeature=i.b2ContactFeatureType=void 0;var o,n=t("../Common/b2Settings"),r=t("../Common/b2Math"),s=t("./b2Distance");(function(t){t[t.e_vertex=0]="e_vertex",t[t.e_face=1]="e_face"})(o=i.b2ContactFeatureType||(i.b2ContactFeatureType={}));var a=function(){function t(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return Object.defineProperty(t.prototype,"key",{get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexA",{get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexB",{get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"typeA",{get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"typeB",{get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0},enumerable:!1,configurable:!0}),t}();i.b2ContactFeature=a;var c=function(){function t(){this.cf=new a}return t.prototype.Copy=function(t){return this.key=t.key,this},t.prototype.Clone=function(){return(new t).Copy(this)},Object.defineProperty(t.prototype,"key",{get:function(){return this.cf.key},set:function(t){this.cf.key=t},enumerable:!1,configurable:!0}),t}();i.b2ContactID=c;var l,u=function(){function t(){this.localPoint=new r.b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.id=new c}return t.MakeArray=function(e){return n.b2MakeArray(e,function(){return new t})},t.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},t.prototype.Copy=function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this},t}();i.b2ManifoldPoint=u,function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circles=0]="e_circles",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(l=i.b2ManifoldType||(i.b2ManifoldType={}));var _=function(){function t(){this.points=u.MakeArray(n.b2_maxManifoldPoints),this.localNormal=new r.b2Vec2,this.localPoint=new r.b2Vec2,this.type=l.e_unknown,this.pointCount=0}return t.prototype.Reset=function(){for(var t=0;t<n.b2_maxManifoldPoints;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=l.e_unknown,this.pointCount=0},t.prototype.Copy=function(t){this.pointCount=t.pointCount;for(var e=0;e<n.b2_maxManifoldPoints;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this},t.prototype.Clone=function(){return(new t).Copy(this)},t}();i.b2Manifold=_;var m,h=function(){function t(){this.normal=new r.b2Vec2,this.points=r.b2Vec2.MakeArray(n.b2_maxManifoldPoints),this.separations=n.b2MakeNumberArray(n.b2_maxManifoldPoints)}return t.prototype.Initialize=function(e,i,o,s,a){if(0!==e.pointCount)switch(e.type){case l.e_circles:this.normal.Set(1,0);var c=r.b2Transform.MulXV(i,e.localPoint,t.Initialize_s_pointA),u=r.b2Transform.MulXV(s,e.points[0].localPoint,t.Initialize_s_pointB);r.b2Vec2.DistanceSquaredVV(c,u)>n.b2_epsilon_sq&&r.b2Vec2.SubVV(u,c,this.normal).SelfNormalize();var _=r.b2Vec2.AddVMulSV(c,o,this.normal,t.Initialize_s_cA),m=r.b2Vec2.SubVMulSV(u,a,this.normal,t.Initialize_s_cB);r.b2Vec2.MidVV(_,m,this.points[0]),this.separations[0]=r.b2Vec2.DotVV(r.b2Vec2.SubVV(m,_,r.b2Vec2.s_t0),this.normal);break;case l.e_faceA:r.b2Rot.MulRV(i.q,e.localNormal,this.normal);for(var h=r.b2Transform.MulXV(i,e.localPoint,t.Initialize_s_planePoint),p=0;p<e.pointCount;++p){var f=r.b2Transform.MulXV(s,e.points[p].localPoint,t.Initialize_s_clipPoint),b=o-r.b2Vec2.DotVV(r.b2Vec2.SubVV(f,h,r.b2Vec2.s_t0),this.normal);_=r.b2Vec2.AddVMulSV(f,b,this.normal,t.Initialize_s_cA),m=r.b2Vec2.SubVMulSV(f,a,this.normal,t.Initialize_s_cB),r.b2Vec2.MidVV(_,m,this.points[p]),this.separations[p]=r.b2Vec2.DotVV(r.b2Vec2.SubVV(m,_,r.b2Vec2.s_t0),this.normal)}break;case l.e_faceB:for(r.b2Rot.MulRV(s.q,e.localNormal,this.normal),h=r.b2Transform.MulXV(s,e.localPoint,t.Initialize_s_planePoint),p=0;p<e.pointCount;++p)f=r.b2Transform.MulXV(i,e.points[p].localPoint,t.Initialize_s_clipPoint),b=a-r.b2Vec2.DotVV(r.b2Vec2.SubVV(f,h,r.b2Vec2.s_t0),this.normal),m=r.b2Vec2.AddVMulSV(f,b,this.normal,t.Initialize_s_cB),_=r.b2Vec2.SubVMulSV(f,o,this.normal,t.Initialize_s_cA),r.b2Vec2.MidVV(_,m,this.points[p]),this.separations[p]=r.b2Vec2.DotVV(r.b2Vec2.SubVV(_,m,r.b2Vec2.s_t0),this.normal);this.normal.SelfNeg()}},t.Initialize_s_pointA=new r.b2Vec2,t.Initialize_s_pointB=new r.b2Vec2,t.Initialize_s_cA=new r.b2Vec2,t.Initialize_s_cB=new r.b2Vec2,t.Initialize_s_planePoint=new r.b2Vec2,t.Initialize_s_clipPoint=new r.b2Vec2,t}();i.b2WorldManifold=h,function(t){t[t.b2_nullState=0]="b2_nullState",t[t.b2_addState=1]="b2_addState",t[t.b2_persistState=2]="b2_persistState",t[t.b2_removeState=3]="b2_removeState"}(m=i.b2PointState||(i.b2PointState={})),i.b2GetPointStates=function(t,e,i,o){var r;for(r=0;r<i.pointCount;++r){var s=i.points[r].id.key;t[r]=m.b2_removeState;for(var a=0,c=o.pointCount;a<c;++a)if(o.points[a].id.key===s){t[r]=m.b2_persistState;break}}for(;r<n.b2_maxManifoldPoints;++r)t[r]=m.b2_nullState;for(r=0;r<o.pointCount;++r)for(s=o.points[r].id.key,e[r]=m.b2_addState,a=0,c=i.pointCount;a<c;++a)if(i.points[a].id.key===s){e[r]=m.b2_persistState;break}for(;r<n.b2_maxManifoldPoints;++r)e[r]=m.b2_nullState};var p=function(){function t(){this.v=new r.b2Vec2,this.id=new c}return t.MakeArray=function(e){return n.b2MakeArray(e,function(){return new t})},t.prototype.Copy=function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this},t}();i.b2ClipVertex=p;var f=function(){function t(){this.p1=new r.b2Vec2,this.p2=new r.b2Vec2,this.maxFraction=1}return t.prototype.Copy=function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this},t}();i.b2RayCastInput=f;var b=function(){function t(){this.normal=new r.b2Vec2,this.fraction=0}return t.prototype.Copy=function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this},t}();i.b2RayCastOutput=b;var d=function(){function t(){this.lowerBound=new r.b2Vec2,this.upperBound=new r.b2Vec2,this.m_cache_center=new r.b2Vec2,this.m_cache_extent=new r.b2Vec2}return t.prototype.Copy=function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this},t.prototype.IsValid=function(){return!(!this.lowerBound.IsValid()||!this.upperBound.IsValid()||this.upperBound.x<this.lowerBound.x||this.upperBound.y<this.lowerBound.y)},t.prototype.GetCenter=function(){return r.b2Vec2.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)},t.prototype.GetExtents=function(){return r.b2Vec2.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)},t.prototype.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},t.prototype.Combine1=function(t){return this.lowerBound.x=r.b2Min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=r.b2Min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=r.b2Max(this.upperBound.x,t.upperBound.x),this.upperBound.y=r.b2Max(this.upperBound.y,t.upperBound.y),this},t.prototype.Combine2=function(t,e){return this.lowerBound.x=r.b2Min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=r.b2Min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=r.b2Max(t.upperBound.x,e.upperBound.x),this.upperBound.y=r.b2Max(t.upperBound.y,e.upperBound.y),this},t.Combine=function(t,e,i){return i.Combine2(t,e),i},t.prototype.Contains=function(t){return!(this.lowerBound.x<=t.lowerBound.x||this.lowerBound.y<=t.lowerBound.y||t.upperBound.x<=this.upperBound.x||t.upperBound.y<=this.upperBound.y)},t.prototype.RayCast=function(t,e){var i,o,s=-n.b2_maxFloat,a=n.b2_maxFloat,c=e.p1.x,l=e.p1.y,u=e.p2.x-e.p1.x,_=e.p2.y-e.p1.y,m=r.b2Abs(u),h=r.b2Abs(_),p=t.normal;if(m<n.b2_epsilon){if(c<this.lowerBound.x||this.upperBound.x<c)return!1}else{var f=1/u,b=-1;if((i=(this.lowerBound.x-c)*f)>(o=(this.upperBound.x-c)*f)){var d=i;i=o,o=d,b=1}if(i>s&&(p.x=b,p.y=0,s=i),s>(a=r.b2Min(a,o)))return!1}if(h<n.b2_epsilon){if(l<this.lowerBound.y||this.upperBound.y<l)return!1}else if(f=1/_,b=-1,(i=(this.lowerBound.y-l)*f)>(o=(this.upperBound.y-l)*f)&&(d=i,i=o,o=d,b=1),i>s&&(p.x=0,p.y=b,s=i),s>(a=r.b2Min(a,o)))return!1;return!(s<0||e.maxFraction<s||(t.fraction=s,0))},t.prototype.TestContain=function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)},t.prototype.TestOverlap=function(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)},t}();i.b2AABB=d,i.b2TestOverlapAABB=function(t,e){return!(t.upperBound.x<e.lowerBound.x||t.upperBound.y<e.lowerBound.y||e.upperBound.x<t.lowerBound.x||e.upperBound.y<t.lowerBound.y)},i.b2ClipSegmentToLine=function(t,e,i,n,s){var a=0,c=e[0],l=e[1],u=r.b2Vec2.DotVV(i,c.v)-n,_=r.b2Vec2.DotVV(i,l.v)-n;if(u<=0&&t[a++].Copy(c),_<=0&&t[a++].Copy(l),u*_<0){var m=u/(u-_),h=t[a].v;h.x=c.v.x+m*(l.v.x-c.v.x),h.y=c.v.y+m*(l.v.y-c.v.y);var p=t[a].id;p.cf.indexA=s,p.cf.indexB=c.id.cf.indexB,p.cf.typeA=o.e_vertex,p.cf.typeB=o.e_face,++a}return a};var y=new s.b2DistanceInput,v=new s.b2SimplexCache,V=new s.b2DistanceOutput;i.b2TestOverlapShape=function(t,e,i,o,r,a){var c=y.Reset();c.proxyA.SetShape(t,e),c.proxyB.SetShape(i,o),c.transformA.Copy(r),c.transformB.Copy(a),c.useRadii=!0;var l=v.Reset();l.count=0;var u=V.Reset();return s.b2Distance(u,l,c),u.distance<10*n.b2_epsilon},cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Distance":"b2Distance"}],b2ConstantAccelController:[function(t,e,i){"use strict";cc._RF.push(e,"2d21bxSTbFDPYQ1z5AkNul8","b2ConstantAccelController");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2ConstantAccelController=void 0;var r=t("./b2Controller"),s=t("../Common/b2Math"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.A=new s.b2Vec2(0,0),e}return n(e,t),e.prototype.Step=function(t){for(var i=s.b2Vec2.MulSV(t.dt,this.A,e.Step_s_dtA),o=this.m_bodyList;o;o=o.nextBody){var n=o.body;n.IsAwake()&&n.SetLinearVelocity(s.b2Vec2.AddVV(n.GetLinearVelocity(),i,s.b2Vec2.s_t0))}},e.prototype.Draw=function(){},e.Step_s_dtA=new s.b2Vec2,e}(r.b2Controller);i.b2ConstantAccelController=a,cc._RF.pop()},{"../Common/b2Math":"b2Math","./b2Controller":"b2Controller"}],b2ConstantForceController:[function(t,e,i){"use strict";cc._RF.push(e,"c9e22/97Z1C1agzPs8H+AKn","b2ConstantForceController");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2ConstantForceController=void 0;var r=t("./b2Controller"),s=t("../Common/b2Math"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.F=new s.b2Vec2(0,0),e}return n(e,t),e.prototype.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},e.prototype.Draw=function(){},e}(r.b2Controller);i.b2ConstantForceController=a,cc._RF.pop()},{"../Common/b2Math":"b2Math","./b2Controller":"b2Controller"}],b2ContactFactory:[function(t,e,i){"use strict";cc._RF.push(e,"e1bc6n6LPJBybUHGynpM85G","b2ContactFactory"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2ContactFactory=i.b2ContactRegister=void 0;var o=t("../../Collision/Shapes/b2Shape"),n=t("./b2CircleContact"),r=t("./b2PolygonContact"),s=t("./b2PolygonAndCircleContact"),a=t("./b2EdgeAndCircleContact"),c=t("./b2EdgeAndPolygonContact"),l=t("./b2ChainAndCircleContact"),u=t("./b2ChainAndPolygonContact"),_=function(){this.pool=[],this.createFcn=null,this.destroyFcn=null,this.primary=!1};i.b2ContactRegister=_;var m=function(){function t(){this.m_registers=[],this.InitializeRegisters()}return t.prototype.AddType=function(t,e,i,o){var n=[];function r(){return n.pop()||t()}function s(t){n.push(t)}this.m_registers[i][o].pool=n,this.m_registers[i][o].createFcn=r,this.m_registers[i][o].destroyFcn=s,this.m_registers[i][o].primary=!0,i!==o&&(this.m_registers[o][i].pool=n,this.m_registers[o][i].createFcn=r,this.m_registers[o][i].destroyFcn=s,this.m_registers[o][i].primary=!1)},t.prototype.InitializeRegisters=function(){for(var t=0;t<o.b2ShapeType.e_shapeTypeCount;t++){this.m_registers[t]=[];for(var e=0;e<o.b2ShapeType.e_shapeTypeCount;e++)this.m_registers[t][e]=new _}this.AddType(n.b2CircleContact.Create,n.b2CircleContact.Destroy,o.b2ShapeType.e_circleShape,o.b2ShapeType.e_circleShape),this.AddType(s.b2PolygonAndCircleContact.Create,s.b2PolygonAndCircleContact.Destroy,o.b2ShapeType.e_polygonShape,o.b2ShapeType.e_circleShape),this.AddType(r.b2PolygonContact.Create,r.b2PolygonContact.Destroy,o.b2ShapeType.e_polygonShape,o.b2ShapeType.e_polygonShape),this.AddType(a.b2EdgeAndCircleContact.Create,a.b2EdgeAndCircleContact.Destroy,o.b2ShapeType.e_edgeShape,o.b2ShapeType.e_circleShape),this.AddType(c.b2EdgeAndPolygonContact.Create,c.b2EdgeAndPolygonContact.Destroy,o.b2ShapeType.e_edgeShape,o.b2ShapeType.e_polygonShape),this.AddType(l.b2ChainAndCircleContact.Create,l.b2ChainAndCircleContact.Destroy,o.b2ShapeType.e_chainShape,o.b2ShapeType.e_circleShape),this.AddType(u.b2ChainAndPolygonContact.Create,u.b2ChainAndPolygonContact.Destroy,o.b2ShapeType.e_chainShape,o.b2ShapeType.e_polygonShape)},t.prototype.Create=function(t,e,i,o){var n=t.GetType(),r=i.GetType(),s=this.m_registers[n][r];if(s.createFcn){var a=s.createFcn();return s.primary?a.Reset(t,e,i,o):a.Reset(i,o,t,e),a}return null},t.prototype.Destroy=function(t){var e=t.m_fixtureA.GetType(),i=t.m_fixtureB.GetType(),o=this.m_registers[e][i];o.destroyFcn&&o.destroyFcn(t)},t}();i.b2ContactFactory=m,cc._RF.pop()},{"../../Collision/Shapes/b2Shape":"b2Shape","./b2ChainAndCircleContact":"b2ChainAndCircleContact","./b2ChainAndPolygonContact":"b2ChainAndPolygonContact","./b2CircleContact":"b2CircleContact","./b2EdgeAndCircleContact":"b2EdgeAndCircleContact","./b2EdgeAndPolygonContact":"b2EdgeAndPolygonContact","./b2PolygonAndCircleContact":"b2PolygonAndCircleContact","./b2PolygonContact":"b2PolygonContact"}],b2ContactManager:[function(t,e,i){"use strict";cc._RF.push(e,"fb036w03StLPJHX+hemZmrr","b2ContactManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2ContactManager=void 0;var o=t("../Collision/b2BroadPhase"),n=t("../Collision/b2Collision"),r=t("./Contacts/b2ContactFactory"),s=t("./b2Body"),a=t("./b2WorldCallbacks"),c=function(){function t(){this.m_broadPhase=new o.b2BroadPhase,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=a.b2ContactFilter.b2_defaultFilter,this.m_contactListener=a.b2ContactListener.b2_defaultListener,this.m_contactFactory=new r.b2ContactFactory}return t.prototype.AddPair=function(t,e){var i=t.fixture,o=e.fixture,n=t.childIndex,r=e.childIndex,s=i.GetBody(),a=o.GetBody();if(s!==a){for(var c=a.GetContactList();c;){if(c.other===s){var l=c.contact.GetFixtureA(),u=c.contact.GetFixtureB(),_=c.contact.GetChildIndexA(),m=c.contact.GetChildIndexB();if(l===i&&u===o&&_===n&&m===r)return;if(l===o&&u===i&&_===r&&m===n)return}c=c.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,o)){var h=this.m_contactFactory.Create(i,n,o,r);null!==h&&(i=h.GetFixtureA(),o=h.GetFixtureB(),n=h.GetChildIndexA(),r=h.GetChildIndexB(),s=i.m_body,a=o.m_body,h.m_prev=null,h.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=h),this.m_contactList=h,h.m_nodeA.other=a,h.m_nodeA.prev=null,h.m_nodeA.next=s.m_contactList,null!==s.m_contactList&&(s.m_contactList.prev=h.m_nodeA),s.m_contactList=h.m_nodeA,h.m_nodeB.other=s,h.m_nodeB.prev=null,h.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=h.m_nodeB),a.m_contactList=h.m_nodeB,i.IsSensor()||o.IsSensor()||(s.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}}},t.prototype.FindNewContacts=function(){var t=this;this.m_broadPhase.UpdatePairs(function(e,i){t.AddPair(e,i)})},t.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),o=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount},t.prototype.Collide=function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),o=t.GetChildIndexA(),r=t.GetChildIndexB(),a=e.GetBody(),c=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){t=(_=t).m_next,this.Destroy(_);continue}t.m_filterFlag=!1}var l=a.IsAwake()&&a.m_type!==s.b2BodyType.b2_staticBody,u=c.IsAwake()&&c.m_type!==s.b2BodyType.b2_staticBody;if(l||u){var _,m=e.m_proxies[o].treeNode,h=i.m_proxies[r].treeNode;n.b2TestOverlapAABB(m.aabb,h.aabb)?(t.Update(this.m_contactListener),t=t.m_next):(t=(_=t).m_next,this.Destroy(_))}else t=t.m_next}},t}();i.b2ContactManager=c,cc._RF.pop()},{"../Collision/b2BroadPhase":"b2BroadPhase","../Collision/b2Collision":"b2Collision","./Contacts/b2ContactFactory":"b2ContactFactory","./b2Body":"b2Body","./b2WorldCallbacks":"b2WorldCallbacks"}],b2ContactSolver:[function(t,e,i){"use strict";cc._RF.push(e,"518e9kIscZK56VN0Vi58GtR","b2ContactSolver"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2ContactSolver=i.b2PositionSolverManifold=i.b2ContactSolverDef=i.b2ContactPositionConstraint=i.b2ContactVelocityConstraint=i.b2VelocityConstraintPoint=i.g_blockSolve=void 0;var o=t("../../Common/b2Settings"),n=t("../../Common/b2Math"),r=t("../../Collision/b2Collision"),s=t("../../Collision/b2Collision"),a=t("../b2TimeStep");i.g_blockSolve=!1;var c=function(){function t(){this.rA=new n.b2Vec2,this.rB=new n.b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t.MakeArray=function(e){return o.b2MakeArray(e,function(){return new t})},t}();i.b2VelocityConstraintPoint=c;var l=function(){function t(){this.points=c.MakeArray(o.b2_maxManifoldPoints),this.normal=new n.b2Vec2,this.tangent=new n.b2Vec2,this.normalMass=new n.b2Mat22,this.K=new n.b2Mat22,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return t.MakeArray=function(e){return o.b2MakeArray(e,function(){return new t})},t}();i.b2ContactVelocityConstraint=l;var u=function(){function t(){this.localPoints=n.b2Vec2.MakeArray(o.b2_maxManifoldPoints),this.localNormal=new n.b2Vec2,this.localPoint=new n.b2Vec2,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new n.b2Vec2,this.localCenterB=new n.b2Vec2,this.invIA=0,this.invIB=0,this.type=s.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return t.MakeArray=function(e){return o.b2MakeArray(e,function(){return new t})},t}();i.b2ContactPositionConstraint=u;i.b2ContactSolverDef=function(){this.step=new a.b2TimeStep,this.count=0};var _=function(){function t(){this.normal=new n.b2Vec2,this.point=new n.b2Vec2,this.separation=0}return t.prototype.Initialize=function(e,i,o,r){var a=t.Initialize_s_pointA,c=t.Initialize_s_pointB,l=t.Initialize_s_planePoint,u=t.Initialize_s_clipPoint;switch(e.type){case s.b2ManifoldType.e_circles:n.b2Transform.MulXV(i,e.localPoint,a),n.b2Transform.MulXV(o,e.localPoints[0],c),n.b2Vec2.SubVV(c,a,this.normal).SelfNormalize(),n.b2Vec2.MidVV(a,c,this.point),this.separation=n.b2Vec2.DotVV(n.b2Vec2.SubVV(c,a,n.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB;break;case s.b2ManifoldType.e_faceA:n.b2Rot.MulRV(i.q,e.localNormal,this.normal),n.b2Transform.MulXV(i,e.localPoint,l),n.b2Transform.MulXV(o,e.localPoints[r],u),this.separation=n.b2Vec2.DotVV(n.b2Vec2.SubVV(u,l,n.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(u);break;case s.b2ManifoldType.e_faceB:n.b2Rot.MulRV(o.q,e.localNormal,this.normal),n.b2Transform.MulXV(o,e.localPoint,l),n.b2Transform.MulXV(i,e.localPoints[r],u),this.separation=n.b2Vec2.DotVV(n.b2Vec2.SubVV(u,l,n.b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(u),this.normal.SelfNeg()}},t.Initialize_s_pointA=new n.b2Vec2,t.Initialize_s_pointB=new n.b2Vec2,t.Initialize_s_planePoint=new n.b2Vec2,t.Initialize_s_clipPoint=new n.b2Vec2,t}();i.b2PositionSolverManifold=_;var m=function(){function t(){this.m_step=new a.b2TimeStep,this.m_positionConstraints=u.MakeArray(1024),this.m_velocityConstraints=l.MakeArray(1024),this.m_count=0}return t.prototype.Initialize=function(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=n.b2Max(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new u;if(this.m_velocityConstraints.length<this.m_count)for(e=n.b2Max(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<e;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new l;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var i=0;i<this.m_count;++i){var o=this.m_contacts[i],r=o.m_fixtureA,s=o.m_fixtureB,a=r.GetShape(),c=s.GetShape(),_=a.m_radius,m=c.m_radius,h=r.GetBody(),p=s.GetBody(),f=o.GetManifold(),b=f.pointCount,d=this.m_velocityConstraints[i];d.friction=o.m_friction,d.restitution=o.m_restitution,d.tangentSpeed=o.m_tangentSpeed,d.indexA=h.m_islandIndex,d.indexB=p.m_islandIndex,d.invMassA=h.m_invMass,d.invMassB=p.m_invMass,d.invIA=h.m_invI,d.invIB=p.m_invI,d.contactIndex=i,d.pointCount=b,d.K.SetZero(),d.normalMass.SetZero();var y=this.m_positionConstraints[i];y.indexA=h.m_islandIndex,y.indexB=p.m_islandIndex,y.invMassA=h.m_invMass,y.invMassB=p.m_invMass,y.localCenterA.Copy(h.m_sweep.localCenter),y.localCenterB.Copy(p.m_sweep.localCenter),y.invIA=h.m_invI,y.invIB=p.m_invI,y.localNormal.Copy(f.localNormal),y.localPoint.Copy(f.localPoint),y.pointCount=b,y.radiusA=_,y.radiusB=m,y.type=f.type;for(var v=0;v<b;++v){var V=f.points[v],x=d.points[v];this.m_step.warmStarting?(x.normalImpulse=this.m_step.dtRatio*V.normalImpulse,x.tangentImpulse=this.m_step.dtRatio*V.tangentImpulse):(x.normalImpulse=0,x.tangentImpulse=0),x.rA.SetZero(),x.rB.SetZero(),x.normalMass=0,x.tangentMass=0,x.velocityBias=0,y.localPoints[v].Copy(V.localPoint)}}return this},t.prototype.InitializeVelocityConstraints=function(){for(var e=t.InitializeVelocityConstraints_s_xfA,r=t.InitializeVelocityConstraints_s_xfB,s=t.InitializeVelocityConstraints_s_worldManifold,a=0;a<this.m_count;++a){var c=this.m_velocityConstraints[a],l=this.m_positionConstraints[a],u=l.radiusA,_=l.radiusB,m=this.m_contacts[c.contactIndex].GetManifold(),h=c.indexA,p=c.indexB,f=c.invMassA,b=c.invMassB,d=c.invIA,y=c.invIB,v=l.localCenterA,V=l.localCenterB,x=this.m_positions[h].c,C=this.m_positions[h].a,S=this.m_velocities[h].v,B=this.m_velocities[h].w,g=this.m_positions[p].c,A=this.m_positions[p].a,w=this.m_velocities[p].v,M=this.m_velocities[p].w;e.q.SetAngle(C),r.q.SetAngle(A),n.b2Vec2.SubVV(x,n.b2Rot.MulRV(e.q,v,n.b2Vec2.s_t0),e.p),n.b2Vec2.SubVV(g,n.b2Rot.MulRV(r.q,V,n.b2Vec2.s_t0),r.p),s.Initialize(m,e,u,r,_),c.normal.Copy(s.normal),n.b2Vec2.CrossVOne(c.normal,c.tangent);for(var P=c.pointCount,D=0;D<P;++D){var R=c.points[D];n.b2Vec2.SubVV(s.points[D],x,R.rA),n.b2Vec2.SubVV(s.points[D],g,R.rB);var F=n.b2Vec2.CrossVV(R.rA,c.normal),G=n.b2Vec2.CrossVV(R.rB,c.normal),I=f+b+d*F*F+y*G*G;R.normalMass=I>0?1/I:0;var T=c.tangent,L=n.b2Vec2.CrossVV(R.rA,T),E=n.b2Vec2.CrossVV(R.rB,T),J=f+b+d*L*L+y*E*E;R.tangentMass=J>0?1/J:0,R.velocityBias=0;var O=n.b2Vec2.DotVV(c.normal,n.b2Vec2.SubVV(n.b2Vec2.AddVCrossSV(w,M,R.rB,n.b2Vec2.s_t0),n.b2Vec2.AddVCrossSV(S,B,R.rA,n.b2Vec2.s_t1),n.b2Vec2.s_t0));O<-o.b2_velocityThreshold&&(R.velocityBias+=-c.restitution*O)}if(2===c.pointCount&&i.g_blockSolve){var k=c.points[0],j=c.points[1],q=n.b2Vec2.CrossVV(k.rA,c.normal),z=n.b2Vec2.CrossVV(k.rB,c.normal),N=n.b2Vec2.CrossVV(j.rA,c.normal),W=n.b2Vec2.CrossVV(j.rB,c.normal),U=f+b+d*q*q+y*z*z,X=f+b+d*N*N+y*W*W,Z=f+b+d*q*N+y*z*W;U*U<1e3*(U*X-Z*Z)?(c.K.ex.Set(U,Z),c.K.ey.Set(Z,X),c.K.GetInverse(c.normalMass)):c.pointCount=1}}},t.prototype.WarmStart=function(){for(var e=t.WarmStart_s_P,i=0;i<this.m_count;++i){for(var o=this.m_velocityConstraints[i],r=o.indexA,s=o.indexB,a=o.invMassA,c=o.invIA,l=o.invMassB,u=o.invIB,_=o.pointCount,m=this.m_velocities[r].v,h=this.m_velocities[r].w,p=this.m_velocities[s].v,f=this.m_velocities[s].w,b=o.normal,d=o.tangent,y=0;y<_;++y){var v=o.points[y];n.b2Vec2.AddVV(n.b2Vec2.MulSV(v.normalImpulse,b,n.b2Vec2.s_t0),n.b2Vec2.MulSV(v.tangentImpulse,d,n.b2Vec2.s_t1),e),h-=c*n.b2Vec2.CrossVV(v.rA,e),m.SelfMulSub(a,e),f+=u*n.b2Vec2.CrossVV(v.rB,e),p.SelfMulAdd(l,e)}this.m_velocities[r].w=h,this.m_velocities[s].w=f}},t.prototype.SolveVelocityConstraints=function(){for(var e=t.SolveVelocityConstraints_s_dv,o=t.SolveVelocityConstraints_s_dv1,r=t.SolveVelocityConstraints_s_dv2,s=t.SolveVelocityConstraints_s_P,a=t.SolveVelocityConstraints_s_a,c=t.SolveVelocityConstraints_s_b,l=t.SolveVelocityConstraints_s_x,u=t.SolveVelocityConstraints_s_d,_=t.SolveVelocityConstraints_s_P1,m=t.SolveVelocityConstraints_s_P2,h=t.SolveVelocityConstraints_s_P1P2,p=0;p<this.m_count;++p){for(var f=this.m_velocityConstraints[p],b=f.indexA,d=f.indexB,y=f.invMassA,v=f.invIA,V=f.invMassB,x=f.invIB,C=f.pointCount,S=this.m_velocities[b].v,B=this.m_velocities[b].w,g=this.m_velocities[d].v,A=this.m_velocities[d].w,w=f.normal,M=f.tangent,P=f.friction,D=0;D<C;++D){var R=f.points[D];n.b2Vec2.SubVV(n.b2Vec2.AddVCrossSV(g,A,R.rB,n.b2Vec2.s_t0),n.b2Vec2.AddVCrossSV(S,B,R.rA,n.b2Vec2.s_t1),e);var F=n.b2Vec2.DotVV(e,M)-f.tangentSpeed,G=R.tangentMass*-F,I=P*R.normalImpulse;G=(T=n.b2Clamp(R.tangentImpulse+G,-I,I))-R.tangentImpulse,R.tangentImpulse=T,n.b2Vec2.MulSV(G,M,s),S.SelfMulSub(y,s),B-=v*n.b2Vec2.CrossVV(R.rA,s),g.SelfMulAdd(V,s),A+=x*n.b2Vec2.CrossVV(R.rB,s)}if(1===f.pointCount||!1===i.g_blockSolve)for(D=0;D<C;++D){R=f.points[D],n.b2Vec2.SubVV(n.b2Vec2.AddVCrossSV(g,A,R.rB,n.b2Vec2.s_t0),n.b2Vec2.AddVCrossSV(S,B,R.rA,n.b2Vec2.s_t1),e);var T,L=n.b2Vec2.DotVV(e,w);G=-R.normalMass*(L-R.velocityBias),G=(T=n.b2Max(R.normalImpulse+G,0))-R.normalImpulse,R.normalImpulse=T,n.b2Vec2.MulSV(G,w,s),S.SelfMulSub(y,s),B-=v*n.b2Vec2.CrossVV(R.rA,s),g.SelfMulAdd(V,s),A+=x*n.b2Vec2.CrossVV(R.rB,s)}else{var E=f.points[0],J=f.points[1];a.Set(E.normalImpulse,J.normalImpulse),n.b2Vec2.SubVV(n.b2Vec2.AddVCrossSV(g,A,E.rB,n.b2Vec2.s_t0),n.b2Vec2.AddVCrossSV(S,B,E.rA,n.b2Vec2.s_t1),o),n.b2Vec2.SubVV(n.b2Vec2.AddVCrossSV(g,A,J.rB,n.b2Vec2.s_t0),n.b2Vec2.AddVCrossSV(S,B,J.rA,n.b2Vec2.s_t1),r);var O=n.b2Vec2.DotVV(o,w),k=n.b2Vec2.DotVV(r,w);for(c.x=O-E.velocityBias,c.y=k-J.velocityBias,c.SelfSub(n.b2Mat22.MulMV(f.K,a,n.b2Vec2.s_t0));;){if(n.b2Mat22.MulMV(f.normalMass,c,l).SelfNeg(),l.x>=0&&l.y>=0){n.b2Vec2.SubVV(l,a,u),n.b2Vec2.MulSV(u.x,w,_),n.b2Vec2.MulSV(u.y,w,m),n.b2Vec2.AddVV(_,m,h),S.SelfMulSub(y,h),B-=v*(n.b2Vec2.CrossVV(E.rA,_)+n.b2Vec2.CrossVV(J.rA,m)),g.SelfMulAdd(V,h),A+=x*(n.b2Vec2.CrossVV(E.rB,_)+n.b2Vec2.CrossVV(J.rB,m)),E.normalImpulse=l.x,J.normalImpulse=l.y;break}if(l.x=-E.normalMass*c.x,l.y=0,O=0,k=f.K.ex.y*l.x+c.y,l.x>=0&&k>=0){n.b2Vec2.SubVV(l,a,u),n.b2Vec2.MulSV(u.x,w,_),n.b2Vec2.MulSV(u.y,w,m),n.b2Vec2.AddVV(_,m,h),S.SelfMulSub(y,h),B-=v*(n.b2Vec2.CrossVV(E.rA,_)+n.b2Vec2.CrossVV(J.rA,m)),g.SelfMulAdd(V,h),A+=x*(n.b2Vec2.CrossVV(E.rB,_)+n.b2Vec2.CrossVV(J.rB,m)),E.normalImpulse=l.x,J.normalImpulse=l.y;break}if(l.x=0,l.y=-J.normalMass*c.y,O=f.K.ey.x*l.y+c.x,k=0,l.y>=0&&O>=0){n.b2Vec2.SubVV(l,a,u),n.b2Vec2.MulSV(u.x,w,_),n.b2Vec2.MulSV(u.y,w,m),n.b2Vec2.AddVV(_,m,h),S.SelfMulSub(y,h),B-=v*(n.b2Vec2.CrossVV(E.rA,_)+n.b2Vec2.CrossVV(J.rA,m)),g.SelfMulAdd(V,h),A+=x*(n.b2Vec2.CrossVV(E.rB,_)+n.b2Vec2.CrossVV(J.rB,m)),E.normalImpulse=l.x,J.normalImpulse=l.y;break}if(l.x=0,l.y=0,O=c.x,k=c.y,O>=0&&k>=0){n.b2Vec2.SubVV(l,a,u),n.b2Vec2.MulSV(u.x,w,_),n.b2Vec2.MulSV(u.y,w,m),n.b2Vec2.AddVV(_,m,h),S.SelfMulSub(y,h),B-=v*(n.b2Vec2.CrossVV(E.rA,_)+n.b2Vec2.CrossVV(J.rA,m)),g.SelfMulAdd(V,h),A+=x*(n.b2Vec2.CrossVV(E.rB,_)+n.b2Vec2.CrossVV(J.rB,m)),E.normalImpulse=l.x,J.normalImpulse=l.y;break}break}}this.m_velocities[b].w=B,this.m_velocities[d].w=A}},t.prototype.StoreImpulses=function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),o=0;o<e.pointCount;++o)i.points[o].normalImpulse=e.points[o].normalImpulse,i.points[o].tangentImpulse=e.points[o].tangentImpulse},t.prototype.SolvePositionConstraints=function(){for(var e=t.SolvePositionConstraints_s_xfA,i=t.SolvePositionConstraints_s_xfB,r=t.SolvePositionConstraints_s_psm,s=t.SolvePositionConstraints_s_rA,a=t.SolvePositionConstraints_s_rB,c=t.SolvePositionConstraints_s_P,l=0,u=0;u<this.m_count;++u){for(var _=this.m_positionConstraints[u],m=_.indexA,h=_.indexB,p=_.localCenterA,f=_.invMassA,b=_.invIA,d=_.localCenterB,y=_.invMassB,v=_.invIB,V=_.pointCount,x=this.m_positions[m].c,C=this.m_positions[m].a,S=this.m_positions[h].c,B=this.m_positions[h].a,g=0;g<V;++g){e.q.SetAngle(C),i.q.SetAngle(B),n.b2Vec2.SubVV(x,n.b2Rot.MulRV(e.q,p,n.b2Vec2.s_t0),e.p),n.b2Vec2.SubVV(S,n.b2Rot.MulRV(i.q,d,n.b2Vec2.s_t0),i.p),r.Initialize(_,e,i,g);var A=r.normal,w=r.point,M=r.separation;n.b2Vec2.SubVV(w,x,s),n.b2Vec2.SubVV(w,S,a),l=n.b2Min(l,M);var P=n.b2Clamp(o.b2_baumgarte*(M+o.b2_linearSlop),-o.b2_maxLinearCorrection,0),D=n.b2Vec2.CrossVV(s,A),R=n.b2Vec2.CrossVV(a,A),F=f+y+b*D*D+v*R*R,G=F>0?-P/F:0;n.b2Vec2.MulSV(G,A,c),x.SelfMulSub(f,c),C-=b*n.b2Vec2.CrossVV(s,c),S.SelfMulAdd(y,c),B+=v*n.b2Vec2.CrossVV(a,c)}this.m_positions[m].a=C,this.m_positions[h].a=B}return l>-3*o.b2_linearSlop},t.prototype.SolveTOIPositionConstraints=function(e,i){for(var r=t.SolveTOIPositionConstraints_s_xfA,s=t.SolveTOIPositionConstraints_s_xfB,a=t.SolveTOIPositionConstraints_s_psm,c=t.SolveTOIPositionConstraints_s_rA,l=t.SolveTOIPositionConstraints_s_rB,u=t.SolveTOIPositionConstraints_s_P,_=0,m=0;m<this.m_count;++m){var h=this.m_positionConstraints[m],p=h.indexA,f=h.indexB,b=h.localCenterA,d=h.localCenterB,y=h.pointCount,v=0,V=0;p!==e&&p!==i||(v=h.invMassA,V=h.invIA);var x=0,C=0;f!==e&&f!==i||(x=h.invMassB,C=h.invIB);for(var S=this.m_positions[p].c,B=this.m_positions[p].a,g=this.m_positions[f].c,A=this.m_positions[f].a,w=0;w<y;++w){r.q.SetAngle(B),s.q.SetAngle(A),n.b2Vec2.SubVV(S,n.b2Rot.MulRV(r.q,b,n.b2Vec2.s_t0),r.p),n.b2Vec2.SubVV(g,n.b2Rot.MulRV(s.q,d,n.b2Vec2.s_t0),s.p),a.Initialize(h,r,s,w);var M=a.normal,P=a.point,D=a.separation;n.b2Vec2.SubVV(P,S,c),n.b2Vec2.SubVV(P,g,l),_=n.b2Min(_,D);var R=n.b2Clamp(o.b2_toiBaumgarte*(D+o.b2_linearSlop),-o.b2_maxLinearCorrection,0),F=n.b2Vec2.CrossVV(c,M),G=n.b2Vec2.CrossVV(l,M),I=v+x+V*F*F+C*G*G,T=I>0?-R/I:0;n.b2Vec2.MulSV(T,M,u),S.SelfMulSub(v,u),B-=V*n.b2Vec2.CrossVV(c,u),g.SelfMulAdd(x,u),A+=C*n.b2Vec2.CrossVV(l,u)}this.m_positions[p].a=B,this.m_positions[f].a=A}return _>=-1.5*o.b2_linearSlop},t.InitializeVelocityConstraints_s_xfA=new n.b2Transform,t.InitializeVelocityConstraints_s_xfB=new n.b2Transform,t.InitializeVelocityConstraints_s_worldManifold=new r.b2WorldManifold,t.WarmStart_s_P=new n.b2Vec2,t.SolveVelocityConstraints_s_dv=new n.b2Vec2,t.SolveVelocityConstraints_s_dv1=new n.b2Vec2,t.SolveVelocityConstraints_s_dv2=new n.b2Vec2,t.SolveVelocityConstraints_s_P=new n.b2Vec2,t.SolveVelocityConstraints_s_a=new n.b2Vec2,t.SolveVelocityConstraints_s_b=new n.b2Vec2,t.SolveVelocityConstraints_s_x=new n.b2Vec2,t.SolveVelocityConstraints_s_d=new n.b2Vec2,t.SolveVelocityConstraints_s_P1=new n.b2Vec2,t.SolveVelocityConstraints_s_P2=new n.b2Vec2,t.SolveVelocityConstraints_s_P1P2=new n.b2Vec2,t.SolvePositionConstraints_s_xfA=new n.b2Transform,t.SolvePositionConstraints_s_xfB=new n.b2Transform,t.SolvePositionConstraints_s_psm=new _,t.SolvePositionConstraints_s_rA=new n.b2Vec2,t.SolvePositionConstraints_s_rB=new n.b2Vec2,t.SolvePositionConstraints_s_P=new n.b2Vec2,t.SolveTOIPositionConstraints_s_xfA=new n.b2Transform,t.SolveTOIPositionConstraints_s_xfB=new n.b2Transform,t.SolveTOIPositionConstraints_s_psm=new _,t.SolveTOIPositionConstraints_s_rA=new n.b2Vec2,t.SolveTOIPositionConstraints_s_rB=new n.b2Vec2,t.SolveTOIPositionConstraints_s_P=new n.b2Vec2,t}();i.b2ContactSolver=m,cc._RF.pop()},{"../../Collision/b2Collision":"b2Collision","../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","../b2TimeStep":"b2TimeStep"}],b2Contact:[function(t,e,i){"use strict";cc._RF.push(e,"12a0aoWyslEUZlCwxqiVQYe","b2Contact"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Contact=i.b2ContactEdge=i.b2MixRestitution=i.b2MixFriction=void 0;var o=t("../../Common/b2Settings"),n=t("../../Common/b2Math"),r=t("../../Collision/b2Collision"),s=t("../../Collision/b2Collision"),a=t("../../Collision/b2TimeOfImpact");function c(t,e){return n.b2Sqrt(t*e)}function l(t,e){return t>e?t:e}i.b2MixFriction=c,i.b2MixRestitution=l;var u=function(){function t(t){this._other=null,this.prev=null,this.next=null,this.contact=t}return Object.defineProperty(t.prototype,"other",{get:function(){if(null===this._other)throw new Error;return this._other},set:function(t){if(null!==this._other)throw new Error;this._other=t},enumerable:!1,configurable:!0}),t.prototype.Reset=function(){this._other=null,this.prev=null,this.next=null},t}();i.b2ContactEdge=u;var _=function(){function t(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new u(this),this.m_nodeB=new u(this),this.m_indexA=0,this.m_indexB=0,this.m_manifold=new r.b2Manifold,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new r.b2Manifold}return t.prototype.GetManifold=function(){return this.m_manifold},t.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),o=this.GetShapeA(),n=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),o.m_radius,i.GetTransform(),n.m_radius)},t.prototype.IsTouching=function(){return this.m_touchingFlag},t.prototype.SetEnabled=function(t){this.m_enabledFlag=t},t.prototype.IsEnabled=function(){return this.m_enabledFlag},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetFixtureA=function(){return this.m_fixtureA},t.prototype.GetChildIndexA=function(){return this.m_indexA},t.prototype.GetShapeA=function(){return this.m_fixtureA.GetShape()},t.prototype.GetFixtureB=function(){return this.m_fixtureB},t.prototype.GetChildIndexB=function(){return this.m_indexB},t.prototype.GetShapeB=function(){return this.m_fixtureB.GetShape()},t.prototype.FlagForFiltering=function(){this.m_filterFlag=!0},t.prototype.SetFriction=function(t){this.m_friction=t},t.prototype.GetFriction=function(){return this.m_friction},t.prototype.ResetFriction=function(){this.m_friction=c(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},t.prototype.SetRestitution=function(t){this.m_restitution=t},t.prototype.GetRestitution=function(){return this.m_restitution},t.prototype.ResetRestitution=function(){this.m_restitution=l(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.prototype.SetTangentSpeed=function(t){this.m_tangentSpeed=t},t.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},t.prototype.Reset=function(t,e,i,o){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=o,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=c(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=l(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,o=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),a=n||r,c=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),u=c.GetTransform(),_=l.GetTransform();if(a){var m=this.GetShapeA(),h=this.GetShapeB();i=s.b2TestOverlapShape(m,this.m_indexA,h,this.m_indexB,u,_),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,u,_),i=this.m_manifold.pointCount>0;for(var p=0;p<this.m_manifold.pointCount;++p){var f=this.m_manifold.points[p];f.normalImpulse=0,f.tangentImpulse=0;for(var b=f.id,d=0;d<this.m_oldManifold.pointCount;++d){var y=this.m_oldManifold.points[d];if(y.id.key===b.key){f.normalImpulse=y.normalImpulse,f.tangentImpulse=y.tangentImpulse;break}}}i!==o&&(c.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!o&&i&&t&&t.BeginContact(this),o&&!i&&t&&t.EndContact(this),!a&&i&&t&&t.PreSolve(this,this.m_oldManifold)},t.prototype.ComputeTOI=function(e,i){var n=t.ComputeTOI_s_input;n.proxyA.SetShape(this.GetShapeA(),this.m_indexA),n.proxyB.SetShape(this.GetShapeB(),this.m_indexB),n.sweepA.Copy(e),n.sweepB.Copy(i),n.tMax=o.b2_linearSlop;var r=t.ComputeTOI_s_output;return a.b2TimeOfImpact(r,n),r.t},t.ComputeTOI_s_input=new a.b2TOIInput,t.ComputeTOI_s_output=new a.b2TOIOutput,t}();i.b2Contact=_,cc._RF.pop()},{"../../Collision/b2Collision":"b2Collision","../../Collision/b2TimeOfImpact":"b2TimeOfImpact","../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings"}],b2Controller:[function(t,e,i){"use strict";cc._RF.push(e,"86e07gLsYJIpKUVqL94w9Ur","b2Controller"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Controller=i.b2ControllerEdge=void 0;var o=function(t,e){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=e};i.b2ControllerEdge=o;var n=function(){function t(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}return t.prototype.GetNext=function(){return this.m_next},t.prototype.GetPrev=function(){return this.m_prev},t.prototype.GetBodyList=function(){return this.m_bodyList},t.prototype.AddBody=function(t){var e=new o(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount},t.prototype.RemoveBody=function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount},t.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},t}();i.b2Controller=n,cc._RF.pop()},{}],b2DistanceJoint:[function(t,e,i){"use strict";cc._RF.push(e,"22ea9Nve1FHAL6D7XbI2FcX","b2DistanceJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2DistanceJoint=i.b2DistanceJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_distanceJoint)||this;return e.localAnchorA=new s.b2Vec2,e.localAnchorB=new s.b2Vec2,e.length=1,e.frequencyHz=0,e.dampingRatio=0,e}return n(e,t),e.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.length=s.b2Vec2.DistanceVV(i,o),this.frequencyHz=0,this.dampingRatio=0},e}(a.b2JointDef);i.b2DistanceJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_frequencyHz=0,i.m_dampingRatio=0,i.m_bias=0,i.m_localAnchorA=new s.b2Vec2,i.m_localAnchorB=new s.b2Vec2,i.m_gamma=0,i.m_impulse=0,i.m_length=0,i.m_indexA=0,i.m_indexB=0,i.m_u=new s.b2Vec2,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=0,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_lalcA=new s.b2Vec2,i.m_lalcB=new s.b2Vec2,i.m_frequencyHz=r.b2Maybe(e.frequencyHz,0),i.m_dampingRatio=r.b2Maybe(e.dampingRatio,0),i.m_localAnchorA.Copy(e.localAnchorA),i.m_localAnchorB.Copy(e.localAnchorB),i.m_length=e.length,i}return n(e,t),e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e},e.prototype.GetReactionTorque=function(){return 0},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.SetLength=function(t){this.m_length=t},e.prototype.Length=function(){return this.m_length},e.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,c=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,_=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(o),h=this.m_qB.SetAngle(l);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.b2Rot.MulRV(m,this.m_lalcA,this.m_rA),s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.b2Rot.MulRV(h,this.m_lalcB,this.m_rB),this.m_u.x=c.x+this.m_rB.x-i.x-this.m_rA.x,this.m_u.y=c.y+this.m_rB.y-i.y-this.m_rA.y;var p=this.m_u.Length();p>r.b2_linearSlop?this.m_u.SelfMul(1/p):this.m_u.SetZero();var f=s.b2Vec2.CrossVV(this.m_rA,this.m_u),b=s.b2Vec2.CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*b*b;if(this.m_mass=0!==d?1/d:0,this.m_frequencyHz>0){var y=p-this.m_length,v=2*r.b2_pi*this.m_frequencyHz,V=2*this.m_mass*this.m_dampingRatio*v,x=this.m_mass*v*v,C=t.step.dt;this.m_gamma=C*(V+C*x),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=y*C*x*this.m_gamma,d+=this.m_gamma,this.m_mass=0!==d?1/d:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var S=s.b2Vec2.MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,S),a-=this.m_invIA*s.b2Vec2.CrossVV(this.m_rA,S),u.SelfMulAdd(this.m_invMassB,S),_+=this.m_invIB*s.b2Vec2.CrossVV(this.m_rB,S)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=_},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=s.b2Vec2.AddVCrossSV(i,o,this.m_rA,e.SolveVelocityConstraints_s_vpA),c=s.b2Vec2.AddVCrossSV(n,r,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=s.b2Vec2.DotVV(this.m_u,s.b2Vec2.SubVV(c,a,s.b2Vec2.s_t0)),u=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var _=s.b2Vec2.MulSV(u,this.m_u,e.SolveVelocityConstraints_s_P);i.SelfMulSub(this.m_invMassA,_),o-=this.m_invIA*s.b2Vec2.CrossVV(this.m_rA,_),n.SelfMulAdd(this.m_invMassB,_),r+=this.m_invIB*s.b2Vec2.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,c=this.m_qA.SetAngle(o),l=this.m_qB.SetAngle(a),u=s.b2Rot.MulRV(c,this.m_lalcA,this.m_rA),_=s.b2Rot.MulRV(l,this.m_lalcB,this.m_rB),m=this.m_u;m.x=n.x+_.x-i.x-u.x,m.y=n.y+_.y-i.y-u.y;var h=this.m_u.Normalize()-this.m_length;h=s.b2Clamp(h,-r.b2_maxLinearCorrection,r.b2_maxLinearCorrection);var p=-this.m_mass*h,f=s.b2Vec2.MulSV(p,m,e.SolvePositionConstraints_s_P);return i.SelfMulSub(this.m_invMassA,f),o-=this.m_invIA*s.b2Vec2.CrossVV(u,f),n.SelfMulAdd(this.m_invMassB,f),a+=this.m_invIB*s.b2Vec2.CrossVV(_,f),t.positions[this.m_indexA].a=o,t.positions[this.m_indexB].a=a,s.b2Abs(h)<r.b2_linearSlop},e.InitVelocityConstraints_s_P=new s.b2Vec2,e.SolveVelocityConstraints_s_vpA=new s.b2Vec2,e.SolveVelocityConstraints_s_vpB=new s.b2Vec2,e.SolveVelocityConstraints_s_P=new s.b2Vec2,e.SolvePositionConstraints_s_P=new s.b2Vec2,e}(a.b2Joint);i.b2DistanceJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2Distance:[function(t,e,i){"use strict";cc._RF.push(e,"fcf85kg9ypNPZe5Vt7uTQrv","b2Distance"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2ShapeCast=i.b2Distance=i.b2Simplex=i.b2SimplexVertex=i.b2_gjk_reset=i.b2_gjkMaxIters=i.b2_gjkIters=i.b2_gjkCalls=i.b2ShapeCastOutput=i.b2ShapeCastInput=i.b2DistanceOutput=i.b2DistanceInput=i.b2SimplexCache=i.b2DistanceProxy=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=function(){function t(){this.m_buffer=n.b2Vec2.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}return t.prototype.Copy=function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this},t.prototype.Reset=function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this},t.prototype.SetShape=function(t,e){t.SetupDistanceProxy(this,e)},t.prototype.SetVerticesRadius=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i},t.prototype.GetSupport=function(t){for(var e=0,i=n.b2Vec2.DotVV(this.m_vertices[0],t),o=1;o<this.m_count;++o){var r=n.b2Vec2.DotVV(this.m_vertices[o],t);r>i&&(e=o,i=r)}return e},t.prototype.GetSupportVertex=function(t){for(var e=0,i=n.b2Vec2.DotVV(this.m_vertices[0],t),o=1;o<this.m_count;++o){var r=n.b2Vec2.DotVV(this.m_vertices[o],t);r>i&&(e=o,i=r)}return this.m_vertices[e]},t.prototype.GetVertexCount=function(){return this.m_count},t.prototype.GetVertex=function(t){return this.m_vertices[t]},t}();i.b2DistanceProxy=r;var s=function(){function t(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return t.prototype.Reset=function(){return this.metric=0,this.count=0,this},t}();i.b2SimplexCache=s;var a=function(){function t(){this.proxyA=new r,this.proxyB=new r,this.transformA=new n.b2Transform,this.transformB=new n.b2Transform,this.useRadii=!1}return t.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},t}();i.b2DistanceInput=a;var c=function(){function t(){this.pointA=new n.b2Vec2,this.pointB=new n.b2Vec2,this.distance=0,this.iterations=0}return t.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},t}();i.b2DistanceOutput=c;i.b2ShapeCastInput=function(){this.proxyA=new r,this.proxyB=new r,this.transformA=new n.b2Transform,this.transformB=new n.b2Transform,this.translationB=new n.b2Vec2};i.b2ShapeCastOutput=function(){this.point=new n.b2Vec2,this.normal=new n.b2Vec2,this.lambda=0,this.iterations=0},i.b2_gjkCalls=0,i.b2_gjkIters=0,i.b2_gjkMaxIters=0,i.b2_gjk_reset=function(){i.b2_gjkCalls=0,i.b2_gjkIters=0,i.b2_gjkMaxIters=0};var l=function(){function t(){this.wA=new n.b2Vec2,this.wB=new n.b2Vec2,this.w=new n.b2Vec2,this.a=0,this.indexA=0,this.indexB=0}return t.prototype.Copy=function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this},t}();i.b2SimplexVertex=l;var u=function(){function t(){this.m_v1=new l,this.m_v2=new l,this.m_v3=new l,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}return t.prototype.ReadCache=function(t,e,i,r,s){this.m_count=t.count;for(var a=this.m_vertices,c=0;c<this.m_count;++c){(h=a[c]).indexA=t.indexA[c],h.indexB=t.indexB[c];var l=e.GetVertex(h.indexA),u=r.GetVertex(h.indexB);n.b2Transform.MulXV(i,l,h.wA),n.b2Transform.MulXV(s,u,h.wB),n.b2Vec2.SubVV(h.wB,h.wA,h.w),h.a=0}if(this.m_count>1){var _=t.metric,m=this.GetMetric();(m<.5*_||2*_<m||m<o.b2_epsilon)&&(this.m_count=0)}var h;0===this.m_count&&((h=a[0]).indexA=0,h.indexB=0,l=e.GetVertex(0),u=r.GetVertex(0),n.b2Transform.MulXV(i,l,h.wA),n.b2Transform.MulXV(s,u,h.wB),n.b2Vec2.SubVV(h.wB,h.wA,h.w),h.a=1,this.m_count=1)},t.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB},t.prototype.GetSearchDirection=function(t){switch(this.m_count){case 1:return n.b2Vec2.NegV(this.m_v1.w,t);case 2:var e=n.b2Vec2.SubVV(this.m_v2.w,this.m_v1.w,t);return n.b2Vec2.CrossVV(e,n.b2Vec2.NegV(this.m_v1.w,n.b2Vec2.s_t0))>0?n.b2Vec2.CrossOneV(e,t):n.b2Vec2.CrossVOne(e,t);default:return t.SetZero()}},t.prototype.GetClosestPoint=function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}},t.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}},t.prototype.GetMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return n.b2Vec2.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return n.b2Vec2.CrossVV(n.b2Vec2.SubVV(this.m_v2.w,this.m_v1.w,n.b2Vec2.s_t0),n.b2Vec2.SubVV(this.m_v3.w,this.m_v1.w,n.b2Vec2.s_t1));default:return 0}},t.prototype.Solve2=function(){var e=this.m_v1.w,i=this.m_v2.w,o=n.b2Vec2.SubVV(i,e,t.s_e12),r=-n.b2Vec2.DotVV(e,o);if(r<=0)return this.m_v1.a=1,void(this.m_count=1);var s=n.b2Vec2.DotVV(i,o);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var a=1/(s+r);this.m_v1.a=s*a,this.m_v2.a=r*a,this.m_count=2},t.prototype.Solve3=function(){var e=this.m_v1.w,i=this.m_v2.w,o=this.m_v3.w,r=n.b2Vec2.SubVV(i,e,t.s_e12),s=n.b2Vec2.DotVV(e,r),a=n.b2Vec2.DotVV(i,r),c=-s,l=n.b2Vec2.SubVV(o,e,t.s_e13),u=n.b2Vec2.DotVV(e,l),_=n.b2Vec2.DotVV(o,l),m=-u,h=n.b2Vec2.SubVV(o,i,t.s_e23),p=n.b2Vec2.DotVV(i,h),f=n.b2Vec2.DotVV(o,h),b=-p,d=n.b2Vec2.CrossVV(r,l),y=d*n.b2Vec2.CrossVV(i,o),v=d*n.b2Vec2.CrossVV(o,e),V=d*n.b2Vec2.CrossVV(e,i);if(c<=0&&m<=0)return this.m_v1.a=1,void(this.m_count=1);if(a>0&&c>0&&V<=0){var x=1/(a+c);return this.m_v1.a=a*x,this.m_v2.a=c*x,void(this.m_count=2)}if(_>0&&m>0&&v<=0){var C=1/(_+m);return this.m_v1.a=_*C,this.m_v3.a=m*C,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(a<=0&&b<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(_<=0&&f<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(f>0&&b>0&&y<=0){var S=1/(f+b);return this.m_v2.a=f*S,this.m_v3.a=b*S,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var B=1/(y+v+V);this.m_v1.a=y*B,this.m_v2.a=v*B,this.m_v3.a=V*B,this.m_count=3},t.s_e12=new n.b2Vec2,t.s_e13=new n.b2Vec2,t.s_e23=new n.b2Vec2,t}();i.b2Simplex=u;var _=new u,m=[0,0,0],h=[0,0,0],p=new n.b2Vec2,f=new n.b2Vec2,b=new n.b2Vec2,d=new n.b2Vec2,y=new n.b2Vec2;i.b2Distance=function(t,e,r){++i.b2_gjkCalls;var s=r.proxyA,a=r.proxyB,c=r.transformA,l=r.transformB,u=_;u.ReadCache(e,s,c,a,l);for(var v=u.m_vertices,V=m,x=h,C=0,S=0;S<20;){C=u.m_count;for(var B=0;B<C;++B)V[B]=v[B].indexA,x[B]=v[B].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3()}if(3===u.m_count)break;var g=u.GetSearchDirection(f);if(g.LengthSquared()<o.b2_epsilon_sq)break;var A=v[u.m_count];A.indexA=s.GetSupport(n.b2Rot.MulTRV(c.q,n.b2Vec2.NegV(g,n.b2Vec2.s_t0),d)),n.b2Transform.MulXV(c,s.GetVertex(A.indexA),A.wA),A.indexB=a.GetSupport(n.b2Rot.MulTRV(l.q,g,y)),n.b2Transform.MulXV(l,a.GetVertex(A.indexB),A.wB),n.b2Vec2.SubVV(A.wB,A.wA,A.w),++S,++i.b2_gjkIters;var w=!1;for(B=0;B<C;++B)if(A.indexA===V[B]&&A.indexB===x[B]){w=!0;break}if(w)break;++u.m_count}if(i.b2_gjkMaxIters=n.b2Max(i.b2_gjkMaxIters,S),u.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.b2Vec2.DistanceVV(t.pointA,t.pointB),t.iterations=S,u.WriteCache(e),r.useRadii){var M=s.m_radius,P=a.m_radius;if(t.distance>M+P&&t.distance>o.b2_epsilon){t.distance-=M+P;var D=n.b2Vec2.SubVV(t.pointB,t.pointA,b);D.Normalize(),t.pointA.SelfMulAdd(M,D),t.pointB.SelfMulSub(P,D)}else{var R=n.b2Vec2.MidVV(t.pointA,t.pointB,p);t.pointA.Copy(R),t.pointB.Copy(R),t.distance=0}}};var v=new n.b2Vec2,V=new u,x=new n.b2Vec2,C=new n.b2Vec2,S=new n.b2Vec2,B=new n.b2Vec2,g=new n.b2Vec2,A=new n.b2Vec2;i.b2ShapeCast=function(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,r=e.proxyB,s=n.b2Max(i.m_radius,o.b2_polygonRadius)+n.b2Max(r.m_radius,o.b2_polygonRadius),a=e.transformA,c=e.transformB,l=e.translationB,u=v.Set(0,0),_=0,m=V;m.m_count=0;for(var h=m.m_vertices,p=i.GetSupport(n.b2Rot.MulTRV(a.q,n.b2Vec2.NegV(l,n.b2Vec2.s_t1),n.b2Vec2.s_t0)),f=n.b2Transform.MulXV(a,i.GetVertex(p),x),b=r.GetSupport(n.b2Rot.MulTRV(c.q,l,n.b2Vec2.s_t0)),d=n.b2Transform.MulXV(c,r.GetVertex(b),C),y=n.b2Vec2.SubVV(f,d,S),w=n.b2Max(o.b2_polygonRadius,s-o.b2_polygonRadius),M=.5*o.b2_linearSlop,P=0;P<20&&n.b2Abs(y.Length()-w)>M;){t.iterations+=1,p=i.GetSupport(n.b2Rot.MulTRV(a.q,n.b2Vec2.NegV(y,n.b2Vec2.s_t1),n.b2Vec2.s_t0)),f=n.b2Transform.MulXV(a,i.GetVertex(p),x),b=r.GetSupport(n.b2Rot.MulTRV(c.q,y,n.b2Vec2.s_t0)),d=n.b2Transform.MulXV(c,r.GetVertex(b),C);var D=n.b2Vec2.SubVV(f,d,B);y.Normalize();var R=n.b2Vec2.DotVV(y,D),F=n.b2Vec2.DotVV(y,l);if(R-w>_*F){if(F<=0)return!1;if((_=(R-w)/F)>1)return!1;u.Copy(y).SelfNeg(),m.m_count=0}var G=h[m.m_count];switch(G.indexA=b,G.wA.Copy(d).SelfMulAdd(_,l),G.indexB=p,G.wB.Copy(f),G.w.Copy(G.wB).SelfSub(G.wA),G.a=1,m.m_count+=1,m.m_count){case 1:break;case 2:m.Solve2();break;case 3:m.Solve3()}if(3===m.m_count)return!1;m.GetClosestPoint(y),++P}var I=g,T=A;return m.GetWitnessPoints(I,T),y.LengthSquared()>0&&(u.Copy(y).SelfNeg(),u.Normalize()),t.normal.Copy(u),t.lambda=_,t.iterations=P,!0},cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings"}],b2Draw:[function(t,e,i){"use strict";cc._RF.push(e,"4b649S24atMHIojI/iMMyVC","b2Draw"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Draw=i.b2DrawFlags=i.b2Color=void 0;var o=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t[0]instanceof Float32Array){if(4!==t[0].length)throw new Error;this.data=t[0]}else{var i="number"==typeof t[0]?t[0]:.5,o="number"==typeof t[1]?t[1]:.5,n="number"==typeof t[2]?t[2]:.5,r="number"==typeof t[3]?t[3]:1;this.data=new Float32Array([i,o,n,r])}}return Object.defineProperty(t.prototype,"r",{get:function(){return this.data[0]},set:function(t){this.data[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this.data[1]},set:function(t){this.data[1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this.data[2]},set:function(t){this.data[2]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this.data[3]},set:function(t){this.data[3]=t},enumerable:!1,configurable:!0}),t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.IsEqual=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},t.prototype.IsZero=function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a},t.prototype.Set=function(t,e,i,o){void 0===o&&(o=this.a),this.SetRGBA(t,e,i,o)},t.prototype.SetByteRGB=function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this},t.prototype.SetByteRGBA=function(t,e,i,o){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=o/255,this},t.prototype.SetRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},t.prototype.SetRGBA=function(t,e,i,o){return this.r=t,this.g=e,this.b=i,this.a=o,this},t.prototype.SelfAdd=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.Add=function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e},t.prototype.SelfSub=function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this},t.prototype.Sub=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e},t.prototype.SelfMul=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},t.prototype.Mul=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e},t.prototype.Mix=function(e,i){t.MixColors(this,e,i)},t.MixColors=function(t,e,i){var o=i*(e.r-t.r),n=i*(e.g-t.g),r=i*(e.b-t.b),s=i*(e.a-t.a);t.r+=o,t.g+=n,t.b+=r,t.a+=s,e.r-=o,e.g-=n,e.b-=r,e.a-=s},t.prototype.MakeStyleString=function(e){return void 0===e&&(e=this.a),t.MakeStyleString(this.r,this.g,this.b,e)},t.MakeStyleString=function(t,e,i,o){return void 0===o&&(o=1),t*=255,e*=255,i*=255,o<1?"rgba("+t+","+e+","+i+","+o+")":"rgb("+t+","+e+","+i+")"},t.ZERO=new t(0,0,0,0),t.RED=new t(1,0,0),t.GREEN=new t(0,1,0),t.BLUE=new t(0,0,1),t}();i.b2Color=o,function(t){t[t.e_none=0]="e_none",t[t.e_shapeBit=1]="e_shapeBit",t[t.e_jointBit=2]="e_jointBit",t[t.e_aabbBit=4]="e_aabbBit",t[t.e_pairBit=8]="e_pairBit",t[t.e_centerOfMassBit=16]="e_centerOfMassBit",t[t.e_particleBit=32]="e_particleBit",t[t.e_controllerBit=64]="e_controllerBit",t[t.e_all=63]="e_all"}(i.b2DrawFlags||(i.b2DrawFlags={}));var n=function(){function t(){this.m_drawFlags=0}return t.prototype.SetFlags=function(t){this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){this.m_drawFlags&=~t},t}();i.b2Draw=n,cc._RF.pop()},{}],b2DynamicTree:[function(t,e,i){"use strict";cc._RF.push(e,"795adJT5D1PmpT7m4ce0q7Y","b2DynamicTree"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2DynamicTree=i.b2TreeNode=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=t("../Common/b2GrowableStack"),s=t("./b2Collision");function a(t){if(null===t)throw new Error;return t}var c=function(){function t(t){void 0===t&&(t=0),this.m_id=0,this.aabb=new s.b2AABB,this._userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}return Object.defineProperty(t.prototype,"userData",{get:function(){if(null===this._userData)throw new Error;return this._userData},set:function(t){if(null!==this._userData)throw new Error;this._userData=t},enumerable:!1,configurable:!0}),t.prototype.Reset=function(){this._userData=null},t.prototype.IsLeaf=function(){return null===this.child1},t}();i.b2TreeNode=c;var l=function(){function t(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new r.b2GrowableStack(256)}return t.prototype.Query=function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var o=i.Pop();if(null!==o&&o.aabb.TestOverlap(t))if(o.IsLeaf()){if(!e(o))return}else i.Push(o.child1),i.Push(o.child2)}},t.prototype.QueryPoint=function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var o=i.Pop();if(null!==o&&o.aabb.TestContain(t))if(o.IsLeaf()){if(!e(o))return}else i.Push(o.child1),i.Push(o.child2)}},t.prototype.RayCast=function(e,i){var o=e.p1,r=e.p2,a=n.b2Vec2.SubVV(r,o,t.s_r);a.Normalize();var c=n.b2Vec2.CrossOneV(a,t.s_v),l=n.b2Vec2.AbsV(c,t.s_abs_v),u=e.maxFraction,_=t.s_segmentAABB,m=o.x+u*(r.x-o.x),h=o.y+u*(r.y-o.y);_.lowerBound.x=n.b2Min(o.x,m),_.lowerBound.y=n.b2Min(o.y,h),_.upperBound.x=n.b2Max(o.x,m),_.upperBound.y=n.b2Max(o.y,h);var p=this.m_stack.Reset();for(p.Push(this.m_root);p.GetCount()>0;){var f=p.Pop();if(null!==f&&s.b2TestOverlapAABB(f.aabb,_)){var b=f.aabb.GetCenter(),d=f.aabb.GetExtents();if(!(n.b2Abs(n.b2Vec2.DotVV(c,n.b2Vec2.SubVV(o,b,n.b2Vec2.s_t0)))-n.b2Vec2.DotVV(l,d)>0))if(f.IsLeaf()){var y=t.s_subInput;y.p1.Copy(e.p1),y.p2.Copy(e.p2),y.maxFraction=u;var v=i(y,f);if(0===v)return;v>0&&(u=v,m=o.x+u*(r.x-o.x),h=o.y+u*(r.y-o.y),_.lowerBound.x=n.b2Min(o.x,m),_.lowerBound.y=n.b2Min(o.y,h),_.upperBound.x=n.b2Max(o.x,m),_.upperBound.y=n.b2Max(o.y,h))}else p.Push(f.child1),p.Push(f.child2)}}},t.prototype.AllocateNode=function(){if(null!==this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e}return new c(t.s_node_id++)},t.prototype.FreeNode=function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.Reset(),this.m_freeList=t},t.prototype.CreateProxy=function(t,e){var i=this.AllocateNode(),n=o.b2_aabbExtension,r=o.b2_aabbExtension;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-r,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+r,i.userData=e,i.height=0,this.InsertLeaf(i),i},t.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},t.prototype.MoveProxy=function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var n=o.b2_aabbExtension,r=o.b2_aabbExtension;t.aabb.lowerBound.x=e.lowerBound.x-n,t.aabb.lowerBound.y=e.lowerBound.y-r,t.aabb.upperBound.x=e.upperBound.x+n,t.aabb.upperBound.y=e.upperBound.y+r;var s=o.b2_aabbMultiplier*i.x,a=o.b2_aabbMultiplier*i.y;return s<0?t.aabb.lowerBound.x+=s:t.aabb.upperBound.x+=s,a<0?t.aabb.lowerBound.y+=a:t.aabb.upperBound.y+=a,this.InsertLeaf(t),!0},t.prototype.InsertLeaf=function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var i=e.aabb,o=this.m_root;!o.IsLeaf();){var r=a(o.child1),s=a(o.child2),c=o.aabb.GetPerimeter(),l=t.s_combinedAABB;l.Combine2(o.aabb,i);var u=l.GetPerimeter(),_=2*u,m=2*(u-c),h=void 0,p=t.s_aabb,f=void 0;r.IsLeaf()?(p.Combine2(i,r.aabb),h=p.GetPerimeter()+m):(p.Combine2(i,r.aabb),f=r.aabb.GetPerimeter(),h=p.GetPerimeter()-f+m);var b=void 0;if(s.IsLeaf()?(p.Combine2(i,s.aabb),b=p.GetPerimeter()+m):(p.Combine2(i,s.aabb),f=s.aabb.GetPerimeter(),b=p.GetPerimeter()-f+m),_<h&&_<b)break;o=h<b?r:s}var d=o.parent,y=this.AllocateNode();y.parent=d,y.aabb.Combine2(i,o.aabb),y.height=o.height+1,null!==d?(d.child1===o?d.child1=y:d.child2=y,y.child1=o,y.child2=e,o.parent=y,e.parent=y):(y.child1=o,y.child2=e,o.parent=y,e.parent=y,this.m_root=y);for(var v=e.parent;null!==v;)r=a((v=this.Balance(v)).child1),s=a(v.child2),v.height=1+n.b2Max(r.height,s.height),v.aabb.Combine2(r.aabb,s.aabb),v=v.parent},t.prototype.RemoveLeaf=function(t){if(t!==this.m_root){var e=a(t.parent),i=e&&e.parent,o=a(e.child1===t?e.child2:e.child1);if(null!==i){i.child1===e?i.child1=o:i.child2=o,o.parent=i,this.FreeNode(e);for(var r=i;null!==r;){var s=a((r=this.Balance(r)).child1),c=a(r.child2);r.aabb.Combine2(s.aabb,c.aabb),r.height=1+n.b2Max(s.height,c.height),r=r.parent}}else this.m_root=o,o.parent=null,this.FreeNode(e)}else this.m_root=null},t.prototype.Balance=function(t){if(t.IsLeaf()||t.height<2)return t;var e=a(t.child1),i=a(t.child2),o=i.height-e.height;if(o>1){var r=a(i.child1),s=a(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,r.height>s.height?(i.child2=r,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+n.b2Max(e.height,s.height),i.height=1+n.b2Max(t.height,r.height)):(i.child2=s,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+n.b2Max(e.height,r.height),i.height=1+n.b2Max(t.height,s.height)),i}if(o<-1){var c=a(e.child1),l=a(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,c.height>l.height?(e.child2=c,t.child1=l,l.parent=t,t.aabb.Combine2(i.aabb,l.aabb),e.aabb.Combine2(t.aabb,c.aabb),t.height=1+n.b2Max(i.height,l.height),e.height=1+n.b2Max(t.height,c.height)):(e.child2=l,t.child1=c,c.parent=t,t.aabb.Combine2(i.aabb,c.aabb),e.aabb.Combine2(t.aabb,l.aabb),t.height=1+n.b2Max(i.height,c.height),e.height=1+n.b2Max(t.height,l.height)),e}return t},t.prototype.GetHeight=function(){return null===this.m_root?0:this.m_root.height},t.GetAreaNode=function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=e.aabb.GetPerimeter();return(i+=t.GetAreaNode(e.child1))+t.GetAreaNode(e.child2)},t.prototype.GetAreaRatio=function(){if(null===this.m_root)return 0;var e=this.m_root.aabb.GetPerimeter();return t.GetAreaNode(this.m_root)/e},t.ComputeHeightNode=function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=t.ComputeHeightNode(e.child1),o=t.ComputeHeightNode(e.child2);return 1+n.b2Max(i,o)},t.prototype.ComputeHeight=function(){return t.ComputeHeightNode(this.m_root)},t.prototype.ValidateStructure=function(t){if(null!==t&&(this.m_root,!t.IsLeaf())){var e=a(t.child1),i=a(t.child2);this.ValidateStructure(e),this.ValidateStructure(i)}},t.prototype.ValidateMetrics=function(e){if(null!==e&&!e.IsLeaf()){var i=a(e.child1),o=a(e.child2);t.s_aabb.Combine2(i.aabb,o.aabb),this.ValidateMetrics(i),this.ValidateMetrics(o)}},t.prototype.Validate=function(){},t.GetMaxBalanceNode=function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=a(t.child1),o=a(t.child2),r=n.b2Abs(o.height-i.height);return n.b2Max(e,r)},t.prototype.GetMaxBalance=function(){return t.GetMaxBalanceNode(this.m_root,0)},t.prototype.RebuildBottomUp=function(){this.Validate()},t.ShiftOriginNode=function(e,i){if(null!==e&&!(e.height<=1)){var o=e.child1,n=e.child2;t.ShiftOriginNode(o,i),t.ShiftOriginNode(n,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}},t.prototype.ShiftOrigin=function(e){t.ShiftOriginNode(this.m_root,e)},t.s_r=new n.b2Vec2,t.s_v=new n.b2Vec2,t.s_abs_v=new n.b2Vec2,t.s_segmentAABB=new s.b2AABB,t.s_subInput=new s.b2RayCastInput,t.s_combinedAABB=new s.b2AABB,t.s_aabb=new s.b2AABB,t.s_node_id=0,t}();i.b2DynamicTree=l,cc._RF.pop()},{"../Common/b2GrowableStack":"b2GrowableStack","../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Collision":"b2Collision"}],b2EdgeAndCircleContact:[function(t,e,i){"use strict";cc._RF.push(e,"ad23fJqMxFLYZXGrs9Cl/2Q","b2EdgeAndCircleContact");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2EdgeAndCircleContact=void 0;var r=t("../../Collision/b2CollideEdge"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,i){r.b2CollideEdgeAndCircle(t,this.GetShapeA(),e,this.GetShapeB(),i)},e}(t("./b2Contact").b2Contact);i.b2EdgeAndCircleContact=s,cc._RF.pop()},{"../../Collision/b2CollideEdge":"b2CollideEdge","./b2Contact":"b2Contact"}],b2EdgeAndPolygonContact:[function(t,e,i){"use strict";cc._RF.push(e,"908d2xvsCtC6qJ2FEmGX+wU","b2EdgeAndPolygonContact");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2EdgeAndPolygonContact=void 0;var r=t("../../Collision/b2CollideEdge"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,i){r.b2CollideEdgeAndPolygon(t,this.GetShapeA(),e,this.GetShapeB(),i)},e}(t("./b2Contact").b2Contact);i.b2EdgeAndPolygonContact=s,cc._RF.pop()},{"../../Collision/b2CollideEdge":"b2CollideEdge","./b2Contact":"b2Contact"}],b2EdgeShape:[function(t,e,i){"use strict";cc._RF.push(e,"bab28JwkihL05eo4nvQn5vi","b2EdgeShape");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2EdgeShape=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Shape"),c=function(t){function e(){var e=t.call(this,a.b2ShapeType.e_edgeShape,r.b2_polygonRadius)||this;return e.m_vertex1=new s.b2Vec2,e.m_vertex2=new s.b2Vec2,e.m_vertex0=new s.b2Vec2,e.m_vertex3=new s.b2Vec2,e.m_hasVertex0=!1,e.m_hasVertex3=!1,e}return n(e,t),e.prototype.Set=function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},e.prototype.Clone=function(){return(new e).Copy(this)},e.prototype.Copy=function(e){return t.prototype.Copy.call(this,e),this.m_vertex1.Copy(e.m_vertex1),this.m_vertex2.Copy(e.m_vertex2),this.m_vertex0.Copy(e.m_vertex0),this.m_vertex3.Copy(e.m_vertex3),this.m_hasVertex0=e.m_hasVertex0,this.m_hasVertex3=e.m_hasVertex3,this},e.prototype.GetChildCount=function(){return 1},e.prototype.TestPoint=function(){return!1},e.prototype.ComputeDistance=function(t,i,o){var n=s.b2Transform.MulXV(t,this.m_vertex1,e.ComputeDistance_s_v1),r=s.b2Transform.MulXV(t,this.m_vertex2,e.ComputeDistance_s_v2),a=s.b2Vec2.SubVV(i,n,e.ComputeDistance_s_d),c=s.b2Vec2.SubVV(r,n,e.ComputeDistance_s_s),l=s.b2Vec2.DotVV(a,c);if(l>0){var u=s.b2Vec2.DotVV(c,c);l>u?s.b2Vec2.SubVV(i,r,a):a.SelfMulSub(l/u,c)}return o.Copy(a),o.Normalize()},e.prototype.RayCast=function(t,i,o){var n=s.b2Transform.MulTXV(o,i.p1,e.RayCast_s_p1),r=s.b2Transform.MulTXV(o,i.p2,e.RayCast_s_p2),a=s.b2Vec2.SubVV(r,n,e.RayCast_s_d),c=this.m_vertex1,l=this.m_vertex2,u=s.b2Vec2.SubVV(l,c,e.RayCast_s_e),_=t.normal.Set(u.y,-u.x).SelfNormalize(),m=s.b2Vec2.DotVV(_,s.b2Vec2.SubVV(c,n,s.b2Vec2.s_t0)),h=s.b2Vec2.DotVV(_,a);if(0===h)return!1;var p=m/h;if(p<0||i.maxFraction<p)return!1;var f=s.b2Vec2.AddVMulSV(n,p,a,e.RayCast_s_q),b=s.b2Vec2.SubVV(l,c,e.RayCast_s_r),d=s.b2Vec2.DotVV(b,b);if(0===d)return!1;var y=s.b2Vec2.DotVV(s.b2Vec2.SubVV(f,c,s.b2Vec2.s_t0),b)/d;return!(y<0||1<y||(t.fraction=p,s.b2Rot.MulRV(o.q,t.normal,t.normal),m>0&&t.normal.SelfNeg(),0))},e.prototype.ComputeAABB=function(t,i){var o=s.b2Transform.MulXV(i,this.m_vertex1,e.ComputeAABB_s_v1),n=s.b2Transform.MulXV(i,this.m_vertex2,e.ComputeAABB_s_v2);s.b2Vec2.MinV(o,n,t.lowerBound),s.b2Vec2.MaxV(o,n,t.upperBound);var r=this.m_radius;t.lowerBound.SelfSubXY(r,r),t.upperBound.SelfAddXY(r,r)},e.prototype.ComputeMass=function(t){t.mass=0,s.b2Vec2.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0},e.prototype.SetupDistanceProxy=function(t){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius},e.prototype.ComputeSubmergedArea=function(t,e,i,o){return o.SetZero(),0},e.prototype.Dump=function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},e.ComputeDistance_s_v1=new s.b2Vec2,e.ComputeDistance_s_v2=new s.b2Vec2,e.ComputeDistance_s_d=new s.b2Vec2,e.ComputeDistance_s_s=new s.b2Vec2,e.RayCast_s_p1=new s.b2Vec2,e.RayCast_s_p2=new s.b2Vec2,e.RayCast_s_d=new s.b2Vec2,e.RayCast_s_e=new s.b2Vec2,e.RayCast_s_q=new s.b2Vec2,e.RayCast_s_r=new s.b2Vec2,e.ComputeAABB_s_v1=new s.b2Vec2,e.ComputeAABB_s_v2=new s.b2Vec2,e}(a.b2Shape);i.b2EdgeShape=c,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Shape":"b2Shape"}],b2Fixture:[function(t,e,i){"use strict";cc._RF.push(e,"a7f9awyqm5GjoDH9ZQcBqVM","b2Fixture"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Fixture=i.b2FixtureProxy=i.b2FixtureDef=i.b2Filter=void 0;var o=t("../Common/b2Settings"),n=t("../Collision/b2Collision"),r=t("../Collision/Shapes/b2Shape"),s=function(){function t(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this},t.DEFAULT=new t,t}();i.b2Filter=s;i.b2FixtureDef=function(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new s};var a=function(){function t(t,e){this.aabb=new n.b2AABB,this.childIndex=0,this.fixture=t,this.childIndex=e,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),e),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}return t.prototype.Reset=function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)},t.prototype.Touch=function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)},t.prototype.Synchronize=function(e,i,o){if(e===i)this.fixture.m_shape.ComputeAABB(this.aabb,e,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,o);else{var n=t.Synchronize_s_aabb1,r=t.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(n,e,this.childIndex),this.fixture.m_shape.ComputeAABB(r,i,this.childIndex),this.aabb.Combine2(n,r),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,o)}},t.Synchronize_s_aabb1=new n.b2AABB,t.Synchronize_s_aabb2=new n.b2AABB,t}();i.b2FixtureProxy=a;var c=function(){function t(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_filter=new s,this.m_isSensor=!1,this.m_userData=null,this.m_body=t,this.m_shape=e.shape.Clone(),this.m_userData=o.b2Maybe(e.userData,null),this.m_friction=o.b2Maybe(e.friction,.2),this.m_restitution=o.b2Maybe(e.restitution,0),this.m_filter.Copy(o.b2Maybe(e.filter,s.DEFAULT)),this.m_isSensor=o.b2Maybe(e.isSensor,!1),this.m_density=o.b2Maybe(e.density,0)}return Object.defineProperty(t.prototype,"m_proxyCount",{get:function(){return this.m_proxies.length},enumerable:!1,configurable:!0}),t.prototype.Reset=function(){},t.prototype.GetType=function(){return this.m_shape.GetType()},t.prototype.GetShape=function(){return this.m_shape},t.prototype.SetSensor=function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},t.prototype.IsSensor=function(){return this.m_isSensor},t.prototype.SetFilterData=function(t){this.m_filter.Copy(t),this.Refilter()},t.prototype.GetFilterData=function(){return this.m_filter},t.prototype.Refilter=function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),o=e.GetFixtureB();i!==this&&o!==this||e.FlagForFiltering(),t=t.next}this.TouchProxies()},t.prototype.GetBody=function(){return this.m_body},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(t){this.m_userData=t},t.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},t.prototype.ComputeDistance=function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)},t.prototype.RayCast=function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)},t.prototype.GetMassData=function(t){return void 0===t&&(t=new r.b2MassData),this.m_shape.ComputeMass(t,this.m_density),t},t.prototype.SetDensity=function(t){this.m_density=t},t.prototype.GetDensity=function(){return this.m_density},t.prototype.GetFriction=function(){return this.m_friction},t.prototype.SetFriction=function(t){this.m_friction=t},t.prototype.GetRestitution=function(){return this.m_restitution},t.prototype.SetRestitution=function(t){this.m_restitution=t},t.prototype.GetAABB=function(t){return this.m_proxies[t].aabb},t.prototype.Dump=function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)},t.prototype.CreateProxies=function(){if(0!==this.m_proxies.length)throw new Error;for(var t=0;t<this.m_shape.GetChildCount();++t)this.m_proxies[t]=new a(this,t)},t.prototype.DestroyProxies=function(){for(var t=0,e=this.m_proxies;t<e.length;t++)e[t].Reset();this.m_proxies.length=0},t.prototype.TouchProxies=function(){for(var t=0,e=this.m_proxies;t<e.length;t++)e[t].Touch()},t.prototype.SynchronizeProxies=function(t,e,i){for(var o=0,n=this.m_proxies;o<n.length;o++)n[o].Synchronize(t,e,i)},t}();i.b2Fixture=c,cc._RF.pop()},{"../Collision/Shapes/b2Shape":"b2Shape","../Collision/b2Collision":"b2Collision","../Common/b2Settings":"b2Settings"}],b2FrictionJoint:[function(t,e,i){"use strict";cc._RF.push(e,"5e20cdyhPtFQo+83sZvYdBu","b2FrictionJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2FrictionJoint=i.b2FrictionJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_frictionJoint)||this;return e.localAnchorA=new s.b2Vec2,e.localAnchorB=new s.b2Vec2,e.maxForce=0,e.maxTorque=0,e}return n(e,t),e.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)},e}(a.b2JointDef);i.b2FrictionJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_localAnchorA=new s.b2Vec2,i.m_localAnchorB=new s.b2Vec2,i.m_linearImpulse=new s.b2Vec2,i.m_angularImpulse=0,i.m_maxForce=0,i.m_maxTorque=0,i.m_indexA=0,i.m_indexB=0,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_linearMass=new s.b2Mat22,i.m_angularMass=0,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_lalcA=new s.b2Vec2,i.m_lalcB=new s.b2Vec2,i.m_K=new s.b2Mat22,i.m_localAnchorA.Copy(e.localAnchorA),i.m_localAnchorB.Copy(e.localAnchorB),i.m_linearImpulse.SetZero(),i.m_maxForce=r.b2Maybe(e.maxForce,0),i.m_maxTorque=r.b2Maybe(e.maxTorque,0),i.m_linearMass.SetZero(),i}return n(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,c=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=s.b2Rot.MulRV(c,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var _=s.b2Rot.MulRV(l,this.m_lalcB,this.m_rB),m=this.m_invMassA,h=this.m_invMassB,p=this.m_invIA,f=this.m_invIB,b=this.m_K;if(b.ex.x=m+h+p*u.y*u.y+f*_.y*_.y,b.ex.y=-p*u.x*u.y-f*_.x*_.y,b.ey.x=b.ex.y,b.ey.y=m+h+p*u.x*u.x+f*_.x*_.x,b.GetInverse(this.m_linearMass),this.m_angularMass=p+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var d=this.m_linearImpulse;i.SelfMulSub(m,d),o-=p*(s.b2Vec2.CrossVV(this.m_rA,d)+this.m_angularImpulse),r.SelfMulAdd(h,d),a+=f*(s.b2Vec2.CrossVV(this.m_rB,d)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=a},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,_=t.step.dt,m=r-o,h=-this.m_angularMass*m,p=this.m_angularImpulse,f=_*this.m_maxTorque;this.m_angularImpulse=s.b2Clamp(this.m_angularImpulse+h,-f,f),o-=l*(h=this.m_angularImpulse-p),r+=u*h;var b=s.b2Vec2.SubVV(s.b2Vec2.AddVCrossSV(n,r,this.m_rB,s.b2Vec2.s_t0),s.b2Vec2.AddVCrossSV(i,o,this.m_rA,s.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),d=s.b2Mat22.MulMV(this.m_linearMass,b,e.SolveVelocityConstraints_s_impulseV).SelfNeg(),y=e.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(d),f=_*this.m_maxForce,this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(f)),s.b2Vec2.SubVV(this.m_linearImpulse,y,d),i.SelfMulSub(a,d),o-=l*s.b2Vec2.CrossVV(this.m_rA,d),n.SelfMulAdd(c,d),r+=u*s.b2Vec2.CrossVV(this.m_rB,d),t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(){return!0},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e},e.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.SetMaxForce=function(t){this.m_maxForce=t},e.prototype.GetMaxForce=function(){return this.m_maxForce},e.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},e.prototype.GetMaxTorque=function(){return this.m_maxTorque},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.SolveVelocityConstraints_s_Cdot_v2=new s.b2Vec2,e.SolveVelocityConstraints_s_impulseV=new s.b2Vec2,e.SolveVelocityConstraints_s_oldImpulseV=new s.b2Vec2,e}(a.b2Joint);i.b2FrictionJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2GearJoint:[function(t,e,i){"use strict";cc._RF.push(e,"5079537Nq1GubFXgS9ZdtB3","b2GearJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2GearJoint=i.b2GearJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_gearJoint)||this;return e.ratio=1,e}return n(e,t),e}(a.b2JointDef);i.b2GearJointDef=c;var l=function(t){function e(e){var i,o,n=t.call(this,e)||this;n.m_typeA=a.b2JointType.e_unknownJoint,n.m_typeB=a.b2JointType.e_unknownJoint,n.m_localAnchorA=new s.b2Vec2,n.m_localAnchorB=new s.b2Vec2,n.m_localAnchorC=new s.b2Vec2,n.m_localAnchorD=new s.b2Vec2,n.m_localAxisC=new s.b2Vec2,n.m_localAxisD=new s.b2Vec2,n.m_referenceAngleA=0,n.m_referenceAngleB=0,n.m_constant=0,n.m_ratio=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_indexC=0,n.m_indexD=0,n.m_lcA=new s.b2Vec2,n.m_lcB=new s.b2Vec2,n.m_lcC=new s.b2Vec2,n.m_lcD=new s.b2Vec2,n.m_mA=0,n.m_mB=0,n.m_mC=0,n.m_mD=0,n.m_iA=0,n.m_iB=0,n.m_iC=0,n.m_iD=0,n.m_JvAC=new s.b2Vec2,n.m_JvBD=new s.b2Vec2,n.m_JwA=0,n.m_JwB=0,n.m_JwC=0,n.m_JwD=0,n.m_mass=0,n.m_qA=new s.b2Rot,n.m_qB=new s.b2Rot,n.m_qC=new s.b2Rot,n.m_qD=new s.b2Rot,n.m_lalcA=new s.b2Vec2,n.m_lalcB=new s.b2Vec2,n.m_lalcC=new s.b2Vec2,n.m_lalcD=new s.b2Vec2,n.m_joint1=e.joint1,n.m_joint2=e.joint2,n.m_typeA=n.m_joint1.GetType(),n.m_typeB=n.m_joint2.GetType(),n.m_bodyC=n.m_joint1.GetBodyA(),n.m_bodyA=n.m_joint1.GetBodyB();var c=n.m_bodyA.m_xf,l=n.m_bodyA.m_sweep.a,u=n.m_bodyC.m_xf,_=n.m_bodyC.m_sweep.a;if(n.m_typeA===a.b2JointType.e_revoluteJoint){var m=e.joint1;n.m_localAnchorC.Copy(m.m_localAnchorA),n.m_localAnchorA.Copy(m.m_localAnchorB),n.m_referenceAngleA=m.m_referenceAngle,n.m_localAxisC.SetZero(),i=l-_-n.m_referenceAngleA}else{var h=e.joint1;n.m_localAnchorC.Copy(h.m_localAnchorA),n.m_localAnchorA.Copy(h.m_localAnchorB),n.m_referenceAngleA=h.m_referenceAngle,n.m_localAxisC.Copy(h.m_localXAxisA);var p=n.m_localAnchorC,f=s.b2Rot.MulTRV(u.q,s.b2Vec2.AddVV(s.b2Rot.MulRV(c.q,n.m_localAnchorA,s.b2Vec2.s_t0),s.b2Vec2.SubVV(c.p,u.p,s.b2Vec2.s_t1),s.b2Vec2.s_t0),s.b2Vec2.s_t0);i=s.b2Vec2.DotVV(s.b2Vec2.SubVV(f,p,s.b2Vec2.s_t0),n.m_localAxisC)}n.m_bodyD=n.m_joint2.GetBodyA(),n.m_bodyB=n.m_joint2.GetBodyB();var b=n.m_bodyB.m_xf,d=n.m_bodyB.m_sweep.a,y=n.m_bodyD.m_xf,v=n.m_bodyD.m_sweep.a;if(n.m_typeB===a.b2JointType.e_revoluteJoint)m=e.joint2,n.m_localAnchorD.Copy(m.m_localAnchorA),n.m_localAnchorB.Copy(m.m_localAnchorB),n.m_referenceAngleB=m.m_referenceAngle,n.m_localAxisD.SetZero(),o=d-v-n.m_referenceAngleB;else{h=e.joint2,n.m_localAnchorD.Copy(h.m_localAnchorA),n.m_localAnchorB.Copy(h.m_localAnchorB),n.m_referenceAngleB=h.m_referenceAngle,n.m_localAxisD.Copy(h.m_localXAxisA);var V=n.m_localAnchorD,x=s.b2Rot.MulTRV(y.q,s.b2Vec2.AddVV(s.b2Rot.MulRV(b.q,n.m_localAnchorB,s.b2Vec2.s_t0),s.b2Vec2.SubVV(b.p,y.p,s.b2Vec2.s_t1),s.b2Vec2.s_t0),s.b2Vec2.s_t0);o=s.b2Vec2.DotVV(s.b2Vec2.SubVV(x,V,s.b2Vec2.s_t0),n.m_localAxisD)}return n.m_ratio=r.b2Maybe(e.ratio,1),n.m_constant=i+n.m_ratio*o,n.m_impulse=0,n}return n(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=t.positions[this.m_indexA].a,o=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,u=t.positions[this.m_indexC].a,_=t.velocities[this.m_indexC].v,m=t.velocities[this.m_indexC].w,h=t.positions[this.m_indexD].a,p=t.velocities[this.m_indexD].v,f=t.velocities[this.m_indexD].w,b=this.m_qA.SetAngle(i),d=this.m_qB.SetAngle(r),y=this.m_qC.SetAngle(u),v=this.m_qD.SetAngle(h);if(this.m_mass=0,this.m_typeA===a.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var V=s.b2Rot.MulRV(y,this.m_localAxisC,e.InitVelocityConstraints_s_u);s.b2Vec2.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var x=s.b2Rot.MulRV(y,this.m_lalcC,e.InitVelocityConstraints_s_rC);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var C=s.b2Rot.MulRV(b,this.m_lalcA,e.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(V),this.m_JwC=s.b2Vec2.CrossVV(x,V),this.m_JwA=s.b2Vec2.CrossVV(C,V),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===a.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{V=s.b2Rot.MulRV(v,this.m_localAxisD,e.InitVelocityConstraints_s_u),s.b2Vec2.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var S=s.b2Rot.MulRV(v,this.m_lalcD,e.InitVelocityConstraints_s_rD);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var B=s.b2Rot.MulRV(d,this.m_lalcB,e.InitVelocityConstraints_s_rB);s.b2Vec2.MulSV(this.m_ratio,V,this.m_JvBD),this.m_JwD=this.m_ratio*s.b2Vec2.CrossVV(S,V),this.m_JwB=this.m_ratio*s.b2Vec2.CrossVV(B,V),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(o.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,c.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),l+=this.m_iB*this.m_impulse*this.m_JwB,_.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),m-=this.m_iC*this.m_impulse*this.m_JwC,p.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),f-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l,t.velocities[this.m_indexC].w=m,t.velocities[this.m_indexD].w=f},e.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,o=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,r=t.velocities[this.m_indexC].v,a=t.velocities[this.m_indexC].w,c=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,u=s.b2Vec2.DotVV(this.m_JvAC,s.b2Vec2.SubVV(e,r,s.b2Vec2.s_t0))+s.b2Vec2.DotVV(this.m_JvBD,s.b2Vec2.SubVV(o,c,s.b2Vec2.s_t0));u+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*n-this.m_JwD*l);var _=-this.m_mass*u;this.m_impulse+=_,e.SelfMulAdd(this.m_mA*_,this.m_JvAC),i+=this.m_iA*_*this.m_JwA,o.SelfMulAdd(this.m_mB*_,this.m_JvBD),n+=this.m_iB*_*this.m_JwB,r.SelfMulSub(this.m_mC*_,this.m_JvAC),a-=this.m_iC*_*this.m_JwC,c.SelfMulSub(this.m_mD*_,this.m_JvBD),l-=this.m_iD*_*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=l},e.prototype.SolvePositionConstraints=function(t){var i,o,n,c,l,u,_=t.positions[this.m_indexA].c,m=t.positions[this.m_indexA].a,h=t.positions[this.m_indexB].c,p=t.positions[this.m_indexB].a,f=t.positions[this.m_indexC].c,b=t.positions[this.m_indexC].a,d=t.positions[this.m_indexD].c,y=t.positions[this.m_indexD].a,v=this.m_qA.SetAngle(m),V=this.m_qB.SetAngle(p),x=this.m_qC.SetAngle(b),C=this.m_qD.SetAngle(y),S=this.m_JvAC,B=this.m_JvBD,g=0;if(this.m_typeA===a.b2JointType.e_revoluteJoint)S.SetZero(),n=1,l=1,g+=this.m_iA+this.m_iC,i=m-b-this.m_referenceAngleA;else{var A=s.b2Rot.MulRV(x,this.m_localAxisC,e.SolvePositionConstraints_s_u),w=s.b2Rot.MulRV(x,this.m_lalcC,e.SolvePositionConstraints_s_rC),M=s.b2Rot.MulRV(v,this.m_lalcA,e.SolvePositionConstraints_s_rA);S.Copy(A),l=s.b2Vec2.CrossVV(w,A),n=s.b2Vec2.CrossVV(M,A),g+=this.m_mC+this.m_mA+this.m_iC*l*l+this.m_iA*n*n;var P=this.m_lalcC,D=s.b2Rot.MulTRV(x,s.b2Vec2.AddVV(M,s.b2Vec2.SubVV(_,f,s.b2Vec2.s_t0),s.b2Vec2.s_t0),s.b2Vec2.s_t0);i=s.b2Vec2.DotVV(s.b2Vec2.SubVV(D,P,s.b2Vec2.s_t0),this.m_localAxisC)}if(this.m_typeB===a.b2JointType.e_revoluteJoint)B.SetZero(),c=this.m_ratio,u=this.m_ratio,g+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),o=p-y-this.m_referenceAngleB;else{A=s.b2Rot.MulRV(C,this.m_localAxisD,e.SolvePositionConstraints_s_u);var R=s.b2Rot.MulRV(C,this.m_lalcD,e.SolvePositionConstraints_s_rD),F=s.b2Rot.MulRV(V,this.m_lalcB,e.SolvePositionConstraints_s_rB);s.b2Vec2.MulSV(this.m_ratio,A,B),u=this.m_ratio*s.b2Vec2.CrossVV(R,A),c=this.m_ratio*s.b2Vec2.CrossVV(F,A),g+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*u*u+this.m_iB*c*c;var G=this.m_lalcD,I=s.b2Rot.MulTRV(C,s.b2Vec2.AddVV(F,s.b2Vec2.SubVV(h,d,s.b2Vec2.s_t0),s.b2Vec2.s_t0),s.b2Vec2.s_t0);o=s.b2Vec2.DotVV(s.b2Vec2.SubVV(I,G,s.b2Vec2.s_t0),this.m_localAxisD)}var T=i+this.m_ratio*o-this.m_constant,L=0;return g>0&&(L=-T/g),_.SelfMulAdd(this.m_mA*L,S),m+=this.m_iA*L*n,h.SelfMulAdd(this.m_mB*L,B),p+=this.m_iB*L*c,f.SelfMulSub(this.m_mC*L,S),b-=this.m_iC*L*l,d.SelfMulSub(this.m_mD*L,B),y-=this.m_iD*L*u,t.positions[this.m_indexA].a=m,t.positions[this.m_indexB].a=p,t.positions[this.m_indexC].a=b,t.positions[this.m_indexD].a=y,0<r.b2_linearSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return s.b2Vec2.MulSV(t*this.m_impulse,this.m_JvAC,e)},e.prototype.GetReactionTorque=function(t){return t*this.m_impulse*this.m_JwA},e.prototype.GetJoint1=function(){return this.m_joint1},e.prototype.GetJoint2=function(){return this.m_joint2},e.prototype.GetRatio=function(){return this.m_ratio},e.prototype.SetRatio=function(t){this.m_ratio=t},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,o=this.m_joint1.m_index,n=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",o),t("  jd.joint2 = joints[%d];\n",n),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.InitVelocityConstraints_s_u=new s.b2Vec2,e.InitVelocityConstraints_s_rA=new s.b2Vec2,e.InitVelocityConstraints_s_rB=new s.b2Vec2,e.InitVelocityConstraints_s_rC=new s.b2Vec2,e.InitVelocityConstraints_s_rD=new s.b2Vec2,e.SolvePositionConstraints_s_u=new s.b2Vec2,e.SolvePositionConstraints_s_rA=new s.b2Vec2,e.SolvePositionConstraints_s_rB=new s.b2Vec2,e.SolvePositionConstraints_s_rC=new s.b2Vec2,e.SolvePositionConstraints_s_rD=new s.b2Vec2,e}(a.b2Joint);i.b2GearJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2GravityController:[function(t,e,i){"use strict";cc._RF.push(e,"4bbb8qAyINHA4V5m/M/nCar","b2GravityController");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2GravityController=void 0;var r=t("./b2Controller"),s=t("../Common/b2Settings"),a=t("../Common/b2Math"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.G=1,e.invSqr=!0,e}return n(e,t),e.prototype.Step=function(){if(this.invSqr)for(var t=this.m_bodyList;t;t=t.nextBody)for(var i=(l=t.body).GetWorldCenter(),o=l.GetMass(),n=this.m_bodyList;n&&n!==t;n=n.nextBody){var r=(u=n.body).GetWorldCenter(),c=u.GetMass();(h=(_=r.x-i.x)*_+(m=r.y-i.y)*m)<s.b2_epsilon||((p=e.Step_s_f.Set(_,m)).SelfMul(this.G/h/a.b2Sqrt(h)*o*c),l.IsAwake()&&l.ApplyForce(p,i),u.IsAwake()&&u.ApplyForce(p.SelfMul(-1),r))}else for(t=this.m_bodyList;t;t=t.nextBody){var l;for(i=(l=t.body).GetWorldCenter(),o=l.GetMass(),n=this.m_bodyList;n&&n!==t;n=n.nextBody){var u,_,m,h,p;r=(u=n.body).GetWorldCenter(),c=u.GetMass(),(h=(_=r.x-i.x)*_+(m=r.y-i.y)*m)<s.b2_epsilon||((p=e.Step_s_f.Set(_,m)).SelfMul(this.G/h*o*c),l.IsAwake()&&l.ApplyForce(p,i),u.IsAwake()&&u.ApplyForce(p.SelfMul(-1),r))}}},e.prototype.Draw=function(){},e.Step_s_f=new a.b2Vec2,e}(r.b2Controller);i.b2GravityController=c,cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Controller":"b2Controller"}],b2GrowableStack:[function(t,e,i){"use strict";cc._RF.push(e,"7106fnvJNRIta7QkXDxRwQd","b2GrowableStack"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2GrowableStack=void 0;var o=t("./b2Settings"),n=function(){function t(t){this.m_stack=[],this.m_count=0,this.m_stack=o.b2MakeArray(t,function(){return null}),this.m_count=0}return t.prototype.Reset=function(){return this.m_count=0,this},t.prototype.Push=function(t){this.m_stack[this.m_count]=t,this.m_count++},t.prototype.Pop=function(){this.m_count--;var t=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===t)throw new Error;return t},t.prototype.GetCount=function(){return this.m_count},t}();i.b2GrowableStack=n,cc._RF.pop()},{"./b2Settings":"b2Settings"}],b2Island:[function(t,e,i){"use strict";cc._RF.push(e,"d50e8dZ2o1O0Y+sq2u6/Pz0","b2Island"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Island=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Settings"),r=t("../Common/b2Settings"),s=t("../Common/b2Settings"),a=t("../Common/b2Math"),c=t("../Common/b2Timer"),l=t("./Contacts/b2ContactSolver"),u=t("./b2Body"),_=t("./b2TimeStep"),m=t("./b2WorldCallbacks"),h=function(){function t(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=_.b2Position.MakeArray(1024),this.m_velocities=_.b2Velocity.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return t.prototype.Initialize=function(t,e,i,o){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=o,this.m_positions.length<t)for(var n=a.b2Max(2*this.m_positions.length,t);this.m_positions.length<n;)this.m_positions[this.m_positions.length]=new _.b2Position;if(this.m_velocities.length<t)for(n=a.b2Max(2*this.m_velocities.length,t);this.m_velocities.length<n;)this.m_velocities[this.m_velocities.length]=new _.b2Velocity},t.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},t.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},t.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},t.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},t.prototype.Solve=function(e,i,c,l){for(var _=t.s_timer.Reset(),m=i.dt,h=0;h<this.m_bodyCount;++h){var p=this.m_bodies[h];this.m_positions[h].c.Copy(p.m_sweep.c);var f=p.m_sweep.a,b=this.m_velocities[h].v.Copy(p.m_linearVelocity),d=p.m_angularVelocity;p.m_sweep.c0.Copy(p.m_sweep.c),p.m_sweep.a0=p.m_sweep.a,p.m_type===u.b2BodyType.b2_dynamicBody&&(b.x+=m*(p.m_gravityScale*c.x+p.m_invMass*p.m_force.x),b.y+=m*(p.m_gravityScale*c.y+p.m_invMass*p.m_force.y),d+=m*p.m_invI*p.m_torque,b.SelfMul(1/(1+m*p.m_linearDamping)),d*=1/(1+m*p.m_angularDamping)),this.m_positions[h].a=f,this.m_velocities[h].w=d}_.Reset();var y=t.s_solverData;y.step.Copy(i),y.positions=this.m_positions,y.velocities=this.m_velocities;var v=t.s_contactSolverDef;v.step.Copy(i),v.contacts=this.m_contacts,v.count=this.m_contactCount,v.positions=this.m_positions,v.velocities=this.m_velocities;var V=t.s_contactSolver.Initialize(v);for(V.InitializeVelocityConstraints(),i.warmStarting&&V.WarmStart(),h=0;h<this.m_jointCount;++h)this.m_joints[h].InitVelocityConstraints(y);for(e.solveInit=_.GetMilliseconds(),_.Reset(),h=0;h<i.velocityIterations;++h){for(var x=0;x<this.m_jointCount;++x)this.m_joints[x].SolveVelocityConstraints(y);V.SolveVelocityConstraints()}for(V.StoreImpulses(),e.solveVelocity=_.GetMilliseconds(),h=0;h<this.m_bodyCount;++h){var C=this.m_positions[h].c,S=(f=this.m_positions[h].a,b=this.m_velocities[h].v,d=this.m_velocities[h].w,a.b2Vec2.MulSV(m,b,t.s_translation));if(a.b2Vec2.DotVV(S,S)>n.b2_maxTranslationSquared){var B=n.b2_maxTranslation/S.Length();b.SelfMul(B)}var g=m*d;g*g>r.b2_maxRotationSquared&&(d*=B=r.b2_maxRotation/a.b2Abs(g)),C.x+=m*b.x,C.y+=m*b.y,f+=m*d,this.m_positions[h].a=f,this.m_velocities[h].w=d}_.Reset();var A=!1;for(h=0;h<i.positionIterations;++h){var w=V.SolvePositionConstraints(),M=!0;for(x=0;x<this.m_jointCount;++x){var P=this.m_joints[x].SolvePositionConstraints(y);M=M&&P}if(w&&M){A=!0;break}}for(h=0;h<this.m_bodyCount;++h){var D=this.m_bodies[h];D.m_sweep.c.Copy(this.m_positions[h].c),D.m_sweep.a=this.m_positions[h].a,D.m_linearVelocity.Copy(this.m_velocities[h].v),D.m_angularVelocity=this.m_velocities[h].w,D.SynchronizeTransform()}if(e.solvePosition=_.GetMilliseconds(),this.Report(V.m_velocityConstraints),l){var R=o.b2_maxFloat,F=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,G=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(h=0;h<this.m_bodyCount;++h)(p=this.m_bodies[h]).GetType()!==u.b2BodyType.b2_staticBody&&(!p.m_autoSleepFlag||p.m_angularVelocity*p.m_angularVelocity>G||a.b2Vec2.DotVV(p.m_linearVelocity,p.m_linearVelocity)>F?(p.m_sleepTime=0,R=0):(p.m_sleepTime+=m,R=a.b2Min(R,p.m_sleepTime)));if(R>=o.b2_timeToSleep&&A)for(h=0;h<this.m_bodyCount;++h)(p=this.m_bodies[h]).SetAwake(!1)}},t.prototype.SolveTOI=function(e,i,o){for(var s=0;s<this.m_bodyCount;++s){var c=this.m_bodies[s];this.m_positions[s].c.Copy(c.m_sweep.c),this.m_positions[s].a=c.m_sweep.a,this.m_velocities[s].v.Copy(c.m_linearVelocity),this.m_velocities[s].w=c.m_angularVelocity}var l=t.s_contactSolverDef;l.contacts=this.m_contacts,l.count=this.m_contactCount,l.step.Copy(e),l.positions=this.m_positions,l.velocities=this.m_velocities;var u=t.s_contactSolver.Initialize(l);for(s=0;s<e.positionIterations&&!u.SolveTOIPositionConstraints(i,o);++s);for(this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,this.m_bodies[o].m_sweep.c0.Copy(this.m_positions[o].c),this.m_bodies[o].m_sweep.a0=this.m_positions[o].a,u.InitializeVelocityConstraints(),s=0;s<e.velocityIterations;++s)u.SolveVelocityConstraints();var _=e.dt;for(s=0;s<this.m_bodyCount;++s){var m=this.m_positions[s].c,h=this.m_positions[s].a,p=this.m_velocities[s].v,f=this.m_velocities[s].w,b=a.b2Vec2.MulSV(_,p,t.s_translation);if(a.b2Vec2.DotVV(b,b)>n.b2_maxTranslationSquared){var d=n.b2_maxTranslation/b.Length();p.SelfMul(d)}var y=_*f;y*y>r.b2_maxRotationSquared&&(f*=d=r.b2_maxRotation/a.b2Abs(y)),m.SelfMulAdd(_,p),h+=_*f,this.m_positions[s].a=h,this.m_velocities[s].w=f;var v=this.m_bodies[s];v.m_sweep.c.Copy(m),v.m_sweep.a=h,v.m_linearVelocity.Copy(p),v.m_angularVelocity=f,v.SynchronizeTransform()}this.Report(u.m_velocityConstraints)},t.prototype.Report=function(e){if(null!==this.m_listener)for(var i=0;i<this.m_contactCount;++i){var o=this.m_contacts[i];if(o){var n=e[i],r=t.s_impulse;r.count=n.pointCount;for(var s=0;s<n.pointCount;++s)r.normalImpulses[s]=n.points[s].normalImpulse,r.tangentImpulses[s]=n.points[s].tangentImpulse;this.m_listener.PostSolve(o,r)}}},t.s_timer=new c.b2Timer,t.s_solverData=new _.b2SolverData,t.s_contactSolverDef=new l.b2ContactSolverDef,t.s_contactSolver=new l.b2ContactSolver,t.s_translation=new a.b2Vec2,t.s_impulse=new m.b2ContactImpulse,t}();i.b2Island=h,cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","../Common/b2Timer":"b2Timer","./Contacts/b2ContactSolver":"b2ContactSolver","./b2Body":"b2Body","./b2TimeStep":"b2TimeStep","./b2WorldCallbacks":"b2WorldCallbacks"}],b2Joint:[function(t,e,i){"use strict";cc._RF.push(e,"deb1aAGUa9IMI+jf7ph1dZ0","b2Joint"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Joint=i.b2JointDef=i.b2JointEdge=i.b2Jacobian=i.b2LimitState=i.b2JointType=void 0;var o,n=t("../../Common/b2Settings"),r=t("../../Common/b2Math");(function(t){t[t.e_unknownJoint=0]="e_unknownJoint",t[t.e_revoluteJoint=1]="e_revoluteJoint",t[t.e_prismaticJoint=2]="e_prismaticJoint",t[t.e_distanceJoint=3]="e_distanceJoint",t[t.e_pulleyJoint=4]="e_pulleyJoint",t[t.e_mouseJoint=5]="e_mouseJoint",t[t.e_gearJoint=6]="e_gearJoint",t[t.e_wheelJoint=7]="e_wheelJoint",t[t.e_weldJoint=8]="e_weldJoint",t[t.e_frictionJoint=9]="e_frictionJoint",t[t.e_ropeJoint=10]="e_ropeJoint",t[t.e_motorJoint=11]="e_motorJoint",t[t.e_areaJoint=12]="e_areaJoint"})(o=i.b2JointType||(i.b2JointType={})),function(t){t[t.e_inactiveLimit=0]="e_inactiveLimit",t[t.e_atLowerLimit=1]="e_atLowerLimit",t[t.e_atUpperLimit=2]="e_atUpperLimit",t[t.e_equalLimits=3]="e_equalLimits"}(i.b2LimitState||(i.b2LimitState={}));var s=function(){function t(){this.linear=new r.b2Vec2,this.angularA=0,this.angularB=0}return t.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},t.prototype.Set=function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this},t}();i.b2Jacobian=s;var a=function(){function t(t){this._other=null,this.prev=null,this.next=null,this.joint=t}return Object.defineProperty(t.prototype,"other",{get:function(){if(null===this._other)throw new Error;return this._other},set:function(t){if(null!==this._other)throw new Error;this._other=t},enumerable:!1,configurable:!0}),t.prototype.Reset=function(){this._other=null,this.prev=null,this.next=null},t}();i.b2JointEdge=a;i.b2JointDef=function(t){this.type=o.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=t};var c=function(){function t(t){this.m_type=o.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_edgeA=new a(this),this.m_edgeB=new a(this),this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=t.type,this.m_edgeA.other=t.bodyB,this.m_edgeB.other=t.bodyA,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=n.b2Maybe(t.collideConnected,!1),this.m_userData=n.b2Maybe(t.userData,null)}return t.prototype.GetType=function(){return this.m_type},t.prototype.GetBodyA=function(){return this.m_bodyA},t.prototype.GetBodyB=function(){return this.m_bodyB},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(t){this.m_userData=t},t.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},t.prototype.GetCollideConnected=function(){return this.m_collideConnected},t.prototype.Dump=function(t){t("// Dump is not supported for this joint type.\n")},t.prototype.ShiftOrigin=function(){},t}();i.b2Joint=c,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings"}],b2Math:[function(t,e,i){"use strict";cc._RF.push(e,"4d9da442SdPFbT/AgeQYG48","b2Math"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Sweep=i.b2Transform=i.b2Rot=i.b2Mat33=i.b2Mat22=i.b2Vec3=i.b2Vec2_zero=i.b2Vec2=i.b2RandomRange=i.b2Random=i.b2IsPowerOfTwo=i.b2NextPowerOfTwo=i.b2Atan2=i.b2Asin=i.b2Acos=i.b2Sin=i.b2Cos=i.b2RadToDeg=i.b2DegToRad=i.b2Pow=i.b2Sqrt=i.b2InvSqrt=i.b2Sq=i.b2IsValid=i.b2Swap=i.b2Clamp=i.b2Max=i.b2Min=i.b2Abs=i.b2_two_pi=i.b2_180_over_pi=i.b2_pi_over_180=void 0;var o=t("./b2Settings");function n(t,e){return t<e?t:e}function r(t,e){return t>e?t:e}function s(t,e,i){return t<e?e:t>i?i:t}i.b2_pi_over_180=o.b2_pi/180,i.b2_180_over_pi=180/o.b2_pi,i.b2_two_pi=2*o.b2_pi,i.b2Abs=Math.abs,i.b2Min=n,i.b2Max=r,i.b2Clamp=s,i.b2Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},i.b2IsValid=isFinite,i.b2Sq=function(t){return t*t},i.b2InvSqrt=function(t){return 1/Math.sqrt(t)},i.b2Sqrt=Math.sqrt,i.b2Pow=Math.pow,i.b2DegToRad=function(t){return t*i.b2_pi_over_180},i.b2RadToDeg=function(t){return t*i.b2_180_over_pi},i.b2Cos=Math.cos,i.b2Sin=Math.sin,i.b2Acos=Math.acos,i.b2Asin=Math.asin,i.b2Atan2=Math.atan2,i.b2NextPowerOfTwo=function(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,1+(t|=t>>16&65535)},i.b2IsPowerOfTwo=function(t){return t>0&&0==(t&t-1)},i.b2Random=function(){return 2*Math.random()-1},i.b2RandomRange=function(t,e){return(e-t)*Math.random()+t};var a=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t[0]instanceof Float32Array){if(2!==t[0].length)throw new Error;this.data=t[0]}else{var i="number"==typeof t[0]?t[0]:0,o="number"==typeof t[1]?t[1]:0;this.data=new Float32Array([i,o])}}return Object.defineProperty(t.prototype,"x",{get:function(){return this.data[0]},set:function(t){this.data[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.data[1]},set:function(t){this.data[1]=t},enumerable:!1,configurable:!0}),t.prototype.Clone=function(){return new t(this.x,this.y)},t.prototype.SetZero=function(){return this.x=0,this.y=0,this},t.prototype.Set=function(t,e){return this.x=t,this.y=e,this},t.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.SelfAddXY=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.SelfSubXY=function(t,e){return this.x-=t,this.y-=e,this},t.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this},t.prototype.SelfMulAdd=function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this},t.prototype.SelfMulSub=function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this},t.prototype.Dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.Cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.Length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.LengthSquared=function(){var t=this.x,e=this.y;return t*t+e*e},t.prototype.Normalize=function(){var t=this.Length();if(t>=o.b2_epsilon){var e=1/t;this.x*=e,this.y*=e}return t},t.prototype.SelfNormalize=function(){var t=this.Length();if(t>=o.b2_epsilon){var e=1/t;this.x*=e,this.y*=e}return this},t.prototype.SelfRotate=function(t){var e=Math.cos(t),i=Math.sin(t),o=this.x;return this.x=e*o-i*this.y,this.y=i*o+e*this.y,this},t.prototype.SelfRotateCosSin=function(t,e){var i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this},t.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},t.prototype.SelfCrossVS=function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this},t.prototype.SelfCrossSV=function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this},t.prototype.SelfMinV=function(t){return this.x=n(this.x,t.x),this.y=n(this.y,t.y),this},t.prototype.SelfMaxV=function(t){return this.x=r(this.x,t.x),this.y=r(this.y,t.y),this},t.prototype.SelfAbs=function(){return this.x=i.b2Abs(this.x),this.y=i.b2Abs(this.y),this},t.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.SelfSkew=function(){var t=this.x;return this.x=-this.y,this.y=t,this},t.MakeArray=function(e){return o.b2MakeArray(e,function(){return new t})},t.AbsV=function(t,e){return e.x=i.b2Abs(t.x),e.y=i.b2Abs(t.y),e},t.MinV=function(t,e,i){return i.x=n(t.x,e.x),i.y=n(t.y,e.y),i},t.MaxV=function(t,e,i){return i.x=r(t.x,e.x),i.y=r(t.y,e.y),i},t.ClampV=function(t,e,i,o){return o.x=s(t.x,e.x,i.x),o.y=s(t.y,e.y,i.y),o},t.RotateV=function(t,e,i){var o=t.x,n=t.y,r=Math.cos(e),s=Math.sin(e);return i.x=r*o-s*n,i.y=s*o+r*n,i},t.DotVV=function(t,e){return t.x*e.x+t.y*e.y},t.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},t.CrossVS=function(t,e,i){var o=t.x;return i.x=e*t.y,i.y=-e*o,i},t.CrossVOne=function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e},t.CrossSV=function(t,e,i){var o=e.x;return i.x=-t*e.y,i.y=t*o,i},t.CrossOneV=function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e},t.AddVV=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},t.SubVV=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},t.MulSV=function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i},t.MulVS=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},t.AddVMulSV=function(t,e,i,o){return o.x=t.x+e*i.x,o.y=t.y+e*i.y,o},t.SubVMulSV=function(t,e,i,o){return o.x=t.x-e*i.x,o.y=t.y-e*i.y,o},t.AddVCrossSV=function(t,e,i,o){var n=i.x;return o.x=t.x-e*i.y,o.y=t.y+e*n,o},t.MidVV=function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i},t.ExtVV=function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i},t.IsEqualToV=function(t,e){return t.x===e.x&&t.y===e.y},t.DistanceVV=function(t,e){var i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)},t.DistanceSquaredVV=function(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o},t.NegV=function(t,e){return e.x=-t.x,e.y=-t.y,e},t.ZERO=new t(0,0),t.UNITX=new t(1,0),t.UNITY=new t(0,1),t.s_t0=new t,t.s_t1=new t,t.s_t2=new t,t.s_t3=new t,t}();i.b2Vec2=a,i.b2Vec2_zero=new a(0,0);var c=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t[0]instanceof Float32Array){if(3!==t[0].length)throw new Error;this.data=t[0]}else{var i="number"==typeof t[0]?t[0]:0,o="number"==typeof t[1]?t[1]:0,n="number"==typeof t[2]?t[2]:0;this.data=new Float32Array([i,o,n])}}return Object.defineProperty(t.prototype,"x",{get:function(){return this.data[0]},set:function(t){this.data[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.data[1]},set:function(t){this.data[1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.data[2]},set:function(t){this.data[2]=t},enumerable:!1,configurable:!0}),t.prototype.Clone=function(){return new t(this.x,this.y,this.z)},t.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},t.prototype.SetXYZ=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.SelfAddXYZ=function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this},t.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.SelfSubXYZ=function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this},t.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.DotV3V3=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.CrossV3V3=function(t,e,i){var o=t.x,n=t.y,r=t.z,s=e.x,a=e.y,c=e.z;return i.x=n*c-r*a,i.y=r*s-o*c,i.z=o*a-n*s,i},t.ZERO=new t(0,0,0),t.s_t0=new t,t}();i.b2Vec3=c;var l=function(){function t(){this.data=new Float32Array([1,0,0,1]),this.ex=new a(this.data.subarray(0,2)),this.ey=new a(this.data.subarray(2,4))}return t.prototype.Clone=function(){return(new t).Copy(this)},t.FromVV=function(e,i){return(new t).SetVV(e,i)},t.FromSSSS=function(e,i,o,n){return(new t).SetSSSS(e,i,o,n)},t.FromAngle=function(e){return(new t).SetAngle(e)},t.prototype.SetSSSS=function(t,e,i,o){return this.ex.Set(t,i),this.ey.Set(e,o),this},t.prototype.SetVV=function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this},t.prototype.SetAngle=function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this},t.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this},t.prototype.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},t.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},t.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},t.prototype.GetInverse=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,n=this.ey.y,r=e*n-i*o;return 0!==r&&(r=1/r),t.ex.x=r*n,t.ey.x=-r*i,t.ex.y=-r*o,t.ey.y=r*e,t},t.prototype.Solve=function(t,e,i){var o=this.ex.x,n=this.ey.x,r=this.ex.y,s=this.ey.y,a=o*s-n*r;return 0!==a&&(a=1/a),i.x=a*(s*t-n*e),i.y=a*(o*e-r*t),i},t.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},t.prototype.SelfInv=function(){return this.GetInverse(this),this},t.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this},t.prototype.SelfSubM=function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this},t.AbsM=function(t,e){var o=t.ex,n=t.ey;return e.ex.x=i.b2Abs(o.x),e.ex.y=i.b2Abs(o.y),e.ey.x=i.b2Abs(n.x),e.ey.y=i.b2Abs(n.y),e},t.MulMV=function(t,e,i){var o=t.ex,n=t.ey,r=e.x,s=e.y;return i.x=o.x*r+n.x*s,i.y=o.y*r+n.y*s,i},t.MulTMV=function(t,e,i){var o=t.ex,n=t.ey,r=e.x,s=e.y;return i.x=o.x*r+o.y*s,i.y=n.x*r+n.y*s,i},t.AddMM=function(t,e,i){var o=t.ex,n=t.ey,r=e.ex,s=e.ey;return i.ex.x=o.x+r.x,i.ex.y=o.y+r.y,i.ey.x=n.x+s.x,i.ey.y=n.y+s.y,i},t.MulMM=function(t,e,i){var o=t.ex.x,n=t.ex.y,r=t.ey.x,s=t.ey.y,a=e.ex.x,c=e.ex.y,l=e.ey.x,u=e.ey.y;return i.ex.x=o*a+r*c,i.ex.y=n*a+s*c,i.ey.x=o*l+r*u,i.ey.y=n*l+s*u,i},t.MulTMM=function(t,e,i){var o=t.ex.x,n=t.ex.y,r=t.ey.x,s=t.ey.y,a=e.ex.x,c=e.ex.y,l=e.ey.x,u=e.ey.y;return i.ex.x=o*a+n*c,i.ex.y=r*a+s*c,i.ey.x=o*l+n*u,i.ey.y=r*l+s*u,i},t.IDENTITY=new t,t}();i.b2Mat22=l;var u=function(){function t(){this.data=new Float32Array([1,0,0,0,1,0,0,0,1]),this.ex=new c(this.data.subarray(0,3)),this.ey=new c(this.data.subarray(3,6)),this.ez=new c(this.data.subarray(6,9))}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.SetVVV=function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this},t.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this},t.prototype.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},t.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},t.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this},t.prototype.Solve33=function(t,e,i,o){var n=this.ex.x,r=this.ex.y,s=this.ex.z,a=this.ey.x,c=this.ey.y,l=this.ey.z,u=this.ez.x,_=this.ez.y,m=this.ez.z,h=n*(c*m-l*_)+r*(l*u-a*m)+s*(a*_-c*u);return 0!==h&&(h=1/h),o.x=h*(t*(c*m-l*_)+e*(l*u-a*m)+i*(a*_-c*u)),o.y=h*(n*(e*m-i*_)+r*(i*u-t*m)+s*(t*_-e*u)),o.z=h*(n*(c*i-l*e)+r*(l*t-a*i)+s*(a*e-c*t)),o},t.prototype.Solve22=function(t,e,i){var o=this.ex.x,n=this.ey.x,r=this.ex.y,s=this.ey.y,a=o*s-n*r;return 0!==a&&(a=1/a),i.x=a*(s*t-n*e),i.y=a*(o*e-r*t),i},t.prototype.GetInverse22=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,n=this.ey.y,r=e*n-i*o;0!==r&&(r=1/r),t.ex.x=r*n,t.ey.x=-r*i,t.ex.z=0,t.ex.y=-r*o,t.ey.y=r*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},t.prototype.GetSymInverse33=function(t){var e=c.DotV3V3(this.ex,c.CrossV3V3(this.ey,this.ez,c.s_t0));0!==e&&(e=1/e);var i=this.ex.x,o=this.ey.x,n=this.ez.x,r=this.ey.y,s=this.ez.y,a=this.ez.z;t.ex.x=e*(r*a-s*s),t.ex.y=e*(n*s-o*a),t.ex.z=e*(o*s-n*r),t.ey.x=t.ex.y,t.ey.y=e*(i*a-n*n),t.ey.z=e*(n*o-i*s),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*r-o*o)},t.MulM33V3=function(t,e,i){var o=e.x,n=e.y,r=e.z;return i.x=t.ex.x*o+t.ey.x*n+t.ez.x*r,i.y=t.ex.y*o+t.ey.y*n+t.ez.y*r,i.z=t.ex.z*o+t.ey.z*n+t.ez.z*r,i},t.MulM33XYZ=function(t,e,i,o,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*o,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*o,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*o,n},t.MulM33V2=function(t,e,i){var o=e.x,n=e.y;return i.x=t.ex.x*o+t.ey.x*n,i.y=t.ex.y*o+t.ey.y*n,i},t.MulM33XY=function(t,e,i,o){return o.x=t.ex.x*e+t.ey.x*i,o.y=t.ex.y*e+t.ey.y*i,o},t.IDENTITY=new t,t}();i.b2Mat33=u;var _=function(){function t(t){void 0===t&&(t=0),this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.s=t.s,this.c=t.c,this},t.prototype.SetAngle=function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this},t.prototype.SetIdentity=function(){return this.s=0,this.c=1,this},t.prototype.GetAngle=function(){return Math.atan2(this.s,this.c)},t.prototype.GetXAxis=function(t){return t.x=this.c,t.y=this.s,t},t.prototype.GetYAxis=function(t){return t.x=-this.s,t.y=this.c,t},t.MulRR=function(t,e,i){var o=t.c,n=t.s,r=e.c,s=e.s;return i.s=n*r+o*s,i.c=o*r-n*s,i},t.MulTRR=function(t,e,i){var o=t.c,n=t.s,r=e.c,s=e.s;return i.s=o*s-n*r,i.c=o*r+n*s,i},t.MulRV=function(t,e,i){var o=t.c,n=t.s,r=e.x,s=e.y;return i.x=o*r-n*s,i.y=n*r+o*s,i},t.MulTRV=function(t,e,i){var o=t.c,n=t.s,r=e.x,s=e.y;return i.x=o*r+n*s,i.y=-n*r+o*s,i},t.IDENTITY=new t,t}();i.b2Rot=_;var m=function(){function t(){this.p=new a,this.q=new _}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this},t.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},t.prototype.SetPositionRotation=function(t,e){return this.p.Copy(t),this.q.Copy(e),this},t.prototype.SetPositionAngle=function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this},t.prototype.SetPosition=function(t){return this.p.Copy(t),this},t.prototype.SetPositionXY=function(t,e){return this.p.Set(t,e),this},t.prototype.SetRotation=function(t){return this.q.Copy(t),this},t.prototype.SetRotationAngle=function(t){return this.q.SetAngle(t),this},t.prototype.GetPosition=function(){return this.p},t.prototype.GetRotation=function(){return this.q},t.prototype.GetRotationAngle=function(){return this.q.GetAngle()},t.prototype.GetAngle=function(){return this.q.GetAngle()},t.MulXV=function(t,e,i){var o=t.q.c,n=t.q.s,r=e.x,s=e.y;return i.x=o*r-n*s+t.p.x,i.y=n*r+o*s+t.p.y,i},t.MulTXV=function(t,e,i){var o=t.q.c,n=t.q.s,r=e.x-t.p.x,s=e.y-t.p.y;return i.x=o*r+n*s,i.y=-n*r+o*s,i},t.MulXX=function(t,e,i){return _.MulRR(t.q,e.q,i.q),a.AddVV(_.MulRV(t.q,e.p,i.p),t.p,i.p),i},t.MulTXX=function(t,e,i){return _.MulTRR(t.q,e.q,i.q),_.MulTRV(t.q,a.SubVV(e.p,t.p,i.p),i.p),i},t.IDENTITY=new t,t}();i.b2Transform=m;var h=function(){function t(){this.localCenter=new a,this.c0=new a,this.c=new a,this.a0=0,this.a=0,this.alpha0=0}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this},t.prototype.GetTransform=function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var o=i*this.a0+e*this.a;return t.q.SetAngle(o),t.p.SelfSub(_.MulRV(t.q,this.localCenter,a.s_t0)),t},t.prototype.Advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t},t.prototype.Normalize=function(){var t=i.b2_two_pi*Math.floor(this.a0/i.b2_two_pi);this.a0-=t,this.a-=t},t}();i.b2Sweep=h,cc._RF.pop()},{"./b2Settings":"b2Settings"}],b2MotorJoint:[function(t,e,i){"use strict";cc._RF.push(e,"71bcdC0tHxGP7UaTkKT8kJ1","b2MotorJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2MotorJoint=i.b2MotorJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_motorJoint)||this;return e.linearOffset=new s.b2Vec2(0,0),e.angularOffset=0,e.maxForce=1,e.maxTorque=1,e.correctionFactor=.3,e}return n(e,t),e.prototype.Initialize=function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),o=this.bodyB.GetAngle();this.angularOffset=o-i},e}(a.b2JointDef);i.b2MotorJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_linearOffset=new s.b2Vec2,i.m_angularOffset=0,i.m_linearImpulse=new s.b2Vec2,i.m_angularImpulse=0,i.m_maxForce=0,i.m_maxTorque=0,i.m_correctionFactor=.3,i.m_indexA=0,i.m_indexB=0,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_linearError=new s.b2Vec2,i.m_angularError=0,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_linearMass=new s.b2Mat22,i.m_angularMass=0,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_K=new s.b2Mat22,i.m_linearOffset.Copy(r.b2Maybe(e.linearOffset,s.b2Vec2.ZERO)),i.m_linearImpulse.SetZero(),i.m_maxForce=r.b2Maybe(e.maxForce,0),i.m_maxTorque=r.b2Maybe(e.maxTorque,0),i.m_correctionFactor=r.b2Maybe(e.correctionFactor,.3),i}return n(e,t),e.prototype.GetAnchorA=function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t},e.prototype.GetAnchorB=function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t},e.prototype.GetReactionForce=function(t,e){return s.b2Vec2.MulSV(t,this.m_linearImpulse,e)},e.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.SetLinearOffset=function(t){s.b2Vec2.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))},e.prototype.GetLinearOffset=function(){return this.m_linearOffset},e.prototype.SetAngularOffset=function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},e.prototype.GetAngularOffset=function(){return this.m_angularOffset},e.prototype.SetMaxForce=function(t){this.m_maxForce=t},e.prototype.GetMaxForce=function(){return this.m_maxForce},e.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},e.prototype.GetMaxTorque=function(){return this.m_maxTorque},e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,o=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(a),m=s.b2Rot.MulRV(u,s.b2Vec2.SubVV(this.m_linearOffset,this.m_localCenterA,s.b2Vec2.s_t0),this.m_rA),h=s.b2Rot.MulRV(_,s.b2Vec2.NegV(this.m_localCenterB,s.b2Vec2.s_t0),this.m_rB),p=this.m_invMassA,f=this.m_invMassB,b=this.m_invIA,d=this.m_invIB,y=this.m_K;if(y.ex.x=p+f+b*m.y*m.y+d*h.y*h.y,y.ex.y=-b*m.x*m.y-d*h.x*h.y,y.ey.x=y.ex.y,y.ey.y=p+f+b*m.x*m.x+d*h.x*h.x,y.GetInverse(this.m_linearMass),this.m_angularMass=b+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),s.b2Vec2.SubVV(s.b2Vec2.AddVV(r,h,s.b2Vec2.s_t0),s.b2Vec2.AddVV(e,m,s.b2Vec2.s_t1),this.m_linearError),this.m_angularError=a-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var v=this.m_linearImpulse;o.SelfMulSub(p,v),n-=b*(s.b2Vec2.CrossVV(m,v)+this.m_angularImpulse),c.SelfMulAdd(f,v),l+=d*(s.b2Vec2.CrossVV(h,v)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,_=t.step.dt,m=t.step.inv_dt,h=r-o+m*this.m_correctionFactor*this.m_angularError,p=-this.m_angularMass*h,f=this.m_angularImpulse,b=_*this.m_maxTorque;this.m_angularImpulse=s.b2Clamp(this.m_angularImpulse+p,-b,b),o-=l*(p=this.m_angularImpulse-f),r+=u*p;var d=this.m_rA,y=this.m_rB,v=s.b2Vec2.AddVV(s.b2Vec2.SubVV(s.b2Vec2.AddVV(n,s.b2Vec2.CrossSV(r,y,s.b2Vec2.s_t0),s.b2Vec2.s_t0),s.b2Vec2.AddVV(i,s.b2Vec2.CrossSV(o,d,s.b2Vec2.s_t1),s.b2Vec2.s_t1),s.b2Vec2.s_t2),s.b2Vec2.MulSV(m*this.m_correctionFactor,this.m_linearError,s.b2Vec2.s_t3),e.SolveVelocityConstraints_s_Cdot_v2),V=s.b2Mat22.MulMV(this.m_linearMass,v,e.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),x=e.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(V),b=_*this.m_maxForce,this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(b)),s.b2Vec2.SubVV(this.m_linearImpulse,x,V),i.SelfMulSub(a,V),o-=l*s.b2Vec2.CrossVV(d,V),n.SelfMulAdd(c,V),r+=u*s.b2Vec2.CrossVV(y,V),t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(){return!0},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.SolveVelocityConstraints_s_Cdot_v2=new s.b2Vec2,e.SolveVelocityConstraints_s_impulse_v2=new s.b2Vec2,e.SolveVelocityConstraints_s_oldImpulse_v2=new s.b2Vec2,e}(a.b2Joint);i.b2MotorJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2MouseJoint:[function(t,e,i){"use strict";cc._RF.push(e,"8c58bkZoupKQLNfIrNOUMR9","b2MouseJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2MouseJoint=i.b2MouseJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_mouseJoint)||this;return e.target=new s.b2Vec2,e.maxForce=0,e.frequencyHz=5,e.dampingRatio=.7,e}return n(e,t),e}(a.b2JointDef);i.b2MouseJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_localAnchorB=new s.b2Vec2,i.m_targetA=new s.b2Vec2,i.m_frequencyHz=0,i.m_dampingRatio=0,i.m_beta=0,i.m_impulse=new s.b2Vec2,i.m_maxForce=0,i.m_gamma=0,i.m_indexA=0,i.m_indexB=0,i.m_rB=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassB=0,i.m_invIB=0,i.m_mass=new s.b2Mat22,i.m_C=new s.b2Vec2,i.m_qB=new s.b2Rot,i.m_lalcB=new s.b2Vec2,i.m_K=new s.b2Mat22,i.m_targetA.Copy(r.b2Maybe(e.target,s.b2Vec2.ZERO)),s.b2Transform.MulTXV(i.m_bodyB.GetTransform(),i.m_targetA,i.m_localAnchorB),i.m_maxForce=r.b2Maybe(e.maxForce,0),i.m_impulse.SetZero(),i.m_frequencyHz=r.b2Maybe(e.frequencyHz,0),i.m_dampingRatio=r.b2Maybe(e.dampingRatio,0),i.m_beta=0,i.m_gamma=0,i}return n(e,t),e.prototype.SetTarget=function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)},e.prototype.GetTarget=function(){return this.m_targetA},e.prototype.SetMaxForce=function(t){this.m_maxForce=t},e.prototype.GetMaxForce=function(){return this.m_maxForce},e.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.InitVelocityConstraints=function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,a=this.m_qB.SetAngle(i),c=this.m_bodyB.GetMass(),l=2*r.b2_pi*this.m_frequencyHz,u=2*c*this.m_dampingRatio*l,_=c*l*l,m=t.step.dt;this.m_gamma=m*(u+m*_),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=m*_*this.m_gamma,s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.b2Rot.MulRV(a,this.m_lalcB,this.m_rB);var h=this.m_K;h.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,h.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,h.ey.x=h.ex.y,h.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,h.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),o.x+=this.m_invMassB*this.m_impulse.x,o.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*s.b2Vec2.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,n=s.b2Vec2.AddVCrossSV(i,o,this.m_rB,e.SolveVelocityConstraints_s_Cdot),r=s.b2Mat22.MulMV(this.m_mass,s.b2Vec2.AddVV(n,s.b2Vec2.AddVV(this.m_C,s.b2Vec2.MulSV(this.m_gamma,this.m_impulse,s.b2Vec2.s_t0),s.b2Vec2.s_t0),s.b2Vec2.s_t0).SelfNeg(),e.SolveVelocityConstraints_s_impulse),a=e.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(r);var c=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>c*c&&this.m_impulse.SelfMul(c/this.m_impulse.Length()),s.b2Vec2.SubVV(this.m_impulse,a,r),i.SelfMulAdd(this.m_invMassB,r),o+=this.m_invIB*s.b2Vec2.CrossVV(this.m_rB,r),t.velocities[this.m_indexB].w=o},e.prototype.SolvePositionConstraints=function(){return!0},e.prototype.GetAnchorA=function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return s.b2Vec2.MulSV(t,this.m_impulse,e)},e.prototype.GetReactionTorque=function(){return 0},e.prototype.Dump=function(t){t("Mouse joint dumping is not supported.\n")},e.prototype.ShiftOrigin=function(t){this.m_targetA.SelfSub(t)},e.SolveVelocityConstraints_s_Cdot=new s.b2Vec2,e.SolveVelocityConstraints_s_impulse=new s.b2Vec2,e.SolveVelocityConstraints_s_oldImpulse=new s.b2Vec2,e}(a.b2Joint);i.b2MouseJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2ParticleGroup:[function(t,e,i){"use strict";cc._RF.push(e,"861f69yEl9JiaUKvA3wexLP","b2ParticleGroup"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2ParticleGroup=i.b2ParticleGroupDef=i.b2ParticleGroupFlag=void 0;var o,n=t("../Common/b2Math"),r=t("../Common/b2Draw");(function(t){t[t.b2_solidParticleGroup=1]="b2_solidParticleGroup",t[t.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",t[t.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",t[t.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",t[t.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",t[t.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask"})(o=i.b2ParticleGroupFlag||(i.b2ParticleGroupFlag={}));i.b2ParticleGroupDef=function(){this.flags=0,this.groupFlags=0,this.position=new n.b2Vec2,this.angle=0,this.linearVelocity=new n.b2Vec2,this.angularVelocity=0,this.color=new r.b2Color,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null};var s=function(){function t(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new n.b2Vec2,this.m_linearVelocity=new n.b2Vec2,this.m_angularVelocity=0,this.m_transform=new n.b2Transform,this.m_userData=null,this.m_system=t}return t.prototype.GetNext=function(){return this.m_next},t.prototype.GetParticleSystem=function(){return this.m_system},t.prototype.GetParticleCount=function(){return this.m_lastIndex-this.m_firstIndex},t.prototype.GetBufferIndex=function(){return this.m_firstIndex},t.prototype.ContainsParticle=function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex},t.prototype.GetAllParticleFlags=function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t},t.prototype.GetGroupFlags=function(){return this.m_groupFlags},t.prototype.SetGroupFlags=function(t){t|=this.m_groupFlags&o.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,t)},t.prototype.GetMass=function(){return this.UpdateStatistics(),this.m_mass},t.prototype.GetInertia=function(){return this.UpdateStatistics(),this.m_inertia},t.prototype.GetCenter=function(){return this.UpdateStatistics(),this.m_center},t.prototype.GetLinearVelocity=function(){return this.UpdateStatistics(),this.m_linearVelocity},t.prototype.GetAngularVelocity=function(){return this.UpdateStatistics(),this.m_angularVelocity},t.prototype.GetTransform=function(){return this.m_transform},t.prototype.GetPosition=function(){return this.m_transform.p},t.prototype.GetAngle=function(){return this.m_transform.q.GetAngle()},t.prototype.GetLinearVelocityFromWorldPoint=function(e,i){var o=t.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),n.b2Vec2.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,n.b2Vec2.SubVV(e,this.m_center,o),i)},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(t){this.m_userData=t},t.prototype.ApplyForce=function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)},t.prototype.ApplyLinearImpulse=function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)},t.prototype.DestroyParticles=function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)},t.prototype.UpdateStatistics=function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new n.b2Vec2,e=new n.b2Vec2;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var o=this.m_firstIndex;o<this.m_lastIndex;o++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[o]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[o]);if(this.m_mass>0){var r=1/this.m_mass;this.m_center.SelfMul(r),this.m_linearVelocity.SelfMul(r)}for(this.m_inertia=0,this.m_angularVelocity=0,o=this.m_firstIndex;o<this.m_lastIndex;o++)n.b2Vec2.SubVV(this.m_system.m_positionBuffer.data[o],this.m_center,t),n.b2Vec2.SubVV(this.m_system.m_velocityBuffer.data[o],this.m_linearVelocity,e),this.m_inertia+=i*n.b2Vec2.DotVV(t,t),this.m_angularVelocity+=i*n.b2Vec2.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}},t.GetLinearVelocityFromWorldPoint_s_t0=new n.b2Vec2,t}();i.b2ParticleGroup=s,cc._RF.pop()},{"../Common/b2Draw":"b2Draw","../Common/b2Math":"b2Math"}],b2ParticleSystem:[function(t,e,i){"use strict";cc._RF.push(e,"26af0Pkr4VN5Z9gEkkbSBYN","b2ParticleSystem");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2ParticleSystem_SolveCollisionCallback=i.b2ParticleSystem_UpdateBodyContactsCallback=i.b2ParticleSystem_ReactiveFilter=i.b2ParticleSystem_CompositeShape=i.b2ParticleSystem_JoinParticleGroupsFilter=i.b2ParticleSystem_DestroyParticlesInShapeCallback=i.b2ParticleSystem_ConnectionFilter=i.b2ParticlePairSet=i.b2ParticleSystem_ParticlePair=i.b2ParticleSystem_FixtureParticleSet=i.b2ParticleSystem_FixtureParticle=i.b2ParticleSystem_FixedSetAllocator=i.b2ParticleSystem_ParticleListNode=i.b2ParticleSystem_InsideBoundsEnumerator=i.b2ParticleSystem_Proxy=i.b2ParticleSystem_UserOverridableBuffer=i.b2ParticleSystem=i.b2ParticleSystemDef=i.b2ParticleTriad=i.b2ParticlePair=i.b2ParticleBodyContact=i.b2ParticleContact=i.b2FixtureParticleQueryCallback=i.b2GrowableBuffer=void 0;var r=t("../Common/b2Settings"),s=t("../Common/b2Settings"),a=t("../Common/b2Math"),c=t("../Common/b2Draw"),l=t("../Collision/b2Collision"),u=t("../Collision/Shapes/b2Shape"),_=t("../Collision/Shapes/b2EdgeShape"),m=t("../Dynamics/b2TimeStep"),h=t("../Dynamics/b2WorldCallbacks"),p=t("./b2Particle"),f=t("./b2ParticleGroup"),b=t("./b2VoronoiDiagram");function d(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}function y(t,e){return t<e}function v(t,e,i,o){void 0===e&&(e=0),void 0===i&&(i=t.length-e),void 0===o&&(o=y);for(var n=e,r=[],s=0;;){for(;n+1<i;i++){var a=t[n+Math.floor(Math.random()*(i-n))];r[s++]=i;for(var c=n-1;;){for(;o(t[++c],a););for(;o(a,t[--i]););if(c>=i)break;d(t,c,i)}}if(0===s)break;n=i,i=r[--s]}return t}function V(t,e,i,o){return void 0===e&&(e=0),void 0===i&&(i=t.length-e),void 0===o&&(o=y),v(t,e,i,o)}function x(t,e,i){void 0===i&&(i=t.length);for(var o=0,n=0;n<i;++n)e(t[n])||(n!==o?d(t,o++,n):++o);return o}function C(t,e,i,o,n){for(var r=i-e;r>0;){var s=Math.floor(r/2),a=e+s;n(t[a],o)?(e=++a,r-=s+1):r=s}return e}function S(t,e,i,o,n){for(var r=i-e;r>0;){var s=Math.floor(r/2),a=e+s;n(o,t[a])?r=s:(e=++a,r-=s+1)}return e}function B(t,e,i,o){for(var n=i;e!==n;)d(t,e++,n++),n===o?n=i:e===i&&(i=n)}function g(t,e,i,o){if(e===i)return i;for(var n=e;++e!==i;)o(t[n],t[e])||d(t,++n,e);return++n}var A=function(){function t(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}return t.prototype.Append=function(){return this.count>=this.capacity&&this.Grow(),this.count++},t.prototype.Reserve=function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}},t.prototype.Grow=function(){var t=this.capacity?2*this.capacity:r.b2_minParticleSystemBufferCapacity;this.Reserve(t)},t.prototype.Free=function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)},t.prototype.Shorten=function(){},t.prototype.Data=function(){return this.data},t.prototype.GetCount=function(){return this.count},t.prototype.SetCount=function(t){this.count=t},t.prototype.GetCapacity=function(){return this.capacity},t.prototype.RemoveIf=function(t){this.count=x(this.data,t,this.count)},t.prototype.Unique=function(t){this.count=g(this.data,0,this.count,t)},t}();i.b2GrowableBuffer=A;var w=function(t){function e(e){var i=t.call(this)||this;return i.m_system=e,i}return n(e,t),e.prototype.ShouldQueryParticleSystem=function(){return!1},e.prototype.ReportFixture=function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var o=t.GetAABB(i),n=this.m_system.GetInsideBoundsEnumerator(o),r=void 0;(r=n.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,r);return!0},e.prototype.ReportParticle=function(){return!1},e.prototype.ReportFixtureAndParticle=function(){},e}(h.b2QueryCallback);i.b2FixtureParticleQueryCallback=w;var M=function(){function t(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new a.b2Vec2,this.flags=0}return t.prototype.SetIndices=function(t,e){this.indexA=t,this.indexB=e},t.prototype.SetWeight=function(t){this.weight=t},t.prototype.SetNormal=function(t){this.normal.Copy(t)},t.prototype.SetFlags=function(t){this.flags=t},t.prototype.GetIndexA=function(){return this.indexA},t.prototype.GetIndexB=function(){return this.indexB},t.prototype.GetWeight=function(){return this.weight},t.prototype.GetNormal=function(){return this.normal},t.prototype.GetFlags=function(){return this.flags},t.prototype.IsEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y},t.prototype.IsNotEqual=function(t){return!this.IsEqual(t)},t.prototype.ApproximatelyEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&a.b2Abs(this.weight-t.weight)<.01&&a.b2Vec2.DistanceSquaredVV(this.normal,t.normal)<1e-4},t}();i.b2ParticleContact=M;var P=function(){this.index=0,this.weight=0,this.normal=new a.b2Vec2,this.mass=0};i.b2ParticleBodyContact=P;var D=function(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0};i.b2ParticlePair=D;var R=function(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new a.b2Vec2(0,0),this.pb=new a.b2Vec2(0,0),this.pc=new a.b2Vec2(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0};i.b2ParticleTriad=R;var F=function(){function t(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}return t.prototype.Copy=function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this},t.prototype.Clone=function(){return(new t).Copy(this)},t}();i.b2ParticleSystemDef=F;var G=function(){function t(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new I,this.m_flagsBuffer=new I,this.m_positionBuffer=new I,this.m_velocityBuffer=new I,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new I,this.m_groupBuffer=[],this.m_userDataBuffer=new I,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new I,this.m_bodyContactCountBuffer=new I,this.m_consecutiveContactStepsBuffer=new I,this.m_stuckParticleBuffer=new A(function(){return 0}),this.m_proxyBuffer=new A(function(){return new T}),this.m_contactBuffer=new A(function(){return new M}),this.m_bodyContactBuffer=new A(function(){return new P}),this.m_pairBuffer=new A(function(){return new D}),this.m_triadBuffer=new A(function(){return new R}),this.m_expirationTimeBuffer=new I,this.m_indexByExpirationTimeBuffer=new I,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new F,this.m_prev=null,this.m_next=null,this.UpdateBodyContacts_callback=null,this.SolveCollision_callback=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}return t.computeTag=function(e,i){return(i+t.yOffset>>>0<<t.yShift)+(t.xScale*e+t.xOffset>>>0)>>>0},t.computeRelativeTag=function(e,i,o){return e+(o<<t.yShift)+(i<<t.xShift)>>>0},t.prototype.Drop=function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)},t.prototype.CreateParticle=function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:r.b2_minParticleSystemBufferCapacity;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return r.b2_invalidParticleIndex;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var i=this.m_count++;this.m_flagsBuffer.data[i]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=0),this.m_positionBuffer.data[i]=(this.m_positionBuffer.data[i]||new a.b2Vec2).Copy(r.b2Maybe(t.position,a.b2Vec2.ZERO)),this.m_velocityBuffer.data[i]=(this.m_velocityBuffer.data[i]||new a.b2Vec2).Copy(r.b2Maybe(t.velocity,a.b2Vec2.ZERO)),this.m_weightBuffer[i]=0,this.m_forceBuffer[i]=(this.m_forceBuffer[i]||new a.b2Vec2).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=0),this.m_depthBuffer&&(this.m_depthBuffer[i]=0);var o=(new c.b2Color).Copy(r.b2Maybe(t.color,c.b2Color.ZERO));!this.m_colorBuffer.data&&o.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[i]=(this.m_colorBuffer.data[i]||new c.b2Color).Copy(o)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[i]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[i]=null);var n=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],s=r.b2Maybe(t.lifetime,0),l=s>0;(this.m_expirationTimeBuffer.data||l)&&(this.SetParticleLifetime(i,l?s:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[i]=i),n.index=i;var u=r.b2Maybe(t.group,null);return this.m_groupBuffer[i]=u,u&&(u.m_firstIndex<u.m_lastIndex?(this.RotateBuffer(u.m_firstIndex,u.m_lastIndex,i),u.m_lastIndex=i+1):(u.m_firstIndex=i,u.m_lastIndex=i+1)),this.SetParticleFlags(i,r.b2Maybe(t.flags,0)),i},t.prototype.GetParticleHandleFromIndex=function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new p.b2ParticleHandle).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)},t.prototype.DestroyParticle=function(t,e){void 0===e&&(e=!1);var i=p.b2ParticleFlag.b2_zombieParticle;e&&(i|=p.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i)},t.prototype.DestroyOldestParticle=function(t,e){void 0===e&&(e=!1);var i=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],n=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[o]>0?o:n,e)},t.prototype.DestroyParticlesInShape=function(e,i,o){void 0===o&&(o=!1);var n=t.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var r=new q(this,e,i,o),s=n;return e.ComputeAABB(s,i,0),this.m_world.QueryAABB(r,s),r.Destroyed()},t.prototype.CreateParticleGroup=function(e){var i=t.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var o=i;o.SetPositionAngle(r.b2Maybe(e.position,a.b2Vec2.ZERO),r.b2Maybe(e.angle,0));var n=this.m_count;if(e.shape&&this.CreateParticlesWithShapeForGroup(e.shape,e,o),e.shapes&&this.CreateParticlesWithShapesForGroup(e.shapes,r.b2Maybe(e.shapeCount,e.shapes.length),e,o),e.positionData)for(var s=r.b2Maybe(e.particleCount,e.positionData.length),c=0;c<s;c++){var l=e.positionData[c];this.CreateParticleForGroup(e,o,l)}var u=this.m_count,_=new f.b2ParticleGroup(this);for(_.m_firstIndex=n,_.m_lastIndex=u,_.m_strength=r.b2Maybe(e.strength,1),_.m_userData=e.userData,_.m_transform.Copy(o),_.m_prev=null,_.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=_),this.m_groupList=_,++this.m_groupCount,c=n;c<u;c++)this.m_groupBuffer[c]=_;this.SetGroupFlags(_,r.b2Maybe(e.groupFlags,0));var m=new j;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(n,u,m),e.group&&(this.JoinParticleGroups(e.group,_),_=e.group),_},t.prototype.JoinParticleGroups=function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new z(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var o=e.m_firstIndex;o<e.m_lastIndex;o++)this.m_groupBuffer[o]=t;var n=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,n),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)},t.prototype.SplitParticleGroup=function(e){this.UpdateContacts(!0);var i=e.GetParticleCount(),o=r.b2MakeArray(i,function(){return new E});t.InitializeParticleLists(e,o),this.MergeParticleListsInContact(e,o);var n=t.FindLongestParticleList(e,o);this.MergeZombieParticleListNodes(e,o,n),this.CreateParticleGroupsFromParticleList(e,o,n),this.UpdatePairsAndTriadsWithParticleList(e,o)},t.prototype.GetParticleGroupList=function(){return this.m_groupList},t.prototype.GetParticleGroupCount=function(){return this.m_groupCount},t.prototype.GetParticleCount=function(){return this.m_count},t.prototype.GetMaxParticleCount=function(){return this.m_def.maxCount},t.prototype.SetMaxParticleCount=function(t){this.m_def.maxCount=t},t.prototype.GetAllParticleFlags=function(){return this.m_allParticleFlags},t.prototype.GetAllGroupFlags=function(){return this.m_allGroupFlags},t.prototype.SetPaused=function(t){this.m_paused=t},t.prototype.GetPaused=function(){return this.m_paused},t.prototype.SetDensity=function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density},t.prototype.GetDensity=function(){return this.m_def.density},t.prototype.SetGravityScale=function(t){this.m_def.gravityScale=t},t.prototype.GetGravityScale=function(){return this.m_def.gravityScale},t.prototype.SetDamping=function(t){this.m_def.dampingStrength=t},t.prototype.GetDamping=function(){return this.m_def.dampingStrength},t.prototype.SetStaticPressureIterations=function(t){this.m_def.staticPressureIterations=t},t.prototype.GetStaticPressureIterations=function(){return this.m_def.staticPressureIterations},t.prototype.SetRadius=function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter},t.prototype.GetRadius=function(){return this.m_particleDiameter/2},t.prototype.GetPositionBuffer=function(){return this.m_positionBuffer.data},t.prototype.GetVelocityBuffer=function(){return this.m_velocityBuffer.data},t.prototype.GetColorBuffer=function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data},t.prototype.GetGroupBuffer=function(){return this.m_groupBuffer},t.prototype.GetWeightBuffer=function(){return this.m_weightBuffer},t.prototype.GetUserDataBuffer=function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data},t.prototype.GetFlagsBuffer=function(){return this.m_flagsBuffer.data},t.prototype.SetParticleFlags=function(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&p.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&p.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e},t.prototype.GetParticleFlags=function(t){return this.m_flagsBuffer.data[t]},t.prototype.SetFlagsBuffer=function(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)},t.prototype.SetPositionBuffer=function(t){if(t instanceof Float32Array){if(t.length%2!=0)throw new Error;for(var e=t.length/2,i=new Array(e),o=0;o<e;++o)i[o]=new a.b2Vec2(t.subarray(2*o,2*o+2));t=i}this.SetUserOverridableBuffer(this.m_positionBuffer,t)},t.prototype.SetVelocityBuffer=function(t){if(t instanceof Float32Array){if(t.length%2!=0)throw new Error;for(var e=t.length/2,i=new Array(e),o=0;o<e;++o)i[o]=new a.b2Vec2(t.subarray(2*o,2*o+2));t=i}this.SetUserOverridableBuffer(this.m_velocityBuffer,t)},t.prototype.SetColorBuffer=function(t){if(t instanceof Float32Array){if(t.length%4!=0)throw new Error;for(var e=t.length/4,i=new Array(e),o=0;o<e;++o)i[o]=new c.b2Color(t.subarray(4*o,4*o+4));t=i}this.SetUserOverridableBuffer(this.m_colorBuffer,t)},t.prototype.SetUserDataBuffer=function(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)},t.prototype.GetContacts=function(){return this.m_contactBuffer.data},t.prototype.GetContactCount=function(){return this.m_contactBuffer.count},t.prototype.GetBodyContacts=function(){return this.m_bodyContactBuffer.data},t.prototype.GetBodyContactCount=function(){return this.m_bodyContactBuffer.count},t.prototype.GetPairs=function(){return this.m_pairBuffer.data},t.prototype.GetPairCount=function(){return this.m_pairBuffer.count},t.prototype.GetTriads=function(){return this.m_triadBuffer.data},t.prototype.GetTriadCount=function(){return this.m_triadBuffer.count},t.prototype.SetStuckThreshold=function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))},t.prototype.GetStuckCandidates=function(){return this.m_stuckParticleBuffer.Data()},t.prototype.GetStuckCandidateCount=function(){return this.m_stuckParticleBuffer.GetCount()},t.prototype.ComputeCollisionEnergy=function(){for(var e=t.ComputeCollisionEnergy_s_v,i=this.m_velocityBuffer.data,o=0,n=0;n<this.m_contactBuffer.count;n++){var r=this.m_contactBuffer.data[n],s=r.indexA,c=r.indexB,l=r.normal,u=a.b2Vec2.SubVV(i[c],i[s],e),_=a.b2Vec2.DotVV(u,l);_<0&&(o+=_*_)}return.5*this.GetParticleMass()*o},t.prototype.SetStrictContactCheck=function(t){this.m_def.strictContactCheck=t},t.prototype.GetStrictContactCheck=function(){return this.m_def.strictContactCheck},t.prototype.SetParticleLifetime=function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var o=this.GetParticleCount(),n=0;n<o;++n)this.m_indexByExpirationTimeBuffer.data[n]=n;var r=e/this.m_def.lifetimeGranularity,s=r>0?this.GetQuantizedTimeElapsed()+r:r;s!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=s,this.m_expirationTimeBufferRequiresSorting=!0)},t.prototype.GetParticleLifetime=function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])},t.prototype.SetDestructionByAge=function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t},t.prototype.GetDestructionByAge=function(){return this.m_def.destroyByAge},t.prototype.GetExpirationTimeBuffer=function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data},t.prototype.ExpirationTimeToLifetime=function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity},t.prototype.GetIndexByExpirationTimeBuffer=function(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data},t.prototype.ParticleApplyLinearImpulse=function(t,e){this.ApplyLinearImpulse(t,t+1,e)},t.prototype.ApplyLinearImpulse=function(t,e,i){for(var o=this.m_velocityBuffer.data,n=(e-t)*this.GetParticleMass(),r=(new a.b2Vec2).Copy(i).SelfMul(1/n),s=t;s<e;s++)o[s].SelfAdd(r)},t.IsSignificantForce=function(t){return 0!==t.x||0!==t.y},t.prototype.ParticleApplyForce=function(e,i){t.IsSignificantForce(i)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[e])&&(this.PrepareForceBuffer(),this.m_forceBuffer[e].SelfAdd(i))},t.prototype.ApplyForce=function(e,i,o){var n=(new a.b2Vec2).Copy(o).SelfMul(1/(i-e));if(t.IsSignificantForce(n)){this.PrepareForceBuffer();for(var r=e;r<i;r++)this.m_forceBuffer[r].SelfAdd(n)}},t.prototype.GetNext=function(){return this.m_next},t.prototype.QueryAABB=function(e,i){if(0!==this.m_proxyBuffer.count)for(var o=this.m_proxyBuffer.count,n=C(this.m_proxyBuffer.data,0,o,t.computeTag(this.m_inverseDiameter*i.lowerBound.x,this.m_inverseDiameter*i.lowerBound.y),T.CompareProxyTag),r=S(this.m_proxyBuffer.data,n,o,t.computeTag(this.m_inverseDiameter*i.upperBound.x,this.m_inverseDiameter*i.upperBound.y),T.CompareTagProxy),s=this.m_positionBuffer.data,a=n;a<r;++a){var c=this.m_proxyBuffer.data[a].index,l=s[c];if(i.lowerBound.x<l.x&&l.x<i.upperBound.x&&i.lowerBound.y<l.y&&l.y<i.upperBound.y&&!e.ReportParticle(this,c))break}},t.prototype.QueryShapeAABB=function(e,i,o,n){void 0===n&&(n=0);var r=t.QueryShapeAABB_s_aabb;i.ComputeAABB(r,o,n),this.QueryAABB(e,r)},t.prototype.QueryPointAABB=function(e,i,o){void 0===o&&(o=r.b2_linearSlop);var n=t.QueryPointAABB_s_aabb;n.lowerBound.Set(i.x-o,i.y-o),n.upperBound.Set(i.x+o,i.y+o),this.QueryAABB(e,n)},t.prototype.RayCast=function(e,i,o){var n=t.RayCast_s_aabb,r=t.RayCast_s_p,s=t.RayCast_s_v,c=t.RayCast_s_n,l=t.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var u=this.m_positionBuffer.data,_=n;a.b2Vec2.MinV(i,o,_.lowerBound),a.b2Vec2.MaxV(i,o,_.upperBound);for(var m,h=1,p=a.b2Vec2.SubVV(o,i,s),f=a.b2Vec2.DotVV(p,p),b=this.GetInsideBoundsEnumerator(_);(m=b.GetNext())>=0;){var d=a.b2Vec2.SubVV(i,u[m],r),y=a.b2Vec2.DotVV(d,p),v=y*y-f*(a.b2Vec2.DotVV(d,d)-this.m_squaredDiameter);if(v>=0){var V=a.b2Sqrt(v),x=(-y-V)/f;if(x>h)continue;if(x<0&&((x=(-y+V)/f)<0||x>h))continue;var C=a.b2Vec2.AddVMulSV(d,x,p,c);C.Normalize();var S=e.ReportParticle(this,m,a.b2Vec2.AddVMulSV(i,x,p,l),C,x);if((h=a.b2Min(h,S))<=0)break}}}},t.prototype.ComputeAABB=function(t){var e=this.GetParticleCount();t.lowerBound.x=+r.b2_maxFloat,t.lowerBound.y=+r.b2_maxFloat,t.upperBound.x=-r.b2_maxFloat,t.upperBound.y=-r.b2_maxFloat;for(var i=this.m_positionBuffer.data,o=0;o<e;o++){var n=i[o];a.b2Vec2.MinV(t.lowerBound,n,t.lowerBound),a.b2Vec2.MaxV(t.upperBound,n,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter},t.prototype.FreeBuffer=function(t){null!==t&&(t.length=0)},t.prototype.FreeUserOverridableBuffer=function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)},t.prototype.ReallocateBuffer3=function(t,e,i){if(i<=e)throw new Error;var o=t?t.slice():[];return o.length=i,o},t.prototype.ReallocateBuffer5=function(t,e,i,o,n){if(o<=i)throw new Error;if(e&&!(o<=e))throw new Error;return n&&!t||e||(t=this.ReallocateBuffer3(t,i,o)),t},t.prototype.ReallocateBuffer4=function(t,e,i,o){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,o)},t.prototype.RequestBuffer=function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(r.b2_minParticleSystemBufferCapacity),(t=[]).length=this.m_internalAllocatedCapacity),t},t.prototype.ReallocateHandleBuffers=function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)},t.prototype.ReallocateInternalAllocatedBuffers=function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}},t.prototype.CreateParticleForGroup=function(t,e,i){var o=new p.b2ParticleDef;o.flags=r.b2Maybe(t.flags,0),a.b2Transform.MulXV(e,i,o.position),a.b2Vec2.AddVV(r.b2Maybe(t.linearVelocity,a.b2Vec2.ZERO),a.b2Vec2.CrossSV(r.b2Maybe(t.angularVelocity,0),a.b2Vec2.SubVV(o.position,r.b2Maybe(t.position,a.b2Vec2.ZERO),a.b2Vec2.s_t0),a.b2Vec2.s_t0),o.velocity),o.color.Copy(r.b2Maybe(t.color,c.b2Color.ZERO)),o.lifetime=r.b2Maybe(t.lifetime,0),o.userData=t.userData,this.CreateParticle(o)},t.prototype.CreateParticlesStrokeShapeForGroup=function(e,i,o){var n=t.CreateParticlesStrokeShapeForGroup_s_edge,s=t.CreateParticlesStrokeShapeForGroup_s_d,c=t.CreateParticlesStrokeShapeForGroup_s_p,l=r.b2Maybe(i.stride,0);0===l&&(l=this.GetParticleStride());for(var _=0,m=e.GetChildCount(),h=0;h<m;h++){var p=null;e.GetType()===u.b2ShapeType.e_edgeShape?p=e:(p=n,e.GetChildEdge(p,h));for(var f=a.b2Vec2.SubVV(p.m_vertex2,p.m_vertex1,s),b=f.Length();_<b;){var d=a.b2Vec2.AddVMulSV(p.m_vertex1,_/b,f,c);this.CreateParticleForGroup(i,o,d),_+=l}_-=b}},t.prototype.CreateParticlesFillShapeForGroup=function(e,i,o){var n=t.CreateParticlesFillShapeForGroup_s_aabb,s=t.CreateParticlesFillShapeForGroup_s_p,c=r.b2Maybe(i.stride,0);0===c&&(c=this.GetParticleStride());var l=a.b2Transform.IDENTITY,u=n;e.ComputeAABB(u,l,0);for(var _=Math.floor(u.lowerBound.y/c)*c;_<u.upperBound.y;_+=c)for(var m=Math.floor(u.lowerBound.x/c)*c;m<u.upperBound.x;m+=c){var h=s.Set(m,_);e.TestPoint(l,h)&&this.CreateParticleForGroup(i,o,h)}},t.prototype.CreateParticlesWithShapeForGroup=function(t,e,i){switch(t.GetType()){case u.b2ShapeType.e_edgeShape:case u.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case u.b2ShapeType.e_polygonShape:case u.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i)}},t.prototype.CreateParticlesWithShapesForGroup=function(t,e,i,o){var n=new N(t,e);this.CreateParticlesFillShapeForGroup(n,i,o)},t.prototype.CloneParticle=function(t,e){var i=new p.b2ParticleDef;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var o=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var n=this.m_handleIndexBuffer.data[t];n&&n.SetIndex(o),this.m_handleIndexBuffer.data[o]=n,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[o]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[o]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[o]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[o].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[o]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[o]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[o]=this.m_expirationTimeBuffer.data[t]),o},t.prototype.DestroyParticlesInGroup=function(t,e){void 0===e&&(e=!1);for(var i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)},t.prototype.DestroyParticleGroup=function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount},t.ParticleCanBeConnected=function(t,e){return 0!=(t&(p.b2ParticleFlag.b2_wallParticle|p.b2ParticleFlag.b2_springParticle|p.b2ParticleFlag.b2_elasticParticle))||null!==e&&0!=(e.GetGroupFlags()&f.b2ParticleGroupFlag.b2_rigidParticleGroup)},t.prototype.UpdatePairsAndTriads=function(e,i,o){for(var n=t.UpdatePairsAndTriads_s_dab,s=t.UpdatePairsAndTriads_s_dbc,c=t.UpdatePairsAndTriads_s_dca,l=this.m_positionBuffer.data,u=0,_=e;_<i;_++)u|=this.m_flagsBuffer.data[_];if(u&t.k_pairFlags)for(var m=0;m<this.m_contactBuffer.count;m++){var h=this.m_contactBuffer.data[m],f=h.indexA,d=h.indexB,y=this.m_flagsBuffer.data[f],v=this.m_flagsBuffer.data[d],x=this.m_groupBuffer[f],C=this.m_groupBuffer[d];if(f>=e&&f<i&&d>=e&&d<i&&!((y|v)&p.b2ParticleFlag.b2_zombieParticle)&&(y|v)&t.k_pairFlags&&(o.IsNecessary(f)||o.IsNecessary(d))&&t.ParticleCanBeConnected(y,x)&&t.ParticleCanBeConnected(v,C)&&o.ShouldCreatePair(f,d)){var S=this.m_pairBuffer.data[this.m_pairBuffer.Append()];S.indexA=f,S.indexB=d,S.flags=h.flags,S.strength=a.b2Min(x?x.m_strength:1,C?C.m_strength:1),S.distance=a.b2Vec2.DistanceVV(l[f],l[d])}V(this.m_pairBuffer.data,0,this.m_pairBuffer.count,t.ComparePairIndices),this.m_pairBuffer.Unique(t.MatchPairIndices)}if(u&t.k_triadFlags){var B=new b.b2VoronoiDiagram(i-e);for(_=e;_<i;_++){var g=this.m_flagsBuffer.data[_],A=this.m_groupBuffer[_];g&p.b2ParticleFlag.b2_zombieParticle||!t.ParticleCanBeConnected(g,A)||B.AddGenerator(l[_],_,o.IsNecessary(_))}var w=this.GetParticleStride();B.Generate(w/2,2*w);var M=this;B.GetNodes(function(e,i,u){var _=M.m_flagsBuffer.data[e],m=M.m_flagsBuffer.data[i],h=M.m_flagsBuffer.data[u];if((_|m|h)&t.k_triadFlags&&o.ShouldCreateTriad(e,i,u)){var p=l[e],f=l[i],b=l[u],d=a.b2Vec2.SubVV(p,f,n),y=a.b2Vec2.SubVV(f,b,s),v=a.b2Vec2.SubVV(b,p,c),V=r.b2_maxTriadDistanceSquared*M.m_squaredDiameter;if(a.b2Vec2.DotVV(d,d)>V||a.b2Vec2.DotVV(y,y)>V||a.b2Vec2.DotVV(v,v)>V)return;var x=M.m_groupBuffer[e],C=M.m_groupBuffer[i],S=M.m_groupBuffer[u],B=M.m_triadBuffer.data[M.m_triadBuffer.Append()];B.indexA=e,B.indexB=i,B.indexC=u,B.flags=_|m|h,B.strength=a.b2Min(a.b2Min(x?x.m_strength:1,C?C.m_strength:1),S?S.m_strength:1);var g=(p.x+f.x+b.x)/3,A=(p.y+f.y+b.y)/3;B.pa.x=p.x-g,B.pa.y=p.y-A,B.pb.x=f.x-g,B.pb.y=f.y-A,B.pc.x=b.x-g,B.pc.y=b.y-A,B.ka=-a.b2Vec2.DotVV(v,d),B.kb=-a.b2Vec2.DotVV(d,y),B.kc=-a.b2Vec2.DotVV(y,v),B.s=a.b2Vec2.CrossVV(p,f)+a.b2Vec2.CrossVV(f,b)+a.b2Vec2.CrossVV(b,p)}}),V(this.m_triadBuffer.data,0,this.m_triadBuffer.count,t.CompareTriadIndices),this.m_triadBuffer.Unique(t.MatchTriadIndices)}},t.prototype.UpdatePairsAndTriadsWithReactiveParticles=function(){var t=new W(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=~p.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~p.b2ParticleFlag.b2_reactiveParticle},t.ComparePairIndices=function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB},t.MatchPairIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB},t.CompareTriadIndices=function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var o=t.indexB-e.indexB;return 0!==o?o<0:t.indexC<e.indexC},t.MatchTriadIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC},t.InitializeParticleLists=function(t,e){for(var i=t.GetBufferIndex(),o=t.GetParticleCount(),n=0;n<o;n++){var r=e[n];r.list=r,r.next=null,r.count=1,r.index=n+i}},t.prototype.MergeParticleListsInContact=function(e,i){for(var o=e.GetBufferIndex(),n=0;n<this.m_contactBuffer.count;n++){var r=this.m_contactBuffer.data[n],s=r.indexA,a=r.indexB;if(e.ContainsParticle(s)&&e.ContainsParticle(a)){var c=i[s-o].list,l=i[a-o].list;if(c!==l){if(c.count<l.count){var u=c;c=l,l=u}t.MergeParticleLists(c,l)}}}},t.MergeParticleLists=function(t,e){for(var i=e;;){i.list=t;var o=i.next;if(!o){i.next=t.next;break}i=o}t.next=e,t.count+=e.count,e.count=0},t.FindLongestParticleList=function(t,e){for(var i=t.GetParticleCount(),o=e[0],n=0;n<i;n++){var r=e[n];o.count<r.count&&(o=r)}return o},t.prototype.MergeZombieParticleListNodes=function(e,i,o){for(var n=e.GetParticleCount(),r=0;r<n;r++){var s=i[r];s!==o&&this.m_flagsBuffer.data[s.index]&p.b2ParticleFlag.b2_zombieParticle&&t.MergeParticleListAndNode(o,s)}},t.MergeParticleListAndNode=function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0},t.prototype.CreateParticleGroupsFromParticleList=function(t,e,i){var o=t.GetParticleCount(),n=new f.b2ParticleGroupDef;n.groupFlags=t.GetGroupFlags(),n.userData=t.GetUserData();for(var r=0;r<o;r++){var s=e[r];if(s.count&&s!==i)for(var a=this.CreateParticleGroup(n),c=s;c;c=c.next){var l=c.index,u=this.CloneParticle(l,a);this.m_flagsBuffer.data[l]|=p.b2ParticleFlag.b2_zombieParticle,c.index=u}}},t.prototype.UpdatePairsAndTriadsWithParticleList=function(t,e){for(var i=t.GetBufferIndex(),o=0;o<this.m_pairBuffer.count;o++){var n=this.m_pairBuffer.data[o],r=n.indexA,s=n.indexB;t.ContainsParticle(r)&&(n.indexA=e[r-i].index),t.ContainsParticle(s)&&(n.indexB=e[s-i].index)}for(o=0;o<this.m_triadBuffer.count;o++){var a=this.m_triadBuffer.data[o],c=(r=a.indexA,s=a.indexB,a.indexC);t.ContainsParticle(r)&&(a.indexA=e[r-i].index),t.ContainsParticle(s)&&(a.indexB=e[s-i].index),t.ContainsParticle(c)&&(a.indexC=e[c-i].index)}},t.prototype.ComputeDepth=function(){for(var t=[],e=0,i=0;i<this.m_contactBuffer.count;i++){var o=(v=this.m_contactBuffer.data[i]).indexA,n=v.indexB,s=this.m_groupBuffer[o],c=this.m_groupBuffer[n];s&&s===c&&s.m_groupFlags&f.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(t[e++]=v)}for(var l=[],u=0,_=this.m_groupList;_;_=_.GetNext())if(_.m_groupFlags&f.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){l[u++]=_,this.SetGroupFlags(_,_.m_groupFlags&~f.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var m=_.m_firstIndex;m<_.m_lastIndex;m++)this.m_accumulationBuffer[m]=0}for(i=0;i<e;i++){o=(v=t[i]).indexA,n=v.indexB;var h=v.weight;this.m_accumulationBuffer[o]+=h,this.m_accumulationBuffer[n]+=h}for(m=0;m<u;m++)for(var p=(_=l[m]).m_firstIndex;p<_.m_lastIndex;p++)h=this.m_accumulationBuffer[p],this.m_depthBuffer[p]=h<.8?0:r.b2_maxFloat;for(var b=a.b2Sqrt(this.m_count)>>0,d=0;d<b;d++){var y=!1;for(i=0;i<e;i++){o=(v=t[i]).indexA,n=v.indexB;var v,V=1-v.weight,x=this.m_depthBuffer[o],C=this.m_depthBuffer[n],S=C+V,B=x+V;x>S&&(this.m_depthBuffer[o]=S,y=!0),C>B&&(this.m_depthBuffer[n]=B,y=!0)}if(!y)break}for(m=0;m<u;m++)for(var g=(_=l[m]).m_firstIndex;g<_.m_lastIndex;g++)this.m_depthBuffer[g]<r.b2_maxFloat?this.m_depthBuffer[g]*=this.m_particleDiameter:this.m_depthBuffer[g]=0},t.prototype.GetInsideBoundsEnumerator=function(e){var i=t.computeTag(this.m_inverseDiameter*e.lowerBound.x-1,this.m_inverseDiameter*e.lowerBound.y-1),o=t.computeTag(this.m_inverseDiameter*e.upperBound.x+1,this.m_inverseDiameter*e.upperBound.y+1),n=this.m_proxyBuffer.count,r=C(this.m_proxyBuffer.data,0,n,i,T.CompareProxyTag),s=S(this.m_proxyBuffer.data,0,n,o,T.CompareTagProxy);return new L(this,i,o,r,s)},t.prototype.UpdateAllParticleFlags=function(){this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1},t.prototype.UpdateAllGroupFlags=function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1},t.prototype.AddContact=function(e,i){var o=this.m_flagsBuffer.data,n=this.m_positionBuffer.data,r=a.b2Vec2.SubVV(n[i],n[e],t.AddContact_s_d),s=a.b2Vec2.DotVV(r,r);if(0<s&&s<this.m_squaredDiameter){var c=a.b2InvSqrt(s),l=this.m_contactBuffer.data[this.m_contactBuffer.Append()];l.indexA=e,l.indexB=i,l.flags=o[e]|o[i],l.weight=1-s*c*this.m_inverseDiameter,l.normal.x=c*r.x,l.normal.y=c*r.y}},t.prototype.FindContacts_Reference=function(){var e=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var i=0,o=0;i<e;i++){for(var n=t.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,0),r=i+1;r<e&&!(n<this.m_proxyBuffer.data[r].tag);r++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[r].index,this.m_contactBuffer);for(var s=t.computeRelativeTag(this.m_proxyBuffer.data[i].tag,-1,1);o<e&&!(s<=this.m_proxyBuffer.data[o].tag);o++);var a=t.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,1);for(r=o;r<e&&!(a<this.m_proxyBuffer.data[r].tag);r++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[r].index,this.m_contactBuffer)}},t.prototype.FindContacts=function(t){this.FindContacts_Reference(t)},t.prototype.UpdateProxies_Reference=function(){for(var e=this.m_positionBuffer.data,i=this.m_inverseDiameter,o=0;o<this.m_proxyBuffer.count;++o){var n=this.m_proxyBuffer.data[o],r=e[n.index];n.tag=t.computeTag(i*r.x,i*r.y)}},t.prototype.UpdateProxies=function(t){this.UpdateProxies_Reference(t)},t.prototype.SortProxies=function(){v(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,T.CompareProxyProxy)},t.prototype.FilterContacts=function(){var t=this.GetParticleContactFilter();if(null!==t){var e=this;this.m_contactBuffer.RemoveIf(function(i){return 0!=(i.flags&p.b2ParticleFlag.b2_particleContactFilterParticle)&&!t.ShouldCollideParticleParticle(e,i.indexA,i.indexB)})}},t.prototype.NotifyContactListenerPreContact=function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error},t.prototype.NotifyContactListenerPostContact=function(){var t=this.GetParticleContactListener();if(null!==t){for(var e=0;e<this.m_contactBuffer.count;++e){var i=this.m_contactBuffer.data[e];t.BeginContactParticleParticle(this,i)}throw new Error}},t.b2ParticleContactIsZombie=function(t){return(t.flags&p.b2ParticleFlag.b2_zombieParticle)===p.b2ParticleFlag.b2_zombieParticle},t.prototype.UpdateContacts=function(e){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var i=new k;this.NotifyContactListenerPreContact(i),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(i),e&&this.m_contactBuffer.RemoveIf(t.b2ParticleContactIsZombie)},t.prototype.NotifyBodyContactListenerPreContact=function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error},t.prototype.NotifyBodyContactListenerPostContact=function(){var t=this.GetFixtureContactListener();if(null!==t){for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e];t.BeginContactFixtureParticle(this,i)}throw new Error}},t.prototype.UpdateBodyContacts=function(){var e=t.UpdateBodyContacts_s_aabb,i=new O;if(this.NotifyBodyContactListenerPreContact(i),this.m_stuckThreshold>0)for(var o=this.GetParticleCount(),n=0;n<o;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0);this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var r=e;this.ComputeAABB(r),null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new U(this));var s=this.UpdateBodyContacts_callback;s.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(s,r),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(i)},t.prototype.Solve=function(e){var i=t.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(e),this.m_allParticleFlags&p.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<e.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var o=i.Copy(e);o.dt/=e.particleIterations,o.inv_dt*=e.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&f.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&p.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(o),this.m_allParticleFlags&p.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&p.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(o),this.m_allParticleFlags&p.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(o),this.m_allParticleFlags&p.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(o),this.m_allGroupFlags&f.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(o),this.m_allParticleFlags&p.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(o),this.m_allParticleFlags&p.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(o),this.SolvePressure(o),this.SolveDamping(o),this.m_allParticleFlags&t.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&p.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(o),this.m_allParticleFlags&p.b2ParticleFlag.b2_springParticle&&this.SolveSpring(o),this.LimitVelocity(o),this.m_allGroupFlags&f.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&p.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(o),this.SolveCollision(o),this.m_allGroupFlags&f.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(o),this.m_allParticleFlags&p.b2ParticleFlag.b2_wallParticle&&this.SolveWall();for(var n=0;n<this.m_count;n++)this.m_positionBuffer.data[n].SelfMulAdd(o.dt,this.m_velocityBuffer.data[n])}},t.prototype.SolveCollision=function(e){var i=t.SolveCollision_s_aabb,o=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=i;s.lowerBound.x=+r.b2_maxFloat,s.lowerBound.y=+r.b2_maxFloat,s.upperBound.x=-r.b2_maxFloat,s.upperBound.y=-r.b2_maxFloat;for(var c=0;c<this.m_count;c++){var l=n[c],u=o[c],_=u.x+e.dt*l.x,m=u.y+e.dt*l.y;s.lowerBound.x=a.b2Min(s.lowerBound.x,a.b2Min(u.x,_)),s.lowerBound.y=a.b2Min(s.lowerBound.y,a.b2Min(u.y,m)),s.upperBound.x=a.b2Max(s.upperBound.x,a.b2Max(u.x,_)),s.upperBound.y=a.b2Max(s.upperBound.y,a.b2Max(u.y,m))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new X(this,e));var h=this.SolveCollision_callback;h.m_step=e,this.m_world.QueryAABB(h,s)},t.prototype.LimitVelocity=function(t){for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),o=0;o<this.m_count;o++){var n=e[o],r=a.b2Vec2.DotVV(n,n);r>i&&n.SelfMul(a.b2Sqrt(i/r))}},t.prototype.SolveGravity=function(e){for(var i=t.SolveGravity_s_gravity,o=this.m_velocityBuffer.data,n=a.b2Vec2.MulSV(e.dt*this.m_def.gravityScale,this.m_world.GetGravity(),i),r=0;r<this.m_count;r++)o[r].SelfAdd(n)},t.prototype.SolveBarrier=function(e){for(var i=t.SolveBarrier_s_aabb,o=t.SolveBarrier_s_va,n=t.SolveBarrier_s_vb,s=t.SolveBarrier_s_pba,c=t.SolveBarrier_s_vba,l=t.SolveBarrier_s_vc,u=t.SolveBarrier_s_pca,_=t.SolveBarrier_s_vca,m=t.SolveBarrier_s_qba,h=t.SolveBarrier_s_qca,f=t.SolveBarrier_s_dv,b=t.SolveBarrier_s_f,d=this.m_positionBuffer.data,y=this.m_velocityBuffer.data,v=0;v<this.m_count;v++)0!=(this.m_flagsBuffer.data[v]&t.k_barrierWallFlags)&&y[v].SetZero();for(var V=r.b2_barrierCollisionTime*e.dt,x=this.GetParticleMass(),C=0;C<this.m_pairBuffer.count;C++){var S=this.m_pairBuffer.data[C];if(S.flags&p.b2ParticleFlag.b2_barrierParticle){var B=S.indexA,g=S.indexB,A=d[B],w=d[g],M=i;a.b2Vec2.MinV(A,w,M.lowerBound),a.b2Vec2.MaxV(A,w,M.upperBound);for(var P=this.m_groupBuffer[B],D=this.m_groupBuffer[g],R=this.GetLinearVelocity(P,B,A,o),F=this.GetLinearVelocity(D,g,w,n),G=a.b2Vec2.SubVV(w,A,s),I=a.b2Vec2.SubVV(F,R,c),T=this.GetInsideBoundsEnumerator(M),L=void 0;(L=T.GetNext())>=0;){var E=d[L],J=this.m_groupBuffer[L];if(P!==J&&D!==J){var O=this.GetLinearVelocity(J,L,E,l),k=a.b2Vec2.SubVV(E,A,u),j=a.b2Vec2.SubVV(O,R,_),q=a.b2Vec2.CrossVV(I,j),z=a.b2Vec2.CrossVV(G,j)-a.b2Vec2.CrossVV(k,I),N=a.b2Vec2.CrossVV(G,k),W=void 0,U=void 0,X=m,Z=h;if(0===q){if(0===z)continue;if(!((U=-N/z)>=0&&U<V))continue;if(a.b2Vec2.AddVMulSV(G,U,I,X),a.b2Vec2.AddVMulSV(k,U,j,Z),!((W=a.b2Vec2.DotVV(X,Z)/a.b2Vec2.DotVV(X,X))>=0&&W<=1))continue}else{var H=z*z-4*N*q;if(H<0)continue;var Q=a.b2Sqrt(H),K=(-z-Q)/(2*q),Y=(-z+Q)/(2*q);if(K>Y){var $=K;K=Y,Y=$}if(U=K,a.b2Vec2.AddVMulSV(G,U,I,X),a.b2Vec2.AddVMulSV(k,U,j,Z),W=a.b2Vec2.DotVV(X,Z)/a.b2Vec2.DotVV(X,X),!(U>=0&&U<V&&W>=0&&W<=1)){if(!((U=Y)>=0&&U<V))continue;if(a.b2Vec2.AddVMulSV(G,U,I,X),a.b2Vec2.AddVMulSV(k,U,j,Z),!((W=a.b2Vec2.DotVV(X,Z)/a.b2Vec2.DotVV(X,X))>=0&&W<=1))continue}}var tt=f;tt.x=R.x+W*I.x-O.x,tt.y=R.y+W*I.y-O.y;var et=a.b2Vec2.MulSV(x,tt,b);if(J&&this.IsRigidGroup(J)){var it=J.GetMass(),ot=J.GetInertia();it>0&&J.m_linearVelocity.SelfMulAdd(1/it,et),ot>0&&(J.m_angularVelocity+=a.b2Vec2.CrossVV(a.b2Vec2.SubVV(E,J.GetCenter(),a.b2Vec2.s_t0),et)/ot)}else y[L].SelfAdd(tt);this.ParticleApplyForce(L,et.SelfMul(-e.inv_dt))}}}}},t.prototype.SolveStaticPressure=function(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,o=s.b2_maxParticlePressure*e,n=this.m_def.staticPressureRelaxation,r=0;r<this.m_def.staticPressureIterations;r++){for(var c=0;c<this.m_count;c++)this.m_accumulationBuffer[c]=0;for(var l=0;l<this.m_contactBuffer.count;l++){var u=this.m_contactBuffer.data[l];if(u.flags&p.b2ParticleFlag.b2_staticPressureParticle){var _=u.indexA,m=u.indexB,h=u.weight;this.m_accumulationBuffer[_]+=h*this.m_staticPressureBuffer[m],this.m_accumulationBuffer[m]+=h*this.m_staticPressureBuffer[_]}}for(c=0;c<this.m_count;c++)if(h=this.m_weightBuffer[c],this.m_flagsBuffer.data[c]&p.b2ParticleFlag.b2_staticPressureParticle){var f=(this.m_accumulationBuffer[c]+i*(h-s.b2_minParticleWeight))/(h+n);this.m_staticPressureBuffer[c]=a.b2Clamp(f,0,o)}else this.m_staticPressureBuffer[c]=0}},t.prototype.ComputeWeight=function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(t=0;t<this.m_bodyContactBuffer.count;t++){var e=(o=this.m_bodyContactBuffer.data[t]).index,i=o.weight;this.m_weightBuffer[e]+=i}for(t=0;t<this.m_contactBuffer.count;t++){e=(o=this.m_contactBuffer.data[t]).indexA;var o,n=o.indexB;i=o.weight,this.m_weightBuffer[e]+=i,this.m_weightBuffer[n]+=i}},t.prototype.SolvePressure=function(e){for(var i=t.SolvePressure_s_f,o=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,r=this.GetCriticalPressure(e),c=this.m_def.pressureStrength*r,l=s.b2_maxParticlePressure*r,u=0;u<this.m_count;u++){var _=this.m_weightBuffer[u],m=c*a.b2Max(0,_-s.b2_minParticleWeight);this.m_accumulationBuffer[u]=a.b2Min(m,l)}if(this.m_allParticleFlags&t.k_noPressureFlags)for(u=0;u<this.m_count;u++)this.m_flagsBuffer.data[u]&t.k_noPressureFlags&&(this.m_accumulationBuffer[u]=0);if(this.m_allParticleFlags&p.b2ParticleFlag.b2_staticPressureParticle)for(u=0;u<this.m_count;u++)this.m_flagsBuffer.data[u]&p.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[u]+=this.m_staticPressureBuffer[u]);for(var h=e.dt/(this.m_def.density*this.m_particleDiameter),f=this.GetParticleInvMass(),b=0;b<this.m_bodyContactBuffer.count;b++){var d=(S=this.m_bodyContactBuffer.data[b]).index,y=S.body,v=(_=S.weight,S.mass),V=S.normal,x=o[d],C=(m=this.m_accumulationBuffer[d]+c*_,a.b2Vec2.MulSV(h*_*v*m,V,i));n[d].SelfMulSub(f,C),y.ApplyLinearImpulse(C,x,!0)}for(b=0;b<this.m_contactBuffer.count;b++){var S;d=(S=this.m_contactBuffer.data[b]).indexA,y=S.indexB,_=S.weight,V=S.normal,m=this.m_accumulationBuffer[d]+this.m_accumulationBuffer[y],C=a.b2Vec2.MulSV(h*_*m,V,i),n[d].SelfSub(C),n[y].SelfAdd(C)}},t.prototype.SolveDamping=function(e){for(var i=t.SolveDamping_s_v,o=t.SolveDamping_s_f,n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=this.m_def.dampingStrength,c=1/this.GetCriticalVelocity(e),l=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var _=(V=this.m_bodyContactBuffer.data[u]).index,m=V.body,h=V.weight,p=V.mass,f=V.normal,b=n[_],d=a.b2Vec2.SubVV(m.GetLinearVelocityFromWorldPoint(b,a.b2Vec2.s_t0),r[_],i);if((x=a.b2Vec2.DotVV(d,f))<0){var y=a.b2Max(s*h,a.b2Min(-c*x,.5)),v=a.b2Vec2.MulSV(y*p*x,f,o);r[_].SelfMulAdd(l,v),m.ApplyLinearImpulse(v.SelfNeg(),b,!0)}}for(u=0;u<this.m_contactBuffer.count;u++){var V,x;_=(V=this.m_contactBuffer.data[u]).indexA,m=V.indexB,h=V.weight,f=V.normal,d=a.b2Vec2.SubVV(r[m],r[_],i),(x=a.b2Vec2.DotVV(d,f))<0&&(y=a.b2Max(s*h,a.b2Min(-c*x,.5)),v=a.b2Vec2.MulSV(y*x,f,o),r[_].SelfAdd(v),r[m].SelfSub(v))}},t.prototype.SolveRigidDamping=function(){for(var e=t.SolveRigidDamping_s_t0,i=t.SolveRigidDamping_s_t1,o=t.SolveRigidDamping_s_p,n=t.SolveRigidDamping_s_v,r=[0],s=[0],c=[0],l=[0],u=[0],_=[0],m=this.m_positionBuffer.data,h=this.m_def.dampingStrength,p=0;p<this.m_bodyContactBuffer.count;p++){var f=(C=this.m_bodyContactBuffer.data[p]).index;if((B=this.m_groupBuffer[f])&&this.IsRigidGroup(B)){var b=C.body,d=C.normal,y=C.weight,v=m[f],V=a.b2Vec2.SubVV(b.GetLinearVelocityFromWorldPoint(v,e),B.GetLinearVelocityFromWorldPoint(v,i),n);if((S=a.b2Vec2.DotVV(V,d))<0){this.InitDampingParameterWithRigidGroupOrParticle(r,s,c,!0,B,f,v,d),this.InitDampingParameter(l,u,_,b.GetMass(),b.GetInertia()-b.GetMass()*b.GetLocalCenter().LengthSquared(),b.GetWorldCenter(),v,d);var x=h*a.b2Min(y,1)*this.ComputeDampingImpulse(r[0],s[0],c[0],l[0],u[0],_[0],S);this.ApplyDamping(r[0],s[0],c[0],!0,B,f,x,d),b.ApplyLinearImpulse(a.b2Vec2.MulSV(-x,d,a.b2Vec2.s_t0),v,!0)}}}for(p=0;p<this.m_contactBuffer.count;p++){f=(C=this.m_contactBuffer.data[p]).indexA,b=C.indexB,d=C.normal,y=C.weight;var C,S,B=this.m_groupBuffer[f],g=this.m_groupBuffer[b],A=this.IsRigidGroup(B),w=this.IsRigidGroup(g);if(B!==g&&(A||w))v=a.b2Vec2.MidVV(m[f],m[b],o),V=a.b2Vec2.SubVV(this.GetLinearVelocity(g,b,v,e),this.GetLinearVelocity(B,f,v,i),n),(S=a.b2Vec2.DotVV(V,d))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(r,s,c,A,B,f,v,d),this.InitDampingParameterWithRigidGroupOrParticle(l,u,_,w,g,b,v,d),x=h*y*this.ComputeDampingImpulse(r[0],s[0],c[0],l[0],u[0],_[0],S),this.ApplyDamping(r[0],s[0],c[0],A,B,f,x,d),this.ApplyDamping(l[0],u[0],_[0],w,g,b,-x,d))}},t.prototype.SolveExtraDamping=function(){for(var e=t.SolveExtraDamping_s_v,i=t.SolveExtraDamping_s_f,o=this.m_velocityBuffer.data,n=this.m_positionBuffer.data,r=this.GetParticleInvMass(),s=0;s<this.m_bodyContactBuffer.count;s++){var c=this.m_bodyContactBuffer.data[s],l=c.index;if(this.m_flagsBuffer.data[l]&t.k_extraDampingFlags){var u=c.body,_=c.mass,m=c.normal,h=n[l],p=a.b2Vec2.SubVV(u.GetLinearVelocityFromWorldPoint(h,a.b2Vec2.s_t0),o[l],e),f=a.b2Vec2.DotVV(p,m);if(f<0){var b=a.b2Vec2.MulSV(.5*_*f,m,i);o[l].SelfMulAdd(r,b),u.ApplyLinearImpulse(b.SelfNeg(),h,!0)}}}},t.prototype.SolveWall=function(){for(var t=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&p.b2ParticleFlag.b2_wallParticle&&t[e].SetZero()},t.prototype.SolveRigid=function(e){for(var i=t.SolveRigid_s_position,o=t.SolveRigid_s_rotation,n=t.SolveRigid_s_transform,r=t.SolveRigid_s_velocityTransform,s=this.m_positionBuffer.data,c=this.m_velocityBuffer.data,l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&f.b2ParticleGroupFlag.b2_rigidParticleGroup){l.UpdateStatistics();var u=o;u.SetAngle(e.dt*l.m_angularVelocity);var _=a.b2Vec2.AddVV(l.m_center,a.b2Vec2.SubVV(a.b2Vec2.MulSV(e.dt,l.m_linearVelocity,a.b2Vec2.s_t0),a.b2Rot.MulRV(u,l.m_center,a.b2Vec2.s_t1),a.b2Vec2.s_t0),i),m=n;m.SetPositionRotation(_,u),a.b2Transform.MulXX(m,l.m_transform,l.m_transform);var h=r;h.p.x=e.inv_dt*m.p.x,h.p.y=e.inv_dt*m.p.y,h.q.s=e.inv_dt*m.q.s,h.q.c=e.inv_dt*(m.q.c-1);for(var p=l.m_firstIndex;p<l.m_lastIndex;p++)a.b2Transform.MulXV(h,s[p],c[p])}},t.prototype.SolveElastic=function(e){for(var i=t.SolveElastic_s_pa,o=t.SolveElastic_s_pb,n=t.SolveElastic_s_pc,r=t.SolveElastic_s_r,s=t.SolveElastic_s_t0,c=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,u=e.inv_dt*this.m_def.elasticStrength,_=0;_<this.m_triadBuffer.count;_++){var m=this.m_triadBuffer.data[_];if(m.flags&p.b2ParticleFlag.b2_elasticParticle){var h=m.indexA,f=m.indexB,b=m.indexC,d=m.pa,y=m.pb,v=m.pc,V=i.Copy(c[h]),x=o.Copy(c[f]),C=n.Copy(c[b]),S=l[h],B=l[f],g=l[b];V.SelfMulAdd(e.dt,S),x.SelfMulAdd(e.dt,B),C.SelfMulAdd(e.dt,g);var A=(V.x+x.x+C.x)/3,w=(V.y+x.y+C.y)/3;V.x-=A,V.y-=w,x.x-=A,x.y-=w,C.x-=A,C.y-=w;var M=r;M.s=a.b2Vec2.CrossVV(d,V)+a.b2Vec2.CrossVV(y,x)+a.b2Vec2.CrossVV(v,C),M.c=a.b2Vec2.DotVV(d,V)+a.b2Vec2.DotVV(y,x)+a.b2Vec2.DotVV(v,C);var P=M.s*M.s+M.c*M.c,D=a.b2InvSqrt(P);isFinite(D)||(D=198177537e11),M.s*=D,M.c*=D;var R=u*m.strength;a.b2Rot.MulRV(M,d,s),a.b2Vec2.SubVV(s,V,s),a.b2Vec2.MulSV(R,s,s),S.SelfAdd(s),a.b2Rot.MulRV(M,y,s),a.b2Vec2.SubVV(s,x,s),a.b2Vec2.MulSV(R,s,s),B.SelfAdd(s),a.b2Rot.MulRV(M,v,s),a.b2Vec2.SubVV(s,C,s),a.b2Vec2.MulSV(R,s,s),g.SelfAdd(s)}}},t.prototype.SolveSpring=function(e){for(var i=t.SolveSpring_s_pa,o=t.SolveSpring_s_pb,n=t.SolveSpring_s_d,r=t.SolveSpring_s_f,s=this.m_positionBuffer.data,c=this.m_velocityBuffer.data,l=e.inv_dt*this.m_def.springStrength,u=0;u<this.m_pairBuffer.count;u++){var _=this.m_pairBuffer.data[u];if(_.flags&p.b2ParticleFlag.b2_springParticle){var m=_.indexA,h=_.indexB,f=i.Copy(s[m]),b=o.Copy(s[h]),d=c[m],y=c[h];f.SelfMulAdd(e.dt,d),b.SelfMulAdd(e.dt,y);var v=a.b2Vec2.SubVV(b,f,n),V=_.distance,x=v.Length(),C=l*_.strength,S=a.b2Vec2.MulSV(C*(V-x)/x,v,r);d.SelfSub(S),y.SelfAdd(S)}}},t.prototype.SolveTensile=function(e){for(var i=t.SolveTensile_s_weightedNormal,o=t.SolveTensile_s_s,n=t.SolveTensile_s_f,r=this.m_velocityBuffer.data,c=0;c<this.m_count;c++)this.m_accumulation2Buffer[c]=new a.b2Vec2,this.m_accumulation2Buffer[c].SetZero();for(var l=0;l<this.m_contactBuffer.count;l++)if((V=this.m_contactBuffer.data[l]).flags&p.b2ParticleFlag.b2_tensileParticle){var u=V.indexA,_=V.indexB,m=V.weight,h=V.normal,f=a.b2Vec2.MulSV((1-m)*m,h,i);this.m_accumulation2Buffer[u].SelfSub(f),this.m_accumulation2Buffer[_].SelfAdd(f)}var b=this.GetCriticalVelocity(e),d=this.m_def.surfaceTensionPressureStrength*b,y=this.m_def.surfaceTensionNormalStrength*b,v=s.b2_maxParticleForce*b;for(l=0;l<this.m_contactBuffer.count;l++){var V;if((V=this.m_contactBuffer.data[l]).flags&p.b2ParticleFlag.b2_tensileParticle){u=V.indexA,_=V.indexB,m=V.weight,h=V.normal;var x=this.m_weightBuffer[u]+this.m_weightBuffer[_],C=a.b2Vec2.SubVV(this.m_accumulation2Buffer[_],this.m_accumulation2Buffer[u],o),S=a.b2Min(d*(x-2)+y*a.b2Vec2.DotVV(C,h),v)*m,B=a.b2Vec2.MulSV(S,h,n);r[u].SelfSub(B),r[_].SelfAdd(B)}}},t.prototype.SolveViscous=function(){for(var e=t.SolveViscous_s_v,i=t.SolveViscous_s_f,o=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,r=this.m_def.viscousStrength,s=this.GetParticleInvMass(),c=0;c<this.m_bodyContactBuffer.count;c++){var l=(d=this.m_bodyContactBuffer.data[c]).index;if(this.m_flagsBuffer.data[l]&p.b2ParticleFlag.b2_viscousParticle){var u=d.body,_=d.weight,m=d.mass,h=o[l],f=a.b2Vec2.SubVV(u.GetLinearVelocityFromWorldPoint(h,a.b2Vec2.s_t0),n[l],e),b=a.b2Vec2.MulSV(r*m*_,f,i);n[l].SelfMulAdd(s,b),u.ApplyLinearImpulse(b.SelfNeg(),h,!0)}}for(c=0;c<this.m_contactBuffer.count;c++){var d;(d=this.m_contactBuffer.data[c]).flags&p.b2ParticleFlag.b2_viscousParticle&&(l=d.indexA,u=d.indexB,_=d.weight,f=a.b2Vec2.SubVV(n[u],n[l],e),b=a.b2Vec2.MulSV(r*_,f,i),n[l].SelfAdd(b),n[u].SelfSub(b))}},t.prototype.SolveRepulsive=function(e){for(var i=t.SolveRepulsive_s_f,o=this.m_velocityBuffer.data,n=this.m_def.repulsiveStrength*this.GetCriticalVelocity(e),r=0;r<this.m_contactBuffer.count;r++){var s=this.m_contactBuffer.data[r];if(s.flags&p.b2ParticleFlag.b2_repulsiveParticle){var c=s.indexA,l=s.indexB;if(this.m_groupBuffer[c]!==this.m_groupBuffer[l]){var u=s.weight,_=s.normal,m=a.b2Vec2.MulSV(n*u,_,i);o[c].SelfSub(m),o[l].SelfAdd(m)}}}},t.prototype.SolvePowder=function(e){for(var i=t.SolvePowder_s_f,o=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,r=this.m_def.powderStrength*this.GetCriticalVelocity(e),c=1-s.b2_particleStride,l=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var _=(y=this.m_bodyContactBuffer.data[u]).index;if(this.m_flagsBuffer.data[_]&p.b2ParticleFlag.b2_powderParticle&&(v=y.weight)>c){var m=y.body,h=y.mass,f=o[_],b=y.normal,d=a.b2Vec2.MulSV(r*h*(v-c),b,i);n[_].SelfMulSub(l,d),m.ApplyLinearImpulse(d,f,!0)}}for(u=0;u<this.m_contactBuffer.count;u++){var y,v;(y=this.m_contactBuffer.data[u]).flags&p.b2ParticleFlag.b2_powderParticle&&(v=y.weight)>c&&(_=y.indexA,m=y.indexB,b=y.normal,d=a.b2Vec2.MulSV(r*(v-c),b,i),n[_].SelfSub(d),n[m].SelfAdd(d))}},t.prototype.SolveSolid=function(e){var i=t.SolveSolid_s_f,o=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var n=e.inv_dt*this.m_def.ejectionStrength,r=0;r<this.m_contactBuffer.count;r++){var s=this.m_contactBuffer.data[r],c=s.indexA,l=s.indexB;if(this.m_groupBuffer[c]!==this.m_groupBuffer[l]){var u=s.weight,_=s.normal,m=this.m_depthBuffer[c]+this.m_depthBuffer[l],h=a.b2Vec2.MulSV(n*m*u,_,i);o[c].SelfSub(h),o[l].SelfAdd(h)}}},t.prototype.SolveForce=function(t){for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),o=0;o<this.m_count;o++)e[o].SelfMulAdd(i,this.m_forceBuffer[o]);this.m_hasForce=!1},t.prototype.SolveColorMixing=function(){var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e],o=i.indexA,n=i.indexB;if(this.m_flagsBuffer.data[o]&this.m_flagsBuffer.data[n]&p.b2ParticleFlag.b2_colorMixingParticle){var r=this.m_colorBuffer.data[o],s=this.m_colorBuffer.data[n];c.b2Color.MixColors(r,s,t)}}},t.prototype.SolveZombie=function(){for(var t=0,e=[],i=0;i<this.m_count;i++)e[i]=r.b2_invalidParticleIndex;var o=0;for(i=0;i<this.m_count;i++){var n=this.m_flagsBuffer.data[i];if(n&p.b2ParticleFlag.b2_zombieParticle){var s=this.m_world.m_destructionListener;n&p.b2ParticleFlag.b2_destructionListenerParticle&&s&&s.SayGoodbyeParticle(this,i),this.m_handleIndexBuffer.data&&(c=this.m_handleIndexBuffer.data[i])&&(c.SetIndex(r.b2_invalidParticleIndex),this.m_handleIndexBuffer.data[i]=null),e[i]=r.b2_invalidParticleIndex}else{var c;if(e[i]=t,i!==t)this.m_handleIndexBuffer.data&&((c=this.m_handleIndexBuffer.data[i])&&c.SetIndex(t),this.m_handleIndexBuffer.data[t]=c),this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[i],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[i]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[i]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[i]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[i]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[i]),this.m_groupBuffer[t]=this.m_groupBuffer[i],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[i]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[i]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[i]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[i]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[i]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[i]);t++,o|=n}}for(var l=0;l<this.m_proxyBuffer.count;l++){var u=this.m_proxyBuffer.data[l];u.index=e[u.index]}for(this.m_proxyBuffer.RemoveIf(function(t){return t.index<0}),l=0;l<this.m_contactBuffer.count;l++)(_=this.m_contactBuffer.data[l]).indexA=e[_.indexA],_.indexB=e[_.indexB];for(this.m_contactBuffer.RemoveIf(function(t){return t.indexA<0||t.indexB<0}),l=0;l<this.m_bodyContactBuffer.count;l++){var _;(_=this.m_bodyContactBuffer.data[l]).index=e[_.index]}for(this.m_bodyContactBuffer.RemoveIf(function(t){return t.index<0}),l=0;l<this.m_pairBuffer.count;l++){var m=this.m_pairBuffer.data[l];m.indexA=e[m.indexA],m.indexB=e[m.indexB]}for(this.m_pairBuffer.RemoveIf(function(t){return t.indexA<0||t.indexB<0}),l=0;l<this.m_triadBuffer.count;l++){var h=this.m_triadBuffer.data[l];h.indexA=e[h.indexA],h.indexB=e[h.indexB],h.indexC=e[h.indexC]}if(this.m_triadBuffer.RemoveIf(function(t){return t.indexA<0||t.indexB<0||t.indexC<0}),this.m_indexByExpirationTimeBuffer.data)for(var b=0,d=0;d<this.m_count;d++){var y=e[this.m_indexByExpirationTimeBuffer.data[d]];y!==r.b2_invalidParticleIndex&&(this.m_indexByExpirationTimeBuffer.data[b++]=y)}for(var v=this.m_groupList;v;v=v.GetNext()){var V=t,x=0,C=!1;for(i=v.m_firstIndex;i<v.m_lastIndex;i++){var S=e[i];S>=0?(V=a.b2Min(V,S),x=a.b2Max(x,S+1)):C=!0}V<x?(v.m_firstIndex=V,v.m_lastIndex=x,C&&v.m_groupFlags&f.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(v,v.m_groupFlags|f.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(v.m_firstIndex=0,v.m_lastIndex=0,v.m_groupFlags&f.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(v,v.m_groupFlags|f.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}for(this.m_count=t,this.m_allParticleFlags=o,this.m_needsUpdateAllParticleFlags=!1,v=this.m_groupList;v;){var B=v.GetNext();v.m_groupFlags&f.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(v),v=B}},t.prototype.SolveLifetimes=function(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,o=this.m_indexByExpirationTimeBuffer.data,n=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(v(o,0,n,function(t,e){var o=i[t],n=i[e],r=o<=0;return r===n<=0?o>n:r}),this.m_expirationTimeBufferRequiresSorting=!1);for(var r=n-1;r>=0;--r){var s=o[r],a=i[s];if(e<a||a<=0)break;this.DestroyParticle(s)}},t.prototype.RotateBuffer=function(t,e,i){if(t!==e&&e!==i){if(B(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&B(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&B(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&B(this.m_consecutiveContactStepsBuffer.data,t,e,i),B(this.m_positionBuffer.data,t,e,i),B(this.m_velocityBuffer.data,t,e,i),B(this.m_groupBuffer,t,e,i),this.m_hasForce&&B(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&B(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&B(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&B(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&B(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){B(this.m_handleIndexBuffer.data,t,e,i);for(var o=t;o<i;++o){var n=this.m_handleIndexBuffer.data[o];n&&n.SetIndex(h(n.GetIndex()))}}if(this.m_expirationTimeBuffer.data){B(this.m_expirationTimeBuffer.data,t,e,i);var r=this.GetParticleCount(),s=this.m_indexByExpirationTimeBuffer.data;for(o=0;o<r;++o)s[o]=h(s[o])}for(var a=0;a<this.m_proxyBuffer.count;a++){var c=this.m_proxyBuffer.data[a];c.index=h(c.index)}for(a=0;a<this.m_contactBuffer.count;a++)(l=this.m_contactBuffer.data[a]).indexA=h(l.indexA),l.indexB=h(l.indexB);for(a=0;a<this.m_bodyContactBuffer.count;a++){var l;(l=this.m_bodyContactBuffer.data[a]).index=h(l.index)}for(a=0;a<this.m_pairBuffer.count;a++){var u=this.m_pairBuffer.data[a];u.indexA=h(u.indexA),u.indexB=h(u.indexB)}for(a=0;a<this.m_triadBuffer.count;a++){var _=this.m_triadBuffer.data[a];_.indexA=h(_.indexA),_.indexB=h(_.indexB),_.indexC=h(_.indexC)}for(var m=this.m_groupList;m;m=m.GetNext())m.m_firstIndex=h(m.m_firstIndex),m.m_lastIndex=h(m.m_lastIndex-1)+1}function h(o){return o<t?o:o<e?o+i-e:o<i?o+t-e:o}},t.prototype.GetCriticalVelocity=function(t){return this.m_particleDiameter*t.inv_dt},t.prototype.GetCriticalVelocitySquared=function(t){var e=this.GetCriticalVelocity(t);return e*e},t.prototype.GetCriticalPressure=function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)},t.prototype.GetParticleStride=function(){return s.b2_particleStride*this.m_particleDiameter},t.prototype.GetParticleMass=function(){var t=this.GetParticleStride();return this.m_def.density*t*t},t.prototype.GetParticleInvMass=function(){var t=this.m_inverseDiameter*(1/s.b2_particleStride);return this.m_inverseDensity*t*t},t.prototype.GetFixtureContactFilter=function(){return this.m_allParticleFlags&p.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},t.prototype.GetParticleContactFilter=function(){return this.m_allParticleFlags&p.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},t.prototype.GetFixtureContactListener=function(){return this.m_allParticleFlags&p.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},t.prototype.GetParticleContactListener=function(){return this.m_allParticleFlags&p.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},t.prototype.SetUserOverridableBuffer=function(t,e){t.data=e,t.userSuppliedCapacity=e.length},t.prototype.SetGroupFlags=function(t,e){var i=t.m_groupFlags;(i^e)&f.b2ParticleGroupFlag.b2_solidParticleGroup&&(e|=f.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&f.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e},t.BodyContactCompare=function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index},t.prototype.RemoveSpuriousBodyContacts=function(){v(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,t.BodyContactCompare);var e=t.RemoveSpuriousBodyContacts_s_n,i=t.RemoveSpuriousBodyContacts_s_pos,o=t.RemoveSpuriousBodyContacts_s_normal,n=this,s=-1,c=0;this.m_bodyContactBuffer.count=x(this.m_bodyContactBuffer.data,function(t){if(t.index!==s&&(c=0,s=t.index),c++>3)return!0;var l=e.Copy(t.normal);l.SelfMul(n.m_particleDiameter*(1-t.weight));var u=a.b2Vec2.AddVV(n.m_positionBuffer.data[t.index],l,i);if(!t.fixture.TestPoint(u)){for(var _=t.fixture.GetShape().GetChildCount(),m=0;m<_;m++){var h=o;if(t.fixture.ComputeDistance(u,h,m)<r.b2_linearSlop)return!1}return!0}return!1},this.m_bodyContactBuffer.count)},t.prototype.DetectStuckParticle=function(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)},t.prototype.ValidateParticleIndex=function(t){return t>=0&&t<this.GetParticleCount()&&t!==r.b2_invalidParticleIndex},t.prototype.GetQuantizedTimeElapsed=function(){return Math.floor(this.m_timeElapsed/4294967296)},t.prototype.LifetimeToExpirationTime=function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)},t.prototype.ForceCanBeApplied=function(t){return!(t&p.b2ParticleFlag.b2_wallParticle)},t.prototype.PrepareForceBuffer=function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}},t.prototype.IsRigidGroup=function(t){return null!==t&&0!=(t.m_groupFlags&f.b2ParticleGroupFlag.b2_rigidParticleGroup)},t.prototype.GetLinearVelocity=function(t,e,i,o){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,o):o.Copy(this.m_velocityBuffer.data[e])},t.prototype.InitDampingParameter=function(t,e,i,o,n,r,s,c){t[0]=o>0?1/o:0,e[0]=n>0?1/n:0,i[0]=a.b2Vec2.CrossVV(a.b2Vec2.SubVV(s,r,a.b2Vec2.s_t0),c)},t.prototype.InitDampingParameterWithRigidGroupOrParticle=function(t,e,i,o,n,r,s,a){if(n&&o)this.InitDampingParameter(t,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),s,a);else{var c=this.m_flagsBuffer.data[r];this.InitDampingParameter(t,e,i,c&p.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,s,s,a)}},t.prototype.ComputeDampingImpulse=function(t,e,i,o,n,r,s){var a=t+e*i*i+o+n*r*r;return a>0?s/a:0},t.prototype.ApplyDamping=function(t,e,i,o,n,r,s,a){n&&o?(n.m_linearVelocity.SelfMulAdd(s*t,a),n.m_angularVelocity+=s*i*e):this.m_velocityBuffer.data[r].SelfMulAdd(s*t,a)},t.xTruncBits=12,t.yTruncBits=12,t.tagBits=32,t.yOffset=1<<t.yTruncBits-1,t.yShift=t.tagBits-t.yTruncBits,t.xShift=t.tagBits-t.yTruncBits-t.xTruncBits,t.xScale=1<<t.xShift,t.xOffset=t.xScale*(1<<t.xTruncBits-1),t.yMask=(1<<t.yTruncBits)-1<<t.yShift,t.xMask=~t.yMask,t.DestroyParticlesInShape_s_aabb=new l.b2AABB,t.CreateParticleGroup_s_transform=new a.b2Transform,t.ComputeCollisionEnergy_s_v=new a.b2Vec2,t.QueryShapeAABB_s_aabb=new l.b2AABB,t.QueryPointAABB_s_aabb=new l.b2AABB,t.RayCast_s_aabb=new l.b2AABB,t.RayCast_s_p=new a.b2Vec2,t.RayCast_s_v=new a.b2Vec2,t.RayCast_s_n=new a.b2Vec2,t.RayCast_s_point=new a.b2Vec2,t.k_pairFlags=p.b2ParticleFlag.b2_springParticle,t.k_triadFlags=p.b2ParticleFlag.b2_elasticParticle,t.k_noPressureFlags=p.b2ParticleFlag.b2_powderParticle|p.b2ParticleFlag.b2_tensileParticle,t.k_extraDampingFlags=p.b2ParticleFlag.b2_staticPressureParticle,t.k_barrierWallFlags=p.b2ParticleFlag.b2_barrierParticle|p.b2ParticleFlag.b2_wallParticle,t.CreateParticlesStrokeShapeForGroup_s_edge=new _.b2EdgeShape,t.CreateParticlesStrokeShapeForGroup_s_d=new a.b2Vec2,t.CreateParticlesStrokeShapeForGroup_s_p=new a.b2Vec2,t.CreateParticlesFillShapeForGroup_s_aabb=new l.b2AABB,t.CreateParticlesFillShapeForGroup_s_p=new a.b2Vec2,t.UpdatePairsAndTriads_s_dab=new a.b2Vec2,t.UpdatePairsAndTriads_s_dbc=new a.b2Vec2,t.UpdatePairsAndTriads_s_dca=new a.b2Vec2,t.AddContact_s_d=new a.b2Vec2,t.UpdateBodyContacts_s_aabb=new l.b2AABB,t.Solve_s_subStep=new m.b2TimeStep,t.SolveCollision_s_aabb=new l.b2AABB,t.SolveGravity_s_gravity=new a.b2Vec2,t.SolveBarrier_s_aabb=new l.b2AABB,t.SolveBarrier_s_va=new a.b2Vec2,t.SolveBarrier_s_vb=new a.b2Vec2,t.SolveBarrier_s_pba=new a.b2Vec2,t.SolveBarrier_s_vba=new a.b2Vec2,t.SolveBarrier_s_vc=new a.b2Vec2,t.SolveBarrier_s_pca=new a.b2Vec2,t.SolveBarrier_s_vca=new a.b2Vec2,t.SolveBarrier_s_qba=new a.b2Vec2,t.SolveBarrier_s_qca=new a.b2Vec2,t.SolveBarrier_s_dv=new a.b2Vec2,t.SolveBarrier_s_f=new a.b2Vec2,t.SolvePressure_s_f=new a.b2Vec2,t.SolveDamping_s_v=new a.b2Vec2,t.SolveDamping_s_f=new a.b2Vec2,t.SolveRigidDamping_s_t0=new a.b2Vec2,t.SolveRigidDamping_s_t1=new a.b2Vec2,t.SolveRigidDamping_s_p=new a.b2Vec2,t.SolveRigidDamping_s_v=new a.b2Vec2,t.SolveExtraDamping_s_v=new a.b2Vec2,t.SolveExtraDamping_s_f=new a.b2Vec2,t.SolveRigid_s_position=new a.b2Vec2,t.SolveRigid_s_rotation=new a.b2Rot,t.SolveRigid_s_transform=new a.b2Transform,t.SolveRigid_s_velocityTransform=new a.b2Transform,t.SolveElastic_s_pa=new a.b2Vec2,t.SolveElastic_s_pb=new a.b2Vec2,t.SolveElastic_s_pc=new a.b2Vec2,t.SolveElastic_s_r=new a.b2Rot,t.SolveElastic_s_t0=new a.b2Vec2,t.SolveSpring_s_pa=new a.b2Vec2,t.SolveSpring_s_pb=new a.b2Vec2,t.SolveSpring_s_d=new a.b2Vec2,t.SolveSpring_s_f=new a.b2Vec2,t.SolveTensile_s_weightedNormal=new a.b2Vec2,t.SolveTensile_s_s=new a.b2Vec2,t.SolveTensile_s_f=new a.b2Vec2,t.SolveViscous_s_v=new a.b2Vec2,t.SolveViscous_s_f=new a.b2Vec2,t.SolveRepulsive_s_f=new a.b2Vec2,t.SolvePowder_s_f=new a.b2Vec2,t.SolveSolid_s_f=new a.b2Vec2,t.RemoveSpuriousBodyContacts_s_n=new a.b2Vec2,t.RemoveSpuriousBodyContacts_s_pos=new a.b2Vec2,t.RemoveSpuriousBodyContacts_s_normal=new a.b2Vec2,t}();i.b2ParticleSystem=G;var I=function(){function t(){this._data=null,this.userSuppliedCapacity=0}return Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),t}();i.b2ParticleSystem_UserOverridableBuffer=I;var T=function(){function t(){this.index=r.b2_invalidParticleIndex,this.tag=0}return t.CompareProxyProxy=function(t,e){return t.tag<e.tag},t.CompareTagProxy=function(t,e){return t<e.tag},t.CompareProxyTag=function(t,e){return t.tag<e},t}();i.b2ParticleSystem_Proxy=T;var L=function(){function t(t,e,i,o,n){this.m_system=t,this.m_xLower=(e&G.xMask)>>>0,this.m_xUpper=(i&G.xMask)>>>0,this.m_yLower=(e&G.yMask)>>>0,this.m_yUpper=(i&G.yMask)>>>0,this.m_first=o,this.m_last=n}return t.prototype.GetNext=function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&G.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return r.b2_invalidParticleIndex},t}();i.b2ParticleSystem_InsideBoundsEnumerator=L;var E=function(){this.next=null,this.count=0,this.index=0};i.b2ParticleSystem_ParticleListNode=E;var J=function(){function t(){}return t.prototype.Allocate=function(t,e){return e},t.prototype.Clear=function(){},t.prototype.GetCount=function(){return 0},t.prototype.Invalidate=function(){},t.prototype.GetValidBuffer=function(){return[]},t.prototype.GetBuffer=function(){return[]},t.prototype.SetCount=function(){},t}();i.b2ParticleSystem_FixedSetAllocator=J;i.b2ParticleSystem_FixtureParticle=function(t,e){this.second=r.b2_invalidParticleIndex,this.first=t,this.second=e};var O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.Initialize=function(){},e.prototype.Find=function(){return r.b2_invalidParticleIndex},e}(J);i.b2ParticleSystem_FixtureParticleSet=O;i.b2ParticleSystem_ParticlePair=function(t,e){this.first=r.b2_invalidParticleIndex,this.second=r.b2_invalidParticleIndex,this.first=t,this.second=e};var k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.Initialize=function(){},e.prototype.Find=function(){return r.b2_invalidParticleIndex},e}(J);i.b2ParticlePairSet=k;var j=function(){function t(){}return t.prototype.IsNecessary=function(){return!0},t.prototype.ShouldCreatePair=function(){return!0},t.prototype.ShouldCreateTriad=function(){return!0},t}();i.b2ParticleSystem_ConnectionFilter=j;var q=function(t){function e(e,i,o,n){var r=t.call(this)||this;return r.m_callDestructionListener=!1,r.m_destroyed=0,r.m_system=e,r.m_shape=i,r.m_xf=o,r.m_callDestructionListener=n,r.m_destroyed=0,r}return n(e,t),e.prototype.ReportFixture=function(){return!1},e.prototype.ReportParticle=function(t,e){return t===this.m_system&&(this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)},e.prototype.Destroyed=function(){return this.m_destroyed},e}(h.b2QueryCallback);i.b2ParticleSystem_DestroyParticlesInShapeCallback=q;var z=function(t){function e(e){var i=t.call(this)||this;return i.m_threshold=0,i.m_threshold=e,i}return n(e,t),e.prototype.ShouldCreatePair=function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t},e.prototype.ShouldCreateTriad=function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)},e}(j);i.b2ParticleSystem_JoinParticleGroupsFilter=z;var N=function(t){function e(e,i){void 0===i&&(i=e.length);var o=t.call(this,u.b2ShapeType.e_unknown,0)||this;return o.m_shapeCount=0,o.m_shapes=e,o.m_shapeCount=i,o}return n(e,t),e.prototype.Clone=function(){throw new Error},e.prototype.GetChildCount=function(){return 1},e.prototype.TestPoint=function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1},e.prototype.ComputeDistance=function(){return 0},e.prototype.RayCast=function(){return!1},e.prototype.ComputeAABB=function(t,e){var i=new l.b2AABB;t.lowerBound.x=+r.b2_maxFloat,t.lowerBound.y=+r.b2_maxFloat,t.upperBound.x=-r.b2_maxFloat,t.upperBound.y=-r.b2_maxFloat;for(var o=0;o<this.m_shapeCount;o++)for(var n=this.m_shapes[o].GetChildCount(),s=0;s<n;s++){var a=i;this.m_shapes[o].ComputeAABB(a,e,s),t.Combine1(a)}},e.prototype.ComputeMass=function(){},e.prototype.SetupDistanceProxy=function(){},e.prototype.ComputeSubmergedArea=function(){return 0},e.prototype.Dump=function(){},e}(u.b2Shape);i.b2ParticleSystem_CompositeShape=N;var W=function(t){function e(e){var i=t.call(this)||this;return i.m_flagsBuffer=e,i}return n(e,t),e.prototype.IsNecessary=function(t){return 0!=(this.m_flagsBuffer.data[t]&p.b2ParticleFlag.b2_reactiveParticle)},e}(j);i.b2ParticleSystem_ReactiveFilter=W;var U=function(t){function e(e,i){void 0===i&&(i=null);var o=t.call(this,e)||this;return o.m_contactFilter=null,o.m_contactFilter=i,o}return n(e,t),e.prototype.ShouldCollideFixtureParticle=function(t,e,i){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[i]&p.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)},e.prototype.ReportFixtureAndParticle=function(t,i,o){var n=e.ReportFixtureAndParticle_s_n,r=e.ReportFixtureAndParticle_s_rp,s=this.m_system.m_positionBuffer.data[o],c=n,l=t.ComputeDistance(s,c,i);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,this.m_system,o)){var u=t.GetBody(),_=u.GetWorldCenter(),m=u.GetMass(),h=u.GetInertia()-m*u.GetLocalCenter().LengthSquared(),f=m>0?1/m:0,b=h>0?1/h:0,d=this.m_system.m_flagsBuffer.data[o]&p.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),y=a.b2Vec2.SubVV(s,_,r),v=a.b2Vec2.CrossVV(y,c),V=d+f+b*v*v,x=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];x.index=o,x.body=u,x.fixture=t,x.weight=1-l*this.m_system.m_inverseDiameter,x.normal.Copy(c.SelfNeg()),x.mass=V>0?1/V:0,this.m_system.DetectStuckParticle(o)}},e.ReportFixtureAndParticle_s_n=new a.b2Vec2,e.ReportFixtureAndParticle_s_rp=new a.b2Vec2,e}(w);i.b2ParticleSystem_UpdateBodyContactsCallback=U;var X=function(t){function e(e,i){var o=t.call(this,e)||this;return o.m_step=i,o}return n(e,t),e.prototype.ReportFixtureAndParticle=function(t,i,o){var n=e.ReportFixtureAndParticle_s_p1,s=e.ReportFixtureAndParticle_s_output,c=e.ReportFixtureAndParticle_s_input,l=e.ReportFixtureAndParticle_s_p,_=e.ReportFixtureAndParticle_s_v,m=e.ReportFixtureAndParticle_s_f,h=t.GetBody(),p=this.m_system.m_positionBuffer.data[o],f=this.m_system.m_velocityBuffer.data[o],b=s,d=c;if(0===this.m_system.m_iterationIndex){var y=a.b2Transform.MulTXV(h.m_xf0,p,n);t.GetShape().GetType()===u.b2ShapeType.e_circleShape&&(y.SelfSub(h.GetLocalCenter()),a.b2Rot.MulRV(h.m_xf0.q,y,y),a.b2Rot.MulTRV(h.m_xf.q,y,y),y.SelfAdd(h.GetLocalCenter())),a.b2Transform.MulXV(h.m_xf,y,d.p1)}else d.p1.Copy(p);if(a.b2Vec2.AddVMulSV(p,this.m_step.dt,f,d.p2),d.maxFraction=1,t.RayCast(b,d,i)){var v=b.normal,V=l;V.x=(1-b.fraction)*d.p1.x+b.fraction*d.p2.x+r.b2_linearSlop*v.x,V.y=(1-b.fraction)*d.p1.y+b.fraction*d.p2.y+r.b2_linearSlop*v.y;var x=_;x.x=this.m_step.inv_dt*(V.x-p.x),x.y=this.m_step.inv_dt*(V.y-p.y),this.m_system.m_velocityBuffer.data[o].Copy(x);var C=m;C.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(f.x-x.x),C.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(f.y-x.y),this.m_system.ParticleApplyForce(o,C)}},e.prototype.ReportParticle=function(){return!1},e.ReportFixtureAndParticle_s_p1=new a.b2Vec2,e.ReportFixtureAndParticle_s_output=new l.b2RayCastOutput,e.ReportFixtureAndParticle_s_input=new l.b2RayCastInput,e.ReportFixtureAndParticle_s_p=new a.b2Vec2,e.ReportFixtureAndParticle_s_v=new a.b2Vec2,e.ReportFixtureAndParticle_s_f=new a.b2Vec2,e}(w);i.b2ParticleSystem_SolveCollisionCallback=X,cc._RF.pop()},{"../Collision/Shapes/b2EdgeShape":"b2EdgeShape","../Collision/Shapes/b2Shape":"b2Shape","../Collision/b2Collision":"b2Collision","../Common/b2Draw":"b2Draw","../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","../Dynamics/b2TimeStep":"b2TimeStep","../Dynamics/b2WorldCallbacks":"b2WorldCallbacks","./b2Particle":"b2Particle","./b2ParticleGroup":"b2ParticleGroup","./b2VoronoiDiagram":"b2VoronoiDiagram"}],b2Particle:[function(t,e,i){"use strict";cc._RF.push(e,"796c671RDFMI5JFCTukpdrC","b2Particle"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2ParticleHandle=i.b2CalculateParticleIterations=i.b2ParticleDef=i.b2ParticleFlag=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=t("../Common/b2Draw");(function(t){t[t.b2_waterParticle=0]="b2_waterParticle",t[t.b2_zombieParticle=2]="b2_zombieParticle",t[t.b2_wallParticle=4]="b2_wallParticle",t[t.b2_springParticle=8]="b2_springParticle",t[t.b2_elasticParticle=16]="b2_elasticParticle",t[t.b2_viscousParticle=32]="b2_viscousParticle",t[t.b2_powderParticle=64]="b2_powderParticle",t[t.b2_tensileParticle=128]="b2_tensileParticle",t[t.b2_colorMixingParticle=256]="b2_colorMixingParticle",t[t.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",t[t.b2_barrierParticle=1024]="b2_barrierParticle",t[t.b2_staticPressureParticle=2048]="b2_staticPressureParticle",t[t.b2_reactiveParticle=4096]="b2_reactiveParticle",t[t.b2_repulsiveParticle=8192]="b2_repulsiveParticle",t[t.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",t[t.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",t[t.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",t[t.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle"})(i.b2ParticleFlag||(i.b2ParticleFlag={}));i.b2ParticleDef=function(){this.flags=0,this.position=new n.b2Vec2,this.velocity=new n.b2Vec2,this.color=new r.b2Color(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null},i.b2CalculateParticleIterations=function(t,e,i){var o=Math.ceil(Math.sqrt(t/(.01*e))*i);return n.b2Clamp(o,1,8)};var s=function(){function t(){this.m_index=o.b2_invalidParticleIndex}return t.prototype.GetIndex=function(){return this.m_index},t.prototype.SetIndex=function(t){this.m_index=t},t}();i.b2ParticleHandle=s,cc._RF.pop()},{"../Common/b2Draw":"b2Draw","../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings"}],b2PolygonAndCircleContact:[function(t,e,i){"use strict";cc._RF.push(e,"61a90LRgAdASI05vL3AqHrj","b2PolygonAndCircleContact");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2PolygonAndCircleContact=void 0;var r=t("../../Collision/b2CollideCircle"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,i){r.b2CollidePolygonAndCircle(t,this.GetShapeA(),e,this.GetShapeB(),i)},e}(t("./b2Contact").b2Contact);i.b2PolygonAndCircleContact=s,cc._RF.pop()},{"../../Collision/b2CollideCircle":"b2CollideCircle","./b2Contact":"b2Contact"}],b2PolygonContact:[function(t,e,i){"use strict";cc._RF.push(e,"096a2PNCv1EOL4uAP1Z0kIm","b2PolygonContact");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2PolygonContact=void 0;var r=t("../../Collision/b2CollidePolygon"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,i){r.b2CollidePolygons(t,this.GetShapeA(),e,this.GetShapeB(),i)},e}(t("./b2Contact").b2Contact);i.b2PolygonContact=s,cc._RF.pop()},{"../../Collision/b2CollidePolygon":"b2CollidePolygon","./b2Contact":"b2Contact"}],b2PolygonShape:[function(t,e,i){"use strict";cc._RF.push(e,"8a377RvgzxBPbNek/NpPR2H","b2PolygonShape");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2PolygonShape=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Shape"),c=t("./b2Shape"),l=function(t){function e(){var e=t.call(this,c.b2ShapeType.e_polygonShape,r.b2_polygonRadius)||this;return e.m_centroid=new s.b2Vec2(0,0),e.m_vertices=[],e.m_normals=[],e.m_count=0,e}return n(e,t),e.prototype.Clone=function(){return(new e).Copy(this)},e.prototype.Copy=function(e){t.prototype.Copy.call(this,e),this.m_centroid.Copy(e.m_centroid),this.m_count=e.m_count,this.m_vertices=s.b2Vec2.MakeArray(this.m_count),this.m_normals=s.b2Vec2.MakeArray(this.m_count);for(var i=0;i<this.m_count;++i)this.m_vertices[i].Copy(e.m_vertices[i]),this.m_normals[i].Copy(e.m_normals[i]);return this},e.prototype.GetChildCount=function(){return 1},e.prototype.Set=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if("number"==typeof t[0][0]){var i=t[0];if(i.length%2!=0)throw new Error;return this._Set(function(t){return{x:i[2*t],y:i[2*t+1]}},i.length/2)}var o=t[0],n=t[1]||o.length;return this._Set(function(t){return o[t]},n)},e.prototype._Set=function(t,i){if(i<3)return this.SetAsBox(1,1);for(var o=i,n=[],a=0;a<o;++a){for(var c=t(a),l=!0,u=0;u<n.length;++u)if(s.b2Vec2.DistanceSquaredVV(c,n[u])<.25*r.b2_linearSlop*r.b2_linearSlop){l=!1;break}l&&n.push(c)}if((o=n.length)<3)return this.SetAsBox(1,1);var _=0,m=n[0].x;for(a=1;a<o;++a){var h=n[a].x;(h>m||h===m&&n[a].y<n[_].y)&&(_=a,m=h)}for(var p=[],f=0,b=_;;){p[f]=b;var d=0;for(u=1;u<o;++u)if(d!==b){var y=s.b2Vec2.SubVV(n[d],n[p[f]],e.Set_s_r),v=(c=s.b2Vec2.SubVV(n[u],n[p[f]],e.Set_s_v),s.b2Vec2.CrossVV(y,c));v<0&&(d=u),0===v&&c.LengthSquared()>y.LengthSquared()&&(d=u)}else d=u;if(++f,b=d,d===_)break}for(this.m_count=f,this.m_vertices=s.b2Vec2.MakeArray(this.m_count),this.m_normals=s.b2Vec2.MakeArray(this.m_count),a=0;a<f;++a)this.m_vertices[a].Copy(n[p[a]]);for(a=0;a<f;++a){var V=this.m_vertices[a],x=this.m_vertices[(a+1)%f],C=s.b2Vec2.SubVV(x,V,s.b2Vec2.s_t0);s.b2Vec2.CrossVOne(C,this.m_normals[a]).SelfNormalize()}return e.ComputeCentroid(this.m_vertices,f,this.m_centroid),this},e.prototype.SetAsBox=function(t,e,i,o){if(void 0===o&&(o=0),this.m_count=4,this.m_vertices=s.b2Vec2.MakeArray(this.m_count),this.m_normals=s.b2Vec2.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var n=new s.b2Transform;n.SetPosition(i),n.SetRotationAngle(o);for(var r=0;r<this.m_count;++r)s.b2Transform.MulXV(n,this.m_vertices[r],this.m_vertices[r]),s.b2Rot.MulRV(n.q,this.m_normals[r],this.m_normals[r])}return this},e.prototype.TestPoint=function(t,i){for(var o=s.b2Transform.MulTXV(t,i,e.TestPoint_s_pLocal),n=0;n<this.m_count;++n)if(s.b2Vec2.DotVV(this.m_normals[n],s.b2Vec2.SubVV(o,this.m_vertices[n],s.b2Vec2.s_t0))>0)return!1;return!0},e.prototype.ComputeDistance=function(t,i,o){for(var n=s.b2Transform.MulTXV(t,i,e.ComputeDistance_s_pLocal),a=-r.b2_maxFloat,c=e.ComputeDistance_s_normalForMaxDistance.Copy(n),l=0;l<this.m_count;++l){var u=s.b2Vec2.DotVV(this.m_normals[l],s.b2Vec2.SubVV(n,this.m_vertices[l],s.b2Vec2.s_t0));u>a&&(a=u,c.Copy(this.m_normals[l]))}if(a>0){var _=e.ComputeDistance_s_minDistance.Copy(c),m=a*a;for(l=0;l<this.m_count;++l){var h=s.b2Vec2.SubVV(n,this.m_vertices[l],e.ComputeDistance_s_distance),p=h.LengthSquared();m>p&&(_.Copy(h),m=p)}return s.b2Rot.MulRV(t.q,_,o),o.Normalize(),Math.sqrt(m)}return s.b2Rot.MulRV(t.q,c,o),a},e.prototype.RayCast=function(t,i,o){for(var n=s.b2Transform.MulTXV(o,i.p1,e.RayCast_s_p1),r=s.b2Transform.MulTXV(o,i.p2,e.RayCast_s_p2),a=s.b2Vec2.SubVV(r,n,e.RayCast_s_d),c=0,l=i.maxFraction,u=-1,_=0;_<this.m_count;++_){var m=s.b2Vec2.DotVV(this.m_normals[_],s.b2Vec2.SubVV(this.m_vertices[_],n,s.b2Vec2.s_t0)),h=s.b2Vec2.DotVV(this.m_normals[_],a);if(0===h){if(m<0)return!1}else h<0&&m<c*h?(c=m/h,u=_):h>0&&m<l*h&&(l=m/h);if(l<c)return!1}return u>=0&&(t.fraction=c,s.b2Rot.MulRV(o.q,this.m_normals[u],t.normal),!0)},e.prototype.ComputeAABB=function(t,i){for(var o=s.b2Transform.MulXV(i,this.m_vertices[0],t.lowerBound),n=t.upperBound.Copy(o),r=0;r<this.m_count;++r){var a=s.b2Transform.MulXV(i,this.m_vertices[r],e.ComputeAABB_s_v);s.b2Vec2.MinV(a,o,o),s.b2Vec2.MaxV(a,n,n)}var c=this.m_radius;o.SelfSubXY(c,c),n.SelfAddXY(c,c)},e.prototype.ComputeMass=function(t,i){for(var o=e.ComputeMass_s_center.SetZero(),n=0,r=0,a=e.ComputeMass_s_s.SetZero(),c=0;c<this.m_count;++c)a.SelfAdd(this.m_vertices[c]);for(a.SelfMul(1/this.m_count),c=0;c<this.m_count;++c){var l=s.b2Vec2.SubVV(this.m_vertices[c],a,e.ComputeMass_s_e1),u=s.b2Vec2.SubVV(this.m_vertices[(c+1)%this.m_count],a,e.ComputeMass_s_e2),_=s.b2Vec2.CrossVV(l,u),m=.5*_;n+=m,o.SelfAdd(s.b2Vec2.MulSV(m*(1/3),s.b2Vec2.AddVV(l,u,s.b2Vec2.s_t0),s.b2Vec2.s_t1));var h=l.x,p=l.y,f=u.x,b=u.y;r+=1/3*.25*_*(h*h+f*h+f*f+p*p+b*p+b*b)}t.mass=i*n,o.SelfMul(1/n),s.b2Vec2.AddVV(o,a,t.center),t.I=i*r,t.I+=t.mass*(s.b2Vec2.DotVV(t.center,t.center)-s.b2Vec2.DotVV(o,o))},e.prototype.Validate=function(){for(var t=0;t<this.m_count;++t)for(var i=t,o=(t+1)%this.m_count,n=this.m_vertices[i],r=s.b2Vec2.SubVV(this.m_vertices[o],n,e.Validate_s_e),a=0;a<this.m_count;++a)if(a!==i&&a!==o){var c=s.b2Vec2.SubVV(this.m_vertices[a],n,e.Validate_s_v);if(s.b2Vec2.CrossVV(r,c)<0)return!1}return!0},e.prototype.SetupDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},e.prototype.ComputeSubmergedArea=function(t,i,o,n){for(var a=s.b2Rot.MulTRV(o.q,t,e.ComputeSubmergedArea_s_normalL),c=i-s.b2Vec2.DotVV(t,o.p),l=[],u=0,_=-1,m=-1,h=!1,p=0;p<this.m_count;++p){l[p]=s.b2Vec2.DotVV(a,this.m_vertices[p])-c;var f=l[p]<-r.b2_epsilon;p>0&&(f?h||(_=p-1,u++):h&&(m=p-1,u++)),h=f}switch(u){case 0:if(h){var b=e.ComputeSubmergedArea_s_md;return this.ComputeMass(b,1),s.b2Transform.MulXV(o,b.center,n),b.mass}return 0;case 1:-1===_?_=this.m_count-1:m=this.m_count-1}for(var d,y=(_+1)%this.m_count,v=(m+1)%this.m_count,V=(0-l[_])/(l[y]-l[_]),x=(0-l[m])/(l[v]-l[m]),C=e.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[_].x*(1-V)+this.m_vertices[y].x*V,this.m_vertices[_].y*(1-V)+this.m_vertices[y].y*V),S=e.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[m].x*(1-x)+this.m_vertices[v].x*x,this.m_vertices[m].y*(1-x)+this.m_vertices[v].y*x),B=0,g=e.ComputeSubmergedArea_s_center.SetZero(),A=this.m_vertices[y],w=y;w!==v;){d=(w=(w+1)%this.m_count)===v?S:this.m_vertices[w];var M=.5*((A.x-C.x)*(d.y-C.y)-(A.y-C.y)*(d.x-C.x));B+=M,g.x+=M*(C.x+A.x+d.x)/3,g.y+=M*(C.y+A.y+d.y)/3,A=d}return g.SelfMul(1/B),s.b2Transform.MulXV(o,g,n),B},e.prototype.Dump=function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)},e.ComputeCentroid=function(t,i,o){var n=o;n.SetZero();for(var r=0,a=e.ComputeCentroid_s_pRef.SetZero(),c=0;c<i;++c){var l=a,u=t[c],_=t[(c+1)%i],m=s.b2Vec2.SubVV(u,l,e.ComputeCentroid_s_e1),h=s.b2Vec2.SubVV(_,l,e.ComputeCentroid_s_e2),p=.5*s.b2Vec2.CrossVV(m,h);r+=p,n.x+=p*(1/3)*(l.x+u.x+_.x),n.y+=p*(1/3)*(l.y+u.y+_.y)}return n.SelfMul(1/r),n},e.Set_s_r=new s.b2Vec2,e.Set_s_v=new s.b2Vec2,e.TestPoint_s_pLocal=new s.b2Vec2,e.ComputeDistance_s_pLocal=new s.b2Vec2,e.ComputeDistance_s_normalForMaxDistance=new s.b2Vec2,e.ComputeDistance_s_minDistance=new s.b2Vec2,e.ComputeDistance_s_distance=new s.b2Vec2,e.RayCast_s_p1=new s.b2Vec2,e.RayCast_s_p2=new s.b2Vec2,e.RayCast_s_d=new s.b2Vec2,e.ComputeAABB_s_v=new s.b2Vec2,e.ComputeMass_s_center=new s.b2Vec2,e.ComputeMass_s_s=new s.b2Vec2,e.ComputeMass_s_e1=new s.b2Vec2,e.ComputeMass_s_e2=new s.b2Vec2,e.Validate_s_e=new s.b2Vec2,e.Validate_s_v=new s.b2Vec2,e.ComputeSubmergedArea_s_normalL=new s.b2Vec2,e.ComputeSubmergedArea_s_md=new a.b2MassData,e.ComputeSubmergedArea_s_intoVec=new s.b2Vec2,e.ComputeSubmergedArea_s_outoVec=new s.b2Vec2,e.ComputeSubmergedArea_s_center=new s.b2Vec2,e.ComputeCentroid_s_pRef=new s.b2Vec2,e.ComputeCentroid_s_e1=new s.b2Vec2,e.ComputeCentroid_s_e2=new s.b2Vec2,e}(c.b2Shape);i.b2PolygonShape=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Shape":"b2Shape"}],b2PrismaticJoint:[function(t,e,i){"use strict";cc._RF.push(e,"f184cy1oqhMy5e5xSfAq7ga","b2PrismaticJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2PrismaticJoint=i.b2PrismaticJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_prismaticJoint)||this;return e.localAnchorA=new s.b2Vec2,e.localAnchorB=new s.b2Vec2,e.localAxisA=new s.b2Vec2(1,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerTranslation=0,e.upperTranslation=0,e.enableMotor=!1,e.maxMotorForce=0,e.motorSpeed=0,e}return n(e,t),e.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(o,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},e}(a.b2JointDef);i.b2PrismaticJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_localAnchorA=new s.b2Vec2,i.m_localAnchorB=new s.b2Vec2,i.m_localXAxisA=new s.b2Vec2,i.m_localYAxisA=new s.b2Vec2,i.m_referenceAngle=0,i.m_impulse=new s.b2Vec3(0,0,0),i.m_motorImpulse=0,i.m_lowerTranslation=0,i.m_upperTranslation=0,i.m_maxMotorForce=0,i.m_motorSpeed=0,i.m_enableLimit=!1,i.m_enableMotor=!1,i.m_limitState=a.b2LimitState.e_inactiveLimit,i.m_indexA=0,i.m_indexB=0,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_axis=new s.b2Vec2(0,0),i.m_perp=new s.b2Vec2(0,0),i.m_s1=0,i.m_s2=0,i.m_a1=0,i.m_a2=0,i.m_K=new s.b2Mat33,i.m_K3=new s.b2Mat33,i.m_K2=new s.b2Mat22,i.m_motorMass=0,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_lalcA=new s.b2Vec2,i.m_lalcB=new s.b2Vec2,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_localAnchorA.Copy(r.b2Maybe(e.localAnchorA,s.b2Vec2.ZERO)),i.m_localAnchorB.Copy(r.b2Maybe(e.localAnchorB,s.b2Vec2.ZERO)),i.m_localXAxisA.Copy(r.b2Maybe(e.localAxisA,new s.b2Vec2(1,0))).SelfNormalize(),s.b2Vec2.CrossOneV(i.m_localXAxisA,i.m_localYAxisA),i.m_referenceAngle=r.b2Maybe(e.referenceAngle,0),i.m_lowerTranslation=r.b2Maybe(e.lowerTranslation,0),i.m_upperTranslation=r.b2Maybe(e.upperTranslation,0),i.m_maxMotorForce=r.b2Maybe(e.maxMotorForce,0),i.m_motorSpeed=r.b2Maybe(e.motorSpeed,0),i.m_enableLimit=r.b2Maybe(e.enableLimit,!1),i.m_enableMotor=r.b2Maybe(e.enableMotor,!1),i}return n(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,c=t.velocities[this.m_indexA].w,l=t.positions[this.m_indexB].c,u=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(o),p=this.m_qB.SetAngle(u);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var f=s.b2Rot.MulRV(h,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var b=s.b2Rot.MulRV(p,this.m_lalcB,this.m_rB),d=s.b2Vec2.AddVV(s.b2Vec2.SubVV(l,i,s.b2Vec2.s_t0),s.b2Vec2.SubVV(b,f,s.b2Vec2.s_t1),e.InitVelocityConstraints_s_d),y=this.m_invMassA,v=this.m_invMassB,V=this.m_invIA,x=this.m_invIB;if(s.b2Rot.MulRV(h,this.m_localXAxisA,this.m_axis),this.m_a1=s.b2Vec2.CrossVV(s.b2Vec2.AddVV(d,f,s.b2Vec2.s_t0),this.m_axis),this.m_a2=s.b2Vec2.CrossVV(b,this.m_axis),this.m_motorMass=y+v+V*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),s.b2Rot.MulRV(h,this.m_localYAxisA,this.m_perp),this.m_s1=s.b2Vec2.CrossVV(s.b2Vec2.AddVV(d,f,s.b2Vec2.s_t0),this.m_perp),this.m_s2=s.b2Vec2.CrossVV(b,this.m_perp),this.m_K.ex.x=y+v+V*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.ex.y=V*this.m_s1+x*this.m_s2,this.m_K.ex.z=V*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=V+x,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=V*this.m_a1+x*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=y+v+V*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_enableLimit){var C=s.b2Vec2.DotVV(this.m_axis,d);s.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?this.m_limitState=a.b2LimitState.e_equalLimits:C<=this.m_lowerTranslation?this.m_limitState!==a.b2LimitState.e_atLowerLimit&&(this.m_limitState=a.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):C>=this.m_upperTranslation?this.m_limitState!==a.b2LimitState.e_atUpperLimit&&(this.m_limitState=a.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=a.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=a.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var S=s.b2Vec2.AddVV(s.b2Vec2.MulSV(this.m_impulse.x,this.m_perp,s.b2Vec2.s_t0),s.b2Vec2.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,s.b2Vec2.s_t1),e.InitVelocityConstraints_s_P),B=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,g=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.SelfMulSub(y,S),c-=V*B,_.SelfMulAdd(v,S),m+=x*g}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=m},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,c=this.m_invMassA,l=this.m_invMassB,u=this.m_invIA,_=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==a.b2LimitState.e_equalLimits){var m=s.b2Vec2.DotVV(this.m_axis,s.b2Vec2.SubVV(n,i,s.b2Vec2.s_t0))+this.m_a2*r-this.m_a1*o,h=this.m_motorMass*(this.m_motorSpeed-m),p=this.m_motorImpulse,f=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=s.b2Clamp(this.m_motorImpulse+h,-f,f),h=this.m_motorImpulse-p;var b=s.b2Vec2.MulSV(h,this.m_axis,e.SolveVelocityConstraints_s_P),d=h*this.m_a1,y=h*this.m_a2;i.SelfMulSub(c,b),o-=u*d,n.SelfMulAdd(l,b),r+=_*y}var v=s.b2Vec2.DotVV(this.m_perp,s.b2Vec2.SubVV(n,i,s.b2Vec2.s_t0))+this.m_s2*r-this.m_s1*o,V=r-o;if(this.m_enableLimit&&this.m_limitState!==a.b2LimitState.e_inactiveLimit){var x=s.b2Vec2.DotVV(this.m_axis,s.b2Vec2.SubVV(n,i,s.b2Vec2.s_t0))+this.m_a2*r-this.m_a1*o,C=e.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),S=this.m_K.Solve33(-v,-V,-x,e.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(S),this.m_limitState===a.b2LimitState.e_atLowerLimit?this.m_impulse.z=s.b2Max(this.m_impulse.z,0):this.m_limitState===a.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=s.b2Min(this.m_impulse.z,0));var B=-v-(this.m_impulse.z-C.z)*this.m_K.ez.x,g=-V-(this.m_impulse.z-C.z)*this.m_K.ez.y,A=this.m_K.Solve22(B,g,e.SolveVelocityConstraints_s_f2r);A.x+=C.x,A.y+=C.y,this.m_impulse.x=A.x,this.m_impulse.y=A.y,S.x=this.m_impulse.x-C.x,S.y=this.m_impulse.y-C.y,S.z=this.m_impulse.z-C.z,b=s.b2Vec2.AddVV(s.b2Vec2.MulSV(S.x,this.m_perp,s.b2Vec2.s_t0),s.b2Vec2.MulSV(S.z,this.m_axis,s.b2Vec2.s_t1),e.SolveVelocityConstraints_s_P),d=S.x*this.m_s1+S.y+S.z*this.m_a1,y=S.x*this.m_s2+S.y+S.z*this.m_a2,i.SelfMulSub(c,b),o-=u*d,n.SelfMulAdd(l,b),r+=_*y}else{var w=this.m_K.Solve22(-v,-V,e.SolveVelocityConstraints_s_df2);this.m_impulse.x+=w.x,this.m_impulse.y+=w.y,b=s.b2Vec2.MulSV(w.x,this.m_perp,e.SolveVelocityConstraints_s_P),d=w.x*this.m_s1+w.y,y=w.x*this.m_s2+w.y,i.SelfMulSub(c,b),o-=u*d,n.SelfMulAdd(l,b),r+=_*y}t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,c=this.m_qA.SetAngle(o),l=this.m_qB.SetAngle(a),u=this.m_invMassA,_=this.m_invMassB,m=this.m_invIA,h=this.m_invIB,p=s.b2Rot.MulRV(c,this.m_lalcA,this.m_rA),f=s.b2Rot.MulRV(l,this.m_lalcB,this.m_rB),b=s.b2Vec2.SubVV(s.b2Vec2.AddVV(n,f,s.b2Vec2.s_t0),s.b2Vec2.AddVV(i,p,s.b2Vec2.s_t1),e.SolvePositionConstraints_s_d),d=s.b2Rot.MulRV(c,this.m_localXAxisA,this.m_axis),y=s.b2Vec2.CrossVV(s.b2Vec2.AddVV(b,p,s.b2Vec2.s_t0),d),v=s.b2Vec2.CrossVV(f,d),V=s.b2Rot.MulRV(c,this.m_localYAxisA,this.m_perp),x=s.b2Vec2.CrossVV(s.b2Vec2.AddVV(b,p,s.b2Vec2.s_t0),V),C=s.b2Vec2.CrossVV(f,V),S=e.SolvePositionConstraints_s_impulse,B=s.b2Vec2.DotVV(V,b),g=a-o-this.m_referenceAngle,A=s.b2Abs(B),w=s.b2Abs(g),M=!1,P=0;if(this.m_enableLimit){var D=s.b2Vec2.DotVV(d,b);s.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?(P=s.b2Clamp(D,-r.b2_maxLinearCorrection,r.b2_maxLinearCorrection),A=s.b2Max(A,s.b2Abs(D)),M=!0):D<=this.m_lowerTranslation?(P=s.b2Clamp(D-this.m_lowerTranslation+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),A=s.b2Max(A,this.m_lowerTranslation-D),M=!0):D>=this.m_upperTranslation&&(P=s.b2Clamp(D-this.m_upperTranslation-r.b2_linearSlop,0,r.b2_maxLinearCorrection),A=s.b2Max(A,D-this.m_upperTranslation),M=!0)}if(M){var R=u+_+m*x*x+h*C*C,F=m*x+h*C,G=m*x*y+h*C*v;0===(E=m+h)&&(E=1);var I=m*y+h*v,T=u+_+m*y*y+h*v*v,L=this.m_K3;L.ex.SetXYZ(R,F,G),L.ey.SetXYZ(F,E,I),L.ez.SetXYZ(G,I,T),S=L.Solve33(-B,-g,-P,S)}else{var E;R=u+_+m*x*x+h*C*C,F=m*x+h*C,0===(E=m+h)&&(E=1);var J=this.m_K2;J.ex.Set(R,F),J.ey.Set(F,E);var O=J.Solve(-B,-g,e.SolvePositionConstraints_s_impulse1);S.x=O.x,S.y=O.y,S.z=0}var k=s.b2Vec2.AddVV(s.b2Vec2.MulSV(S.x,V,s.b2Vec2.s_t0),s.b2Vec2.MulSV(S.z,d,s.b2Vec2.s_t1),e.SolvePositionConstraints_s_P),j=S.x*x+S.y+S.z*y,q=S.x*C+S.y+S.z*v;return i.SelfMulSub(u,k),o-=m*j,n.SelfMulAdd(_,k),a+=h*q,t.positions[this.m_indexA].a=o,t.positions[this.m_indexB].a=a,A<=r.b2_linearSlop&&w<=r.b2_angularSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e},e.prototype.GetReactionTorque=function(t){return t*this.m_impulse.y},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},e.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.prototype.GetJointTranslation=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetJointTranslation_s_pA),i=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetJointTranslation_s_pB),o=s.b2Vec2.SubVV(i,t,e.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,e.GetJointTranslation_s_axis);return s.b2Vec2.DotVV(o,n)},e.prototype.GetJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB;s.b2Vec2.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=s.b2Rot.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var o=s.b2Rot.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=s.b2Vec2.AddVV(t.m_sweep.c,i,s.b2Vec2.s_t0),r=s.b2Vec2.AddVV(e.m_sweep.c,o,s.b2Vec2.s_t1),a=s.b2Vec2.SubVV(r,n,s.b2Vec2.s_t2),c=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,u=e.m_linearVelocity,_=t.m_angularVelocity,m=e.m_angularVelocity;return s.b2Vec2.DotVV(a,s.b2Vec2.CrossSV(_,c,s.b2Vec2.s_t0))+s.b2Vec2.DotVV(c,s.b2Vec2.SubVV(s.b2Vec2.AddVCrossSV(u,m,o,s.b2Vec2.s_t0),s.b2Vec2.AddVCrossSV(l,_,i,s.b2Vec2.s_t1),s.b2Vec2.s_t0))},e.prototype.IsLimitEnabled=function(){return this.m_enableLimit},e.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},e.prototype.GetUpperLimit=function(){return this.m_upperTranslation},e.prototype.SetLimits=function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},e.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},e.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},e.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.prototype.SetMaxMotorForce=function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)},e.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},e.prototype.GetMotorForce=function(t){return t*this.m_motorImpulse},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.InitVelocityConstraints_s_d=new s.b2Vec2,e.InitVelocityConstraints_s_P=new s.b2Vec2,e.SolveVelocityConstraints_s_P=new s.b2Vec2,e.SolveVelocityConstraints_s_f2r=new s.b2Vec2,e.SolveVelocityConstraints_s_f1=new s.b2Vec3,e.SolveVelocityConstraints_s_df3=new s.b2Vec3,e.SolveVelocityConstraints_s_df2=new s.b2Vec2,e.SolvePositionConstraints_s_d=new s.b2Vec2,e.SolvePositionConstraints_s_impulse=new s.b2Vec3,e.SolvePositionConstraints_s_impulse1=new s.b2Vec2,e.SolvePositionConstraints_s_P=new s.b2Vec2,e.GetJointTranslation_s_pA=new s.b2Vec2,e.GetJointTranslation_s_pB=new s.b2Vec2,e.GetJointTranslation_s_d=new s.b2Vec2,e.GetJointTranslation_s_axis=new s.b2Vec2,e}(a.b2Joint);i.b2PrismaticJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2PulleyJoint:[function(t,e,i){"use strict";cc._RF.push(e,"ac2e32W10pLbIf36sTvXvI3","b2PulleyJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2PulleyJoint=i.b2PulleyJointDef=i.b2_minPulleyLength=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint");i.b2_minPulleyLength=2;var c=function(t){function e(){var e=t.call(this,a.b2JointType.e_pulleyJoint)||this;return e.groundAnchorA=new s.b2Vec2(-1,1),e.groundAnchorB=new s.b2Vec2(1,1),e.localAnchorA=new s.b2Vec2(-1,0),e.localAnchorB=new s.b2Vec2(1,0),e.lengthA=0,e.lengthB=0,e.ratio=1,e.collideConnected=!0,e}return n(e,t),e.prototype.Initialize=function(t,e,i,o,n,r,a){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(o),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.lengthA=s.b2Vec2.DistanceVV(n,i),this.lengthB=s.b2Vec2.DistanceVV(r,o),this.ratio=a},e}(a.b2JointDef);i.b2PulleyJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_groundAnchorA=new s.b2Vec2,i.m_groundAnchorB=new s.b2Vec2,i.m_lengthA=0,i.m_lengthB=0,i.m_localAnchorA=new s.b2Vec2,i.m_localAnchorB=new s.b2Vec2,i.m_constant=0,i.m_ratio=0,i.m_impulse=0,i.m_indexA=0,i.m_indexB=0,i.m_uA=new s.b2Vec2,i.m_uB=new s.b2Vec2,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=0,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_lalcA=new s.b2Vec2,i.m_lalcB=new s.b2Vec2,i.m_groundAnchorA.Copy(r.b2Maybe(e.groundAnchorA,new s.b2Vec2(-1,1))),i.m_groundAnchorB.Copy(r.b2Maybe(e.groundAnchorB,new s.b2Vec2(1,0))),i.m_localAnchorA.Copy(r.b2Maybe(e.localAnchorA,new s.b2Vec2(-1,0))),i.m_localAnchorB.Copy(r.b2Maybe(e.localAnchorB,new s.b2Vec2(1,0))),i.m_lengthA=r.b2Maybe(e.lengthA,0),i.m_lengthB=r.b2Maybe(e.lengthB,0),i.m_ratio=r.b2Maybe(e.ratio,1),i.m_constant=r.b2Maybe(e.lengthA,0)+i.m_ratio*r.b2Maybe(e.lengthB,0),i.m_impulse=0,i}return n(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,c=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,_=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(o),h=this.m_qB.SetAngle(l);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.b2Rot.MulRV(m,this.m_lalcA,this.m_rA),s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.b2Rot.MulRV(h,this.m_lalcB,this.m_rB),this.m_uA.Copy(i).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(c).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var p=this.m_uA.Length(),f=this.m_uB.Length();p>10*r.b2_linearSlop?this.m_uA.SelfMul(1/p):this.m_uA.SetZero(),f>10*r.b2_linearSlop?this.m_uB.SelfMul(1/f):this.m_uB.SetZero();var b=s.b2Vec2.CrossVV(this.m_rA,this.m_uA),d=s.b2Vec2.CrossVV(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*b*b,v=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=y+this.m_ratio*this.m_ratio*v,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var V=s.b2Vec2.MulSV(-this.m_impulse,this.m_uA,e.InitVelocityConstraints_s_PA),x=s.b2Vec2.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,e.InitVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,V),a+=this.m_invIA*s.b2Vec2.CrossVV(this.m_rA,V),u.SelfMulAdd(this.m_invMassB,x),_+=this.m_invIB*s.b2Vec2.CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=_},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=s.b2Vec2.AddVCrossSV(i,o,this.m_rA,e.SolveVelocityConstraints_s_vpA),c=s.b2Vec2.AddVCrossSV(n,r,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=-s.b2Vec2.DotVV(this.m_uA,a)-this.m_ratio*s.b2Vec2.DotVV(this.m_uB,c),u=-this.m_mass*l;this.m_impulse+=u;var _=s.b2Vec2.MulSV(-u,this.m_uA,e.SolveVelocityConstraints_s_PA),m=s.b2Vec2.MulSV(-this.m_ratio*u,this.m_uB,e.SolveVelocityConstraints_s_PB);i.SelfMulAdd(this.m_invMassA,_),o+=this.m_invIA*s.b2Vec2.CrossVV(this.m_rA,_),n.SelfMulAdd(this.m_invMassB,m),r+=this.m_invIB*s.b2Vec2.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,c=this.m_qA.SetAngle(o),l=this.m_qB.SetAngle(a);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=s.b2Rot.MulRV(c,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var _=s.b2Rot.MulRV(l,this.m_lalcB,this.m_rB),m=this.m_uA.Copy(i).SelfAdd(u).SelfSub(this.m_groundAnchorA),h=this.m_uB.Copy(n).SelfAdd(_).SelfSub(this.m_groundAnchorB),p=m.Length(),f=h.Length();p>10*r.b2_linearSlop?m.SelfMul(1/p):m.SetZero(),f>10*r.b2_linearSlop?h.SelfMul(1/f):h.SetZero();var b=s.b2Vec2.CrossVV(u,m),d=s.b2Vec2.CrossVV(_,h),y=this.m_invMassA+this.m_invIA*b*b,v=this.m_invMassB+this.m_invIB*d*d,V=y+this.m_ratio*this.m_ratio*v;V>0&&(V=1/V);var x=this.m_constant-p-this.m_ratio*f,C=s.b2Abs(x),S=-V*x,B=s.b2Vec2.MulSV(-S,m,e.SolvePositionConstraints_s_PA),g=s.b2Vec2.MulSV(-this.m_ratio*S,h,e.SolvePositionConstraints_s_PB);return i.SelfMulAdd(this.m_invMassA,B),o+=this.m_invIA*s.b2Vec2.CrossVV(u,B),n.SelfMulAdd(this.m_invMassB,g),a+=this.m_invIB*s.b2Vec2.CrossVV(_,g),t.positions[this.m_indexA].a=o,t.positions[this.m_indexB].a=a,C<r.b2_linearSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e},e.prototype.GetReactionTorque=function(){return 0},e.prototype.GetGroundAnchorA=function(){return this.m_groundAnchorA},e.prototype.GetGroundAnchorB=function(){return this.m_groundAnchorB},e.prototype.GetLengthA=function(){return this.m_lengthA},e.prototype.GetLengthB=function(){return this.m_lengthB},e.prototype.GetRatio=function(){return this.m_ratio},e.prototype.GetCurrentLengthA=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetCurrentLengthA_s_p),i=this.m_groundAnchorA;return s.b2Vec2.DistanceVV(t,i)},e.prototype.GetCurrentLengthB=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetCurrentLengthB_s_p),i=this.m_groundAnchorB;return s.b2Vec2.DistanceVV(t,i)},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.prototype.ShiftOrigin=function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)},e.InitVelocityConstraints_s_PA=new s.b2Vec2,e.InitVelocityConstraints_s_PB=new s.b2Vec2,e.SolveVelocityConstraints_s_vpA=new s.b2Vec2,e.SolveVelocityConstraints_s_vpB=new s.b2Vec2,e.SolveVelocityConstraints_s_PA=new s.b2Vec2,e.SolveVelocityConstraints_s_PB=new s.b2Vec2,e.SolvePositionConstraints_s_PA=new s.b2Vec2,e.SolvePositionConstraints_s_PB=new s.b2Vec2,e.GetCurrentLengthA_s_p=new s.b2Vec2,e.GetCurrentLengthB_s_p=new s.b2Vec2,e}(a.b2Joint);i.b2PulleyJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2RevoluteJoint:[function(t,e,i){"use strict";cc._RF.push(e,"007f55pKWJDLZOcW8HpIsra","b2RevoluteJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2RevoluteJoint=i.b2RevoluteJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_revoluteJoint)||this;return e.localAnchorA=new s.b2Vec2(0,0),e.localAnchorB=new s.b2Vec2(0,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerAngle=0,e.upperAngle=0,e.enableMotor=!1,e.motorSpeed=0,e.maxMotorTorque=0,e}return n(e,t),e.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},e}(a.b2JointDef);i.b2RevoluteJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_localAnchorA=new s.b2Vec2,i.m_localAnchorB=new s.b2Vec2,i.m_impulse=new s.b2Vec3,i.m_motorImpulse=0,i.m_enableMotor=!1,i.m_maxMotorTorque=0,i.m_motorSpeed=0,i.m_enableLimit=!1,i.m_referenceAngle=0,i.m_lowerAngle=0,i.m_upperAngle=0,i.m_indexA=0,i.m_indexB=0,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=new s.b2Mat33,i.m_motorMass=0,i.m_limitState=a.b2LimitState.e_inactiveLimit,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_lalcA=new s.b2Vec2,i.m_lalcB=new s.b2Vec2,i.m_K=new s.b2Mat22,i.m_localAnchorA.Copy(r.b2Maybe(e.localAnchorA,s.b2Vec2.ZERO)),i.m_localAnchorB.Copy(r.b2Maybe(e.localAnchorB,s.b2Vec2.ZERO)),i.m_referenceAngle=r.b2Maybe(e.referenceAngle,0),i.m_impulse.SetZero(),i.m_motorImpulse=0,i.m_lowerAngle=r.b2Maybe(e.lowerAngle,0),i.m_upperAngle=r.b2Maybe(e.upperAngle,0),i.m_maxMotorTorque=r.b2Maybe(e.maxMotorTorque,0),i.m_motorSpeed=r.b2Maybe(e.motorSpeed,0),i.m_enableLimit=r.b2Maybe(e.enableLimit,!1),i.m_enableMotor=r.b2Maybe(e.enableMotor,!1),i.m_limitState=a.b2LimitState.e_inactiveLimit,i}return n(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,o=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,c=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,_=this.m_qA.SetAngle(i),m=this.m_qB.SetAngle(c);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.b2Rot.MulRV(_,this.m_lalcA,this.m_rA),s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.b2Rot.MulRV(m,this.m_lalcB,this.m_rB);var h=this.m_invMassA,p=this.m_invMassB,f=this.m_invIA,b=this.m_invIB,d=f+b===0;if(this.m_mass.ex.x=h+p+this.m_rA.y*this.m_rA.y*f+this.m_rB.y*this.m_rB.y*b,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*f-this.m_rB.y*this.m_rB.x*b,this.m_mass.ez.x=-this.m_rA.y*f-this.m_rB.y*b,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=h+p+this.m_rA.x*this.m_rA.x*f+this.m_rB.x*this.m_rB.x*b,this.m_mass.ez.y=this.m_rA.x*f+this.m_rB.x*b,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=f+b,this.m_motorMass=f+b,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!d||(this.m_motorImpulse=0),this.m_enableLimit&&!d){var y=c-i-this.m_referenceAngle;s.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*r.b2_angularSlop?this.m_limitState=a.b2LimitState.e_equalLimits:y<=this.m_lowerAngle?(this.m_limitState!==a.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=a.b2LimitState.e_atLowerLimit):y>=this.m_upperAngle?(this.m_limitState!==a.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=a.b2LimitState.e_atUpperLimit):(this.m_limitState=a.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=a.b2LimitState.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var v=e.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);o.SelfMulSub(h,v),n-=f*(s.b2Vec2.CrossVV(this.m_rA,v)+this.m_motorImpulse+this.m_impulse.z),l.SelfMulAdd(p,v),u+=b*(s.b2Vec2.CrossVV(this.m_rB,v)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=u},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,c=this.m_invMassA,l=this.m_invMassB,u=this.m_invIA,_=this.m_invIB,m=u+_===0;if(this.m_enableMotor&&this.m_limitState!==a.b2LimitState.e_equalLimits&&!m){var h=r-o-this.m_motorSpeed,p=-this.m_motorMass*h,f=this.m_motorImpulse,b=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=s.b2Clamp(this.m_motorImpulse+p,-b,b),o-=u*(p=this.m_motorImpulse-f),r+=_*p}if(this.m_enableLimit&&this.m_limitState!==a.b2LimitState.e_inactiveLimit&&!m){var d=s.b2Vec2.SubVV(s.b2Vec2.AddVCrossSV(n,r,this.m_rB,s.b2Vec2.s_t0),s.b2Vec2.AddVCrossSV(i,o,this.m_rA,s.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot1),y=r-o,v=this.m_mass.Solve33(d.x,d.y,y,e.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===a.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(v);else if(this.m_limitState===a.b2LimitState.e_atLowerLimit)if(this.m_impulse.z+v.z<0){var V=-d.x+this.m_impulse.z*this.m_mass.ez.x,x=-d.y+this.m_impulse.z*this.m_mass.ez.y,C=this.m_mass.Solve22(V,x,e.SolveVelocityConstraints_s_reduced_v2);v.x=C.x,v.y=C.y,v.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(v);else this.m_limitState===a.b2LimitState.e_atUpperLimit&&(this.m_impulse.z+v.z>0?(V=-d.x+this.m_impulse.z*this.m_mass.ez.x,x=-d.y+this.m_impulse.z*this.m_mass.ez.y,C=this.m_mass.Solve22(V,x,e.SolveVelocityConstraints_s_reduced_v2),v.x=C.x,v.y=C.y,v.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(v));var S=e.SolveVelocityConstraints_s_P.Set(v.x,v.y);i.SelfMulSub(c,S),o-=u*(s.b2Vec2.CrossVV(this.m_rA,S)+v.z),n.SelfMulAdd(l,S),r+=_*(s.b2Vec2.CrossVV(this.m_rB,S)+v.z)}else{var B=s.b2Vec2.SubVV(s.b2Vec2.AddVCrossSV(n,r,this.m_rB,s.b2Vec2.s_t0),s.b2Vec2.AddVCrossSV(i,o,this.m_rA,s.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),g=this.m_mass.Solve22(-B.x,-B.y,e.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,i.SelfMulSub(c,g),o-=u*s.b2Vec2.CrossVV(this.m_rA,g),n.SelfMulAdd(l,g),r+=_*s.b2Vec2.CrossVV(this.m_rB,g)}t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){var i,o=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,c=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,u=this.m_qA.SetAngle(n),_=this.m_qB.SetAngle(l),m=0,h=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==a.b2LimitState.e_inactiveLimit&&!h){var p=l-n-this.m_referenceAngle,f=0;if(this.m_limitState===a.b2LimitState.e_equalLimits){var b=s.b2Clamp(p-this.m_lowerAngle,-r.b2_maxAngularCorrection,r.b2_maxAngularCorrection);f=-this.m_motorMass*b,m=s.b2Abs(b)}else this.m_limitState===a.b2LimitState.e_atLowerLimit?(m=-(b=p-this.m_lowerAngle),b=s.b2Clamp(b+r.b2_angularSlop,-r.b2_maxAngularCorrection,0),f=-this.m_motorMass*b):this.m_limitState===a.b2LimitState.e_atUpperLimit&&(m=b=p-this.m_upperAngle,b=s.b2Clamp(b-r.b2_angularSlop,0,r.b2_maxAngularCorrection),f=-this.m_motorMass*b);n-=this.m_invIA*f,l+=this.m_invIB*f}u.SetAngle(n),_.SetAngle(l),s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var d=s.b2Rot.MulRV(u,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y=s.b2Rot.MulRV(_,this.m_lalcB,this.m_rB),v=s.b2Vec2.SubVV(s.b2Vec2.AddVV(c,y,s.b2Vec2.s_t0),s.b2Vec2.AddVV(o,d,s.b2Vec2.s_t1),e.SolvePositionConstraints_s_C_v2);i=v.Length();var V=this.m_invMassA,x=this.m_invMassB,C=this.m_invIA,S=this.m_invIB,B=this.m_K;B.ex.x=V+x+C*d.y*d.y+S*y.y*y.y,B.ex.y=-C*d.x*d.y-S*y.x*y.y,B.ey.x=B.ex.y,B.ey.y=V+x+C*d.x*d.x+S*y.x*y.x;var g=B.Solve(v.x,v.y,e.SolvePositionConstraints_s_impulse).SelfNeg();return o.SelfMulSub(V,g),n-=C*s.b2Vec2.CrossVV(d,g),c.SelfMulAdd(x,g),l+=S*s.b2Vec2.CrossVV(y,g),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=l,i<=r.b2_linearSlop&&m<=r.b2_angularSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},e.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},e.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},e.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},e.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},e.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.IsLimitEnabled=function(){return this.m_enableLimit},e.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.GetLowerLimit=function(){return this.m_lowerAngle},e.prototype.GetUpperLimit=function(){return this.m_upperAngle},e.prototype.SetLimits=function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},e.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.InitVelocityConstraints_s_P=new s.b2Vec2,e.SolveVelocityConstraints_s_P=new s.b2Vec2,e.SolveVelocityConstraints_s_Cdot_v2=new s.b2Vec2,e.SolveVelocityConstraints_s_Cdot1=new s.b2Vec2,e.SolveVelocityConstraints_s_impulse_v3=new s.b2Vec3,e.SolveVelocityConstraints_s_reduced_v2=new s.b2Vec2,e.SolveVelocityConstraints_s_impulse_v2=new s.b2Vec2,e.SolvePositionConstraints_s_C_v2=new s.b2Vec2,e.SolvePositionConstraints_s_impulse=new s.b2Vec2,e}(a.b2Joint);i.b2RevoluteJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2RopeJoint:[function(t,e,i){"use strict";cc._RF.push(e,"509ae5atWlKDLUOo+W034g/","b2RopeJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2RopeJoint=i.b2RopeJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_ropeJoint)||this;return e.localAnchorA=new s.b2Vec2(-1,0),e.localAnchorB=new s.b2Vec2(1,0),e.maxLength=0,e}return n(e,t),e}(a.b2JointDef);i.b2RopeJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_localAnchorA=new s.b2Vec2,i.m_localAnchorB=new s.b2Vec2,i.m_maxLength=0,i.m_length=0,i.m_impulse=0,i.m_indexA=0,i.m_indexB=0,i.m_u=new s.b2Vec2,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=0,i.m_state=a.b2LimitState.e_inactiveLimit,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_lalcA=new s.b2Vec2,i.m_lalcB=new s.b2Vec2,i.m_localAnchorA.Copy(r.b2Maybe(e.localAnchorA,new s.b2Vec2(-1,0))),i.m_localAnchorB.Copy(r.b2Maybe(e.localAnchorB,new s.b2Vec2(1,0))),i.m_maxLength=r.b2Maybe(e.maxLength,0),i}return n(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,c=t.velocities[this.m_indexA].w,l=t.positions[this.m_indexB].c,u=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(o),p=this.m_qB.SetAngle(u);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.b2Rot.MulRV(h,this.m_lalcA,this.m_rA),s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.b2Rot.MulRV(p,this.m_lalcB,this.m_rB),this.m_u.Copy(l).SelfAdd(this.m_rB).SelfSub(i).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var f=this.m_length-this.m_maxLength;if(this.m_state=f>0?a.b2LimitState.e_atUpperLimit:a.b2LimitState.e_inactiveLimit,!(this.m_length>r.b2_linearSlop))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var b=s.b2Vec2.CrossVV(this.m_rA,this.m_u),d=s.b2Vec2.CrossVV(this.m_rB,this.m_u),y=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!==y?1/y:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var v=s.b2Vec2.MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,v),c-=this.m_invIA*s.b2Vec2.CrossVV(this.m_rA,v),_.SelfMulAdd(this.m_invMassB,v),m+=this.m_invIB*s.b2Vec2.CrossVV(this.m_rB,v)}else this.m_impulse=0;t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=m},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=s.b2Vec2.AddVCrossSV(i,o,this.m_rA,e.SolveVelocityConstraints_s_vpA),c=s.b2Vec2.AddVCrossSV(n,r,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength,u=s.b2Vec2.DotVV(this.m_u,s.b2Vec2.SubVV(c,a,s.b2Vec2.s_t0));l<0&&(u+=t.step.inv_dt*l);var _=-this.m_mass*u,m=this.m_impulse;this.m_impulse=s.b2Min(0,this.m_impulse+_),_=this.m_impulse-m;var h=s.b2Vec2.MulSV(_,this.m_u,e.SolveVelocityConstraints_s_P);i.SelfMulSub(this.m_invMassA,h),o-=this.m_invIA*s.b2Vec2.CrossVV(this.m_rA,h),n.SelfMulAdd(this.m_invMassB,h),r+=this.m_invIB*s.b2Vec2.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,c=this.m_qA.SetAngle(o),l=this.m_qB.SetAngle(a);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=s.b2Rot.MulRV(c,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var _=s.b2Rot.MulRV(l,this.m_lalcB,this.m_rB),m=this.m_u.Copy(n).SelfAdd(_).SelfSub(i).SelfSub(u),h=m.Normalize(),p=h-this.m_maxLength;p=s.b2Clamp(p,0,r.b2_maxLinearCorrection);var f=-this.m_mass*p,b=s.b2Vec2.MulSV(f,m,e.SolvePositionConstraints_s_P);return i.SelfMulSub(this.m_invMassA,b),o-=this.m_invIA*s.b2Vec2.CrossVV(u,b),n.SelfMulAdd(this.m_invMassB,b),a+=this.m_invIB*s.b2Vec2.CrossVV(_,b),t.positions[this.m_indexA].a=o,t.positions[this.m_indexB].a=a,h-this.m_maxLength<r.b2_linearSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return s.b2Vec2.MulSV(t*this.m_impulse,this.m_u,e)},e.prototype.GetReactionTorque=function(){return 0},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.SetMaxLength=function(t){this.m_maxLength=t},e.prototype.GetMaxLength=function(){return this.m_maxLength},e.prototype.GetLimitState=function(){return this.m_state},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.InitVelocityConstraints_s_P=new s.b2Vec2,e.SolveVelocityConstraints_s_vpA=new s.b2Vec2,e.SolveVelocityConstraints_s_vpB=new s.b2Vec2,e.SolveVelocityConstraints_s_P=new s.b2Vec2,e.SolvePositionConstraints_s_P=new s.b2Vec2,e}(a.b2Joint);i.b2RopeJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2Rope:[function(t,e,i){"use strict";cc._RF.push(e,"221faZRpohGtILSZYVMy3DK","b2Rope"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Rope=i.b2RopeDef=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=t("../Common/b2Draw");i.b2RopeDef=function(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new n.b2Vec2(0,0),this.damping=.1,this.k2=.9,this.k3=.1};var s=function(){function t(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new n.b2Vec2,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return t.prototype.GetVertexCount=function(){return this.m_count},t.prototype.GetVertices=function(){return this.m_ps},t.prototype.Initialize=function(t){this.m_count=t.count,this.m_ps=n.b2Vec2.MakeArray(this.m_count),this.m_p0s=n.b2Vec2.MakeArray(this.m_count),this.m_vs=n.b2Vec2.MakeArray(this.m_count),this.m_ims=o.b2MakeNumberArray(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=i>0?1/i:0}var r=this.m_count-1,s=this.m_count-2;for(this.m_Ls=o.b2MakeNumberArray(r),this.m_as=o.b2MakeNumberArray(s),e=0;e<r;++e){var a=this.m_ps[e],c=this.m_ps[e+1];this.m_Ls[e]=n.b2Vec2.DistanceVV(a,c)}for(e=0;e<s;++e){a=this.m_ps[e],c=this.m_ps[e+1];var l=this.m_ps[e+2],u=n.b2Vec2.SubVV(c,a,n.b2Vec2.s_t0),_=n.b2Vec2.SubVV(l,c,n.b2Vec2.s_t1),m=n.b2Vec2.CrossVV(u,_),h=n.b2Vec2.DotVV(u,_);this.m_as[e]=n.b2Atan2(m,h)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3},t.prototype.Step=function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),o=0;o<this.m_count;++o)this.m_p0s[o].Copy(this.m_ps[o]),this.m_ims[o]>0&&this.m_vs[o].SelfMulAdd(t,this.m_gravity),this.m_vs[o].SelfMul(i),this.m_ps[o].SelfMulAdd(t,this.m_vs[o]);for(o=0;o<e;++o)this.SolveC2(),this.SolveC3(),this.SolveC2();var r=1/t;for(o=0;o<this.m_count;++o)n.b2Vec2.MulSV(r,n.b2Vec2.SubVV(this.m_ps[o],this.m_p0s[o],n.b2Vec2.s_t0),this.m_vs[o])}},t.prototype.SolveC2=function(){for(var e=this.m_count-1,i=0;i<e;++i){var o=this.m_ps[i],r=this.m_ps[i+1],s=n.b2Vec2.SubVV(r,o,t.s_d),a=s.Normalize(),c=this.m_ims[i],l=this.m_ims[i+1];if(c+l!==0){var u=c/(c+l),_=l/(c+l);o.SelfMulSub(this.m_k2*u*(this.m_Ls[i]-a),s),r.SelfMulAdd(this.m_k2*_*(this.m_Ls[i]-a),s)}}},t.prototype.SetAngle=function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t},t.prototype.SolveC3=function(){for(var e=this.m_count-2,i=0;i<e;++i){var r=this.m_ps[i],s=this.m_ps[i+1],a=this.m_ps[i+2],c=this.m_ims[i],l=this.m_ims[i+1],u=this.m_ims[i+2],_=n.b2Vec2.SubVV(s,r,t.s_d1),m=n.b2Vec2.SubVV(a,s,t.s_d2),h=_.LengthSquared(),p=m.LengthSquared();if(h*p!=0){var f=n.b2Vec2.CrossVV(_,m),b=n.b2Vec2.DotVV(_,m),d=n.b2Atan2(f,b),y=n.b2Vec2.MulSV(-1/h,_.SelfSkew(),t.s_Jd1),v=n.b2Vec2.MulSV(1/p,m.SelfSkew(),t.s_Jd2),V=n.b2Vec2.NegV(y,t.s_J1),x=n.b2Vec2.SubVV(y,v,t.s_J2),C=v,S=c*n.b2Vec2.DotVV(V,V)+l*n.b2Vec2.DotVV(x,x)+u*n.b2Vec2.DotVV(C,C);if(0!==S){S=1/S;for(var B=d-this.m_as[i];B>o.b2_pi;)B=(d-=2*o.b2_pi)-this.m_as[i];for(;B<-o.b2_pi;)B=(d+=2*o.b2_pi)-this.m_as[i];var g=-this.m_k3*S*B;r.SelfMulAdd(c*g,V),s.SelfMulAdd(l*g,x),a.SelfMulAdd(u*g,C)}}}},t.prototype.Draw=function(t){for(var e=new r.b2Color(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)},t.s_d=new n.b2Vec2,t.s_d1=new n.b2Vec2,t.s_d2=new n.b2Vec2,t.s_Jd1=new n.b2Vec2,t.s_Jd2=new n.b2Vec2,t.s_J1=new n.b2Vec2,t.s_J2=new n.b2Vec2,t}();i.b2Rope=s,cc._RF.pop()},{"../Common/b2Draw":"b2Draw","../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings"}],b2Settings:[function(t,e,i){"use strict";cc._RF.push(e,"a6046LpclxEYYVFDgRkLWjE","b2Settings");var o=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var o=Array(t),n=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,n++)o[n]=r[s];return o};Object.defineProperty(i,"__esModule",{value:!0}),i.b2MakeNumberArray=i.b2MakeNullArray=i.b2MakeArray=i.b2ParseUInt=i.b2ParseInt=i.b2_commit=i.b2_branch=i.b2_version=i.b2Version=i.b2Log=i.b2Free=i.b2Alloc=i.b2_angularSleepTolerance=i.b2_linearSleepTolerance=i.b2_timeToSleep=i.b2_barrierCollisionTime=i.b2_minParticleSystemBufferCapacity=i.b2_maxTriadDistanceSquared=i.b2_maxTriadDistance=i.b2_maxParticleForce=i.b2_maxParticlePressure=i.b2_minParticleWeight=i.b2_particleStride=i.b2_maxParticleIndex=i.b2_invalidParticleIndex=i.b2_toiBaumgarte=i.b2_baumgarte=i.b2_maxRotationSquared=i.b2_maxRotation=i.b2_maxTranslationSquared=i.b2_maxTranslation=i.b2_maxAngularCorrection=i.b2_maxLinearCorrection=i.b2_velocityThreshold=i.b2_maxTOIContacts=i.b2_maxSubSteps=i.b2_polygonRadius=i.b2_angularSlop=i.b2_linearSlop=i.b2_aabbMultiplier=i.b2_aabbExtension=i.b2_maxPolygonVertices=i.b2_maxManifoldPoints=i.b2_pi=i.b2_epsilon_sq=i.b2_epsilon=i.b2_maxFloat=i.b2Maybe=i.b2Assert=void 0,i.b2Assert=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!t)throw new(Error.bind.apply(Error,o([void 0],e)))},i.b2Maybe=function(t,e){return void 0!==t?t:e},i.b2_maxFloat=1e37,i.b2_epsilon=1e-5,i.b2_epsilon_sq=i.b2_epsilon*i.b2_epsilon,i.b2_pi=3.14159265359,i.b2_maxManifoldPoints=2,i.b2_maxPolygonVertices=8,i.b2_aabbExtension=.1,i.b2_aabbMultiplier=2,i.b2_linearSlop=.008,i.b2_angularSlop=2/180*i.b2_pi,i.b2_polygonRadius=2*i.b2_linearSlop,i.b2_maxSubSteps=8,i.b2_maxTOIContacts=32,i.b2_velocityThreshold=1,i.b2_maxLinearCorrection=.2,i.b2_maxAngularCorrection=8/180*i.b2_pi,i.b2_maxTranslation=2,i.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation,i.b2_maxRotation=.5*i.b2_pi,i.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation,i.b2_baumgarte=.2,i.b2_toiBaumgarte=.75,i.b2_invalidParticleIndex=-1,i.b2_maxParticleIndex=2147483647,i.b2_particleStride=.75,i.b2_minParticleWeight=1,i.b2_maxParticlePressure=.25,i.b2_maxParticleForce=.5,i.b2_maxTriadDistance=2,i.b2_maxTriadDistanceSquared=i.b2_maxTriadDistance*i.b2_maxTriadDistance,i.b2_minParticleSystemBufferCapacity=256,i.b2_barrierCollisionTime=2.5,i.b2_timeToSleep=.5,i.b2_linearSleepTolerance=.01,i.b2_angularSleepTolerance=2/180*i.b2_pi,i.b2Alloc=function(){return null},i.b2Free=function(){},i.b2Log=function(){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e]};var n=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}return t.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},t}();i.b2Version=n,i.b2_version=new n(2,3,2),i.b2_branch="master",i.b2_commit="fbf51801d80fc389d43dc46524520e89043b6faf",i.b2ParseInt=function(t){return parseInt(t,10)},i.b2ParseUInt=function(t){return Math.abs(parseInt(t,10))},i.b2MakeArray=function(t,e){for(var i=new Array(t),o=0;o<t;++o)i[o]=e(o);return i},i.b2MakeNullArray=function(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=null;return e},i.b2MakeNumberArray=function(t,e){void 0===e&&(e=0);for(var i=new Array(t),o=0;o<t;++o)i[o]=e;return i},cc._RF.pop()},{}],b2Shape:[function(t,e,i){"use strict";cc._RF.push(e,"45c486w5jVD7rTne2XfN0ME","b2Shape"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Shape=i.b2ShapeType=i.b2MassData=void 0;var o,n=t("../../Common/b2Math");i.b2MassData=function(){this.mass=0,this.center=new n.b2Vec2(0,0),this.I=0},function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circleShape=0]="e_circleShape",t[t.e_edgeShape=1]="e_edgeShape",t[t.e_polygonShape=2]="e_polygonShape",t[t.e_chainShape=3]="e_chainShape",t[t.e_shapeTypeCount=4]="e_shapeTypeCount"}(o=i.b2ShapeType||(i.b2ShapeType={}));var r=function(){function t(t,e){this.m_type=o.e_unknown,this.m_radius=0,this.m_type=t,this.m_radius=e}return t.prototype.Copy=function(t){return this.m_radius=t.m_radius,this},t.prototype.GetType=function(){return this.m_type},t}();i.b2Shape=r,cc._RF.pop()},{"../../Common/b2Math":"b2Math"}],b2StackAllocator:[function(t,e,i){"use strict";cc._RF.push(e,"7a6f2tdW8NNSoxAaHxKt/sO","b2StackAllocator"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2StackAllocator=void 0;i.b2StackAllocator=function(){},cc._RF.pop()},{}],b2StackQueue:[function(t,e,i){"use strict";cc._RF.push(e,"0e72a0muGBPr59GHRt7oCru","b2StackQueue"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2StackQueue=void 0;var o=t("../Common/b2Settings"),n=function(){function t(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=o.b2MakeArray(t,function(){return null}),this.m_capacity=t}return t.prototype.Push=function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(o.b2MakeArray(this.m_capacity,function(){return null})),this.m_capacity*=2):(this.m_buffer.concat(o.b2MakeArray(1,function(){return null})),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++},t.prototype.Pop=function(){this.m_buffer[this.m_front]=null,this.m_front++},t.prototype.Empty=function(){return this.m_front===this.m_back},t.prototype.Front=function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t},t}();i.b2StackQueue=n,cc._RF.pop()},{"../Common/b2Settings":"b2Settings"}],b2TensorDampingController:[function(t,e,i){"use strict";cc._RF.push(e,"ce1fa62mdtBLL0RznMR3FPg","b2TensorDampingController");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2TensorDampingController=void 0;var r=t("./b2Controller"),s=t("../Common/b2Math"),a=t("../Common/b2Settings"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.T=new s.b2Mat22,e.maxTimestep=0,e}return n(e,t),e.prototype.Step=function(t){var i=t.dt;if(!(i<=a.b2_epsilon)){i>this.maxTimestep&&this.maxTimestep>0&&(i=this.maxTimestep);for(var o=this.m_bodyList;o;o=o.nextBody){var n=o.body;if(n.IsAwake()){var r=n.GetWorldVector(s.b2Mat22.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity(),s.b2Vec2.s_t0),s.b2Vec2.s_t1),e.Step_s_damping);n.SetLinearVelocity(s.b2Vec2.AddVV(n.GetLinearVelocity(),s.b2Vec2.MulSV(i,r,s.b2Vec2.s_t0),s.b2Vec2.s_t1))}}}},e.prototype.Draw=function(){},e.prototype.SetAxisAligned=function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=t>0||e>0?1/s.b2Max(t,e):0},e.Step_s_damping=new s.b2Vec2,e}(r.b2Controller);i.b2TensorDampingController=c,cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2Controller":"b2Controller"}],b2TimeOfImpact:[function(t,e,i){"use strict";cc._RF.push(e,"5805dJYp6tJIovi4GSwjsQ7","b2TimeOfImpact"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2TimeOfImpact=i.b2SeparationFunction=i.b2SeparationFunctionType=i.b2TOIOutput=i.b2TOIOutputState=i.b2TOIInput=i.b2_toi_reset=i.b2_toiMaxRootIters=i.b2_toiRootIters=i.b2_toiMaxIters=i.b2_toiIters=i.b2_toiCalls=i.b2_toiMaxTime=i.b2_toiTime=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=t("../Common/b2Timer"),s=t("./b2Distance");i.b2_toiTime=0,i.b2_toiMaxTime=0,i.b2_toiCalls=0,i.b2_toiIters=0,i.b2_toiMaxIters=0,i.b2_toiRootIters=0,i.b2_toiMaxRootIters=0,i.b2_toi_reset=function(){i.b2_toiTime=0,i.b2_toiMaxTime=0,i.b2_toiCalls=0,i.b2_toiIters=0,i.b2_toiMaxIters=0,i.b2_toiRootIters=0,i.b2_toiMaxRootIters=0};var a,c=new n.b2Transform,l=new n.b2Transform,u=new n.b2Vec2,_=new n.b2Vec2,m=new n.b2Vec2,h=new n.b2Vec2,p=new n.b2Vec2;i.b2TOIInput=function(){this.proxyA=new s.b2DistanceProxy,this.proxyB=new s.b2DistanceProxy,this.sweepA=new n.b2Sweep,this.sweepB=new n.b2Sweep,this.tMax=0},function(t){t[t.e_unknown=0]="e_unknown",t[t.e_failed=1]="e_failed",t[t.e_overlapped=2]="e_overlapped",t[t.e_touching=3]="e_touching",t[t.e_separated=4]="e_separated"}(a=i.b2TOIOutputState||(i.b2TOIOutputState={}));var f;i.b2TOIOutput=function(){this.state=a.e_unknown,this.t=0},function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_points=0]="e_points",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(f=i.b2SeparationFunctionType||(i.b2SeparationFunctionType={}));var b=function(){function t(){this.m_sweepA=new n.b2Sweep,this.m_sweepB=new n.b2Sweep,this.m_type=f.e_unknown,this.m_localPoint=new n.b2Vec2,this.m_axis=new n.b2Vec2}return t.prototype.Initialize=function(t,e,i,o,r,s){this.m_proxyA=e,this.m_proxyB=o;var a=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(r);var h=c,p=l;if(this.m_sweepA.GetTransform(h,s),this.m_sweepB.GetTransform(p,s),1===a){this.m_type=f.e_points;var b=this.m_proxyA.GetVertex(t.indexA[0]),d=this.m_proxyB.GetVertex(t.indexB[0]),y=n.b2Transform.MulXV(h,b,u),v=n.b2Transform.MulXV(p,d,_);n.b2Vec2.SubVV(v,y,this.m_axis);var V=this.m_axis.Normalize();return this.m_localPoint.SetZero(),V}if(t.indexA[0]===t.indexA[1]){this.m_type=f.e_faceB;var x=this.m_proxyB.GetVertex(t.indexB[0]),C=this.m_proxyB.GetVertex(t.indexB[1]);n.b2Vec2.CrossVOne(n.b2Vec2.SubVV(C,x,n.b2Vec2.s_t0),this.m_axis).SelfNormalize();var S=n.b2Rot.MulRV(p.q,this.m_axis,m);return n.b2Vec2.MidVV(x,C,this.m_localPoint),v=n.b2Transform.MulXV(p,this.m_localPoint,_),b=this.m_proxyA.GetVertex(t.indexA[0]),y=n.b2Transform.MulXV(h,b,u),(V=n.b2Vec2.DotVV(n.b2Vec2.SubVV(y,v,n.b2Vec2.s_t0),S))<0&&(this.m_axis.SelfNeg(),V=-V),V}this.m_type=f.e_faceA;var B=this.m_proxyA.GetVertex(t.indexA[0]),g=this.m_proxyA.GetVertex(t.indexA[1]);return n.b2Vec2.CrossVOne(n.b2Vec2.SubVV(g,B,n.b2Vec2.s_t0),this.m_axis).SelfNormalize(),S=n.b2Rot.MulRV(h.q,this.m_axis,m),n.b2Vec2.MidVV(B,g,this.m_localPoint),y=n.b2Transform.MulXV(h,this.m_localPoint,u),d=this.m_proxyB.GetVertex(t.indexB[0]),v=n.b2Transform.MulXV(p,d,_),(V=n.b2Vec2.DotVV(n.b2Vec2.SubVV(v,y,n.b2Vec2.s_t0),S))<0&&(this.m_axis.SelfNeg(),V=-V),V},t.prototype.FindMinSeparation=function(t,e,i){var o=c,r=l;switch(this.m_sweepA.GetTransform(o,i),this.m_sweepB.GetTransform(r,i),this.m_type){case f.e_points:var s=n.b2Rot.MulTRV(o.q,this.m_axis,h),a=n.b2Rot.MulTRV(r.q,n.b2Vec2.NegV(this.m_axis,n.b2Vec2.s_t0),p);t[0]=this.m_proxyA.GetSupport(s),e[0]=this.m_proxyB.GetSupport(a);var b=this.m_proxyA.GetVertex(t[0]),d=this.m_proxyB.GetVertex(e[0]),y=n.b2Transform.MulXV(o,b,u),v=n.b2Transform.MulXV(r,d,_);return n.b2Vec2.DotVV(n.b2Vec2.SubVV(v,y,n.b2Vec2.s_t0),this.m_axis);case f.e_faceA:var V=n.b2Rot.MulRV(o.q,this.m_axis,m);return y=n.b2Transform.MulXV(o,this.m_localPoint,u),a=n.b2Rot.MulTRV(r.q,n.b2Vec2.NegV(V,n.b2Vec2.s_t0),p),t[0]=-1,e[0]=this.m_proxyB.GetSupport(a),d=this.m_proxyB.GetVertex(e[0]),v=n.b2Transform.MulXV(r,d,_),n.b2Vec2.DotVV(n.b2Vec2.SubVV(v,y,n.b2Vec2.s_t0),V);case f.e_faceB:return V=n.b2Rot.MulRV(r.q,this.m_axis,m),v=n.b2Transform.MulXV(r,this.m_localPoint,_),s=n.b2Rot.MulTRV(o.q,n.b2Vec2.NegV(V,n.b2Vec2.s_t0),h),e[0]=-1,t[0]=this.m_proxyA.GetSupport(s),b=this.m_proxyA.GetVertex(t[0]),y=n.b2Transform.MulXV(o,b,u),n.b2Vec2.DotVV(n.b2Vec2.SubVV(y,v,n.b2Vec2.s_t0),V);default:return t[0]=-1,e[0]=-1,0}},t.prototype.Evaluate=function(t,e,i){var o=c,r=l;switch(this.m_sweepA.GetTransform(o,i),this.m_sweepB.GetTransform(r,i),this.m_type){case f.e_points:var s=this.m_proxyA.GetVertex(t),a=this.m_proxyB.GetVertex(e),h=n.b2Transform.MulXV(o,s,u),p=n.b2Transform.MulXV(r,a,_);return n.b2Vec2.DotVV(n.b2Vec2.SubVV(p,h,n.b2Vec2.s_t0),this.m_axis);case f.e_faceA:var b=n.b2Rot.MulRV(o.q,this.m_axis,m);return h=n.b2Transform.MulXV(o,this.m_localPoint,u),a=this.m_proxyB.GetVertex(e),p=n.b2Transform.MulXV(r,a,_),n.b2Vec2.DotVV(n.b2Vec2.SubVV(p,h,n.b2Vec2.s_t0),b);case f.e_faceB:return b=n.b2Rot.MulRV(r.q,this.m_axis,m),p=n.b2Transform.MulXV(r,this.m_localPoint,_),s=this.m_proxyA.GetVertex(t),h=n.b2Transform.MulXV(o,s,u),n.b2Vec2.DotVV(n.b2Vec2.SubVV(h,p,n.b2Vec2.s_t0),b);default:return 0}},t}();i.b2SeparationFunction=b;var d=new r.b2Timer,y=new s.b2SimplexCache,v=new s.b2DistanceInput,V=new s.b2DistanceOutput,x=new b,C=[0],S=[0],B=new n.b2Sweep,g=new n.b2Sweep;i.b2TimeOfImpact=function(t,e){var r=d.Reset();++i.b2_toiCalls,t.state=a.e_unknown,t.t=e.tMax;var u=e.proxyA,_=e.proxyB,m=n.b2Max(o.b2_maxPolygonVertices,n.b2Max(u.m_count,_.m_count)),h=B.Copy(e.sweepA),p=g.Copy(e.sweepB);h.Normalize(),p.Normalize();var f=e.tMax,b=u.m_radius+_.m_radius,A=n.b2Max(o.b2_linearSlop,b-3*o.b2_linearSlop),w=.25*o.b2_linearSlop,M=0,P=0,D=y;D.count=0;var R=v;for(R.proxyA.Copy(e.proxyA),R.proxyB.Copy(e.proxyB),R.useRadii=!1;;){var F=c,G=l;h.GetTransform(F,M),p.GetTransform(G,M),R.transformA.Copy(F),R.transformB.Copy(G);var I=V;if(s.b2Distance(I,D,R),I.distance<=0){t.state=a.e_overlapped,t.t=0;break}if(I.distance<A+w){t.state=a.e_touching,t.t=M;break}var T=x;T.Initialize(D,u,h,_,p,M);for(var L=!1,E=f,J=0;;){var O=C,k=S,j=T.FindMinSeparation(O,k,E);if(j>A+w){t.state=a.e_separated,t.t=f,L=!0;break}if(j>A-w){M=E;break}var q=T.Evaluate(O[0],k[0],M);if(q<A-w){t.state=a.e_failed,t.t=M,L=!0;break}if(q<=A+w){t.state=a.e_touching,t.t=M,L=!0;break}for(var z=0,N=M,W=E;;){var U;U=1&z?N+(A-q)*(W-N)/(j-q):.5*(N+W),++z,++i.b2_toiRootIters;var X=T.Evaluate(O[0],k[0],U);if(n.b2Abs(X-A)<w){E=U;break}if(X>A?(N=U,q=X):(W=U,j=X),50===z)break}if(i.b2_toiMaxRootIters=n.b2Max(i.b2_toiMaxRootIters,z),++J===m)break}if(++P,++i.b2_toiIters,L)break;if(20===P){t.state=a.e_failed,t.t=M;break}}i.b2_toiMaxIters=n.b2Max(i.b2_toiMaxIters,P);var Z=r.GetMilliseconds();i.b2_toiMaxTime=n.b2Max(i.b2_toiMaxTime,Z),i.b2_toiTime+=Z},cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","../Common/b2Timer":"b2Timer","./b2Distance":"b2Distance"}],b2TimeStep:[function(t,e,i){"use strict";cc._RF.push(e,"88ec4X+kbZPf5AoUJ0JfhyP","b2TimeStep"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2SolverData=i.b2Velocity=i.b2Position=i.b2TimeStep=i.b2Profile=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=function(){function t(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return t.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},t}();i.b2Profile=r;var s=function(){function t(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}return t.prototype.Copy=function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this},t}();i.b2TimeStep=s;var a=function(){function t(){this.c=new n.b2Vec2,this.a=0}return t.MakeArray=function(e){return o.b2MakeArray(e,function(){return new t})},t}();i.b2Position=a;var c=function(){function t(){this.v=new n.b2Vec2,this.w=0}return t.MakeArray=function(e){return o.b2MakeArray(e,function(){return new t})},t}();i.b2Velocity=c;i.b2SolverData=function(){this.step=new s},cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings"}],b2Timer:[function(t,e,i){"use strict";cc._RF.push(e,"24aebCrlbpLWKoZm6OiH/yG","b2Timer"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2Counter=i.b2Timer=void 0;var o=function(){function t(){this.m_start=Date.now()}return t.prototype.Reset=function(){return this.m_start=Date.now(),this},t.prototype.GetMilliseconds=function(){return Date.now()-this.m_start},t}();i.b2Timer=o;var n=function(){function t(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}return t.prototype.GetCount=function(){return this.m_count},t.prototype.GetMinCount=function(){return this.m_min_count},t.prototype.GetMaxCount=function(){return this.m_max_count},t.prototype.ResetCount=function(){var t=this.m_count;return this.m_count=0,t},t.prototype.ResetMinCount=function(){this.m_min_count=0},t.prototype.ResetMaxCount=function(){this.m_max_count=0},t.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},t.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},t}();i.b2Counter=n,cc._RF.pop()},{}],b2VoronoiDiagram:[function(t,e,i){"use strict";cc._RF.push(e,"4d38ae67B5LCYZ1UOf7mM/I","b2VoronoiDiagram"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2VoronoiDiagram_Task=i.b2VoronoiDiagram_Generator=i.b2VoronoiDiagram=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=t("./b2StackQueue"),s=function(){function t(t){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=o.b2MakeArray(t,function(){return new a}),this.m_generatorCapacity=t}return t.prototype.AddGenerator=function(t,e,i){var o=this.m_generatorBuffer[this.m_generatorCount++];o.center.Copy(t),o.tag=e,o.necessary=i},t.prototype.Generate=function(t,e){for(var i=1/t,s=new n.b2Vec2(+o.b2_maxFloat,+o.b2_maxFloat),a=new n.b2Vec2(-o.b2_maxFloat,-o.b2_maxFloat),l=0,u=0;u<this.m_generatorCount;u++)(f=this.m_generatorBuffer[u]).necessary&&(n.b2Vec2.MinV(s,f.center,s),n.b2Vec2.MaxV(a,f.center,a),++l);if(0===l)return this.m_countX=0,void(this.m_countY=0);s.x-=e,s.y-=e,a.x+=e,a.y+=e,this.m_countX=1+Math.floor(i*(a.x-s.x)),this.m_countY=1+Math.floor(i*(a.y-s.y)),this.m_diagram=[];var _=new r.b2StackQueue(4*this.m_countX*this.m_countY);for(u=0;u<this.m_generatorCount;u++){(f=this.m_generatorBuffer[u]).center.SelfSub(s).SelfMul(i);var m=Math.floor(f.center.x),h=Math.floor(f.center.y);m>=0&&h>=0&&m<this.m_countX&&h<this.m_countY&&_.Push(new c(m,h,m+h*this.m_countX,f))}for(;!_.Empty();){m=(b=_.Front()).m_x,h=b.m_y;var p=b.m_i,f=b.m_generator;_.Pop(),this.m_diagram[p]||(this.m_diagram[p]=f,m>0&&_.Push(new c(m-1,h,p-1,f)),h>0&&_.Push(new c(m,h-1,p-this.m_countX,f)),m<this.m_countX-1&&_.Push(new c(m+1,h,p+1,f)),h<this.m_countY-1&&_.Push(new c(m,h+1,p+this.m_countX,f)))}for(h=0;h<this.m_countY;h++)for(m=0;m<this.m_countX-1;m++)p=m+h*this.m_countX,(d=this.m_diagram[p])!==(y=this.m_diagram[p+1])&&(_.Push(new c(m,h,p,y)),_.Push(new c(m+1,h,p+1,d)));for(h=0;h<this.m_countY-1;h++)for(m=0;m<this.m_countX;m++)p=m+h*this.m_countX,(d=this.m_diagram[p])!==(y=this.m_diagram[p+this.m_countX])&&(_.Push(new c(m,h,p,y)),_.Push(new c(m,h+1,p+this.m_countX,d)));for(;!_.Empty();){var b,d,y;if(m=(b=_.Front()).m_x,h=b.m_y,p=b.m_i,u=b.m_generator,_.Pop(),(d=this.m_diagram[p])!==(y=u)){var v=d.center.x-m,V=d.center.y-h,x=y.center.x-m,C=y.center.y-h;v*v+V*V>x*x+C*C&&(this.m_diagram[p]=y,m>0&&_.Push(new c(m-1,h,p-1,y)),h>0&&_.Push(new c(m,h-1,p-this.m_countX,y)),m<this.m_countX-1&&_.Push(new c(m+1,h,p+1,y)),h<this.m_countY-1&&_.Push(new c(m,h+1,p+this.m_countX,y)))}}},t.prototype.GetNodes=function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var o=i+e*this.m_countX,n=this.m_diagram[o],r=this.m_diagram[o+1],s=this.m_diagram[o+this.m_countX],a=this.m_diagram[o+1+this.m_countX];r!==s&&(n!==r&&n!==s&&(n.necessary||r.necessary||s.necessary)&&t(n.tag,r.tag,s.tag),a!==r&&a!==s&&(n.necessary||r.necessary||s.necessary)&&t(r.tag,a.tag,s.tag))}},t}();i.b2VoronoiDiagram=s;var a=function(){this.center=new n.b2Vec2,this.tag=0,this.necessary=!1};i.b2VoronoiDiagram_Generator=a;var c=function(t,e,i,o){this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=o};i.b2VoronoiDiagram_Task=c,cc._RF.pop()},{"../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","./b2StackQueue":"b2StackQueue"}],b2WeldJoint:[function(t,e,i){"use strict";cc._RF.push(e,"8c81de78v9EZoV3T5CKv2ca","b2WeldJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2WeldJoint=i.b2WeldJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_weldJoint)||this;return e.localAnchorA=new s.b2Vec2,e.localAnchorB=new s.b2Vec2,e.referenceAngle=0,e.frequencyHz=0,e.dampingRatio=0,e}return n(e,t),e.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},e}(a.b2JointDef);i.b2WeldJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_frequencyHz=0,i.m_dampingRatio=0,i.m_bias=0,i.m_localAnchorA=new s.b2Vec2,i.m_localAnchorB=new s.b2Vec2,i.m_referenceAngle=0,i.m_gamma=0,i.m_impulse=new s.b2Vec3(0,0,0),i.m_indexA=0,i.m_indexB=0,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=new s.b2Mat33,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_lalcA=new s.b2Vec2,i.m_lalcB=new s.b2Vec2,i.m_K=new s.b2Mat33,i.m_frequencyHz=r.b2Maybe(e.frequencyHz,0),i.m_dampingRatio=r.b2Maybe(e.dampingRatio,0),i.m_localAnchorA.Copy(r.b2Maybe(e.localAnchorA,s.b2Vec2.ZERO)),i.m_localAnchorB.Copy(r.b2Maybe(e.localAnchorB,s.b2Vec2.ZERO)),i.m_referenceAngle=r.b2Maybe(e.referenceAngle,0),i.m_impulse.SetZero(),i}return n(e,t),e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,o=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(a);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.b2Rot.MulRV(u,this.m_lalcA,this.m_rA),s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.b2Rot.MulRV(_,this.m_lalcB,this.m_rB);var m=this.m_invMassA,h=this.m_invMassB,p=this.m_invIA,f=this.m_invIB,b=this.m_K;if(b.ex.x=m+h+this.m_rA.y*this.m_rA.y*p+this.m_rB.y*this.m_rB.y*f,b.ey.x=-this.m_rA.y*this.m_rA.x*p-this.m_rB.y*this.m_rB.x*f,b.ez.x=-this.m_rA.y*p-this.m_rB.y*f,b.ex.y=b.ey.x,b.ey.y=m+h+this.m_rA.x*this.m_rA.x*p+this.m_rB.x*this.m_rB.x*f,b.ez.y=this.m_rA.x*p+this.m_rB.x*f,b.ex.z=b.ez.x,b.ey.z=b.ez.y,b.ez.z=p+f,this.m_frequencyHz>0){b.GetInverse22(this.m_mass);var d=p+f,y=d>0?1/d:0,v=a-i-this.m_referenceAngle,V=2*r.b2_pi*this.m_frequencyHz,x=2*y*this.m_dampingRatio*V,C=y*V*V,S=t.step.dt;this.m_gamma=S*(x+S*C),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=v*S*C*this.m_gamma,d+=this.m_gamma,this.m_mass.ez.z=0!==d?1/d:0}else b.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var B=e.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);o.SelfMulSub(m,B),n-=p*(s.b2Vec2.CrossVV(this.m_rA,B)+this.m_impulse.z),c.SelfMulAdd(h,B),l+=f*(s.b2Vec2.CrossVV(this.m_rB,B)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l},e.prototype.SolveVelocityConstraints=function(t){var i=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,u=this.m_invIB;if(this.m_frequencyHz>0){var _=r-o,m=-this.m_mass.ez.z*(_+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=m,o-=l*m,r+=u*m;var h=s.b2Vec2.SubVV(s.b2Vec2.AddVCrossSV(n,r,this.m_rB,s.b2Vec2.s_t0),s.b2Vec2.AddVCrossSV(i,o,this.m_rA,s.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot1),p=s.b2Mat33.MulM33XY(this.m_mass,h.x,h.y,e.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var f=p;i.SelfMulSub(a,f),o-=l*s.b2Vec2.CrossVV(this.m_rA,f),n.SelfMulAdd(c,f),r+=u*s.b2Vec2.CrossVV(this.m_rB,f)}else{h=s.b2Vec2.SubVV(s.b2Vec2.AddVCrossSV(n,r,this.m_rB,s.b2Vec2.s_t0),s.b2Vec2.AddVCrossSV(i,o,this.m_rA,s.b2Vec2.s_t1),e.SolveVelocityConstraints_s_Cdot1),_=r-o;var b=s.b2Mat33.MulM33XYZ(this.m_mass,h.x,h.y,_,e.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(b),f=e.SolveVelocityConstraints_s_P.Set(b.x,b.y),i.SelfMulSub(a,f),o-=l*(s.b2Vec2.CrossVV(this.m_rA,f)+b.z),n.SelfMulAdd(c,f),r+=u*(s.b2Vec2.CrossVV(this.m_rB,f)+b.z)}t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=r},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,c=this.m_qA.SetAngle(o),l=this.m_qB.SetAngle(a),u=this.m_invMassA,_=this.m_invMassB,m=this.m_invIA,h=this.m_invIB;s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var p=s.b2Rot.MulRV(c,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var f,b,d=s.b2Rot.MulRV(l,this.m_lalcB,this.m_rB),y=this.m_K;if(y.ex.x=u+_+p.y*p.y*m+d.y*d.y*h,y.ey.x=-p.y*p.x*m-d.y*d.x*h,y.ez.x=-p.y*m-d.y*h,y.ex.y=y.ey.x,y.ey.y=u+_+p.x*p.x*m+d.x*d.x*h,y.ez.y=p.x*m+d.x*h,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=m+h,this.m_frequencyHz>0){f=(V=s.b2Vec2.SubVV(s.b2Vec2.AddVV(n,d,s.b2Vec2.s_t0),s.b2Vec2.AddVV(i,p,s.b2Vec2.s_t1),e.SolvePositionConstraints_s_C1)).Length(),b=0;var v=y.Solve22(V.x,V.y,e.SolvePositionConstraints_s_P).SelfNeg();i.SelfMulSub(u,v),o-=m*s.b2Vec2.CrossVV(p,v),n.SelfMulAdd(_,v),a+=h*s.b2Vec2.CrossVV(d,v)}else{var V=s.b2Vec2.SubVV(s.b2Vec2.AddVV(n,d,s.b2Vec2.s_t0),s.b2Vec2.AddVV(i,p,s.b2Vec2.s_t1),e.SolvePositionConstraints_s_C1),x=a-o-this.m_referenceAngle;f=V.Length(),b=s.b2Abs(x);var C=y.Solve33(V.x,V.y,x,e.SolvePositionConstraints_s_impulse).SelfNeg();v=e.SolvePositionConstraints_s_P.Set(C.x,C.y),i.SelfMulSub(u,v),o-=m*(s.b2Vec2.CrossVV(this.m_rA,v)+C.z),n.SelfMulAdd(_,v),a+=h*(s.b2Vec2.CrossVV(this.m_rB,v)+C.z)}return t.positions[this.m_indexA].a=o,t.positions[this.m_indexB].a=a,f<=r.b2_linearSlop&&b<=r.b2_angularSlop},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},e.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.prototype.GetFrequency=function(){return this.m_frequencyHz},e.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.InitVelocityConstraints_s_P=new s.b2Vec2,e.SolveVelocityConstraints_s_Cdot1=new s.b2Vec2,e.SolveVelocityConstraints_s_impulse1=new s.b2Vec2,e.SolveVelocityConstraints_s_impulse=new s.b2Vec3,e.SolveVelocityConstraints_s_P=new s.b2Vec2,e.SolvePositionConstraints_s_C1=new s.b2Vec2,e.SolvePositionConstraints_s_P=new s.b2Vec2,e.SolvePositionConstraints_s_impulse=new s.b2Vec3,e}(a.b2Joint);i.b2WeldJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2WheelJoint:[function(t,e,i){"use strict";cc._RF.push(e,"6ea12jDYA1DDqv5pucK5Nz9","b2WheelJoint");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0}),i.b2WheelJoint=i.b2WheelJointDef=void 0;var r=t("../../Common/b2Settings"),s=t("../../Common/b2Math"),a=t("./b2Joint"),c=function(t){function e(){var e=t.call(this,a.b2JointType.e_wheelJoint)||this;return e.localAnchorA=new s.b2Vec2(0,0),e.localAnchorB=new s.b2Vec2(0,0),e.localAxisA=new s.b2Vec2(1,0),e.enableMotor=!1,e.maxMotorTorque=0,e.motorSpeed=0,e.frequencyHz=2,e.dampingRatio=.7,e}return n(e,t),e.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(o,this.localAxisA)},e}(a.b2JointDef);i.b2WheelJointDef=c;var l=function(t){function e(e){var i=t.call(this,e)||this;return i.m_frequencyHz=0,i.m_dampingRatio=0,i.m_localAnchorA=new s.b2Vec2,i.m_localAnchorB=new s.b2Vec2,i.m_localXAxisA=new s.b2Vec2,i.m_localYAxisA=new s.b2Vec2,i.m_impulse=0,i.m_motorImpulse=0,i.m_springImpulse=0,i.m_maxMotorTorque=0,i.m_motorSpeed=0,i.m_enableMotor=!1,i.m_indexA=0,i.m_indexB=0,i.m_localCenterA=new s.b2Vec2,i.m_localCenterB=new s.b2Vec2,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_ax=new s.b2Vec2,i.m_ay=new s.b2Vec2,i.m_sAx=0,i.m_sBx=0,i.m_sAy=0,i.m_sBy=0,i.m_mass=0,i.m_motorMass=0,i.m_springMass=0,i.m_bias=0,i.m_gamma=0,i.m_qA=new s.b2Rot,i.m_qB=new s.b2Rot,i.m_lalcA=new s.b2Vec2,i.m_lalcB=new s.b2Vec2,i.m_rA=new s.b2Vec2,i.m_rB=new s.b2Vec2,i.m_frequencyHz=r.b2Maybe(e.frequencyHz,2),i.m_dampingRatio=r.b2Maybe(e.dampingRatio,.7),i.m_localAnchorA.Copy(r.b2Maybe(e.localAnchorA,s.b2Vec2.ZERO)),i.m_localAnchorB.Copy(r.b2Maybe(e.localAnchorB,s.b2Vec2.ZERO)),i.m_localXAxisA.Copy(r.b2Maybe(e.localAxisA,s.b2Vec2.UNITX)),s.b2Vec2.CrossOneV(i.m_localXAxisA,i.m_localYAxisA),i.m_maxMotorTorque=r.b2Maybe(e.maxMotorTorque,0),i.m_motorSpeed=r.b2Maybe(e.motorSpeed,0),i.m_enableMotor=r.b2Maybe(e.enableMotor,!1),i.m_ax.SetZero(),i.m_ay.SetZero(),i}return n(e,t),e.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.SetSpringFrequencyHz=function(t){this.m_frequencyHz=t},e.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},e.prototype.SetSpringDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},e.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_invMassA,o=this.m_invMassB,n=this.m_invIA,a=this.m_invIB,c=t.positions[this.m_indexA].c,l=t.positions[this.m_indexA].a,u=t.velocities[this.m_indexA].v,_=t.velocities[this.m_indexA].w,m=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,p=t.velocities[this.m_indexB].v,f=t.velocities[this.m_indexB].w,b=this.m_qA.SetAngle(l),d=this.m_qB.SetAngle(h);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=s.b2Rot.MulRV(b,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var v=s.b2Rot.MulRV(d,this.m_lalcB,this.m_rB),V=s.b2Vec2.SubVV(s.b2Vec2.AddVV(m,v,s.b2Vec2.s_t0),s.b2Vec2.AddVV(c,y,s.b2Vec2.s_t1),e.InitVelocityConstraints_s_d);if(s.b2Rot.MulRV(b,this.m_localYAxisA,this.m_ay),this.m_sAy=s.b2Vec2.CrossVV(s.b2Vec2.AddVV(V,y,s.b2Vec2.s_t0),this.m_ay),this.m_sBy=s.b2Vec2.CrossVV(v,this.m_ay),this.m_mass=i+o+n*this.m_sAy*this.m_sAy+a*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){s.b2Rot.MulRV(b,this.m_localXAxisA,this.m_ax),this.m_sAx=s.b2Vec2.CrossVV(s.b2Vec2.AddVV(V,y,s.b2Vec2.s_t0),this.m_ax),this.m_sBx=s.b2Vec2.CrossVV(v,this.m_ax);var x=i+o+n*this.m_sAx*this.m_sAx+a*this.m_sBx*this.m_sBx;if(x>0){this.m_springMass=1/x;var C=s.b2Vec2.DotVV(V,this.m_ax),S=2*r.b2_pi*this.m_frequencyHz,B=2*this.m_springMass*this.m_dampingRatio*S,g=this.m_springMass*S*S,A=t.step.dt;this.m_gamma=A*(B+A*g),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=C*A*g*this.m_gamma,this.m_springMass=x+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+a,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var w=s.b2Vec2.AddVV(s.b2Vec2.MulSV(this.m_impulse,this.m_ay,s.b2Vec2.s_t0),s.b2Vec2.MulSV(this.m_springImpulse,this.m_ax,s.b2Vec2.s_t1),e.InitVelocityConstraints_s_P),M=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,P=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;u.SelfMulSub(this.m_invMassA,w),_-=this.m_invIA*M,p.SelfMulAdd(this.m_invMassB,w),f+=this.m_invIB*P}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=_,t.velocities[this.m_indexB].w=f},e.prototype.SolveVelocityConstraints=function(t){var i=this.m_invMassA,o=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,a=t.velocities[this.m_indexA].v,c=t.velocities[this.m_indexA].w,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,_=s.b2Vec2.DotVV(this.m_ax,s.b2Vec2.SubVV(l,a,s.b2Vec2.s_t0))+this.m_sBx*u-this.m_sAx*c,m=-this.m_springMass*(_+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=m;var h=s.b2Vec2.MulSV(m,this.m_ax,e.SolveVelocityConstraints_s_P),p=m*this.m_sAx,f=m*this.m_sBx;a.SelfMulSub(i,h),c-=n*p,l.SelfMulAdd(o,h),_=(u+=r*f)-c-this.m_motorSpeed,m=-this.m_motorMass*_;var b=this.m_motorImpulse,d=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=s.b2Clamp(this.m_motorImpulse+m,-d,d),c-=n*(m=this.m_motorImpulse-b),u+=r*m,_=s.b2Vec2.DotVV(this.m_ay,s.b2Vec2.SubVV(l,a,s.b2Vec2.s_t0))+this.m_sBy*u-this.m_sAy*c,m=-this.m_mass*_,this.m_impulse+=m,h=s.b2Vec2.MulSV(m,this.m_ay,e.SolveVelocityConstraints_s_P),p=m*this.m_sAy,f=m*this.m_sBy,a.SelfMulSub(i,h),c-=n*p,l.SelfMulAdd(o,h),u+=r*f,t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=u},e.prototype.SolvePositionConstraints=function(t){var i=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,c=this.m_qA.SetAngle(o),l=this.m_qB.SetAngle(a);s.b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=s.b2Rot.MulRV(c,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var _,m=s.b2Rot.MulRV(l,this.m_lalcB,this.m_rB),h=s.b2Vec2.AddVV(s.b2Vec2.SubVV(n,i,s.b2Vec2.s_t0),s.b2Vec2.SubVV(m,u,s.b2Vec2.s_t1),e.SolvePositionConstraints_s_d),p=s.b2Rot.MulRV(c,this.m_localYAxisA,this.m_ay),f=s.b2Vec2.CrossVV(s.b2Vec2.AddVV(h,u,s.b2Vec2.s_t0),p),b=s.b2Vec2.CrossVV(m,p),d=s.b2Vec2.DotVV(h,this.m_ay),y=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;_=0!==y?-d/y:0;var v=s.b2Vec2.MulSV(_,p,e.SolvePositionConstraints_s_P),V=_*f,x=_*b;return i.SelfMulSub(this.m_invMassA,v),o-=this.m_invIA*V,n.SelfMulAdd(this.m_invMassB,v),a+=this.m_invIB*x,t.positions[this.m_indexA].a=o,t.positions[this.m_indexB].a=a,s.b2Abs(d)<=r.b2_linearSlop},e.prototype.GetDefinition=function(t){return t},e.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e},e.prototype.GetReactionTorque=function(t){return t*this.m_motorImpulse},e.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},e.prototype.GetJointTranslation=function(){return this.GetPrismaticJointTranslation()},e.prototype.GetJointLinearSpeed=function(){return this.GetPrismaticJointSpeed()},e.prototype.GetJointAngle=function(){return this.GetRevoluteJointAngle()},e.prototype.GetJointAngularSpeed=function(){return this.GetRevoluteJointSpeed()},e.prototype.GetPrismaticJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new s.b2Vec2),o=e.GetWorldPoint(this.m_localAnchorB,new s.b2Vec2),n=s.b2Vec2.SubVV(o,i,new s.b2Vec2),r=t.GetWorldVector(this.m_localXAxisA,new s.b2Vec2);return s.b2Vec2.DotVV(n,r)},e.prototype.GetPrismaticJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB;s.b2Vec2.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=s.b2Rot.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);s.b2Vec2.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var o=s.b2Rot.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=s.b2Vec2.AddVV(t.m_sweep.c,i,s.b2Vec2.s_t0),r=s.b2Vec2.AddVV(e.m_sweep.c,o,s.b2Vec2.s_t1),a=s.b2Vec2.SubVV(r,n,s.b2Vec2.s_t2),c=t.GetWorldVector(this.m_localXAxisA,new s.b2Vec2),l=t.m_linearVelocity,u=e.m_linearVelocity,_=t.m_angularVelocity,m=e.m_angularVelocity;return s.b2Vec2.DotVV(a,s.b2Vec2.CrossSV(_,c,s.b2Vec2.s_t0))+s.b2Vec2.DotVV(c,s.b2Vec2.SubVV(s.b2Vec2.AddVCrossSV(u,m,o,s.b2Vec2.s_t0),s.b2Vec2.AddVCrossSV(l,_,i,s.b2Vec2.s_t1),s.b2Vec2.s_t0))},e.prototype.GetRevoluteJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a},e.prototype.GetRevoluteJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},e.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},e.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},e.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},e.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e.InitVelocityConstraints_s_d=new s.b2Vec2,e.InitVelocityConstraints_s_P=new s.b2Vec2,e.SolveVelocityConstraints_s_P=new s.b2Vec2,e.SolvePositionConstraints_s_d=new s.b2Vec2,e.SolvePositionConstraints_s_P=new s.b2Vec2,e}(a.b2Joint);i.b2WheelJoint=l,cc._RF.pop()},{"../../Common/b2Math":"b2Math","../../Common/b2Settings":"b2Settings","./b2Joint":"b2Joint"}],b2WorldCallbacks:[function(t,e,i){"use strict";cc._RF.push(e,"21126HdY0hA2IaoSnOO6Xxv","b2WorldCallbacks"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2RayCastCallback=i.b2QueryCallback=i.b2ContactListener=i.b2ContactImpulse=i.b2ContactFilter=i.b2DestructionListener=void 0;var o=t("../Common/b2Settings"),n=t("./b2Body"),r=function(){function t(){}return t.prototype.SayGoodbyeJoint=function(){},t.prototype.SayGoodbyeFixture=function(){},t.prototype.SayGoodbyeParticleGroup=function(){},t.prototype.SayGoodbyeParticle=function(){},t}();i.b2DestructionListener=r;var s=function(){function t(){}return t.prototype.ShouldCollide=function(t,e){var i=t.GetBody(),o=e.GetBody();if(o.GetType()===n.b2BodyType.b2_staticBody&&i.GetType()===n.b2BodyType.b2_staticBody)return!1;if(!o.ShouldCollideConnected(i))return!1;var r=t.GetFilterData(),s=e.GetFilterData();return r.groupIndex===s.groupIndex&&0!==r.groupIndex?r.groupIndex>0:0!=(r.maskBits&s.categoryBits)&&0!=(r.categoryBits&s.maskBits)},t.prototype.ShouldCollideFixtureParticle=function(){return!0},t.prototype.ShouldCollideParticleParticle=function(){return!0},t.b2_defaultFilter=new t,t}();i.b2ContactFilter=s;i.b2ContactImpulse=function(){this.normalImpulses=o.b2MakeNumberArray(o.b2_maxManifoldPoints),this.tangentImpulses=o.b2MakeNumberArray(o.b2_maxManifoldPoints),this.count=0};var a=function(){function t(){}return t.prototype.BeginContact=function(){},t.prototype.EndContact=function(){},t.prototype.BeginContactFixtureParticle=function(){},t.prototype.EndContactFixtureParticle=function(){},t.prototype.BeginContactParticleParticle=function(){},t.prototype.EndContactParticleParticle=function(){},t.prototype.PreSolve=function(){},t.prototype.PostSolve=function(){},t.b2_defaultListener=new t,t}();i.b2ContactListener=a;var c=function(){function t(){}return t.prototype.ReportFixture=function(){return!0},t.prototype.ReportParticle=function(){return!1},t.prototype.ShouldQueryParticleSystem=function(){return!0},t}();i.b2QueryCallback=c;var l=function(){function t(){}return t.prototype.ReportFixture=function(t,e,i,o){return o},t.prototype.ReportParticle=function(){return 0},t.prototype.ShouldQueryParticleSystem=function(){return!0},t}();i.b2RayCastCallback=l,cc._RF.pop()},{"../Common/b2Settings":"b2Settings","./b2Body":"b2Body"}],b2World:[function(t,e,i){"use strict";cc._RF.push(e,"bf24ayjAvxLab4vn9ywIv1Q","b2World"),Object.defineProperty(i,"__esModule",{value:!0}),i.b2World=void 0;var o=t("../Common/b2Settings"),n=t("../Common/b2Math"),r=t("../Common/b2Timer"),s=t("../Common/b2Draw"),a=t("../Collision/b2Collision"),c=t("../Collision/b2TimeOfImpact"),l=t("../Collision/Shapes/b2Shape"),u=t("./Joints/b2Joint"),_=t("./Joints/b2AreaJoint"),m=t("./Joints/b2DistanceJoint"),h=t("./Joints/b2FrictionJoint"),p=t("./Joints/b2GearJoint"),f=t("./Joints/b2MotorJoint"),b=t("./Joints/b2MouseJoint"),d=t("./Joints/b2PrismaticJoint"),y=t("./Joints/b2PulleyJoint"),v=t("./Joints/b2RevoluteJoint"),V=t("./Joints/b2RopeJoint"),x=t("./Joints/b2WeldJoint"),C=t("./Joints/b2WheelJoint"),S=t("./b2Body"),B=t("./b2ContactManager"),g=t("./b2Island"),A=t("./b2TimeStep"),w=t("./b2WorldCallbacks"),M=t("./b2WorldCallbacks"),P=t("../Common/b2Settings"),D=t("../Particle/b2Particle"),R=t("../Particle/b2ParticleSystem"),F=function(){function t(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new B.b2ContactManager,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new n.b2Vec2,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new A.b2Profile,this.m_island=new g.b2Island,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}return t.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},t.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},t.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},t.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},t.prototype.CreateBody=function(t){if(void 0===t&&(t={}),this.IsLocked())throw new Error;var e=new S.b2Body(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},t.prototype.DestroyBody=function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_controllerList;o;){var n=o;o=o.nextController,n.controller.RemoveBody(t)}for(var r=t.m_contactList;r;){var s=r;r=r.next,this.m_contactManager.Destroy(s.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var c=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxies(),c.Reset(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount},t._Joint_Create=function(t){switch(t.type){case u.b2JointType.e_distanceJoint:return new m.b2DistanceJoint(t);case u.b2JointType.e_mouseJoint:return new b.b2MouseJoint(t);case u.b2JointType.e_prismaticJoint:return new d.b2PrismaticJoint(t);case u.b2JointType.e_revoluteJoint:return new v.b2RevoluteJoint(t);case u.b2JointType.e_pulleyJoint:return new y.b2PulleyJoint(t);case u.b2JointType.e_gearJoint:return new p.b2GearJoint(t);case u.b2JointType.e_wheelJoint:return new C.b2WheelJoint(t);case u.b2JointType.e_weldJoint:return new x.b2WeldJoint(t);case u.b2JointType.e_frictionJoint:return new h.b2FrictionJoint(t);case u.b2JointType.e_ropeJoint:return new V.b2RopeJoint(t);case u.b2JointType.e_motorJoint:return new f.b2MotorJoint(t);case u.b2JointType.e_areaJoint:return new _.b2AreaJoint(t)}throw new Error},t._Joint_Destroy=function(){},t.prototype.CreateJoint=function(e){if(this.IsLocked())throw new Error;var i=t._Joint_Create(e);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var o=i.m_bodyA,n=i.m_bodyB;if(!i.m_collideConnected)for(var r=n.GetContactList();r;)r.other===o&&r.contact.FlagForFiltering(),r=r.next;return i},t.prototype.DestroyJoint=function(e){if(this.IsLocked())throw new Error;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e===this.m_jointList&&(this.m_jointList=e.m_next);var i=e.m_bodyA,o=e.m_bodyB,n=e.m_collideConnected;if(i.SetAwake(!0),o.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA===i.m_jointList&&(i.m_jointList=e.m_edgeA.next),e.m_edgeA.Reset(),e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB===o.m_jointList&&(o.m_jointList=e.m_edgeB.next),e.m_edgeB.Reset(),t._Joint_Destroy(e),--this.m_jointCount,!n)for(var r=o.GetContactList();r;)r.other===i&&r.contact.FlagForFiltering(),r=r.next},t.prototype.CreateParticleSystem=function(t){if(this.IsLocked())throw new Error;var e=new R.b2ParticleSystem(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e},t.prototype.DestroyParticleSystem=function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)},t.prototype.CalculateReasonableParticleIterations=function(t){return null===this.m_particleSystemList?1:D.b2CalculateParticleIterations(this.m_gravity.Length(),function(t){for(var e=P.b2_maxFloat,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=n.b2Min(e,i.GetRadius());return e}(this),t)},t.prototype.Step=function(e,i,o,n){void 0===n&&(n=this.CalculateReasonableParticleIterations(e));var r=t.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var s=t.Step_s_step;s.dt=e,s.velocityIterations=i,s.positionIterations=o,s.particleIterations=n,s.inv_dt=e>0?1/e:0,s.dtRatio=this.m_inv_dt0*e,s.warmStarting=this.m_warmStarting;var a=t.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=a.GetMilliseconds(),this.m_stepComplete&&s.dt>0){for(var c=t.Step_s_timer.Reset(),l=this.m_particleSystemList;l;l=l.m_next)l.Solve(s);this.Solve(s),this.m_profile.solve=c.GetMilliseconds()}if(this.m_continuousPhysics&&s.dt>0){var u=t.Step_s_timer.Reset();this.SolveTOI(s),this.m_profile.solveTOI=u.GetMilliseconds()}s.dt>0&&(this.m_inv_dt0=s.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=r.GetMilliseconds()},t.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},t.prototype.DrawParticleSystem=function(t){if(null!==this.m_debugDraw){var e=t.GetParticleCount();if(e){var i=t.GetRadius(),o=t.GetPositionBuffer();if(t.m_colorBuffer.data){var n=t.GetColorBuffer();this.m_debugDraw.DrawParticles(o,i,n,e)}else this.m_debugDraw.DrawParticles(o,i,null,e)}}},t.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){var e=this.m_debugDraw.GetFlags(),i=t.DrawDebugData_s_color.SetRGB(0,0,0);if(e&s.b2DrawFlags.e_shapeBit)for(var o=this.m_bodyList;o;o=o.m_next){var n=o.m_xf;this.m_debugDraw.PushTransform(n);for(var r=o.GetFixtureList();r;r=r.m_next)o.IsActive()?o.GetType()===S.b2BodyType.b2_staticBody?(i.SetRGB(.5,.9,.5),this.DrawShape(r,i)):o.GetType()===S.b2BodyType.b2_kinematicBody?(i.SetRGB(.5,.5,.9),this.DrawShape(r,i)):o.IsAwake()?(i.SetRGB(.9,.7,.7),this.DrawShape(r,i)):(i.SetRGB(.6,.6,.6),this.DrawShape(r,i)):(i.SetRGB(.5,.5,.3),this.DrawShape(r,i));this.m_debugDraw.PopTransform(n)}if(e&s.b2DrawFlags.e_particleBit)for(var a=this.m_particleSystemList;a;a=a.m_next)this.DrawParticleSystem(a);if(e&s.b2DrawFlags.e_jointBit)for(var c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(e&s.b2DrawFlags.e_aabbBit){i.SetRGB(.9,.3,.9);var l=t.DrawDebugData_s_vs;for(o=this.m_bodyList;o;o=o.m_next)if(o.IsActive())for(r=o.GetFixtureList();r;r=r.m_next)for(var u=0;u<r.m_proxyCount;++u){var _=r.m_proxies[u].treeNode.aabb;l[0].Set(_.lowerBound.x,_.lowerBound.y),l[1].Set(_.upperBound.x,_.lowerBound.y),l[2].Set(_.upperBound.x,_.upperBound.y),l[3].Set(_.lowerBound.x,_.upperBound.y),this.m_debugDraw.DrawPolygon(l,4,i)}}if(e&s.b2DrawFlags.e_centerOfMassBit)for(o=this.m_bodyList;o;o=o.m_next)(n=t.DrawDebugData_s_xf).q.Copy(o.m_xf.q),n.p.Copy(o.GetWorldCenter()),this.m_debugDraw.DrawTransform(n);if(e&s.b2DrawFlags.e_controllerBit)for(var m=this.m_controllerList;m;m=m.m_next)m.Draw(this.m_debugDraw)}},t.prototype.QueryAABB=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]instanceof w.b2QueryCallback?this._QueryAABB(t[0],t[1]):this._QueryAABB(null,t[0],t[1])},t.prototype._QueryAABB=function(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,function(e){var o=e.userData.fixture;return t?t.ReportFixture(o):!i||i(o)}),t instanceof w.b2QueryCallback)for(var o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.QueryAABB(t,e)},t.prototype.QueryAllAABB=function(t,e){return void 0===e&&(e=[]),this.QueryAABB(t,function(t){return e.push(t),!0}),e},t.prototype.QueryPointAABB=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]instanceof w.b2QueryCallback?this._QueryPointAABB(t[0],t[1]):this._QueryPointAABB(null,t[0],t[1])},t.prototype._QueryPointAABB=function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,function(e){var o=e.userData.fixture;return t?t.ReportFixture(o):!i||i(o)}),t instanceof w.b2QueryCallback)for(var o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.QueryPointAABB(t,e)},t.prototype.QueryAllPointAABB=function(t,e){return void 0===e&&(e=[]),this.QueryPointAABB(t,function(t){return e.push(t),!0}),e},t.prototype.QueryFixtureShape=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]instanceof w.b2QueryCallback?this._QueryFixtureShape(t[0],t[1],t[2],t[3]):this._QueryFixtureShape(null,t[0],t[1],t[2],t[3])},t.prototype._QueryFixtureShape=function(e,i,o,n,r){var s=t.QueryFixtureShape_s_aabb;if(i.ComputeAABB(s,n,o),this.m_contactManager.m_broadPhase.Query(s,function(t){var s=t.userData,c=s.fixture;if(a.b2TestOverlapShape(i,o,c.GetShape(),s.childIndex,n,c.GetBody().GetTransform())){if(e)return e.ReportFixture(c);if(r)return r(c)}return!0}),e instanceof w.b2QueryCallback)for(var c=this.m_particleSystemList;c;c=c.m_next)e.ShouldQueryParticleSystem(c)&&c.QueryAABB(e,s)},t.prototype.QueryAllFixtureShape=function(t,e,i,o){return void 0===o&&(o=[]),this.QueryFixtureShape(t,e,i,function(t){return o.push(t),!0}),o},t.prototype.QueryFixturePoint=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]instanceof w.b2QueryCallback?this._QueryFixturePoint(t[0],t[1]):this._QueryFixturePoint(null,t[0],t[1])},t.prototype._QueryFixturePoint=function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,function(o){var n=o.userData.fixture;if(n.TestPoint(e)){if(t)return t.ReportFixture(n);if(i)return i(n)}return!0}),t)for(var o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.QueryPointAABB(t,e)},t.prototype.QueryAllFixturePoint=function(t,e){return void 0===e&&(e=[]),this.QueryFixturePoint(t,function(t){return e.push(t),!0}),e},t.prototype.RayCast=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]instanceof M.b2RayCastCallback?this._RayCast(t[0],t[1],t[2]):this._RayCast(null,t[0],t[1],t[2])},t.prototype._RayCast=function(e,i,o,n){var r=t.RayCast_s_input;if(r.maxFraction=1,r.p1.Copy(i),r.p2.Copy(o),this.m_contactManager.m_broadPhase.RayCast(r,function(r,s){var a=s.userData,c=a.fixture,l=a.childIndex,u=t.RayCast_s_output;if(c.RayCast(u,r,l)){var _=u.fraction,m=t.RayCast_s_point;if(m.Set((1-_)*i.x+_*o.x,(1-_)*i.y+_*o.y),e)return e.ReportFixture(c,m,u.normal,_);if(n)return n(c,m,u.normal,_)}return r.maxFraction}),e)for(var s=this.m_particleSystemList;s;s=s.m_next)e.ShouldQueryParticleSystem(s)&&s.RayCast(e,i,o)},t.prototype.RayCastOne=function(t,e){var i=null,o=1;return this.RayCast(t,e,function(t,e,n,r){return r<o&&(o=r,i=t),o}),i},t.prototype.RayCastAll=function(t,e,i){return void 0===i&&(i=[]),this.RayCast(t,e,function(t){return i.push(t),1}),i},t.prototype.GetBodyList=function(){return this.m_bodyList},t.prototype.GetJointList=function(){return this.m_jointList},t.prototype.GetParticleSystemList=function(){return this.m_particleSystemList},t.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},t.prototype.SetAllowSleeping=function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},t.prototype.GetAllowSleeping=function(){return this.m_allowSleep},t.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},t.prototype.GetWarmStarting=function(){return this.m_warmStarting},t.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},t.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},t.prototype.SetSubStepping=function(t){this.m_subStepping=t},t.prototype.GetSubStepping=function(){return this.m_subStepping},t.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},t.prototype.GetBodyCount=function(){return this.m_bodyCount},t.prototype.GetJointCount=function(){return this.m_jointCount},t.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},t.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},t.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},t.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},t.prototype.SetGravity=function(t,e){if(void 0===e&&(e=!0),!n.b2Vec2.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)},t.prototype.GetGravity=function(){return this.m_gravity},t.prototype.IsLocked=function(){return this.m_locked},t.prototype.SetAutoClearForces=function(t){this.m_clearForces=t},t.prototype.GetAutoClearForces=function(){return this.m_clearForces},t.prototype.ShiftOrigin=function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)},t.prototype.GetContactManager=function(){return this.m_contactManager},t.prototype.GetProfile=function(){return this.m_profile},t.prototype.Dump=function(t){if(!this.m_locked){t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n");for(var e=0,i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;e=0;for(var o=this.m_jointList;o;o=o.m_next)o.m_index=e,++e;for(o=this.m_jointList;o;o=o.m_next)o.m_type!==u.b2JointType.e_gearJoint&&(t("{\n"),o.Dump(t),t("}\n"));for(o=this.m_jointList;o;o=o.m_next)o.m_type===u.b2JointType.e_gearJoint&&(t("{\n"),o.Dump(t),t("}\n"))}},t.prototype.DrawJoint=function(e){if(null!==this.m_debugDraw){var i=e.GetBodyA(),o=e.GetBodyB(),n=i.m_xf,r=o.m_xf,s=n.p,a=r.p,c=e.GetAnchorA(t.DrawJoint_s_p1),l=e.GetAnchorB(t.DrawJoint_s_p2),_=t.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(e.m_type){case u.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(c,l,_);break;case u.b2JointType.e_pulleyJoint:var m=e,h=m.GetGroundAnchorA(),p=m.GetGroundAnchorB();this.m_debugDraw.DrawSegment(h,c,_),this.m_debugDraw.DrawSegment(p,l,_),this.m_debugDraw.DrawSegment(h,p,_);break;case u.b2JointType.e_mouseJoint:var f=t.DrawJoint_s_c;f.Set(0,1,0),this.m_debugDraw.DrawPoint(c,4,f),this.m_debugDraw.DrawPoint(l,4,f),f.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(c,l,f);break;default:this.m_debugDraw.DrawSegment(s,c,_),this.m_debugDraw.DrawSegment(c,l,_),this.m_debugDraw.DrawSegment(a,l,_)}}},t.prototype.DrawShape=function(e,i){if(null!==this.m_debugDraw){var o=e.GetShape();switch(o.m_type){case l.b2ShapeType.e_circleShape:var r=o,s=r.m_p,a=r.m_radius,c=n.b2Vec2.UNITX;this.m_debugDraw.DrawSolidCircle(s,a,c,i);break;case l.b2ShapeType.e_edgeShape:var u=o,_=u.m_vertex1,m=u.m_vertex2;this.m_debugDraw.DrawSegment(_,m,i);break;case l.b2ShapeType.e_chainShape:var h=o,p=h.m_count,f=h.m_vertices,b=t.DrawShape_s_ghostColor.SetRGBA(.75*i.r,.75*i.g,.75*i.b,i.a);if(_=f[0],this.m_debugDraw.DrawPoint(_,4,i),h.m_hasPrevVertex){var d=h.m_prevVertex;this.m_debugDraw.DrawSegment(d,_,b),this.m_debugDraw.DrawCircle(d,.1,b)}for(var y=1;y<p;++y)m=f[y],this.m_debugDraw.DrawSegment(_,m,i),this.m_debugDraw.DrawPoint(m,4,i),_=m;if(h.m_hasNextVertex){var v=h.m_nextVertex;this.m_debugDraw.DrawSegment(v,_,b),this.m_debugDraw.DrawCircle(v,.1,b)}break;case l.b2ShapeType.e_polygonShape:var V=o,x=V.m_count;f=V.m_vertices,this.m_debugDraw.DrawSolidPolygon(f,x,i)}}},t.prototype.Solve=function(t){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf0.Copy(e.m_xf);for(var i=this.m_controllerList;i;i=i.m_next)i.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var o=this.m_island;for(o.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener),e=this.m_bodyList;e;e=e.m_next)e.m_islandFlag=!1;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_islandFlag=!1;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var a=this.s_stack,c=this.m_bodyList;c;c=c.m_next)if(!c.m_islandFlag&&c.IsAwake()&&c.IsActive()&&c.GetType()!==S.b2BodyType.b2_staticBody){o.Clear();var l=0;for(a[l++]=c,c.m_islandFlag=!0;l>0;){if(!(e=a[--l]))throw new Error;if(o.AddBody(e),e.m_awakeFlag=!0,e.GetType()!==S.b2BodyType.b2_staticBody){for(var u=e.m_contactList;u;u=u.next){var _=u.contact;if(!_.m_islandFlag&&_.IsEnabled()&&_.IsTouching()){var m=_.m_fixtureA.m_isSensor,h=_.m_fixtureB.m_isSensor;m||h||(o.AddContact(_),_.m_islandFlag=!0,(f=u.other).m_islandFlag||(a[l++]=f,f.m_islandFlag=!0))}}for(var p=e.m_jointList;p;p=p.next){var f;p.joint.m_islandFlag||(f=p.other).IsActive()&&(o.AddJoint(p.joint),p.joint.m_islandFlag=!0,f.m_islandFlag||(a[l++]=f,f.m_islandFlag=!0))}}}var b=new A.b2Profile;o.Solve(b,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=b.solveInit,this.m_profile.solveVelocity+=b.solveVelocity,this.m_profile.solvePosition+=b.solvePosition;for(var d=0;d<o.m_bodyCount;++d)(e=o.m_bodies[d]).GetType()===S.b2BodyType.b2_staticBody&&(e.m_islandFlag=!1)}for(d=0;d<a.length&&a[d];++d)a[d]=null;var y=new r.b2Timer;for(e=this.m_bodyList;e;e=e.m_next)e.m_islandFlag&&e.GetType()!==S.b2BodyType.b2_staticBody&&e.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=y.GetMilliseconds()},t.prototype.SolveTOI=function(e){var i=this.m_island;if(i.Initialize(2*o.b2_maxTOIContacts,o.b2_maxTOIContacts,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var r=this.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1,r.m_sweep.alpha0=0;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_toiFlag=!1,s.m_islandFlag=!1,s.m_toiCount=0,s.m_toi=1}for(;;){var a=null,l=1;for(s=this.m_contactManager.m_contactList;s;s=s.m_next)if(s.IsEnabled()&&!(s.m_toiCount>o.b2_maxSubSteps)){var u=1;if(s.m_toiFlag)u=s.m_toi;else{var _=s.GetFixtureA(),m=s.GetFixtureB();if(_.IsSensor()||m.IsSensor())continue;var h=_.GetBody(),p=m.GetBody(),f=h.m_type,b=p.m_type,d=h.IsAwake()&&f!==S.b2BodyType.b2_staticBody,y=p.IsAwake()&&b!==S.b2BodyType.b2_staticBody;if(!d&&!y)continue;var v=h.IsBullet()||f!==S.b2BodyType.b2_dynamicBody,V=p.IsBullet()||b!==S.b2BodyType.b2_dynamicBody;if(!v&&!V)continue;var x=h.m_sweep.alpha0;h.m_sweep.alpha0<p.m_sweep.alpha0?(x=p.m_sweep.alpha0,h.m_sweep.Advance(x)):p.m_sweep.alpha0<h.m_sweep.alpha0&&(x=h.m_sweep.alpha0,p.m_sweep.Advance(x));var C=s.GetChildIndexA(),B=s.GetChildIndexB(),g=t.SolveTOI_s_toi_input;g.proxyA.SetShape(_.GetShape(),C),g.proxyB.SetShape(m.GetShape(),B),g.sweepA.Copy(h.m_sweep),g.sweepB.Copy(p.m_sweep),g.tMax=1;var A=t.SolveTOI_s_toi_output;c.b2TimeOfImpact(A,g);var w=A.t;u=A.state===c.b2TOIOutputState.e_touching?n.b2Min(x+(1-x)*w,1):1,s.m_toi=u,s.m_toiFlag=!0}u<l&&(a=s,l=u)}if(null===a||1-10*o.b2_epsilon<l){this.m_stepComplete=!0;break}var M=a.GetFixtureA(),P=a.GetFixtureB(),D=M.GetBody(),R=P.GetBody(),F=t.SolveTOI_s_backup1.Copy(D.m_sweep),G=t.SolveTOI_s_backup2.Copy(R.m_sweep);if(D.Advance(l),R.Advance(l),a.Update(this.m_contactManager.m_contactListener),a.m_toiFlag=!1,++a.m_toiCount,a.IsEnabled()&&a.IsTouching()){D.SetAwake(!0),R.SetAwake(!0),i.Clear(),i.AddBody(D),i.AddBody(R),i.AddContact(a),D.m_islandFlag=!0,R.m_islandFlag=!0,a.m_islandFlag=!0;for(var I=0;I<2;++I)if((q=0===I?D:R).m_type===S.b2BodyType.b2_dynamicBody)for(var T=q.m_contactList;T&&i.m_bodyCount!==i.m_bodyCapacity&&i.m_contactCount!==i.m_contactCapacity;T=T.next){var L=T.contact;if(!L.m_islandFlag){var E=T.other;if(E.m_type!==S.b2BodyType.b2_dynamicBody||q.IsBullet()||E.IsBullet()){var J=L.m_fixtureA.m_isSensor,O=L.m_fixtureB.m_isSensor;if(!J&&!O){var k=t.SolveTOI_s_backup.Copy(E.m_sweep);E.m_islandFlag||E.Advance(l),L.Update(this.m_contactManager.m_contactListener),L.IsEnabled()&&L.IsTouching()?(L.m_islandFlag=!0,i.AddContact(L),E.m_islandFlag||(E.m_islandFlag=!0,E.m_type!==S.b2BodyType.b2_staticBody&&E.SetAwake(!0),i.AddBody(E))):(E.m_sweep.Copy(k),E.SynchronizeTransform())}}}}var j=t.SolveTOI_s_subStep;for(j.dt=(1-l)*e.dt,j.inv_dt=1/j.dt,j.dtRatio=1,j.positionIterations=20,j.velocityIterations=e.velocityIterations,j.particleIterations=e.particleIterations,j.warmStarting=!1,i.SolveTOI(j,D.m_islandIndex,R.m_islandIndex),I=0;I<i.m_bodyCount;++I){var q;if((q=i.m_bodies[I]).m_islandFlag=!1,q.m_type===S.b2BodyType.b2_dynamicBody)for(q.SynchronizeFixtures(),T=q.m_contactList;T;T=T.next)T.contact.m_toiFlag=!1,T.contact.m_islandFlag=!1}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else a.SetEnabled(!1),D.m_sweep.Copy(F),R.m_sweep.Copy(G),D.SynchronizeTransform(),R.SynchronizeTransform()}},t.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t},t.prototype.RemoveController=function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t},t.Step_s_step=new A.b2TimeStep,t.Step_s_stepTimer=new r.b2Timer,t.Step_s_timer=new r.b2Timer,t.DrawDebugData_s_color=new s.b2Color(0,0,0),t.DrawDebugData_s_vs=n.b2Vec2.MakeArray(4),t.DrawDebugData_s_xf=new n.b2Transform,t.QueryFixtureShape_s_aabb=new a.b2AABB,t.RayCast_s_input=new a.b2RayCastInput,t.RayCast_s_output=new a.b2RayCastOutput,t.RayCast_s_point=new n.b2Vec2,t.DrawJoint_s_p1=new n.b2Vec2,t.DrawJoint_s_p2=new n.b2Vec2,t.DrawJoint_s_color=new s.b2Color(.5,.8,.8),t.DrawJoint_s_c=new s.b2Color,t.DrawShape_s_ghostColor=new s.b2Color,t.SolveTOI_s_subStep=new A.b2TimeStep,t.SolveTOI_s_backup=new n.b2Sweep,t.SolveTOI_s_backup1=new n.b2Sweep,t.SolveTOI_s_backup2=new n.b2Sweep,t.SolveTOI_s_toi_input=new c.b2TOIInput,t.SolveTOI_s_toi_output=new c.b2TOIOutput,t}();i.b2World=F,cc._RF.pop()},{"../Collision/Shapes/b2Shape":"b2Shape","../Collision/b2Collision":"b2Collision","../Collision/b2TimeOfImpact":"b2TimeOfImpact","../Common/b2Draw":"b2Draw","../Common/b2Math":"b2Math","../Common/b2Settings":"b2Settings","../Common/b2Timer":"b2Timer","../Particle/b2Particle":"b2Particle","../Particle/b2ParticleSystem":"b2ParticleSystem","./Joints/b2AreaJoint":"b2AreaJoint","./Joints/b2DistanceJoint":"b2DistanceJoint","./Joints/b2FrictionJoint":"b2FrictionJoint","./Joints/b2GearJoint":"b2GearJoint","./Joints/b2Joint":"b2Joint","./Joints/b2MotorJoint":"b2MotorJoint","./Joints/b2MouseJoint":"b2MouseJoint","./Joints/b2PrismaticJoint":"b2PrismaticJoint","./Joints/b2PulleyJoint":"b2PulleyJoint","./Joints/b2RevoluteJoint":"b2RevoluteJoint","./Joints/b2RopeJoint":"b2RopeJoint","./Joints/b2WeldJoint":"b2WeldJoint","./Joints/b2WheelJoint":"b2WheelJoint","./b2Body":"b2Body","./b2ContactManager":"b2ContactManager","./b2Island":"b2Island","./b2TimeStep":"b2TimeStep","./b2WorldCallbacks":"b2WorldCallbacks"}]},{},["Index","Jiang","Setting","AddCtrl","ApplyCtrl","ArgsPromiseCtrl","CollectionStorage","Define","EmptyPromiseCtrl","EventerNoArgs","EventerWithArgs","FrameMsClock","IdGeneration","MulCtrl","UnitaryCtrl","UtilCollection","UtilColor","UtilDecoration","UtilMath","UtilObject","ViewLoading","MgrCfg","ConfigBullet","ConfigBulletAIStraight","ConfigCommon","ConfigConave","ConfigEff","ConfigGun","ConfigMixMark","ConfigPlane","ConfigRelease","MgrRes","MgrView","MgrViewBasicCtrl","MgrViewBasicRegistMsg","MgrViewInitData","MgrViewNoArgsViewBasic","MgrViewOpenCtrl","MgrViewWithArgsRegistMsg","MgrViewWithArgsViewBasic","ViewRegistMsg","ConfigCenter","DataCenter","Box2DDrawer","CheckBox","RadioBtn","ExamContext","ViewMain","B2ExamBuoyancy","B2ExamCantilever","B2ExamCharacterCollision","B2ExamConveyorBelt","B2ExamEdgeShapes","B2ExamGearsA","B2ExamGearsB","B2ExamMobile","B2ExamMobileBalanced","B2ExamMotorJoint","B2ExamOneSidePlatform","B2ExamParticleCollisionFilter","B2ExamPolyCollision","B2ExamPulleys","B2ExamRope","B2ExamSegway","B2ExamSensorTest","B2ExamSparky","B2ExamTheoJansen","B2ExamTumber","B2ExamVaryingRestitution","B2ExamWaveMachine","B2ExamWeb","B2Drawer","B2EleDotRadius","B2EleSetting","B2Extend","B2ControllerExtend","B2ControllerRD","B2ControllerRS","B2ElementExtend","B2ElementRD","B2ElementRS","B2JointContext","B2JointExtend","B2JointRD","B2JointRS","B2ShapeExtend","B2ShapeRD","B2ShapeRS","Box2D","b2ChainShape","b2CircleShape","b2EdgeShape","b2PolygonShape","b2Shape","b2BroadPhase","b2CollideCircle","b2CollideEdge","b2CollidePolygon","b2Collision","b2Distance","b2DynamicTree","b2TimeOfImpact","b2BlockAllocator","b2Draw","b2GrowableStack","b2Math","b2Settings","b2StackAllocator","b2Timer","b2BuoyancyController","b2ConstantAccelController","b2ConstantForceController","b2Controller","b2GravityController","b2TensorDampingController","b2ChainAndCircleContact","b2ChainAndPolygonContact","b2CircleContact","b2Contact","b2ContactFactory","b2ContactSolver","b2EdgeAndCircleContact","b2EdgeAndPolygonContact","b2PolygonAndCircleContact","b2PolygonContact","b2AreaJoint","b2DistanceJoint","b2FrictionJoint","b2GearJoint","b2Joint","b2MotorJoint","b2MouseJoint","b2PrismaticJoint","b2PulleyJoint","b2RevoluteJoint","b2RopeJoint","b2WeldJoint","b2WheelJoint","b2Body","b2ContactManager","b2Fixture","b2Island","b2TimeStep","b2World","b2WorldCallbacks","b2Particle","b2ParticleGroup","b2ParticleSystem","b2StackQueue","b2VoronoiDiagram","b2Rope","GraphicsDrawer","RDClass","RegistDefine"]);